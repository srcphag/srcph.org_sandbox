(()=>{var n={823:(e,t,i)=>{"use strict";i.r(t);i.d(t,{ARRAY_TYPE:()=>r,EPSILON:()=>n,RANDOM:()=>s,equals:()=>u,setMatrixArrayType:()=>a,toRadian:()=>l});var n=1e-6;var r=typeof Float32Array!=="undefined"?Float32Array:Array;var s=Math.random;function a(e){r=e}var o=Math.PI/180;function l(e){return e*o}function u(e,t){return Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))}if(!Math.hypot)Math.hypot=function(){var e=0,t=arguments.length;while(t--){e+=arguments[t]*arguments[t]}return Math.sqrt(e)}},522:(e,t,i)=>{"use strict";i.r(t);i.d(t,{LDU:()=>T,add:()=>E,adjoint:()=>f,clone:()=>r,copy:()=>s,create:()=>n,determinant:()=>d,equals:()=>I,exactEquals:()=>O,frob:()=>A,fromRotation:()=>_,fromScaling:()=>b,fromValues:()=>o,identity:()=>a,invert:()=>c,mul:()=>C,multiply:()=>g,multiplyScalar:()=>S,multiplyScalarAndAdd:()=>y,rotate:()=>m,scale:()=>p,set:()=>l,str:()=>v,sub:()=>R,subtract:()=>x,transpose:()=>u});var h=i(823);function n(){var e=new h.ARRAY_TYPE(4);if(h.ARRAY_TYPE!=Float32Array){e[1]=0;e[2]=0}e[0]=1;e[3]=1;return e}function r(e){var t=new h.ARRAY_TYPE(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function s(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function a(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e}function o(e,t,i,n){var r=new h.ARRAY_TYPE(4);r[0]=e;r[1]=t;r[2]=i;r[3]=n;return r}function l(e,t,i,n,r){e[0]=t;e[1]=i;e[2]=n;e[3]=r;return e}function u(e,t){if(e===t){var i=t[1];e[1]=t[2];e[2]=i}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e}function c(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i*s-r*n;if(!a){return null}a=1/a;e[0]=s*a;e[1]=-n*a;e[2]=-r*a;e[3]=i*a;return e}function f(e,t){var i=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=i;return e}function d(e){return e[0]*e[3]-e[2]*e[1]}function g(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],u=i[2],h=i[3];e[0]=n*o+s*l;e[1]=r*o+a*l;e[2]=n*u+s*h;e[3]=r*u+a*h;return e}function m(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i);var l=Math.cos(i);e[0]=n*l+s*o;e[1]=r*l+a*o;e[2]=n*-o+s*l;e[3]=r*-o+a*l;return e}function p(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1];e[0]=n*o;e[1]=r*o;e[2]=s*l;e[3]=a*l;return e}function _(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=i;e[2]=-i;e[3]=n;return e}function b(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];return e}function v(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function A(e){return Math.hypot(e[0],e[1],e[2],e[3])}function T(e,t,i,n){e[2]=n[2]/n[0];i[0]=n[0];i[1]=n[1];i[3]=n[3]-e[2]*i[1];return[e,t,i]}function E(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function x(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function O(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function I(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(i-a)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-u)<=h.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))}function S(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function y(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;return e}var C=g;var R=x},964:(e,t,i)=>{"use strict";i.r(t);i.d(t,{add:()=>T,clone:()=>r,copy:()=>s,create:()=>n,determinant:()=>h,equals:()=>S,exactEquals:()=>I,frob:()=>A,fromRotation:()=>p,fromScaling:()=>_,fromTranslation:()=>b,fromValues:()=>o,identity:()=>a,invert:()=>u,mul:()=>y,multiply:()=>c,multiplyScalar:()=>x,multiplyScalarAndAdd:()=>O,rotate:()=>f,scale:()=>d,set:()=>l,str:()=>v,sub:()=>C,subtract:()=>E,translate:()=>m});var g=i(823);function n(){var e=new g.ARRAY_TYPE(6);if(g.ARRAY_TYPE!=Float32Array){e[1]=0;e[2]=0;e[4]=0;e[5]=0}e[0]=1;e[3]=1;return e}function r(e){var t=new g.ARRAY_TYPE(6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function s(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function a(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function o(e,t,i,n,r,s){var a=new g.ARRAY_TYPE(6);a[0]=e;a[1]=t;a[2]=i;a[3]=n;a[4]=r;a[5]=s;return a}function l(e,t,i,n,r,s,a){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;return e}function u(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5];var l=i*s-n*r;if(!l){return null}l=1/l;e[0]=s*l;e[1]=-n*l;e[2]=-r*l;e[3]=i*l;e[4]=(r*o-s*a)*l;e[5]=(n*a-i*o)*l;return e}function h(e){return e[0]*e[3]-e[1]*e[2]}function c(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1],c=i[2],f=i[3],d=i[4],g=i[5];e[0]=n*u+s*h;e[1]=r*u+a*h;e[2]=n*c+s*f;e[3]=r*c+a*f;e[4]=n*d+s*g+o;e[5]=r*d+a*g+l;return e}function f(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=Math.sin(i);var h=Math.cos(i);e[0]=n*h+s*u;e[1]=r*h+a*u;e[2]=n*-u+s*h;e[3]=r*-u+a*h;e[4]=o;e[5]=l;return e}function d(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1];e[0]=n*u;e[1]=r*u;e[2]=s*h;e[3]=a*h;e[4]=o;e[5]=l;return e}function m(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=n*u+s*h+o;e[5]=r*u+a*h+l;return e}function p(e,t){var i=Math.sin(t),n=Math.cos(t);e[0]=n;e[1]=i;e[2]=-i;e[3]=n;e[4]=0;e[5]=0;return e}function _(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];e[4]=0;e[5]=0;return e}function b(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0];e[5]=t[1];return e}function v(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function A(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function T(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];return e}function E(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];return e}function x(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;return e}function O(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;return e}function I(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function S(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5];var l=t[0],u=t[1],h=t[2],c=t[3],f=t[4],d=t[5];return Math.abs(i-l)<=g.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-u)<=g.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-h)<=g.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-c)<=g.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-f)<=g.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-d)<=g.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))}var y=c;var C=E},409:(e,t,i)=>{"use strict";i.r(t);i.d(t,{add:()=>C,adjoint:()=>f,clone:()=>s,copy:()=>a,create:()=>n,determinant:()=>d,equals:()=>w,exactEquals:()=>P,frob:()=>y,fromMat2d:()=>E,fromMat4:()=>r,fromQuat:()=>x,fromRotation:()=>v,fromScaling:()=>T,fromTranslation:()=>b,fromValues:()=>o,identity:()=>u,invert:()=>c,mul:()=>L,multiply:()=>g,multiplyScalar:()=>N,multiplyScalarAndAdd:()=>M,normalFromMat4:()=>O,projection:()=>I,rotate:()=>p,scale:()=>_,set:()=>l,str:()=>S,sub:()=>D,subtract:()=>R,translate:()=>m,transpose:()=>h});var A=i(823);function n(){var e=new A.ARRAY_TYPE(9);if(A.ARRAY_TYPE!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[5]=0;e[6]=0;e[7]=0}e[0]=1;e[4]=1;e[8]=1;return e}function r(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e}function s(e){var t=new A.ARRAY_TYPE(9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function a(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function o(e,t,i,n,r,s,a,o,l){var u=new A.ARRAY_TYPE(9);u[0]=e;u[1]=t;u[2]=i;u[3]=n;u[4]=r;u[5]=s;u[6]=a;u[7]=o;u[8]=l;return u}function l(e,t,i,n,r,s,a,o,l,u){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=u;return e}function u(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function h(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3];e[2]=t[6];e[3]=i;e[5]=t[7];e[6]=n;e[7]=r}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e}function c(e,t){var i=t[0],n=t[1],r=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],u=t[7],h=t[8];var c=h*a-o*u;var f=-h*s+o*l;var d=u*s-a*l;var g=i*c+n*f+r*d;if(!g){return null}g=1/g;e[0]=c*g;e[1]=(-h*n+r*u)*g;e[2]=(o*n-r*a)*g;e[3]=f*g;e[4]=(h*i-r*l)*g;e[5]=(-o*i+r*s)*g;e[6]=d*g;e[7]=(-u*i+n*l)*g;e[8]=(a*i-n*s)*g;return e}function f(e,t){var i=t[0],n=t[1],r=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],u=t[7],h=t[8];e[0]=a*h-o*u;e[1]=r*u-n*h;e[2]=n*o-r*a;e[3]=o*l-s*h;e[4]=i*h-r*l;e[5]=r*s-i*o;e[6]=s*u-a*l;e[7]=n*l-i*u;e[8]=i*a-n*s;return e}function d(e){var t=e[0],i=e[1],n=e[2];var r=e[3],s=e[4],a=e[5];var o=e[6],l=e[7],u=e[8];return t*(u*s-a*l)+i*(-u*r+a*o)+n*(l*r-s*o)}function g(e,t,i){var n=t[0],r=t[1],s=t[2];var a=t[3],o=t[4],l=t[5];var u=t[6],h=t[7],c=t[8];var f=i[0],d=i[1],g=i[2];var m=i[3],p=i[4],_=i[5];var b=i[6],v=i[7],A=i[8];e[0]=f*n+d*a+g*u;e[1]=f*r+d*o+g*h;e[2]=f*s+d*l+g*c;e[3]=m*n+p*a+_*u;e[4]=m*r+p*o+_*h;e[5]=m*s+p*l+_*c;e[6]=b*n+v*a+A*u;e[7]=b*r+v*o+A*h;e[8]=b*s+v*l+A*c;return e}function m(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=i[0],d=i[1];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=o;e[5]=l;e[6]=f*n+d*a+u;e[7]=f*r+d*o+h;e[8]=f*s+d*l+c;return e}function p(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=Math.sin(i),d=Math.cos(i);e[0]=d*n+f*a;e[1]=d*r+f*o;e[2]=d*s+f*l;e[3]=d*a-f*n;e[4]=d*o-f*r;e[5]=d*l-f*s;e[6]=u;e[7]=h;e[8]=c;return e}function _(e,t,i){var n=i[0],r=i[1];e[0]=n*t[0];e[1]=n*t[1];e[2]=n*t[2];e[3]=r*t[3];e[4]=r*t[4];e[5]=r*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function b(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=t[0];e[7]=t[1];e[8]=1;return e}function v(e,t){var i=Math.sin(t),n=Math.cos(t);e[0]=n;e[1]=i;e[2]=0;e[3]=-i;e[4]=n;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function T(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=t[1];e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function E(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e}function x(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i+i;var o=n+n;var l=r+r;var u=i*a;var h=n*a;var c=n*o;var f=r*a;var d=r*o;var g=r*l;var m=s*a;var p=s*o;var _=s*l;e[0]=1-c-g;e[3]=h-_;e[6]=f+p;e[1]=h+_;e[4]=1-u-g;e[7]=d-m;e[2]=f-p;e[5]=d+m;e[8]=1-u-c;return e}function O(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],m=t[13],p=t[14],_=t[15];var b=i*o-n*a;var v=i*l-r*a;var A=i*u-s*a;var T=n*l-r*o;var E=n*u-s*o;var x=r*u-s*l;var O=h*m-c*g;var I=h*p-f*g;var S=h*_-d*g;var y=c*p-f*m;var C=c*_-d*m;var R=f*_-d*p;var N=b*R-v*C+A*y+T*S-E*I+x*O;if(!N){return null}N=1/N;e[0]=(o*R-l*C+u*y)*N;e[1]=(l*S-a*R-u*I)*N;e[2]=(a*C-o*S+u*O)*N;e[3]=(r*C-n*R-s*y)*N;e[4]=(i*R-r*S+s*I)*N;e[5]=(n*S-i*C-s*O)*N;e[6]=(m*x-p*E+_*T)*N;e[7]=(p*A-g*x-_*v)*N;e[8]=(g*E-m*A+_*b)*N;return e}function I(e,t,i){e[0]=2/t;e[1]=0;e[2]=0;e[3]=0;e[4]=-2/i;e[5]=0;e[6]=-1;e[7]=1;e[8]=1;return e}function S(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function y(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function C(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];return e}function R(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];return e}function N(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;return e}function M(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;e[6]=t[6]+i[6]*n;e[7]=t[7]+i[7]*n;e[8]=t[8]+i[8]*n;return e}function P(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function w(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8];var c=t[0],f=t[1],d=t[2],g=t[3],m=t[4],p=t[5],_=t[6],b=t[7],v=t[8];return Math.abs(i-c)<=A.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-f)<=A.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=A.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-g)<=A.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-m)<=A.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-p)<=A.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-_)<=A.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-b)<=A.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(h-v)<=A.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))}var L=g;var D=R},684:(k,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>H,adjoint:()=>u,clone:()=>n,copy:()=>r,create:()=>i,determinant:()=>h,equals:()=>W,exactEquals:()=>Y,frob:()=>z,fromQuat:()=>P,fromQuat2:()=>S,fromRotation:()=>A,fromRotationTranslation:()=>I,fromRotationTranslationScale:()=>N,fromRotationTranslationScaleOrigin:()=>M,fromScaling:()=>v,fromTranslation:()=>b,fromValues:()=>s,fromXRotation:()=>T,fromYRotation:()=>E,fromZRotation:()=>O,frustum:()=>w,getRotation:()=>R,getScaling:()=>C,getTranslation:()=>y,identity:()=>x,invert:()=>l,lookAt:()=>j,mul:()=>K,multiply:()=>c,multiplyScalar:()=>X,multiplyScalarAndAdd:()=>q,ortho:()=>F,perspective:()=>U,perspectiveFromFieldOfView:()=>V,rotate:()=>g,rotateX:()=>m,rotateY:()=>p,rotateZ:()=>_,scale:()=>d,set:()=>a,str:()=>G,sub:()=>Q,subtract:()=>D,targetTo:()=>B,translate:()=>f,transpose:()=>o});var L=t(823);function i(){var e=new L.ARRAY_TYPE(16);if(L.ARRAY_TYPE!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0}e[0]=1;e[5]=1;e[10]=1;e[15]=1;return e}function n(e){var t=new L.ARRAY_TYPE(16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function r(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function s(e,t,i,n,r,s,a,o,l,u,h,c,f,d,g,m){var p=new L.ARRAY_TYPE(16);p[0]=e;p[1]=t;p[2]=i;p[3]=n;p[4]=r;p[5]=s;p[6]=a;p[7]=o;p[8]=l;p[9]=u;p[10]=h;p[11]=c;p[12]=f;p[13]=d;p[14]=g;p[15]=m;return p}function a(e,t,i,n,r,s,a,o,l,u,h,c,f,d,g,m,p){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=u;e[9]=h;e[10]=c;e[11]=f;e[12]=d;e[13]=g;e[14]=m;e[15]=p;return e}function x(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function o(e,t){if(e===t){var i=t[1],n=t[2],r=t[3];var s=t[6],a=t[7];var o=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=i;e[6]=t[9];e[7]=t[13];e[8]=n;e[9]=s;e[11]=t[14];e[12]=r;e[13]=a;e[14]=o}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e}function l(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],m=t[13],p=t[14],_=t[15];var b=i*o-n*a;var v=i*l-r*a;var A=i*u-s*a;var T=n*l-r*o;var E=n*u-s*o;var x=r*u-s*l;var O=h*m-c*g;var I=h*p-f*g;var S=h*_-d*g;var y=c*p-f*m;var C=c*_-d*m;var R=f*_-d*p;var N=b*R-v*C+A*y+T*S-E*I+x*O;if(!N){return null}N=1/N;e[0]=(o*R-l*C+u*y)*N;e[1]=(r*C-n*R-s*y)*N;e[2]=(m*x-p*E+_*T)*N;e[3]=(f*E-c*x-d*T)*N;e[4]=(l*S-a*R-u*I)*N;e[5]=(i*R-r*S+s*I)*N;e[6]=(p*A-g*x-_*v)*N;e[7]=(h*x-f*A+d*v)*N;e[8]=(a*C-o*S+u*O)*N;e[9]=(n*S-i*C-s*O)*N;e[10]=(g*E-m*A+_*b)*N;e[11]=(c*A-h*E-d*b)*N;e[12]=(o*I-a*y-l*O)*N;e[13]=(i*y-n*I+r*O)*N;e[14]=(m*v-g*T-p*b)*N;e[15]=(h*T-c*v+f*b)*N;return e}function u(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],d=t[11];var g=t[12],m=t[13],p=t[14],_=t[15];e[0]=o*(f*_-d*p)-c*(l*_-u*p)+m*(l*d-u*f);e[1]=-(n*(f*_-d*p)-c*(r*_-s*p)+m*(r*d-s*f));e[2]=n*(l*_-u*p)-o*(r*_-s*p)+m*(r*u-s*l);e[3]=-(n*(l*d-u*f)-o*(r*d-s*f)+c*(r*u-s*l));e[4]=-(a*(f*_-d*p)-h*(l*_-u*p)+g*(l*d-u*f));e[5]=i*(f*_-d*p)-h*(r*_-s*p)+g*(r*d-s*f);e[6]=-(i*(l*_-u*p)-a*(r*_-s*p)+g*(r*u-s*l));e[7]=i*(l*d-u*f)-a*(r*d-s*f)+h*(r*u-s*l);e[8]=a*(c*_-d*m)-h*(o*_-u*m)+g*(o*d-u*c);e[9]=-(i*(c*_-d*m)-h*(n*_-s*m)+g*(n*d-s*c));e[10]=i*(o*_-u*m)-a*(n*_-s*m)+g*(n*u-s*o);e[11]=-(i*(o*d-u*c)-a*(n*d-s*c)+h*(n*u-s*o));e[12]=-(a*(c*p-f*m)-h*(o*p-l*m)+g*(o*f-l*c));e[13]=i*(c*p-f*m)-h*(n*p-r*m)+g*(n*f-r*c);e[14]=-(i*(o*p-l*m)-a*(n*p-r*m)+g*(n*l-r*o));e[15]=i*(o*f-l*c)-a*(n*f-r*c)+h*(n*l-r*o);return e}function h(e){var t=e[0],i=e[1],n=e[2],r=e[3];var s=e[4],a=e[5],o=e[6],l=e[7];var u=e[8],h=e[9],c=e[10],f=e[11];var d=e[12],g=e[13],m=e[14],p=e[15];var _=t*a-i*s;var b=t*o-n*s;var v=t*l-r*s;var A=i*o-n*a;var T=i*l-r*a;var E=n*l-r*o;var x=u*g-h*d;var O=u*m-c*d;var I=u*p-f*d;var S=h*m-c*g;var y=h*p-f*g;var C=c*p-f*m;return _*C-b*y+v*S+A*I-T*O+E*x}function c(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=t[4],l=t[5],u=t[6],h=t[7];var c=t[8],f=t[9],d=t[10],g=t[11];var m=t[12],p=t[13],_=t[14],b=t[15];var v=i[0],A=i[1],T=i[2],E=i[3];e[0]=v*n+A*o+T*c+E*m;e[1]=v*r+A*l+T*f+E*p;e[2]=v*s+A*u+T*d+E*_;e[3]=v*a+A*h+T*g+E*b;v=i[4];A=i[5];T=i[6];E=i[7];e[4]=v*n+A*o+T*c+E*m;e[5]=v*r+A*l+T*f+E*p;e[6]=v*s+A*u+T*d+E*_;e[7]=v*a+A*h+T*g+E*b;v=i[8];A=i[9];T=i[10];E=i[11];e[8]=v*n+A*o+T*c+E*m;e[9]=v*r+A*l+T*f+E*p;e[10]=v*s+A*u+T*d+E*_;e[11]=v*a+A*h+T*g+E*b;v=i[12];A=i[13];T=i[14];E=i[15];e[12]=v*n+A*o+T*c+E*m;e[13]=v*r+A*l+T*f+E*p;e[14]=v*s+A*u+T*d+E*_;e[15]=v*a+A*h+T*g+E*b;return e}function f(e,t,i){var n=i[0],r=i[1],s=i[2];var a,o,l,u;var h,c,f,d;var g,m,p,_;if(t===e){e[12]=t[0]*n+t[4]*r+t[8]*s+t[12];e[13]=t[1]*n+t[5]*r+t[9]*s+t[13];e[14]=t[2]*n+t[6]*r+t[10]*s+t[14];e[15]=t[3]*n+t[7]*r+t[11]*s+t[15]}else{a=t[0];o=t[1];l=t[2];u=t[3];h=t[4];c=t[5];f=t[6];d=t[7];g=t[8];m=t[9];p=t[10];_=t[11];e[0]=a;e[1]=o;e[2]=l;e[3]=u;e[4]=h;e[5]=c;e[6]=f;e[7]=d;e[8]=g;e[9]=m;e[10]=p;e[11]=_;e[12]=a*n+h*r+g*s+t[12];e[13]=o*n+c*r+m*s+t[13];e[14]=l*n+f*r+p*s+t[14];e[15]=u*n+d*r+_*s+t[15]}return e}function d(e,t,i){var n=i[0],r=i[1],s=i[2];e[0]=t[0]*n;e[1]=t[1]*n;e[2]=t[2]*n;e[3]=t[3]*n;e[4]=t[4]*r;e[5]=t[5]*r;e[6]=t[6]*r;e[7]=t[7]*r;e[8]=t[8]*s;e[9]=t[9]*s;e[10]=t[10]*s;e[11]=t[11]*s;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function g(e,t,i,n){var r=n[0],s=n[1],a=n[2];var o=Math.hypot(r,s,a);var l,u,h;var c,f,d,g;var m,p,_,b;var v,A,T,E;var x,O,I;var S,y,C;var R,N,M;if(o<L.EPSILON){return null}o=1/o;r*=o;s*=o;a*=o;l=Math.sin(i);u=Math.cos(i);h=1-u;c=t[0];f=t[1];d=t[2];g=t[3];m=t[4];p=t[5];_=t[6];b=t[7];v=t[8];A=t[9];T=t[10];E=t[11];x=r*r*h+u;O=s*r*h+a*l;I=a*r*h-s*l;S=r*s*h-a*l;y=s*s*h+u;C=a*s*h+r*l;R=r*a*h+s*l;N=s*a*h-r*l;M=a*a*h+u;e[0]=c*x+m*O+v*I;e[1]=f*x+p*O+A*I;e[2]=d*x+_*O+T*I;e[3]=g*x+b*O+E*I;e[4]=c*S+m*y+v*C;e[5]=f*S+p*y+A*C;e[6]=d*S+_*y+T*C;e[7]=g*S+b*y+E*C;e[8]=c*R+m*N+v*M;e[9]=f*R+p*N+A*M;e[10]=d*R+_*N+T*M;e[11]=g*R+b*N+E*M;if(t!==e){e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}return e}function m(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[4];var a=t[5];var o=t[6];var l=t[7];var u=t[8];var h=t[9];var c=t[10];var f=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=s*r+u*n;e[5]=a*r+h*n;e[6]=o*r+c*n;e[7]=l*r+f*n;e[8]=u*r-s*n;e[9]=h*r-a*n;e[10]=c*r-o*n;e[11]=f*r-l*n;return e}function p(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var u=t[8];var h=t[9];var c=t[10];var f=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*r-u*n;e[1]=a*r-h*n;e[2]=o*r-c*n;e[3]=l*r-f*n;e[8]=s*n+u*r;e[9]=a*n+h*r;e[10]=o*n+c*r;e[11]=l*n+f*r;return e}function _(e,t,i){var n=Math.sin(i);var r=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var u=t[4];var h=t[5];var c=t[6];var f=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*r+u*n;e[1]=a*r+h*n;e[2]=o*r+c*n;e[3]=l*r+f*n;e[4]=u*r-s*n;e[5]=h*r-a*n;e[6]=c*r-o*n;e[7]=f*r-l*n;return e}function b(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=t[0];e[13]=t[1];e[14]=t[2];e[15]=1;return e}function v(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=t[1];e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=t[2];e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function A(e,t,i){var n=i[0],r=i[1],s=i[2];var a=Math.hypot(n,r,s);var o,l,u;if(a<L.EPSILON){return null}a=1/a;n*=a;r*=a;s*=a;o=Math.sin(t);l=Math.cos(t);u=1-l;e[0]=n*n*u+l;e[1]=r*n*u+s*o;e[2]=s*n*u-r*o;e[3]=0;e[4]=n*r*u-s*o;e[5]=r*r*u+l;e[6]=s*r*u+n*o;e[7]=0;e[8]=n*s*u+r*o;e[9]=r*s*u-n*o;e[10]=s*s*u+l;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function T(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n;e[6]=i;e[7]=0;e[8]=0;e[9]=-i;e[10]=n;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function E(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=0;e[2]=-i;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=i;e[9]=0;e[10]=n;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function O(e,t){var i=Math.sin(t);var n=Math.cos(t);e[0]=n;e[1]=i;e[2]=0;e[3]=0;e[4]=-i;e[5]=n;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function I(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=n+n;var l=r+r;var u=s+s;var h=n*o;var c=n*l;var f=n*u;var d=r*l;var g=r*u;var m=s*u;var p=a*o;var _=a*l;var b=a*u;e[0]=1-(d+m);e[1]=c+b;e[2]=f-_;e[3]=0;e[4]=c-b;e[5]=1-(h+m);e[6]=g+p;e[7]=0;e[8]=f+_;e[9]=g-p;e[10]=1-(h+d);e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function S(e,t){var i=new L.ARRAY_TYPE(3);var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7];var c=n*n+r*r+s*s+a*a;if(c>0){i[0]=(o*a+h*n+l*s-u*r)*2/c;i[1]=(l*a+h*r+u*n-o*s)*2/c;i[2]=(u*a+h*s+o*r-l*n)*2/c}else{i[0]=(o*a+h*n+l*s-u*r)*2;i[1]=(l*a+h*r+u*n-o*s)*2;i[2]=(u*a+h*s+o*r-l*n)*2}I(e,t,i);return e}function y(e,t){e[0]=t[12];e[1]=t[13];e[2]=t[14];return e}function C(e,t){var i=t[0];var n=t[1];var r=t[2];var s=t[4];var a=t[5];var o=t[6];var l=t[8];var u=t[9];var h=t[10];e[0]=Math.hypot(i,n,r);e[1]=Math.hypot(s,a,o);e[2]=Math.hypot(l,u,h);return e}function R(e,t){var i=new L.ARRAY_TYPE(3);C(i,t);var n=1/i[0];var r=1/i[1];var s=1/i[2];var a=t[0]*n;var o=t[1]*r;var l=t[2]*s;var u=t[4]*n;var h=t[5]*r;var c=t[6]*s;var f=t[8]*n;var d=t[9]*r;var g=t[10]*s;var m=a+h+g;var p=0;if(m>0){p=Math.sqrt(m+1)*2;e[3]=.25*p;e[0]=(c-d)/p;e[1]=(f-l)/p;e[2]=(o-u)/p}else if(a>h&&a>g){p=Math.sqrt(1+a-h-g)*2;e[3]=(c-d)/p;e[0]=.25*p;e[1]=(o+u)/p;e[2]=(f+l)/p}else if(h>g){p=Math.sqrt(1+h-a-g)*2;e[3]=(f-l)/p;e[0]=(o+u)/p;e[1]=.25*p;e[2]=(c+d)/p}else{p=Math.sqrt(1+g-a-h)*2;e[3]=(o-u)/p;e[0]=(f+l)/p;e[1]=(c+d)/p;e[2]=.25*p}return e}function N(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=t[3];var l=r+r;var u=s+s;var h=a+a;var c=r*l;var f=r*u;var d=r*h;var g=s*u;var m=s*h;var p=a*h;var _=o*l;var b=o*u;var v=o*h;var A=n[0];var T=n[1];var E=n[2];e[0]=(1-(g+p))*A;e[1]=(f+v)*A;e[2]=(d-b)*A;e[3]=0;e[4]=(f-v)*T;e[5]=(1-(c+p))*T;e[6]=(m+_)*T;e[7]=0;e[8]=(d+b)*E;e[9]=(m-_)*E;e[10]=(1-(c+g))*E;e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function M(e,t,i,n,r){var s=t[0],a=t[1],o=t[2],l=t[3];var u=s+s;var h=a+a;var c=o+o;var f=s*u;var d=s*h;var g=s*c;var m=a*h;var p=a*c;var _=o*c;var b=l*u;var v=l*h;var A=l*c;var T=n[0];var E=n[1];var x=n[2];var O=r[0];var I=r[1];var S=r[2];var y=(1-(m+_))*T;var C=(d+A)*T;var R=(g-v)*T;var N=(d-A)*E;var M=(1-(f+_))*E;var P=(p+b)*E;var w=(g+v)*x;var L=(p-b)*x;var D=(1-(f+m))*x;e[0]=y;e[1]=C;e[2]=R;e[3]=0;e[4]=N;e[5]=M;e[6]=P;e[7]=0;e[8]=w;e[9]=L;e[10]=D;e[11]=0;e[12]=i[0]+O-(y*O+N*I+w*S);e[13]=i[1]+I-(C*O+M*I+L*S);e[14]=i[2]+S-(R*O+P*I+D*S);e[15]=1;return e}function P(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i+i;var o=n+n;var l=r+r;var u=i*a;var h=n*a;var c=n*o;var f=r*a;var d=r*o;var g=r*l;var m=s*a;var p=s*o;var _=s*l;e[0]=1-c-g;e[1]=h+_;e[2]=f-p;e[3]=0;e[4]=h-_;e[5]=1-u-g;e[6]=d+m;e[7]=0;e[8]=f+p;e[9]=d-m;e[10]=1-u-c;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function w(e,t,i,n,r,s,a){var o=1/(i-t);var l=1/(r-n);var u=1/(s-a);e[0]=s*2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s*2*l;e[6]=0;e[7]=0;e[8]=(i+t)*o;e[9]=(r+n)*l;e[10]=(a+s)*u;e[11]=-1;e[12]=0;e[13]=0;e[14]=a*s*2*u;e[15]=0;return e}function U(e,t,i,n,r){var s=1/Math.tan(t/2),a;e[0]=s/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=-1;e[12]=0;e[13]=0;e[15]=0;if(r!=null&&r!==Infinity){a=1/(n-r);e[10]=(r+n)*a;e[14]=2*r*n*a}else{e[10]=-1;e[14]=-2*n}return e}function V(e,t,i,n){var r=Math.tan(t.upDegrees*Math.PI/180);var s=Math.tan(t.downDegrees*Math.PI/180);var a=Math.tan(t.leftDegrees*Math.PI/180);var o=Math.tan(t.rightDegrees*Math.PI/180);var l=2/(a+o);var u=2/(r+s);e[0]=l;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=u;e[6]=0;e[7]=0;e[8]=-((a-o)*l*.5);e[9]=(r-s)*u*.5;e[10]=n/(i-n);e[11]=-1;e[12]=0;e[13]=0;e[14]=n*i/(i-n);e[15]=0;return e}function F(e,t,i,n,r,s,a){var o=1/(t-i);var l=1/(n-r);var u=1/(s-a);e[0]=-2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*l;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*u;e[11]=0;e[12]=(t+i)*o;e[13]=(r+n)*l;e[14]=(a+s)*u;e[15]=1;return e}function j(e,t,i,n){var r,s,a,o,l,u,h,c,f,d;var g=t[0];var m=t[1];var p=t[2];var _=n[0];var b=n[1];var v=n[2];var A=i[0];var T=i[1];var E=i[2];if(Math.abs(g-A)<L.EPSILON&&Math.abs(m-T)<L.EPSILON&&Math.abs(p-E)<L.EPSILON){return x(e)}h=g-A;c=m-T;f=p-E;d=1/Math.hypot(h,c,f);h*=d;c*=d;f*=d;r=b*f-v*c;s=v*h-_*f;a=_*c-b*h;d=Math.hypot(r,s,a);if(!d){r=0;s=0;a=0}else{d=1/d;r*=d;s*=d;a*=d}o=c*a-f*s;l=f*r-h*a;u=h*s-c*r;d=Math.hypot(o,l,u);if(!d){o=0;l=0;u=0}else{d=1/d;o*=d;l*=d;u*=d}e[0]=r;e[1]=o;e[2]=h;e[3]=0;e[4]=s;e[5]=l;e[6]=c;e[7]=0;e[8]=a;e[9]=u;e[10]=f;e[11]=0;e[12]=-(r*g+s*m+a*p);e[13]=-(o*g+l*m+u*p);e[14]=-(h*g+c*m+f*p);e[15]=1;return e}function B(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=n[0],l=n[1],u=n[2];var h=r-i[0],c=s-i[1],f=a-i[2];var d=h*h+c*c+f*f;if(d>0){d=1/Math.sqrt(d);h*=d;c*=d;f*=d}var g=l*f-u*c,m=u*h-o*f,p=o*c-l*h;d=g*g+m*m+p*p;if(d>0){d=1/Math.sqrt(d);g*=d;m*=d;p*=d}e[0]=g;e[1]=m;e[2]=p;e[3]=0;e[4]=c*p-f*m;e[5]=f*g-h*p;e[6]=h*m-c*g;e[7]=0;e[8]=h;e[9]=c;e[10]=f;e[11]=0;e[12]=r;e[13]=s;e[14]=a;e[15]=1;return e}function G(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function z(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function H(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];e[9]=t[9]+i[9];e[10]=t[10]+i[10];e[11]=t[11]+i[11];e[12]=t[12]+i[12];e[13]=t[13]+i[13];e[14]=t[14]+i[14];e[15]=t[15]+i[15];return e}function D(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];e[9]=t[9]-i[9];e[10]=t[10]-i[10];e[11]=t[11]-i[11];e[12]=t[12]-i[12];e[13]=t[13]-i[13];e[14]=t[14]-i[14];e[15]=t[15]-i[15];return e}function X(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;e[9]=t[9]*i;e[10]=t[10]*i;e[11]=t[11]*i;e[12]=t[12]*i;e[13]=t[13]*i;e[14]=t[14]*i;e[15]=t[15]*i;return e}function q(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;e[4]=t[4]+i[4]*n;e[5]=t[5]+i[5]*n;e[6]=t[6]+i[6]*n;e[7]=t[7]+i[7]*n;e[8]=t[8]+i[8]*n;e[9]=t[9]+i[9]*n;e[10]=t[10]+i[10]*n;e[11]=t[11]+i[11]*n;e[12]=t[12]+i[12]*n;e[13]=t[13]+i[13]*n;e[14]=t[14]+i[14]*n;e[15]=t[15]+i[15]*n;return e}function Y(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function W(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=e[4],o=e[5],l=e[6],u=e[7];var h=e[8],c=e[9],f=e[10],d=e[11];var g=e[12],m=e[13],p=e[14],_=e[15];var b=t[0],v=t[1],A=t[2],T=t[3];var E=t[4],x=t[5],O=t[6],I=t[7];var S=t[8],y=t[9],C=t[10],R=t[11];var N=t[12],M=t[13],P=t[14],w=t[15];return Math.abs(i-b)<=L.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-v)<=L.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-A)<=L.EPSILON*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(s-T)<=L.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(a-E)<=L.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-x)<=L.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(l-O)<=L.EPSILON*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(u-I)<=L.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(h-S)<=L.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(c-y)<=L.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(f-C)<=L.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(d-R)<=L.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(g-N)<=L.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(m-M)<=L.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(p-P)<=L.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(_-w)<=L.EPSILON*Math.max(1,Math.abs(_),Math.abs(w))}var K=c;var Q=D},221:(k,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>N,calculateW:()=>g,clone:()=>S,conjugate:()=>E,copy:()=>C,create:()=>r,dot:()=>P,equals:()=>G,exactEquals:()=>B,exp:()=>m,fromEuler:()=>O,fromMat3:()=>x,fromValues:()=>y,getAngle:()=>u,getAxisAngle:()=>a,identity:()=>s,invert:()=>T,len:()=>F,length:()=>w,lerp:()=>V,ln:()=>p,mul:()=>U,multiply:()=>h,normalize:()=>D,pow:()=>b,random:()=>A,rotateX:()=>c,rotateY:()=>f,rotateZ:()=>d,rotationTo:()=>z,scale:()=>M,set:()=>R,setAxes:()=>X,setAxisAngle:()=>l,slerp:()=>v,sqlerp:()=>H,sqrLen:()=>j,squaredLength:()=>L,str:()=>I});var _=t(823);var i=t(409);var o=t(329);var n=t(796);function r(){var e=new _.ARRAY_TYPE(4);if(_.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0;e[2]=0}e[3]=1;return e}function s(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}function l(e,t,i){i=i*.5;var n=Math.sin(i);e[0]=n*t[0];e[1]=n*t[1];e[2]=n*t[2];e[3]=Math.cos(i);return e}function a(e,t){var i=Math.acos(t[3])*2;var n=Math.sin(i/2);if(n>_.EPSILON){e[0]=t[0]/n;e[1]=t[1]/n;e[2]=t[2]/n}else{e[0]=1;e[1]=0;e[2]=0}return i}function u(e,t){var i=P(e,t);return Math.acos(2*i*i-1)}function h(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],u=i[2],h=i[3];e[0]=n*h+a*o+r*u-s*l;e[1]=r*h+a*l+s*o-n*u;e[2]=s*h+a*u+n*l-r*o;e[3]=a*h-n*o-r*l-s*u;return e}function c(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l+a*o;e[1]=r*l+s*o;e[2]=s*l-r*o;e[3]=a*l-n*o;return e}function f(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l-s*o;e[1]=r*l+a*o;e[2]=s*l+n*o;e[3]=a*l-r*o;return e}function d(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=n*l+r*o;e[1]=r*l-n*o;e[2]=s*l+a*o;e[3]=a*l-s*o;return e}function g(e,t){var i=t[0],n=t[1],r=t[2];e[0]=i;e[1]=n;e[2]=r;e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r));return e}function m(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=Math.sqrt(i*i+n*n+r*r);var o=Math.exp(s);var l=a>0?o*Math.sin(a)/a:0;e[0]=i*l;e[1]=n*l;e[2]=r*l;e[3]=o*Math.cos(a);return e}function p(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=Math.sqrt(i*i+n*n+r*r);var o=a>0?Math.atan2(a,s)/a:0;e[0]=i*o;e[1]=n*o;e[2]=r*o;e[3]=.5*Math.log(i*i+n*n+r*r+s*s);return e}function b(e,t,i){p(e,t);M(e,e,i);m(e,e);return e}function v(e,t,i,n){var r=t[0],s=t[1],a=t[2],o=t[3];var l=i[0],u=i[1],h=i[2],c=i[3];var f,d,g,m,p;d=r*l+s*u+a*h+o*c;if(d<0){d=-d;l=-l;u=-u;h=-h;c=-c}if(1-d>_.EPSILON){f=Math.acos(d);g=Math.sin(f);m=Math.sin((1-n)*f)/g;p=Math.sin(n*f)/g}else{m=1-n;p=n}e[0]=m*r+p*l;e[1]=m*s+p*u;e[2]=m*a+p*h;e[3]=m*o+p*c;return e}function A(e){var t=_.RANDOM();var i=_.RANDOM();var n=_.RANDOM();var r=Math.sqrt(1-t);var s=Math.sqrt(t);e[0]=r*Math.sin(2*Math.PI*i);e[1]=r*Math.cos(2*Math.PI*i);e[2]=s*Math.sin(2*Math.PI*n);e[3]=s*Math.cos(2*Math.PI*n);return e}function T(e,t){var i=t[0],n=t[1],r=t[2],s=t[3];var a=i*i+n*n+r*r+s*s;var o=a?1/a:0;e[0]=-i*o;e[1]=-n*o;e[2]=-r*o;e[3]=s*o;return e}function E(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e}function x(e,t){var i=t[0]+t[4]+t[8];var n;if(i>0){n=Math.sqrt(i+1);e[3]=.5*n;n=.5/n;e[0]=(t[5]-t[7])*n;e[1]=(t[6]-t[2])*n;e[2]=(t[1]-t[3])*n}else{var r=0;if(t[4]>t[0])r=1;if(t[8]>t[r*3+r])r=2;var s=(r+1)%3;var a=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[s*3+s]-t[a*3+a]+1);e[r]=.5*n;n=.5/n;e[3]=(t[s*3+a]-t[a*3+s])*n;e[s]=(t[s*3+r]+t[r*3+s])*n;e[a]=(t[a*3+r]+t[r*3+a])*n}return e}function O(e,t,i,n){var r=.5*Math.PI/180;t*=r;i*=r;n*=r;var s=Math.sin(t);var a=Math.cos(t);var o=Math.sin(i);var l=Math.cos(i);var u=Math.sin(n);var h=Math.cos(n);e[0]=s*l*h-a*o*u;e[1]=a*o*h+s*l*u;e[2]=a*l*u-s*o*h;e[3]=a*l*h+s*o*u;return e}function I(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var S=n.clone;var y=n.fromValues;var C=n.copy;var R=n.set;var N=n.add;var U=h;var M=n.scale;var P=n.dot;var V=n.lerp;var w=n.length;var F=w;var L=n.squaredLength;var j=L;var D=n.normalize;var B=n.exactEquals;var G=n.equals;var z=function(){var r=o.create();var s=o.fromValues(1,0,0);var a=o.fromValues(0,1,0);return function(e,t,i){var n=o.dot(t,i);if(n<-.999999){o.cross(r,s,t);if(o.len(r)<1e-6)o.cross(r,a,t);o.normalize(r,r);l(e,r,Math.PI);return e}else if(n>.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}else{o.cross(r,t,i);e[0]=r[0];e[1]=r[1];e[2]=r[2];e[3]=1+n;return D(e,e)}}}();var H=function(){var a=r();var o=r();return function(e,t,i,n,r,s){v(a,t,r,s);v(o,i,n,s);v(e,a,o,2*s*(1-s));return e}}();var X=function(){var r=i.create();return function(e,t,i,n){r[0]=i[0];r[3]=i[1];r[6]=i[2];r[1]=n[0];r[4]=n[1];r[7]=n[2];r[2]=-t[0];r[5]=-t[1];r[8]=-t[2];return D(e,x(e,r))}}()},991:(k,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>C,clone:()=>n,conjugate:()=>V,copy:()=>v,create:()=>i,dot:()=>P,equals:()=>H,exactEquals:()=>z,fromMat4:()=>h,fromRotation:()=>u,fromRotationTranslation:()=>o,fromRotationTranslationValues:()=>a,fromTranslation:()=>l,fromValues:()=>s,getDual:()=>g,getReal:()=>d,getTranslation:()=>A,identity:()=>c,invert:()=>U,len:()=>F,length:()=>L,lerp:()=>w,mul:()=>N,multiply:()=>R,normalize:()=>B,rotateAroundAxis:()=>y,rotateByQuatAppend:()=>I,rotateByQuatPrepend:()=>S,rotateX:()=>E,rotateY:()=>x,rotateZ:()=>O,scale:()=>M,set:()=>f,setDual:()=>_,setReal:()=>p,sqrLen:()=>j,squaredLength:()=>D,str:()=>G,translate:()=>T});var b=t(823);var m=t(221);var r=t(684);function i(){var e=new b.ARRAY_TYPE(8);if(b.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0}e[3]=1;return e}function n(e){var t=new b.ARRAY_TYPE(8);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];return t}function s(e,t,i,n,r,s,a,o){var l=new b.ARRAY_TYPE(8);l[0]=e;l[1]=t;l[2]=i;l[3]=n;l[4]=r;l[5]=s;l[6]=a;l[7]=o;return l}function a(e,t,i,n,r,s,a){var o=new b.ARRAY_TYPE(8);o[0]=e;o[1]=t;o[2]=i;o[3]=n;var l=r*.5,u=s*.5,h=a*.5;o[4]=l*n+u*i-h*t;o[5]=u*n+h*e-l*i;o[6]=h*n+l*t-u*e;o[7]=-l*e-u*t-h*i;return o}function o(e,t,i){var n=i[0]*.5,r=i[1]*.5,s=i[2]*.5,a=t[0],o=t[1],l=t[2],u=t[3];e[0]=a;e[1]=o;e[2]=l;e[3]=u;e[4]=n*u+r*l-s*o;e[5]=r*u+s*a-n*l;e[6]=s*u+n*o-r*a;e[7]=-n*a-r*o-s*l;return e}function l(e,t){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0]*.5;e[5]=t[1]*.5;e[6]=t[2]*.5;e[7]=0;return e}function u(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function h(e,t){var i=m.create();r.getRotation(i,t);var n=new b.ARRAY_TYPE(3);r.getTranslation(n,t);o(e,i,n);return e}function v(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];return e}function c(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function f(e,t,i,n,r,s,a,o,l){e[0]=t;e[1]=i;e[2]=n;e[3]=r;e[4]=s;e[5]=a;e[6]=o;e[7]=l;return e}var d=m.copy;function g(e,t){e[0]=t[4];e[1]=t[5];e[2]=t[6];e[3]=t[7];return e}var p=m.copy;function _(e,t){e[4]=t[0];e[5]=t[1];e[6]=t[2];e[7]=t[3];return e}function A(e,t){var i=t[4],n=t[5],r=t[6],s=t[7],a=-t[0],o=-t[1],l=-t[2],u=t[3];e[0]=(i*u+s*a+n*l-r*o)*2;e[1]=(n*u+s*o+r*a-i*l)*2;e[2]=(r*u+s*l+i*o-n*a)*2;return e}function T(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[0]*.5,l=i[1]*.5,u=i[2]*.5,h=t[4],c=t[5],f=t[6],d=t[7];e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=a*o+r*u-s*l+h;e[5]=a*l+s*o-n*u+c;e[6]=a*u+n*l-r*o+f;e[7]=-n*o-r*l-s*u+d;return e}function E(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*n+l*s-u*r,f=l*a+h*r+u*n-o*s,d=u*a+h*s+o*r-l*n,g=h*a-o*n-l*r-u*s;m.rotateX(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function x(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*n+l*s-u*r,f=l*a+h*r+u*n-o*s,d=u*a+h*s+o*r-l*n,g=h*a-o*n-l*r-u*s;m.rotateY(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function O(e,t,i){var n=-t[0],r=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*n+l*s-u*r,f=l*a+h*r+u*n-o*s,d=u*a+h*s+o*r-l*n,g=h*a-o*n-l*r-u*s;m.rotateZ(e,t,i);n=e[0];r=e[1];s=e[2];a=e[3];e[4]=c*a+g*n+f*s-d*r;e[5]=f*a+g*r+d*n-c*s;e[6]=d*a+g*s+c*r-f*n;e[7]=g*a-c*n-f*r-d*s;return e}function I(e,t,i){var n=i[0],r=i[1],s=i[2],a=i[3],o=t[0],l=t[1],u=t[2],h=t[3];e[0]=o*a+h*n+l*s-u*r;e[1]=l*a+h*r+u*n-o*s;e[2]=u*a+h*s+o*r-l*n;e[3]=h*a-o*n-l*r-u*s;o=t[4];l=t[5];u=t[6];h=t[7];e[4]=o*a+h*n+l*s-u*r;e[5]=l*a+h*r+u*n-o*s;e[6]=u*a+h*s+o*r-l*n;e[7]=h*a-o*n-l*r-u*s;return e}function S(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[0],l=i[1],u=i[2],h=i[3];e[0]=n*h+a*o+r*u-s*l;e[1]=r*h+a*l+s*o-n*u;e[2]=s*h+a*u+n*l-r*o;e[3]=a*h-n*o-r*l-s*u;o=i[4];l=i[5];u=i[6];h=i[7];e[4]=n*h+a*o+r*u-s*l;e[5]=r*h+a*l+s*o-n*u;e[6]=s*h+a*u+n*l-r*o;e[7]=a*h-n*o-r*l-s*u;return e}function y(e,t,i,n){if(Math.abs(n)<b.EPSILON){return v(e,t)}var r=Math.hypot(i[0],i[1],i[2]);n=n*.5;var s=Math.sin(n);var a=s*i[0]/r;var o=s*i[1]/r;var l=s*i[2]/r;var u=Math.cos(n);var h=t[0],c=t[1],f=t[2],d=t[3];e[0]=h*u+d*a+c*l-f*o;e[1]=c*u+d*o+f*a-h*l;e[2]=f*u+d*l+h*o-c*a;e[3]=d*u-h*a-c*o-f*l;var g=t[4],m=t[5],p=t[6],_=t[7];e[4]=g*u+_*a+m*l-p*o;e[5]=m*u+_*o+p*a-g*l;e[6]=p*u+_*l+g*o-m*a;e[7]=_*u-g*a-m*o-p*l;return e}function C(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];return e}function R(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=i[4],l=i[5],u=i[6],h=i[7],c=t[4],f=t[5],d=t[6],g=t[7],m=i[0],p=i[1],_=i[2],b=i[3];e[0]=n*b+a*m+r*_-s*p;e[1]=r*b+a*p+s*m-n*_;e[2]=s*b+a*_+n*p-r*m;e[3]=a*b-n*m-r*p-s*_;e[4]=n*h+a*o+r*u-s*l+c*b+g*m+f*_-d*p;e[5]=r*h+a*l+s*o-n*u+f*b+g*p+d*m-c*_;e[6]=s*h+a*u+n*l-r*o+d*b+g*_+c*p-f*m;e[7]=a*h-n*o-r*l-s*u+g*b-c*m-f*p-d*_;return e}var N=R;function M(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;return e}var P=m.dot;function w(e,t,i,n){var r=1-n;if(P(t,i)<0)n=-n;e[0]=t[0]*r+i[0]*n;e[1]=t[1]*r+i[1]*n;e[2]=t[2]*r+i[2]*n;e[3]=t[3]*r+i[3]*n;e[4]=t[4]*r+i[4]*n;e[5]=t[5]*r+i[5]*n;e[6]=t[6]*r+i[6]*n;e[7]=t[7]*r+i[7]*n;return e}function U(e,t){var i=D(t);e[0]=-t[0]/i;e[1]=-t[1]/i;e[2]=-t[2]/i;e[3]=t[3]/i;e[4]=-t[4]/i;e[5]=-t[5]/i;e[6]=-t[6]/i;e[7]=t[7]/i;return e}function V(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];e[4]=-t[4];e[5]=-t[5];e[6]=-t[6];e[7]=t[7];return e}var L=m.length;var F=L;var D=m.squaredLength;var j=D;function B(e,t){var i=D(t);if(i>0){i=Math.sqrt(i);var n=t[0]/i;var r=t[1]/i;var s=t[2]/i;var a=t[3]/i;var o=t[4];var l=t[5];var u=t[6];var h=t[7];var c=n*o+r*l+s*u+a*h;e[0]=n;e[1]=r;e[2]=s;e[3]=a;e[4]=(o-n*c)/i;e[5]=(l-r*c)/i;e[6]=(u-s*c)/i;e[7]=(h-a*c)/i}return e}function G(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function z(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function H(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7];var h=t[0],c=t[1],f=t[2],d=t[3],g=t[4],m=t[5],p=t[6],_=t[7];return Math.abs(i-h)<=b.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-c)<=b.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-f)<=b.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-d)<=b.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-g)<=b.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-m)<=b.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-p)<=b.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(u-_)<=b.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))}},842:(k,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>l,angle:()=>D,ceil:()=>f,clone:()=>n,copy:()=>s,create:()=>i,cross:()=>y,dist:()=>X,distance:()=>v,div:()=>H,divide:()=>c,dot:()=>S,equals:()=>j,exactEquals:()=>F,floor:()=>d,forEach:()=>W,fromValues:()=>r,inverse:()=>O,len:()=>B,length:()=>T,lerp:()=>C,max:()=>m,min:()=>g,mul:()=>z,multiply:()=>h,negate:()=>x,normalize:()=>I,random:()=>R,rotate:()=>L,round:()=>p,scale:()=>_,scaleAndAdd:()=>b,set:()=>o,sqrDist:()=>q,sqrLen:()=>Y,squaredDistance:()=>A,squaredLength:()=>E,str:()=>V,sub:()=>G,subtract:()=>u,transformMat2:()=>N,transformMat2d:()=>M,transformMat3:()=>P,transformMat4:()=>w,zero:()=>U});var a=t(823);function i(){var e=new a.ARRAY_TYPE(2);if(a.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0}return e}function n(e){var t=new a.ARRAY_TYPE(2);t[0]=e[0];t[1]=e[1];return t}function r(e,t){var i=new a.ARRAY_TYPE(2);i[0]=e;i[1]=t;return i}function s(e,t){e[0]=t[0];e[1]=t[1];return e}function o(e,t,i){e[0]=t;e[1]=i;return e}function l(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];return e}function u(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];return e}function h(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];return e}function c(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];return e}function f(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);return e}function d(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);return e}function g(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);return e}function m(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);return e}function p(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);return e}function _(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;return e}function b(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;return e}function v(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.hypot(i,n)}function A(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function T(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function E(e){var t=e[0],i=e[1];return t*t+i*i}function x(e,t){e[0]=-t[0];e[1]=-t[1];return e}function O(e,t){e[0]=1/t[0];e[1]=1/t[1];return e}function I(e,t){var i=t[0],n=t[1];var r=i*i+n*n;if(r>0){r=1/Math.sqrt(r)}e[0]=t[0]*r;e[1]=t[1]*r;return e}function S(e,t){return e[0]*t[0]+e[1]*t[1]}function y(e,t,i){var n=t[0]*i[1]-t[1]*i[0];e[0]=e[1]=0;e[2]=n;return e}function C(e,t,i,n){var r=t[0],s=t[1];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);return e}function R(e,t){t=t||1;var i=a.RANDOM()*2*Math.PI;e[0]=Math.cos(i)*t;e[1]=Math.sin(i)*t;return e}function N(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r;e[1]=i[1]*n+i[3]*r;return e}function M(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r+i[4];e[1]=i[1]*n+i[3]*r+i[5];return e}function P(e,t,i){var n=t[0],r=t[1];e[0]=i[0]*n+i[3]*r+i[6];e[1]=i[1]*n+i[4]*r+i[7];return e}function w(e,t,i){var n=t[0];var r=t[1];e[0]=i[0]*n+i[4]*r+i[12];e[1]=i[1]*n+i[5]*r+i[13];return e}function L(e,t,i,n){var r=t[0]-i[0],s=t[1]-i[1],a=Math.sin(n),o=Math.cos(n);e[0]=r*o-s*a+i[0];e[1]=r*a+s*o+i[1];return e}function D(e,t){var i=e[0],n=e[1],r=t[0],s=t[1];var a=i*i+n*n;if(a>0){a=1/Math.sqrt(a)}var o=r*r+s*s;if(o>0){o=1/Math.sqrt(o)}var l=(i*r+n*s)*a*o;if(l>1){return 0}else if(l<-1){return Math.PI}else{return Math.acos(l)}}function U(e){e[0]=0;e[1]=0;return e}function V(e){return"vec2("+e[0]+", "+e[1]+")"}function F(e,t){return e[0]===t[0]&&e[1]===t[1]}function j(e,t){var i=e[0],n=e[1];var r=t[0],s=t[1];return Math.abs(i-r)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))}var B=T;var G=u;var z=h;var H=c;var X=v;var q=A;var Y=E;var W=function(){var l=i();return function(e,t,i,n,r,s){var a,o;if(!t){t=2}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];r(l,l,s);e[a]=l[0];e[a+1]=l[1]}return e}}()},329:(k,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>u,angle:()=>F,bezier:()=>N,ceil:()=>d,clone:()=>n,copy:()=>a,create:()=>i,cross:()=>y,dist:()=>Y,distance:()=>A,div:()=>q,divide:()=>f,dot:()=>S,equals:()=>z,exactEquals:()=>G,floor:()=>g,forEach:()=>Z,fromValues:()=>s,hermite:()=>R,inverse:()=>O,len:()=>K,length:()=>r,lerp:()=>C,max:()=>p,min:()=>m,mul:()=>X,multiply:()=>c,negate:()=>x,normalize:()=>I,random:()=>M,rotateX:()=>D,rotateY:()=>U,rotateZ:()=>V,round:()=>_,scale:()=>b,scaleAndAdd:()=>v,set:()=>o,sqrDist:()=>W,sqrLen:()=>Q,squaredDistance:()=>T,squaredLength:()=>E,str:()=>B,sub:()=>H,subtract:()=>h,transformMat3:()=>w,transformMat4:()=>P,transformQuat:()=>L,zero:()=>j});var l=t(823);function i(){var e=new l.ARRAY_TYPE(3);if(l.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0;e[2]=0}return e}function n(e){var t=new l.ARRAY_TYPE(3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t}function r(e){var t=e[0];var i=e[1];var n=e[2];return Math.hypot(t,i,n)}function s(e,t,i){var n=new l.ARRAY_TYPE(3);n[0]=e;n[1]=t;n[2]=i;return n}function a(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e}function o(e,t,i,n){e[0]=t;e[1]=i;e[2]=n;return e}function u(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];return e}function h(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];return e}function c(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];return e}function f(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];return e}function d(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);return e}function g(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);return e}function m(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);return e}function p(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);return e}function _(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);return e}function b(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;return e}function v(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;return e}function A(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];return Math.hypot(i,n,r)}function T(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];return i*i+n*n+r*r}function E(e){var t=e[0];var i=e[1];var n=e[2];return t*t+i*i+n*n}function x(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e}function O(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];return e}function I(e,t){var i=t[0];var n=t[1];var r=t[2];var s=i*i+n*n+r*r;if(s>0){s=1/Math.sqrt(s)}e[0]=t[0]*s;e[1]=t[1]*s;e[2]=t[2]*s;return e}function S(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function y(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[0],o=i[1],l=i[2];e[0]=r*l-s*o;e[1]=s*a-n*l;e[2]=n*o-r*a;return e}function C(e,t,i,n){var r=t[0];var s=t[1];var a=t[2];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);e[2]=a+n*(i[2]-a);return e}function R(e,t,i,n,r,s){var a=s*s;var o=a*(2*s-3)+1;var l=a*(s-2)+s;var u=a*(s-1);var h=a*(3-2*s);e[0]=t[0]*o+i[0]*l+n[0]*u+r[0]*h;e[1]=t[1]*o+i[1]*l+n[1]*u+r[1]*h;e[2]=t[2]*o+i[2]*l+n[2]*u+r[2]*h;return e}function N(e,t,i,n,r,s){var a=1-s;var o=a*a;var l=s*s;var u=o*a;var h=3*s*o;var c=3*l*a;var f=l*s;e[0]=t[0]*u+i[0]*h+n[0]*c+r[0]*f;e[1]=t[1]*u+i[1]*h+n[1]*c+r[1]*f;e[2]=t[2]*u+i[2]*h+n[2]*c+r[2]*f;return e}function M(e,t){t=t||1;var i=l.RANDOM()*2*Math.PI;var n=l.RANDOM()*2-1;var r=Math.sqrt(1-n*n)*t;e[0]=Math.cos(i)*r;e[1]=Math.sin(i)*r;e[2]=n*t;return e}function P(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[3]*n+i[7]*r+i[11]*s+i[15];a=a||1;e[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/a;e[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/a;e[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/a;return e}function w(e,t,i){var n=t[0],r=t[1],s=t[2];e[0]=n*i[0]+r*i[3]+s*i[6];e[1]=n*i[1]+r*i[4]+s*i[7];e[2]=n*i[2]+r*i[5]+s*i[8];return e}function L(e,t,i){var n=i[0],r=i[1],s=i[2],a=i[3];var o=t[0],l=t[1],u=t[2];var h=r*u-s*l,c=s*o-n*u,f=n*l-r*o;var d=r*f-s*c,g=s*h-n*f,m=n*c-r*h;var p=a*2;h*=p;c*=p;f*=p;d*=2;g*=2;m*=2;e[0]=o+h+d;e[1]=l+c+g;e[2]=u+f+m;return e}function D(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[0];s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n);s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function U(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n);s[1]=r[1];s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function V(e,t,i,n){var r=[],s=[];r[0]=t[0]-i[0];r[1]=t[1]-i[1];r[2]=t[2]-i[2];s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n);s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n);s[2]=r[2];e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function F(e,t){var i=s(e[0],e[1],e[2]);var n=s(t[0],t[1],t[2]);I(i,i);I(n,n);var r=S(i,n);if(r>1){return 0}else if(r<-1){return Math.PI}else{return Math.acos(r)}}function j(e){e[0]=0;e[1]=0;e[2]=0;return e}function B(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function z(e,t){var i=e[0],n=e[1],r=e[2];var s=t[0],a=t[1],o=t[2];return Math.abs(i-s)<=l.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))}var H=h;var X=c;var q=f;var Y=A;var W=T;var K=r;var Q=E;var Z=function(){var l=i();return function(e,t,i,n,r,s){var a,o;if(!t){t=3}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];r(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2]}return e}}()},796:(k,e,t)=>{"use strict";t.r(e);t.d(e,{add:()=>o,ceil:()=>f,clone:()=>n,copy:()=>s,create:()=>i,cross:()=>y,dist:()=>j,distance:()=>v,div:()=>F,divide:()=>c,dot:()=>S,equals:()=>D,exactEquals:()=>L,floor:()=>d,forEach:()=>H,fromValues:()=>r,inverse:()=>O,len:()=>G,length:()=>T,lerp:()=>C,max:()=>m,min:()=>g,mul:()=>V,multiply:()=>u,negate:()=>x,normalize:()=>I,random:()=>R,round:()=>p,scale:()=>_,scaleAndAdd:()=>b,set:()=>a,sqrDist:()=>B,sqrLen:()=>z,squaredDistance:()=>A,squaredLength:()=>E,str:()=>w,sub:()=>U,subtract:()=>l,transformMat4:()=>N,transformQuat:()=>M,zero:()=>P});var h=t(823);function i(){var e=new h.ARRAY_TYPE(4);if(h.ARRAY_TYPE!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[3]=0}return e}function n(e){var t=new h.ARRAY_TYPE(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function r(e,t,i,n){var r=new h.ARRAY_TYPE(4);r[0]=e;r[1]=t;r[2]=i;r[3]=n;return r}function s(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function a(e,t,i,n,r){e[0]=t;e[1]=i;e[2]=n;e[3]=r;return e}function o(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function l(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function u(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];e[3]=t[3]*i[3];return e}function c(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];e[3]=t[3]/i[3];return e}function f(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);e[3]=Math.ceil(t[3]);return e}function d(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);e[3]=Math.floor(t[3]);return e}function g(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);e[3]=Math.min(t[3],i[3]);return e}function m(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);e[3]=Math.max(t[3],i[3]);return e}function p(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);e[3]=Math.round(t[3]);return e}function _(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function b(e,t,i,n){e[0]=t[0]+i[0]*n;e[1]=t[1]+i[1]*n;e[2]=t[2]+i[2]*n;e[3]=t[3]+i[3]*n;return e}function v(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];var s=t[3]-e[3];return Math.hypot(i,n,r,s)}function A(e,t){var i=t[0]-e[0];var n=t[1]-e[1];var r=t[2]-e[2];var s=t[3]-e[3];return i*i+n*n+r*r+s*s}function T(e){var t=e[0];var i=e[1];var n=e[2];var r=e[3];return Math.hypot(t,i,n,r)}function E(e){var t=e[0];var i=e[1];var n=e[2];var r=e[3];return t*t+i*i+n*n+r*r}function x(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e}function O(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];e[3]=1/t[3];return e}function I(e,t){var i=t[0];var n=t[1];var r=t[2];var s=t[3];var a=i*i+n*n+r*r+s*s;if(a>0){a=1/Math.sqrt(a)}e[0]=i*a;e[1]=n*a;e[2]=r*a;e[3]=s*a;return e}function S(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function y(e,t,i,n){var r=i[0]*n[1]-i[1]*n[0],s=i[0]*n[2]-i[2]*n[0],a=i[0]*n[3]-i[3]*n[0],o=i[1]*n[2]-i[2]*n[1],l=i[1]*n[3]-i[3]*n[1],u=i[2]*n[3]-i[3]*n[2];var h=t[0];var c=t[1];var f=t[2];var d=t[3];e[0]=c*u-f*l+d*o;e[1]=-(h*u)+f*a-d*s;e[2]=h*l-c*a+d*r;e[3]=-(h*o)+c*s-f*r;return e}function C(e,t,i,n){var r=t[0];var s=t[1];var a=t[2];var o=t[3];e[0]=r+n*(i[0]-r);e[1]=s+n*(i[1]-s);e[2]=a+n*(i[2]-a);e[3]=o+n*(i[3]-o);return e}function R(e,t){t=t||1;var i,n,r,s;var a,o;do{i=h.RANDOM()*2-1;n=h.RANDOM()*2-1;a=i*i+n*n}while(a>=1);do{r=h.RANDOM()*2-1;s=h.RANDOM()*2-1;o=r*r+s*s}while(o>=1);var l=Math.sqrt((1-a)/o);e[0]=t*i;e[1]=t*n;e[2]=t*r*l;e[3]=t*s*l;return e}function N(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3];e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*a;e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*a;e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*a;e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*a;return e}function M(e,t,i){var n=t[0],r=t[1],s=t[2];var a=i[0],o=i[1],l=i[2],u=i[3];var h=u*n+o*s-l*r;var c=u*r+l*n-a*s;var f=u*s+a*r-o*n;var d=-a*n-o*r-l*s;e[0]=h*u+d*-a+c*-l-f*-o;e[1]=c*u+d*-o+f*-a-h*-l;e[2]=f*u+d*-l+h*-o-c*-a;e[3]=t[3];return e}function P(e){e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e}function w(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function L(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function D(e,t){var i=e[0],n=e[1],r=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(i-a)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-u)<=h.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))}var U=l;var V=u;var F=c;var j=v;var B=A;var G=T;var z=E;var H=function(){var l=i();return function(e,t,i,n,r,s){var a,o;if(!t){t=4}if(!i){i=0}if(n){o=Math.min(n*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];l[3]=e[a+3];r(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2];e[a+3]=l[3]}return e}}()},344:(e,t,i)=>{"use strict";i.d(t,{k:()=>h});var n=i(125);var r=i(849);var s=i(562);var a=i(963);class h extends n.A{static EVENT_KEY_DELETE="keyDelete";static EVENT_CHANGE="onChange";static EVENT_UIATTRIB_CHANGE="uiattrchange";static LOOP_OFF=0;static LOOP_REPEAT=1;static LOOP_MIRROR=2;static LOOP_OFFSET=3;static EASING_LINEAR=0;static EASING_ABSOLUTE=1;static EASING_SMOOTHSTEP=2;static EASING_SMOOTHERSTEP=3;static EASING_CUBICSPLINE=4;static EASING_CUBIC_IN=5;static EASING_CUBIC_OUT=6;static EASING_CUBIC_INOUT=7;static EASING_EXPO_IN=8;static EASING_EXPO_OUT=9;static EASING_EXPO_INOUT=10;static EASING_SIN_IN=11;static EASING_SIN_OUT=12;static EASING_SIN_INOUT=13;static EASING_BACK_IN=14;static EASING_BACK_OUT=15;static EASING_BACK_INOUT=16;static EASING_ELASTIC_IN=17;static EASING_ELASTIC_OUT=18;static EASING_BOUNCE_IN=19;static EASING_BOUNCE_OUT=21;static EASING_QUART_IN=22;static EASING_QUART_OUT=23;static EASING_QUART_INOUT=24;static EASING_QUINT_IN=25;static EASING_QUINT_OUT=26;static EASING_QUINT_INOUT=27;static EASING_CLIP=28;static EASINGNAMES=["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out","Clip"];#tlActive=true;uiAttribs={};loop=0;onLooped=null;_timesLooped=0;#needsSort=false;_cachedIndex=0;port=null;keys=[];onChange=null;stayInTimeline=false;batchMode=false;constructor(e={}){super();e=e||{};this.id=(0,s.uuid)();this._log=new r.A("Anim");this.name=e.name||null;this.defaultEasing=e.defaultEasing||h.EASING_LINEAR}forceChangeCallback(){if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this)}forceChangeCallbackSoon(){if(this.batchMode)return;if(!this.forcecbto)this.forcecbto=setTimeout(()=>{this.forceChangeCallback();this.forcecbto=null},50)}getLoop(){return this.loop}setLoop(e){if(e===false)e=0;if(e===true)e=1;this.loop=e;this.emitEvent(h.EVENT_CHANGE,this)}hasEnded(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return true;if(this.keys[this.keys.length-1].time<=e)return true;return false}hasStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return false;if(e>=this.keys[0].time)return true;return false}isRising(e){if(this.#needsSort)this.sortKeys();if(this.hasEnded(e))return false;const t=this.getKeyIndex(e);if(this.keys[t].value<this.keys[t+1].value)return true;return false}clearBefore(e){if(this.#needsSort)this.sortKeys();const t=this.getValue(e);const i=this.getKeyIndex(e);this.setValue(e,t);if(i>1){this.keys.splice(0,i);this.#needsSort=true}}clear(e){if(this.#needsSort)this.sortKeys();let t=0;if(e)t=this.getValue(e);for(let e=0;e<this.keys.length;e++)this.emitEvent(h.EVENT_KEY_DELETE,this.keys[e]);this.keys.length=0;if(e)this.setValue(e,t);this.#needsSort=true;if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this)}checkIsSorted(){let t=true;for(let e=0;e<this.keys.length-1;e++)if(this.keys[e].time>this.keys[e+1].time){t=false;break}return t}sortKeys(){if(this.batchMode)return;if(!this.checkIsSorted()){this.keys.sort((e,t)=>{return e.time-t.time});this.#needsSort=false;if(this.keys.length>999&&this.keys.length%1e3==0)console.log(this.name,this.keys.length);this.emitEvent(h.EVENT_CHANGE)}}hasDuplicates(){const t={};let i=0;for(let e=0;e<this.keys.length;e++){t[this.keys[e].time]=1;i++}const e=Object.keys(t);if(e.length!=i){return true}return false}removeDuplicates(){if(this.hasDuplicates()){if(this.#needsSort)this.sortKeys();let t=0;while(this.hasDuplicates()){for(let e=0;e<this.keys.length-1;e++){if(this.keys[e].time==this.keys[e+1].time){const i=this.keys[e];this.keys.splice(e,1);this.emitEvent(h.EVENT_KEY_DELETE,i)}t++}}this.#needsSort=true}}getLengthLoop(){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return this.lastKey.time-this.firstKey.time}getLength(){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return 0;return this.lastKey.time}getKeyIndex(t){if(this.#needsSort)this.sortKeys();let i=0;let n=0;if(this._cachedIndex&&this.keys.length>this._cachedIndex&&t>=this.keys[this._cachedIndex].time)n=this._cachedIndex;for(let e=n;e<this.keys.length;e++){if(t>=this.keys[e].time)i=e;if(this.keys[e].time>t){if(t!=0)this._cachedIndex=i;return i}}return i}setValue(t,i,n=null){if(isNaN(i))CABLES.logStack();if(this.#needsSort)this.sortKeys();let r=null;if(!this.batchMode)if(this.keys.length==0||t<=this.lastKey.time)for(let e=0;e<this.keys.length;e++)if(this.keys[e].time==t){r=this.keys[e];this.keys[e].setValue(i);this.keys[e].cb=n;break}if(!r){r=new a.rA({time:t,value:i,e:this.defaultEasing,cb:n,anim:this});this.keys.push(r)}if(!this.batchMode){if(this.onChange)this.onChange();this.emitEvent(h.EVENT_CHANGE,this);this.#needsSort=true}return r}setKeyEasing(e,t){if(this.keys[e]){this.keys[e].setEasing(t);this.emitEvent(h.EVENT_CHANGE,this)}}deserialize(t,e,i){if(t.loop)this.loop=t.loop;if(t.tlActive)this.#tlActive=t.tlActive;if(t.height)this.uiAttribs.height=t.height;if(e){while(this.keys.length)this.keys[0].delete();this.keys.length=0}for(const n in t.keys){let e=new a.rA(t.keys[n],this);this.keys.push(e);if(i)if(t.keys[n].clipId){i[t.keys[n].clipId]=i[t.keys[n].clipId]||[];if(i)i[t.keys[n].clipId].push(e)}}this.sortKeys()}getSerialized(){const t={};t.keys=[];t.loop=this.loop;if(this.#tlActive)t.tlActive=this.tlActive;if(this.uiAttribs.height)t.height=this.uiAttribs.height;for(let e=0;e<this.keys.length;e++)t.keys.push(this.keys[e].getSerialized());return t}getKey(e){if(this.#needsSort)this.sortKeys();const t=this.getKeyIndex(e);return this.keys[t]}getNextKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)+1;if(t>=this.keys.length)return null;return this.keys[t]}getPrevKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)-1;if(t<0)return null;return this.keys[t]}isFinished(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return true;return e>this.lastKey.time}isStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return false;return e>=this.firstKey.time}remove(t,i){for(let e=0;e<this.keys.length;e++){if(this.keys[e]==t){this.emitEvent(h.EVENT_KEY_DELETE,this.keys[e]);this.keys.splice(e,1);this.#needsSort=true;if(i===undefined){this.emitEvent(h.EVENT_CHANGE,this)}return}}}get lastKey(){if(this.#needsSort)this.sortKeys();return this.keys[this.keys.length-1]}get firstKey(){if(this.#needsSort)this.sortKeys();return this.keys[0]}getLoopIndex(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return(e-this.firstKey.time)/this.getLengthLoop()}getValue(e){let t=0;if(this.keys.length===0)return 0;if(this.#needsSort)this.sortKeys();if(!this.loop&&e>this.keys[this.keys.length-1].time){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}if(e<this.firstKey.time)return this.keys[0].value;if(this.loop&&this.keys.length>1&&e>this.lastKey.time){const o=this.getLoopIndex(e);if(o>this._timesLooped){this._timesLooped++;if(this.onLooped)this.onLooped()}e=(e-this.firstKey.time)%this.getLengthLoop();if(this.loop==h.LOOP_REPEAT){}else if(this.loop==h.LOOP_MIRROR){if(Math.floor(o)%2==1)e=this.getLengthLoop()-e}else if(this.loop==h.LOOP_OFFSET){t=(this.lastKey.value-this.keys[0].value)*Math.floor(o)}e+=this.firstKey.time}const i=this.getKeyIndex(e);if(i>=this.keys.length-1){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}const n=i+1;const r=this.keys[i];const s=this.keys[n];if(r.cb&&!r.cbTriggered)r.trigger();if(!s)return-1;const a=(e-r.time)/(s.time-r.time);if(r.getEasing()==h.EASING_CLIP){if(r.clip&&r.clip.getValue){return r.clip.getValue(a*r.clip.getLength())}else{if(this.port){const l=this.port.op.patch;const u=l.getVar(r.clipId)?.getValue();if(u)r.clip=u;if(r.clip)return r.clip.getValue(e)}console.log("no clip found")}}return r.ease(a,s)+t}addKey(e){if(e.time===undefined){this._log.warn("key time undefined, ignoring!")}else{this.keys.push(e);if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this);this.#needsSort=true}}sortSoon(){this.#needsSort=true}easingFromString(e){if(e=="linear")return h.EASING_LINEAR;if(e=="absolute")return h.EASING_ABSOLUTE;if(e=="smoothstep")return h.EASING_SMOOTHSTEP;if(e=="smootherstep")return h.EASING_SMOOTHERSTEP;if(e=="Cubic In")return h.EASING_CUBIC_IN;if(e=="Cubic Out")return h.EASING_CUBIC_OUT;if(e=="Cubic In Out")return h.EASING_CUBIC_INOUT;if(e=="Expo In")return h.EASING_EXPO_IN;if(e=="Expo Out")return h.EASING_EXPO_OUT;if(e=="Expo In Out")return h.EASING_EXPO_INOUT;if(e=="Sin In")return h.EASING_SIN_IN;if(e=="Sin Out")return h.EASING_SIN_OUT;if(e=="Sin In Out")return h.EASING_SIN_INOUT;if(e=="Back In")return h.EASING_BACK_IN;if(e=="Back Out")return h.EASING_BACK_OUT;if(e=="Back In Out")return h.EASING_BACK_INOUT;if(e=="Elastic In")return h.EASING_ELASTIC_IN;if(e=="Elastic Out")return h.EASING_ELASTIC_OUT;if(e=="Bounce In")return h.EASING_BOUNCE_IN;if(e=="Bounce Out")return h.EASING_BOUNCE_OUT;if(e=="Quart Out")return h.EASING_QUART_OUT;if(e=="Quart In")return h.EASING_QUART_IN;if(e=="Quart In Out")return h.EASING_QUART_INOUT;if(e=="Quint Out")return h.EASING_QUINT_OUT;if(e=="Quint In")return h.EASING_QUINT_IN;if(e=="Quint In Out")return h.EASING_QUINT_INOUT;console.log("unknown anim easing?",e)}createPort(e,t,i){const n=e.inDropDown(t,h.EASINGNAMES,"linear");n.set("linear");n.defaultValue=0;n.onChange=()=>{this.defaultEasing=this.easingFromString(n.get());this.emitEvent("onChangeDefaultEasing",this);if(i)i()};return n}get tlActive(){return this.#tlActive}set tlActive(e){if(CABLES.UI){this.#tlActive=e;window.gui.emitEvent("tlActiveChanged",this);this.forceChangeCallbackSoon()}}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}this.emitEvent(h.EVENT_UIATTRIB_CHANGE)}hasKeyframesBetween(t,i){for(let e=0;e<this.keys.length;e++)if(this.keys[e].time>=t&&this.keys[e].time<=i)return true;return false}static initClipsFromVars(i){for(const t in i.missingClipAnims){const n=i.getVar(t);for(let e=0;e<i.missingClipAnims[t].length;e++){i.missingClipAnims[t].clip=n.getValue();delete i.missingClipAnims[t]}}}}},963:(e,t,i)=>{"use strict";i.d(t,{rA:()=>l});var r=i(344);class l{anim=null;id=CABLES.simpleId();time=0;value=0;onChange=null;_easing=0;bezCp1=null;bezCp2=null;bezAn=null;cb=null;cbTriggered=false;temp={};uiAttribs={};clip=null;clipId=null;constructor(e,t){this.anim=e.anim||t||null;this.setEasing(r.k.EASING_LINEAR);this.set(e)}setClip(e,t){this.clipId=e;this.clip=t;if(this.anim)this.anim.emitEvent(r.k.EVENT_CHANGE)}emitChange(){if(this.anim.batchMode)return;if(!this.anim)return;this.bezAn=null;if(this.onChange!==null)this.onChange();this.anim.forceChangeCallbackSoon();for(let e=0;e<this.anim.keys.length;e++)this.anim.keys[e].bezAn=null}delete(){if(this.anim)this.anim.remove(this);else console.log("animkey without anim...")}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}if(this.anim)this.anim.emitEvent(r.k.EVENT_CHANGE)}setEasing(e){let t=false;if(this._easing!=e)t=true;this._easing=e;if(this._easing!=r.k.EASING_CLIP){this.clipId="";this.clip=null}if(this._easing==r.k.EASING_LINEAR)this.ease=this.easeLinear;else if(this._easing==r.k.EASING_ABSOLUTE)this.ease=this.easeAbsolute;else if(this._easing==r.k.EASING_SMOOTHSTEP)this.ease=l.easeSmoothStep;else if(this._easing==r.k.EASING_SMOOTHERSTEP)this.ease=l.easeSmootherStep;else if(this._easing==r.k.EASING_CUBIC_IN)this.ease=l.easeCubicIn;else if(this._easing==r.k.EASING_CUBIC_OUT)this.ease=l.easeCubicOut;else if(this._easing==r.k.EASING_CUBIC_INOUT)this.ease=l.easeCubicInOut;else if(this._easing==r.k.EASING_EXPO_IN)this.ease=l.easeExpoIn;else if(this._easing==r.k.EASING_EXPO_OUT)this.ease=l.easeExpoOut;else if(this._easing==r.k.EASING_EXPO_INOUT)this.ease=l.easeExpoInOut;else if(this._easing==r.k.EASING_SIN_IN)this.ease=l.easeSinIn;else if(this._easing==r.k.EASING_SIN_OUT)this.ease=l.easeSinOut;else if(this._easing==r.k.EASING_SIN_INOUT)this.ease=l.easeSinInOut;else if(this._easing==r.k.EASING_BACK_OUT)this.ease=l.easeOutBack;else if(this._easing==r.k.EASING_BACK_IN)this.ease=l.easeInBack;else if(this._easing==r.k.EASING_BACK_INOUT)this.ease=l.easeInOutBack;else if(this._easing==r.k.EASING_ELASTIC_IN)this.ease=l.easeInElastic;else if(this._easing==r.k.EASING_ELASTIC_OUT)this.ease=l.easeOutElastic;else if(this._easing==r.k.EASING_BOUNCE_IN)this.ease=l.easeInBounce;else if(this._easing==r.k.EASING_BOUNCE_OUT)this.ease=l.easeOutBounce;else if(this._easing==r.k.EASING_QUART_OUT)this.ease=l.easeOutQuart;else if(this._easing==r.k.EASING_QUART_IN)this.ease=l.easeInQuart;else if(this._easing==r.k.EASING_QUART_INOUT)this.ease=l.easeInOutQuart;else if(this._easing==r.k.EASING_QUINT_OUT)this.ease=l.easeOutQuint;else if(this._easing==r.k.EASING_QUINT_IN)this.ease=l.easeInQuint;else if(this._easing==r.k.EASING_QUINT_INOUT)this.ease=l.easeInOutQuint;else if(this._easing==r.k.EASING_CLIP)this.ease=this.easeAbsolute;else if(this._easing==r.k.EASING_CUBICSPLINE){if(this.ease!=this.easeCubicSpline){this.ease=this.easeCubicSpline;this.bezReset()}this.bezAn=null}else{this._easing=r.k.EASING_LINEAR;this.ease=this.easeLinear}if(t)this.emitChange()}bezReset(){let e=.5;const t=this.anim.getPrevKey(this.time);if(t)e=(this.time-t.time)/2;let i=.5;const n=this.anim.getNextKey(this.time);if(n)i=(n.time-this.time)/2;this.bezCp1=[-Math.min(e,i),0];this.bezCp2=[Math.min(e,i),0];this.emitChange()}trigger(){this.cb();this.cbTriggered=true}setValue(e){this.value=e;this.emitChange()}setBezCp1(e,t){this.bezCp1=[e,t];this.emitChange()}setBezCp2(e,t){this.bezCp2=[e,t];this.emitChange()}set(e){if(e){if(e.hasOwnProperty("e"))this.setEasing(e.e);if(e.cb){this.cb=e.cb;this.cbTriggered=false}if(e.hasOwnProperty("cp1")){this.bezCp1=e.cp1;this.bezCp2=e.cp2}if(e.hasOwnProperty("t"))this.time=e.t;if(e.hasOwnProperty("time"))this.time=e.time;if(e.hasOwnProperty("v"))this.value=e.v;else if(e.hasOwnProperty("value"))this.value=e.value;if(e.hasOwnProperty("uiAttribs"))this.setUiAttribs(e.uiAttribs);if(e.clipId)this.clipId=e.clipId}this.emitChange()}getSerialized(){const e={};e.t=this.time;e.v=this.value;e.e=this._easing;e.uiAttribs=this.uiAttribs;if(this.clipId)e.clipId=this.clipId;if(this._easing===r.k.EASING_CUBICSPLINE){e.cp1=this.bezCp1;e.cp2=this.bezCp2}return e}getEasing(){return this._easing}easeCubicSpline(e,t){if(!this.bezAn){const i=30;this.bezAn=new r.k;for(let e=0;e<=i+1;e++){const n=l.cubicSpline(e/i,this,t);this.bezAn.setValue(n[0],n[1])}}return this.bezAn.getValue(this.time+e*(t.time-this.time))}easeLinear(e,t){return l.linear(e,this,t)}easeAbsolute(){return this.value}}l.cubicSpline=function(e,t,i){const n=1-e;const r=n*n;const s=e*e;const a=r*n;const o=3*r*e;const l=3*n*s;const u=s*e;t.bezCp1=t.bezCp1||[-.5,0];t.bezCp2=t.bezCp2||[.5,0];i.bezCp1=i.bezCp1||[-.5,0];i.bezCp2=i.bezCp2||[.5,0];const h=Math.min(i.time,t.bezCp2[0]+t.time);const c=Math.max(t.time,i.bezCp1[0]+i.time);const f=a*t.time+o*h+l*c+u*i.time;const d=a*t.value+o*(t.bezCp2[1]+t.value)+l*(i.bezCp1[1]+i.value)+u*i.value;return[f,d]};l.linear=function(e,t,i){return t.value+(i.value-t.value)*e};const n=function(e){return e=2**(10*(e-1))};l.easeExpoIn=function(e,t){e=n(e);return l.linear(e,this,t)};const s=function(e){e=-(2**(-10*e))+1;return e};l.easeExpoOut=function(e,t){e=s(e);return l.linear(e,this,t)};const a=function(e){e*=2;if(e<1){e=.5*2**(10*(e-1))}else{e--;e=.5*(-(2**(-10*e))+2)}return e};l.easeExpoInOut=function(e,t){e=a(e);return l.linear(e,this,t)};l.easeSinIn=function(e,t){e=-1*Math.cos(e*Math.PI/2)+1;return l.linear(e,this,t)};l.easeSinOut=function(e,t){e=Math.sin(e*Math.PI/2);return l.linear(e,this,t)};l.easeSinInOut=function(e,t){e=-.5*(Math.cos(Math.PI*e)-1);return l.linear(e,this,t)};const o=function(e){e=e*e*e;return e};l.easeCubicIn=function(e,t){e=o(e);return l.linear(e,this,t)};l.easeInQuint=function(e,t){e=e*e*e*e*e;return l.linear(e,this,t)};l.easeOutQuint=function(e,t){e=(e-=1)*e*e*e*e+1;return l.linear(e,this,t)};l.easeInOutQuint=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e*e;else e=.5*((e-=2)*e*e*e*e+2);return l.linear(e,this,t)};l.easeInQuart=function(e,t){e=e*e*e*e;return l.linear(e,this,t)};l.easeOutQuart=function(e,t){e=-1*((e-=1)*e*e*e-1);return l.linear(e,this,t)};l.easeInOutQuart=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e;else e=-.5*((e-=2)*e*e*e-2);return l.linear(e,this,t)};l.bounce=function(e){if((e/=1)<1/2.75)e=7.5625*e*e;else if(e<2/2.75)e=7.5625*(e-=1.5/2.75)*e+.75;else if(e<2.5/2.75)e=7.5625*(e-=2.25/2.75)*e+.9375;else e=7.5625*(e-=2.625/2.75)*e+.984375;return e};l.easeInBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeOutBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeInElastic=function(e,t){let i=1.70158;let n=0;let r=1;const s=0;const a=1;const o=1;if(e===0)e=s;else if((e/=a)==1)e=s+o;else{if(!n)n=a*.3;if(r<Math.abs(o)){r=o;i=n/4}else i=n/(2*Math.PI)*Math.asin(o/r);e=-(r*2**(10*(e-=1))*Math.sin((e*a-i)*(2*Math.PI)/n))+s}return l.linear(e,this,t)};l.easeOutElastic=function(e,t){let i=1.70158;let n=0;let r=1;const s=0;const a=1;const o=1;if(e===0)e=s;else if((e/=a)==1)e=s+o;else{if(!n)n=a*.3;if(r<Math.abs(o)){r=o;i=n/4}else i=n/(2*Math.PI)*Math.asin(o/r);e=r*2**(-10*e)*Math.sin((e*a-i)*(2*Math.PI)/n)+o+s}return l.linear(e,this,t)};l.easeInBack=function(e,t){const i=1.70158;e=e*e*((i+1)*e-i);return l.linear(e,this,t)};l.easeOutBack=function(e,t){const i=1.70158;e=(e=e/1-1)*e*((i+1)*e+i)+1;return l.linear(e,this,t)};l.easeInOutBack=function(e,t){let i=1.70158;const n=1/2;if((e/=1/2)<1)e=n*(e*e*(((i*=1.525)+1)*e-i));else e=n*((e-=2)*e*(((i*=1.525)+1)*e+i)+2);return l.linear(e,this,t)};const u=function(e){e--;e=e*e*e+1;return e};l.easeCubicOut=function(e,t){e=u(e);return l.linear(e,this,t)};const h=function(e){e*=2;if(e<1)e=.5*e*e*e;else{e-=2;e=.5*(e*e*e+2)}return e};l.easeCubicInOut=function(e,t){e=h(e);return l.linear(e,this,t)};l.easeSmoothStep=function(e,t){const i=Math.max(0,Math.min(1,e));e=i*i*(3-2*i);return l.linear(e,this,t)};l.easeSmootherStep=function(e,t){const i=Math.max(0,Math.min(1,(e-0)/(1-0)));e=i*i*i*(i*(i*6-15)+10);return l.linear(e,this,t)}},440:(e,t,i)=>{"use strict";i.d(t,{a:()=>r});var n=i(344);const r={ANIM:{EASINGS:n.k.EASINGNAMES,EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27,EASING_CLIP:28},OP:{OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_NUMBER:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_TRIGGER:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},PORT:{PORT_DIR_IN:0,PORT_DIR_OUT:1},PACO:{PACO_CLEAR:0,PACO_VALUECHANGE:1,PACO_OP_DELETE:2,PACO_UNLINK:3,PACO_LINK:4,PACO_LOAD:5,PACO_OP_CREATE:6,PACO_OP_ENABLE:7,PACO_OP_DISABLE:8,PACO_UIATTRIBS:9,PACO_VARIABLES:10,PACO_TRIGGERS:11,PACO_PORT_SETVARIABLE:12,PACO_PORT_SETANIMATED:13,PACO_PORT_ANIM_UPDATED:14,PACO_DESERIALIZE:15,PACO_OP_RELOAD:16}}},50:(e,t,i)=>{"use strict";i.d(t,{I:()=>l});var n=i(125);var r=i(849);var s=i(440);var a=i(562);var o=i(344);class l extends n.A{static DIR_IN=0;static DIR_OUT=1;static TYPE_VALUE=0;static TYPE_NUMBER=0;static TYPE_FUNCTION=1;static TYPE_TRIGGER=1;static TYPE_OBJECT=2;static TYPE_TEXTURE=2;static TYPE_ARRAY=3;static TYPE_DYNAMIC=4;static TYPE_STRING=5;static EVENT_UIATTRCHANGE="onUiAttrChange";static EVENT_VALUE_CHANGE="change";static EVENT_LINK_CHANGED="onLinkChanged";static EVENT_LINK_REMOVED="onLinkRemoved";#oldAnimVal=-5711;animMuted=false;lastAnimTime=0;#uiActiveState=true;#valueBeforeLink=null;#animated=false;#useVariableName=null;#op=null;constructor(e,t,i,n={}){super();this.data={};this._log=new r.A("core_port");this.direction=l.DIR_IN;this.id=String(CABLES.simpleId());this.#op=e;this.links=[];this.value=0;this.name=t;this.type=i||l.TYPE_VALUE;this.uiAttribs=n||{};this.anim=null;this.defaultValue=null;this.ignoreValueSerialize=false;this.onLinkChanged=null;this.crashed=false;this.onValueChanged=null;this.onTriggered=null;this.changeAlways=false;this.forceRefChange=false;this.activityCounter=0;this.apf=0;this.activityCounterStartFrame=0;this.canLink=null;this.preserveLinks=null;this.indexPort=null}get parent(){this._log.stack("use port.op, not .parent");return this.op}get title(){return this.uiAttribs.title||this.name}get op(){return this.#op}get val(){return this.get()}set val(e){this.setValue(e)}copyLinkedUiAttrib(e,t){if(!CABLES.UI)return;if(!this.isLinked())return;const i={};i[e]=this.links[0].getOtherPort(this).getUiAttrib(e);t.setUiAttribs(i)}getValueForDisplay(){let e=this.value;if(typeof this.value==="string"||this.value instanceof String){if(e.length>1e3){e=e.substring(0,999);e+="..."}if(this.uiAttribs&&this.uiAttribs.display=="boolnum"){e+=" - ";if(!this.value)e+="false";else e+="true"}e=e.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"});if(e.length>100)e=e.substring(0,100)}else{e=String(this.value)}return e}onAnimToggle(){}_onAnimToggle(){this.onAnimToggle()}remove(){this.removeLinks();this.#op.removePort(this)}setUiAttribs(e){let t=false;if(!this.uiAttribs)this.uiAttribs={};for(const i in e){if(e[i]===undefined){delete this.uiAttribs[i];continue}if(this.uiAttribs[i]!=e[i])t=true;this.uiAttribs[i]=e[i];if(i=="group"&&this.indexPort)this.indexPort.setUiAttribs({group:e[i]})}if(e.hasOwnProperty("expose"))this.#op.patch.emitEvent("subpatchExpose",this.#op.uiAttribs.subPatch);if(t)this.emitEvent(l.EVENT_UIATTRCHANGE,e,this)}getUiAttribs(){return this.uiAttribs}getUiAttrib(e){if(!this.uiAttribs||!this.uiAttribs.hasOwnProperty(e))return null;return this.uiAttribs[e]}get(){if(CABLES.UI&&this.#animated&&this.lastAnimTime==this.#op.patch.timer.getTime()&&!CABLES.UI.keyframeAutoCreate){return this.value}if(!this.animMuted&&this.#animated&&this.lastAnimFrame!=this.#op.patch.getFrameNum()){this.lastAnimTime=this.#op.patch.timer.getTime();this.lastAnimFrame=this.#op.patch.getFrameNum();let e=this.anim.getValue(this.#op.patch.timer.getTime());if(this.value!=e){this.value=e;this.#oldAnimVal=this.value;this.forceChange()}}return this.value}setRef(e){this.forceRefChange=true;this.set(e)}set(e){this.setValue(e)}setValue(t){if(t===undefined)t=null;if(CABLES.UI&&CABLES.UI.showDevInfos)if(this.direction==s.a.PORT.PORT_DIR_OUT&&this.type==l.TYPE_OBJECT&&t&&!this.forceRefChange)this._log.warn("object port ["+this.name+"] uses .set ["+this.op.objName+"]");if(this.#op.enabled&&!this.crashed){if(t!==this.value||this.changeAlways||this.type==l.TYPE_TEXTURE||this.type==l.TYPE_ARRAY){if(CABLES.UI&&this.#animated){CABLES.UI.PREVISKEYVAL=null;if(!CABLES.UI.keyframeAutoCreate)CABLES.UI.PREVISKEYVAL=t}if(CABLES.UI&&this.#animated&&CABLES.UI.keyframeAutoCreate){let e=this.#op.patch.timer.getTime();if(CABLES.UI&&CABLES.Patch.getGui().glTimeline)CABLES.Patch.getGui().glTimeline.createKey(this.anim,e,t);else this.anim.setValue(e,t)}else{try{this.value=t;this.forceChange()}catch(e){this.crashed=true;this.setValue=function(e){};this.onTriggered=function(){};this._log.error("exception in ",this.#op);this._log.error(e);this.#op.patch.emitEvent("exception",e,this.#op)}if(this.#op&&this.#op.patch&&this.#op.patch.isEditorMode()&&this.type==l.TYPE_TEXTURE)CABLES.Patch.getGui().texturePreview().updateTexturePort(this)}if(this.direction==s.a.PORT.PORT_DIR_OUT)for(let e=0;e<this.links.length;++e)this.links[e].setValue()}}}updateAnim(){if(!this.#animated||this.animMuted)return;this.value=this.get();if(this.#oldAnimVal!=this.value||this.changeAlways){this.#oldAnimVal=this.value;this.forceChange()}this.#oldAnimVal=this.value}forceChange(){if(this.onValueChanged||this.onChange){}this._activity();this.emitEvent(l.EVENT_VALUE_CHANGE,this.value,this);if(this.onChange)this.onChange(this,this.value);else if(this.onValueChanged)this.onValueChanged(this,this.value)}static getTypeString(e){if(e==l.TYPE_VALUE)return"Number";if(e==l.TYPE_FUNCTION)return"Trigger";if(e==l.TYPE_OBJECT)return"Object";if(e==l.TYPE_DYNAMIC)return"Dynamic";if(e==l.TYPE_ARRAY)return"Array";if(e==l.TYPE_STRING)return"String";return"Unknown"}getTypeString(){return l.getTypeString(this.type)}deSerializeSettings(e){if(!e)return;if(e.animated)this.setAnimated(e.animated);if(e.useVariable)this.setVariableName(e.useVariable);if(e.title)this.setUiAttribs({title:e.title});if(e.expose)this.setUiAttribs({expose:true});if(e.order)this.setUiAttribs({order:e.order});if(e.multiPortManual)this.setUiAttribs({multiPortManual:e.multiPortManual});if(e.multiPortNum)this.setUiAttribs({multiPortNum:e.multiPortNum});if(e.anim){if(!this.anim)this.anim=new o.k({name:"port "+this.name});this.#op.hasAnimPort=true;this.anim.port=this;this.anim.deserialize(e.anim,true,this.op.patch.clipAnims);this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.bindAnimListeners();this.anim.sortKeys()}}setInitialValue(e){if(this.op.preservedPortLinks[this.name]){for(let e=0;e<this.op.preservedPortLinks[this.name].length;e++){const t=this.op.preservedPortLinks[this.name][e];this.op.patch._addLink(t.objIn,t.objOut,t.portIn,t.portOut)}}if(this.op.preservedPortValues&&this.op.preservedPortValues.hasOwnProperty(this.name)&&this.op.preservedPortValues[this.name]!==undefined){this.set(this.op.preservedPortValues[this.name])}else if(e!==undefined)this.set(e);if(e!==undefined)this.defaultValue=e}getSerialized(){let t={name:this.getName()};if(!this.ignoreValueSerialize&&this.links.length===0){if(this.type==l.TYPE_OBJECT&&this.value&&this.value.tex){}else t.value=this.value}if(this.#useVariableName)t.useVariable=this.#useVariableName;if(this.#animated)t.animated=true;if(this.anim)t.anim=this.anim.getSerialized();if(this.uiAttribs.multiPortNum)t.multiPortNum=this.uiAttribs.multiPortNum;if(this.uiAttribs.multiPortManual)t.multiPortManual=this.uiAttribs.multiPortManual;if(this.uiAttribs.display=="file")t.display=this.uiAttribs.display;if(this.uiAttribs.expose){t.expose=true;if(this.uiAttribs.hasOwnProperty("order"))t.order=this.uiAttribs.order}if(this.uiAttribs.title)t.title=this.uiAttribs.title;if((this.preserveLinks||this.direction==s.a.PORT.PORT_DIR_OUT)&&this.links.length>0){t.links=[];for(const e in this.links){if(!this.links[e].ignoreInSerialize&&(this.links[e].portIn&&this.links[e].portOut))t.links.push(this.links[e].getSerialized())}}if(this.direction==l.DIR_IN&&this.links.length>0){for(const e in this.links){if(!this.links[e].portIn||!this.links[e].portOut)continue;const i=this.links[e].getOtherPort(this);if(i.op.isInBlueprint2&&this.op.isInBlueprint2){if(i.op.isInBlueprint2()&&!this.op.isInBlueprint2()){t.links=t.links||[];t.links.push(this.links[e].getSerialized())}}}}if(t.links&&t.links.length==0)delete t.links;if(this.type===l.TYPE_FUNCTION)delete t.value;if(this.type===l.TYPE_FUNCTION&&this.links.length==0)t=null;if(t&&Object.keys(t).length==1&&t.name)t=null;(0,a.cleanJson)(t);return t}shouldLink(e,t){return!!(e&&t)}removeLinks(){let e=0;while(this.links.length>0){e++;if(e>5e3){this._log.warn("could not delete links... / infinite loop");this.links.length=0;break}this.links[0].remove()}}removeLink(t){for(let e=0;e<this.links.length;e++)if(this.links[e]==t)this.links.splice(e,1);if(this.direction==l.DIR_IN){if(this.type==l.TYPE_VALUE)this.setValue(this.#valueBeforeLink||0);else this.setValue(this.#valueBeforeLink||null)}if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(l.EVENT_LINK_CHANGED);this.emitEvent(l.EVENT_LINK_REMOVED);this.#op.emitEvent(l.EVENT_LINK_CHANGED)}catch(e){this._log.error(e)}}getName(){return this.name}getTitle(){if(this.uiAttribs.title)return this.uiAttribs.title;return this.name}addLink(e){this.#valueBeforeLink=this.value;this.links.push(e);if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(l.EVENT_LINK_CHANGED);this.#op.emitEvent(l.EVENT_LINK_CHANGED)}catch(e){this._log.error(e)}}getLinkTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]}removeLinkTo(t){for(const e in this.links){if(this.links[e].portIn==t||this.links[e].portOut==t){this.links[e].remove();if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(l.EVENT_LINK_CHANGED);this.emitEvent(l.EVENT_LINK_REMOVED);return}}}isLinkedTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return true;return false}_activity(){this.activityCounter++}trigger(){const t=this.links.length;this._activity();if(t===0)return;if(!this.#op.enabled)return;let i=null;try{for(let e=0;e<t;++e){if(this.links[e].portIn){i=this.links[e].portIn;i.op.patch.pushTriggerStack(i);if(!i._onTriggered){console.log(i,i._onTriggered)}i._onTriggered();i.op.patch.popTriggerStack()}if(this.links[e])this.links[e].activity()}}catch(e){i.op.enabled=false;if(this.#op.patch.isEditorMode()){if(i.op.onError)i.op.onError(e)}this._log.error("exception in port: ",i.name,i.op.name,i.op.id);this._log.error(e)}}call(){this._log.warn("call deprecated - use trigger() ");this.trigger()}execute(){}setVariableName(e){this.#useVariableName=e;this.#op.patch.on("variableRename",(e,t)=>{if(e!=this.#useVariableName)return;this.#useVariableName=t})}getVariableName(){return this.#useVariableName}setVariable(e){this.setAnimated(false);const t={useVariable:false};if(this._variableIn&&this._varChangeListenerId){this._variableIn.off(this._varChangeListenerId);this._variableIn=null}if(e){this._variableIn=this.#op.patch.getVar(e);if(!this._variableIn){}else{if(this.type==l.TYPE_OBJECT){this._varChangeListenerId=this._variableIn.on("change",()=>{this.set(null);this.set(this._variableIn.getValue())})}else{this._varChangeListenerId=this._variableIn.on("change",this.set.bind(this))}this.set(this._variableIn.getValue())}this.#useVariableName=e;t.useVariable=true;t.variableName=this.#useVariableName}else{t.variableName=this.#useVariableName=null;t.useVariable=false}this.setUiAttribs(t);this.#op.patch.emitEvent("portSetVariable",this.#op,this,e)}_handleNoTriggerOpAnimUpdates(e){let t=false;if(!t){if(e)this._notriggerAnimUpdate=this.#op.patch.on("onRenderFrame",()=>{this.updateAnim()});else if(this._notriggerAnimUpdate)this._notriggerAnimUpdate=this.#op.patch.off(this._notriggerAnimUpdate)}}bindAnimListeners(){this.anim.on(o.k.EVENT_CHANGE,()=>{this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.updateAnimMaxTimeSoon()});this.anim.on(o.k.EVENT_KEY_DELETE,()=>{this.#op.patch.updateAnimMaxTimeSoon()})}setAnimated(e){let t=false;if(this.#animated!=e){this.#animated=e;this.#op.hasAnimPort=true;t=true}if(this.#animated&&!this.anim){this.anim=new o.k({name:"port "+this.name});this.bindAnimListeners()}if(this.#animated){let e=0;if(this.#op.patch.gui&&this.#op.patch.gui.glTimeline)e=this.#op.patch.timer.getTime();if(this.anim.keys.length==0)this.anim.setValue(e,this.value)}else{this.anim=null}this._handleNoTriggerOpAnimUpdates(e);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim);this.setUiAttribs({isAnimated:this.#animated});if(t)this._onAnimToggle()}toggleAnim(){this.setAnimated(!this.#animated);this.setUiAttribs({isAnimated:this.#animated});this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim)}getType(){return this.type}isLinked(){return this.links.length>0||this.#animated||this.#useVariableName!=null}isBoundToVar(){const e=this.#useVariableName!=null;this.uiAttribs.boundToVar=e;return e}isAnimated(){return this.#animated}isHidden(){return this.uiAttribs.hidePort}_onTriggered(){this._activity();this.#op.updateAnims();if(this.#op.enabled&&this.onTriggered)this.onTriggered();if(this.#op.enabled)this.emitEvent("trigger")}_onSetProfiling(e){if(this.op.patch.debuggerEnabled){const t=e;this.op.patch.emitEvent("debuggerstep",{opname:this.op.name,opid:this.op.id,portname:this.name,log:this.op.name+" - port "+this.name+": set value to "+e,exec:()=>{this.setValue(t)}});return}this.#op.patch.profiler.add("port",this);this.setValue(e);this.#op.patch.profiler.add("port",null)}_onTriggeredProfiling(){if(this.#op.enabled&&this.onTriggered){if(this.op.patch.debuggerEnabled){console.log();this.op.patch.emitEvent("debuggerstep",{opname:this.op.name,opid:this.op.id,portname:this.name,log:this.op.name+" - triggered "+this.name,exec:()=>{this.onTriggered()}});return}this.#op.patch.profiler.add("port",this);this.onTriggered();this.#op.patch.profiler.add("port",null)}}onValueChange(e){this.onChange=e}hidePort(){}static portTypeNumberToString(e){if(e==l.TYPE_VALUE)return"value";if(e==l.TYPE_FUNCTION)return"function";if(e==l.TYPE_OBJECT)return"object";if(e==l.TYPE_ARRAY)return"array";if(e==l.TYPE_STRING)return"string";if(e==l.TYPE_DYNAMIC)return"dynamic";return"unknown"}}},606:(k,e,t)=>{"use strict";t.r(e);t.d(e,{Anim:()=>m.k,AnimKey:()=>L.rA,CONSTANTS:()=>T.a,EMBED:()=>P,Link:()=>p,LoadingStatus:()=>E,Op:()=>M,Patch:()=>S,PatchVariable:()=>I,Port:()=>v.I,Profiler:()=>O,Timer:()=>x.M4,default:()=>D,now:()=>x.tB,utils:()=>b});var i={};t.r(i);t.d(i,{glMatrix:()=>n,mat2:()=>r,mat2d:()=>s,mat3:()=>a,mat4:()=>o,quat:()=>l,quat2:()=>u,vec2:()=>h,vec3:()=>c,vec4:()=>f});var n=t(823);var r=t(522);var s=t(964);var a=t(409);var o=t(684);var l=t(221);var u=t(991);var h=t(842);var c=t(329);var f=t(796);var d=t(125);var g=t(849);var b=t(562);var m=t(344);var v=t(50);class p extends d.A{constructor(e){super();this.id=CABLES.simpleId();this.portIn=null;this.portOut=null;this._patch=e;this.activityCounter=0;this.ignoreInSerialize=false}setValue(e){if(e===undefined)this._setValue();else this.portIn.set(e)}activity(){this.activityCounter++}_setValue(){if(!this.portOut){this.remove();return}const e=this.portOut.get();if(e==e){if(this.portIn.type!=v.I.TYPE_FUNCTION)this.activity();if(this.portIn.get()!==e){this.portIn.set(e)}else{if(this.portIn.changeAlways)this.portIn.set(e);if(this.portOut.forceRefChange)this.portIn.forceChange()}}}getOtherPort(e){if(e==this.portIn)return this.portOut;return this.portIn}remove(){if(this.portIn)this.portIn.removeLink(this);if(this.portOut)this.portOut.removeLink(this);if(this._patch){this._patch.emitEvent("onUnLink",this.portIn,this.portOut,this)}if(this.portIn&&(this.portIn.type==v.I.TYPE_OBJECT||this.portIn.type==v.I.TYPE_ARRAY)){this.portIn.set(null);if(this.portIn.links.length>0)this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get())}if(this.portIn)this.portIn.op._checkLinksNeededToWork();if(this.portOut)this.portOut.op._checkLinksNeededToWork();this.portIn=null;this.portOut=null;this._patch=null}link(e,t){if(!p.canLink(e,t)){console.warn("[core_link] cannot link ports!",e,t);return false}if(e.direction==v.I.DIR_IN){this.portIn=e;this.portOut=t}else{this.portIn=t;this.portOut=e}e.addLink(this);t.addLink(this);this.setValue();e.op._checkLinksNeededToWork();t.op._checkLinksNeededToWork()}getSerialized(){const e={};e.portIn=this.portIn.getName();e.portOut=this.portOut.getName();e.objIn=this.portIn.op.id;e.objOut=this.portOut.op.id;return e}static canLinkText(e,t){if(e.direction==t.direction){let e="(out)";if(t.direction==v.I.DIR_IN)e="(in)";return"can not link: same direction "+e}if(e.op==t.op)return"can not link: same op";if(e.type!=v.I.TYPE_DYNAMIC&&t.type!=v.I.TYPE_DYNAMIC){if(e.type!=t.type)return"can not link: different type"}if(CABLES.UI&&e.type==v.I.TYPE_OBJECT&&t.type==v.I.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType)if(e.uiAttribs.objType!=t.uiAttribs.objType)return"incompatible objects"}if(!e)return"can not link: port 1 invalid";if(!t)return"can not link: port 2 invalid";if(e.direction==v.I.DIR_IN&&e.isAnimated())return"can not link: is animated";if(t.direction==v.I.DIR_IN&&t.isAnimated())return"can not link: is animated";if(e.isLinkedTo(t))return"ports already linked";if(e.canLink&&!e.canLink(t)||t.canLink&&!t.canLink(e))return"Incompatible";return"can link"}static canLink(e,t){if(!e)return false;if(!t)return false;if(e.direction==v.I.DIR_IN&&e.isAnimated())return false;if(t.direction==v.I.DIR_IN&&t.isAnimated())return false;if(e.isHidden()||t.isHidden())return false;if(e.isLinkedTo(t))return false;if(e.direction==t.direction)return false;if(CABLES.UI&&e.type==v.I.TYPE_OBJECT&&t.type==v.I.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType){if(e.uiAttribs.objType.indexOf("sg_")==0&&t.uiAttribs.objType.indexOf("sg_")==0)return true;if(e.uiAttribs.objType!=t.uiAttribs.objType)return false}}if(e.type!=t.type&&(e.type!=v.I.TYPE_DYNAMIC&&t.type!=v.I.TYPE_DYNAMIC))return false;if(e.type==v.I.TYPE_DYNAMIC||t.type==v.I.TYPE_DYNAMIC)return true;if(e.op==t.op)return false;if(e.canLink&&!e.canLink(t))return false;if(t.canLink&&!t.canLink(e))return false;return true}}var _=t(772);var A=t(308);var T=t(440);class E extends d.A{constructor(e){super();this._log=new g.A("LoadingStatus");this._loadingAssets={};this._cbFinished=[];this._assetTasks=[];this._percent=0;this._count=0;this._countFinished=0;this._order=0;this._startTime=0;this._patch=e;this._wasFinishedPrinted=false;this._loadingAssetTaskCb=false}setOnFinishedLoading(e){this._cbFinished.push(e)}getNumAssets(){return this._countFinished}getProgress(){return this._percent}checkStatus(){this._countFinished=0;this._count=0;for(const e in this._loadingAssets){this._count++;if(!this._loadingAssets[e].finished){this._countFinished++}}this._percent=(this._count-this._countFinished)/this._count;if(this._countFinished===0){for(let e=0;e<this._cbFinished.length;e++){if(this._cbFinished[e]){const t=this._cbFinished[e];setTimeout(()=>{t(this._patch);this.emitEvent("finishedAll")},100)}}if(!this._wasFinishedPrinted){this._wasFinishedPrinted=true;this.print()}this.emitEvent("finishedAll")}}getList(){let t=[];for(const e in this._loadingAssets){t.push(this._loadingAssets[e])}return t}getListJobs(){let t=[];for(const e in this._loadingAssets){if(!this._loadingAssets[e].finished)t.push(this._loadingAssets[e].name)}return t}print(){if(this._patch.config.silent)return;const t=[];for(const e in this._loadingAssets){t.push([this._loadingAssets[e].order,this._loadingAssets[e].type,this._loadingAssets[e].name,(this._loadingAssets[e].timeEnd-this._loadingAssets[e].timeStart)/1e3+"s"])}this._log.groupCollapsed("finished loading "+this._order+" assets in "+(Date.now()-this._startTime)/1e3+"s");this._log.table(t);this._log.groupEnd()}finished(e){const t=this._loadingAssets[e];if(t){if(t.finished)this._log.warn("loading job was already finished",t);if(t.op)t.op.setUiAttribs({loading:false});t.finished=true;t.timeEnd=Date.now()}this.checkStatus();this.emitEvent("finishedTask");return null}_startAssetTasks(){for(let e=0;e<this._assetTasks.length;e++)this._assetTasks[e]();this._assetTasks.length=0}addAssetLoadingTask(e){if(this._patch.isEditorMode()&&!CABLES.UI.loaded){this._assetTasks.push(e);if(!this._loadingAssetTaskCb)window.gui.addEventListener("uiloaded",this._startAssetTasks.bind(this));this._loadingAssetTaskCb=true}else{e()}this.emitEvent("addAssetTask")}existByName(t){for(let e in this._loadingAssets){if(this._loadingAssets[e].name==t&&!this._loadingAssets[e].finished)return true}}start(e,t,i){if(this._startTime==0)this._startTime=Date.now();const n=(0,b.generateUUID)();t=t||"unknown";if(t.length>100)t=t.substring(0,100);if(i)i.setUiAttrib({loading:true});this._loadingAssets[n]={id:n,op:i,type:e,name:t,finished:false,timeStart:Date.now(),order:this._order};this._order++;this.emitEvent("startTask");return n}}var x=t(920);class O{constructor(e){this.startFrame=e.getFrameNum();this.items={};this.currentId=null;this.currentStart=0;this._patch=e}getItems(){return this.items}clear(){this.currentStart=performance.now();if(this.paused)return;this.items={}}togglePause(){this.paused=!this.paused;if(!this.paused){this.items={};this.currentStart=performance.now()}}add(e,t){if(this.paused)return;if(this.currentId!==null){if(!t||t.id!=this.currentId){const i=this.items[this.currentId];if(i){i.timeUsed+=performance.now()-this.currentStart;i._timePsCount++;i._timePsMs+=performance.now()-this.currentStart;if(i._timePsStart==0||performance.now()>i._timePsStart+1e3){i.timePsMs=i._timePsMs;i.timePsMsAvg=i._timePsMs/i._timePsCount;i.timePsCount=i._timePsCount;i._timePsCount=0;i._timePsMs=0;i._timePsStart=performance.now()}if(!i.peakTime||(0,x.tB)()-i.peakTime>5e3){i.peak=0;i.peakTime=(0,x.tB)()}i.peak=Math.max(i.peak,performance.now()-this.currentStart)}}}if(t!==null){if(!this.items[t.id]){this.items[t.id]={numTriggers:0,timeUsed:0,timeUsedFrame:0,timePsMsAvg:0,timePsMs:0,_timePsCount:0,_timePsMs:0,_timePsStart:performance.now()}}if(this.items[t.id].lastFrame!=this._patch.getFrameNum())this.items[t.id].numTriggers=0;this.items[t.id].lastFrame=this._patch.getFrameNum();this.items[t.id].numTriggers++;this.items[t.id].opid=t.op.id;this.items[t.id].title=t.op.name+"."+t.name;this.items[t.id].subPatch=t.op.uiAttribs.subPatch;this.currentId=t.id;this.currentStart=performance.now()}else{this.currentId=null}}print(){console.log("--------");for(const e in this.items){console.log(this.items[e].title+": "+this.items[e].numTriggers+" / "+this.items[e].timeUsed)}}}class I extends d.A{#name;constructor(e,t,i){super();this.#name=e;this.type=i;this.setValue(t)}addListener(e){this.on("change",e,"var")}getValue(){return this._v}get name(){return this.#name}getName(){return this.#name}setValue(e){this._v=e;this.emitEvent("change",e,this)}}class S extends d.A{static EVENT_OP_DELETED="onOpDelete";static EVENT_OP_ADDED="onOpAdd";static EVENT_PAUSE="pause";static EVENT_RESUME="resume";static EVENT_PATCHLOADEND="patchLoadEnd";static EVENT_VARIABLES_CHANGED="variablesChanged";static EVENT_RENDER_FRAME="onRenderFrame";static EVENT_RENDERED_ONE_FRAME="renderedOneFrame";static EVENT_LINK="onLink";static EVENT_VALUESSET="loadedValueSet";static EVENT_ANIM_MAXTIME_CHANGE="animmaxtimechange";#renderOneFrame=false;#initialDeserialize=true;ops=[];settings={};animMaxTime=0;missingClipAnims={};constructor(e){super();this._log=new g.A("core_patch",{onError:e.onError});this.config=e||{glCanvasResizeToWindow:false,prefixAssetPath:"",prefixJsPath:"",silent:true,onError:null,onFinishedLoading:null,onFirstFrameRendered:null,onPatchLoaded:null,fpsLimit:0};this.timer=new x.M4;this.freeTimer=new x.M4;this.animFrameOps=[];this.animFrameCallbacks=[];this.gui=false;CABLES.logSilent=this.silent=true;this.profiler=null;this.aborted=false;this._crashedOps=[];this._animReq=null;this._opIdCache={};this._triggerStack=[];this.storeObjNames=false;this.loading=new E(this);this._volumeListeners=[];this._paused=false;this._frameNum=0;this.onOneFrameRendered=null;this.namedTriggers={};this._origData=null;this._frameNext=0;this._frameInterval=0;this._lastFrameTime=0;this._frameWasdelayed=true;this.tempData=this.frameStore={};this.reqAnimTimeStamp=0;this.cgCanvas=null;if(!function(){return!this}())console.log("not in strict mode: core patch");if(this.config.hasOwnProperty("silent"))this.silent=CABLES.logSilent=this.config.silent;if(!this.config.hasOwnProperty("doRequestAnimation"))this.config.doRequestAnimation=true;if(!this.config.prefixAssetPath)this.config.prefixAssetPath="";if(!this.config.prefixJsPath)this.config.prefixJsPath="";if(!this.config.masterVolume)this.config.masterVolume=1;this._variables={};this.vars={};if(e&&e.vars)this.vars=e.vars;this.cgl=new _.Rq.Context(this);this.cgp=null;this._subpatchOpCache={};this.cgl.setCanvas(this.config.glCanvasId||this.config.glCanvas||"glcanvas");if(this.config.glCanvasResizeToWindow===true)this.cgl.setAutoResize("window");if(this.config.glCanvasResizeToParent===true)this.cgl.setAutoResize("parent");this.loading.setOnFinishedLoading(this.config.onFinishedLoading);if(this.cgl.aborted)this.aborted=true;if(this.cgl.silent)this.silent=true;if(!CABLES.OPS){this.aborted=true;throw new Error("no CABLES.OPS found")}this.freeTimer.play();this.exec();if(!this.aborted){if(this.config.patch){this.deSerialize(this.config.patch)}else if(this.config.patchFile){(0,b.ajax)(this.config.patchFile,(e,t)=>{try{const i=JSON.parse(t);if(e){const n="";this._log.error("err",e);this._log.error("data",i);this._log.error("data",i.msg);return}this.deSerialize(i)}catch(e){this._log.error("could not load/parse patch ",e)}})}this.timer.play()}console.log("made with https://cables.gl");this.cg=undefined}static getGui(){return window.gui}isPlaying(){return!this._paused}renderOneFrame(){this._paused=true;this._renderOneFrame=true;this.exec();this._renderOneFrame=false}isEditorMode(){return this.config.editorMode===true}pause(){cancelAnimationFrame(this._animReq);this.emitEvent(S.EVENT_PAUSE);this._animReq=null;this._paused=true;this.freeTimer.pause()}resume(){if(this._paused){cancelAnimationFrame(this._animReq);this._paused=false;this.freeTimer.play();this.emitEvent(S.EVENT_RESUME);this.exec()}}setVolume(t){this.config.masterVolume=t;for(let e=0;e<this._volumeListeners.length;e++)this._volumeListeners[e].onMasterVolumeChanged(t)}getAssetPath(t=null){if(this.config.hasOwnProperty("assetPath")){return this.config.assetPath}else if(this.isEditorMode()){let e=t||S.getGui().project()._id;return"/assets/"+e+"/"}else if(document.location.href.indexOf("cables.gl")>0||document.location.href.indexOf("cables.local")>0){const i=document.location.pathname.split("/");let e=t||i[i.length-1];return"/assets/"+e+"/"}else{return"assets/"}}getJsPath(){if(this.config.hasOwnProperty("jsPath")){return this.config.jsPath}else{return"js/"}}getFilePath(e){if(!e)return e;e=String(e);if(e.indexOf("https:")===0||e.indexOf("http:")===0)return e;if(e.indexOf("data:")===0)return e;if(e.indexOf("file:")===0)return e;e=e.replace("//","/");if(e.startsWith(this.config.prefixAssetPath))e=e.replace(this.config.prefixAssetPath,"");return this.config.prefixAssetPath+e+(this.config.suffixAssetPath||"")}clear(){this.emitEvent("patchClearStart");this.cgl.TextureEffectMesh=null;this.animFrameOps.length=0;this.timer=new x.M4;while(this.ops.length>0)this.deleteOp(this.ops[0].id);this._opIdCache={};this.emitEvent("patchClearEnd")}createOp(e,t,i=null){let n=null;let r="";try{if(!e){console.error("createop identifier false",e);console.log((new Error).stack);return}if(e.indexOf("Ops.")===-1){const s=e;if(CABLES.OPS[s]){r=CABLES.OPS[s].objName;n=new CABLES.OPS[s].f(this,r,t,s);n.opId=s}else{if(i){e=i;this._log.warn("could not find op by id: "+s)}else{throw new Error("could not find op by id: "+s,{cause:"opId:"+s})}}}if(!n){r=e;const a=e.split(".");const o=S.getOpClass(r);if(!o){this.emitEvent("criticalError",{title:"Unknown op: "+r,text:"Unknown op: "+r});this._log.error("unknown op: "+r);throw new Error("unknown op: "+r)}else{if(a.length==2)n=new window[a[0]][a[1]](this,r,t);else if(a.length==3)n=new window[a[0]][a[1]][a[2]](this,r,t);else if(a.length==4)n=new window[a[0]][a[1]][a[2]][a[3]](this,r,t);else if(a.length==5)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]](this,r,t);else if(a.length==6)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]](this,r,t);else if(a.length==7)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]](this,r,t);else if(a.length==8)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]](this,r,t);else if(a.length==9)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]][a[8]](this,r,t);else if(a.length==10)n=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]][a[8]][a[9]](this,r,t);else console.log("parts.length",a.length)}if(n){n.opId=null;for(const e in CABLES.OPS){if(CABLES.OPS[e].objName==r)n.opId=e}}}}catch(e){this._crashedOps.push(r);this._log.error("[instancing error] "+r,e);if(!this.isEditorMode()){this._log.error("INSTANCE_ERR","Instancing Error: "+r,e)}else{if(this.#initialDeserialize)S.getGui().patchView.store.opCrashed=true}}if(n){n._objName=r;n.patch=this}else{this._log.log("no op was created!?",e,t)}return n}addOp(e,t,i,n=false,r=null){const s=this.createOp(e,i,r);if(s){t=t||{};if(t.hasOwnProperty("errors"))delete t.errors;if(t.hasOwnProperty("error"))delete t.error;t.subPatch=t.subPatch||0;s.setUiAttribs(t);if(s.onCreate)s.onCreate();if(s.hasOwnProperty("onAnimFrame"))this.addOnAnimFrame(s);if(s.hasOwnProperty("onMasterVolumeChanged"))this._volumeListeners.push(s);if(this._opIdCache[s.id]){this._log.warn("opid with id "+s.id+" already exists in patch!");this.deleteOp(s.id)}this.ops.push(s);this._opIdCache[s.id]=s;if(this._subPatchCacheAdd)this._subPatchCacheAdd(t.subPatch,s);this.emitEvent(S.EVENT_OP_ADDED,s,n);if(s.init)s.init();s.emitEvent(M.EVENT_INIT,n)}else{this._log.error("addop: op could not be created: ",e)}return s}addOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t){return}this.animFrameOps.push(t)}removeOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++){if(this.animFrameOps[e]==t){this.animFrameOps.splice(e,1);return}}}addOnAnimFrameCallback(e){this.animFrameCallbacks.push(e)}removeOnAnimCallback(t){for(let e=0;e<this.animFrameCallbacks.length;e++){if(this.animFrameCallbacks[e]==t){this.animFrameCallbacks.splice(e,1);return}}}updateAnimMaxTimeSoon(){if(this.toAnimMaxTime)clearTimeout(this.toAnimMaxTime);this.toAnimMaxTime=setTimeout(()=>{this.updateAnimMaxTime()},50)}updateAnimMaxTime(){let i=0;for(let t=0;t<this.ops.length;t++){if(this.ops[t].hasAnimPort){for(let e=0;e<this.ops[t].portsIn.length;e++){if(this.ops[t].portsIn[e].anim){if(this.ops[t].portsIn[e].anim.lastKey&&this.ops[t].portsIn[e].anim.lastKey.time>i){i=this.ops[t].portsIn[e].anim.lastKey.time}}}}}if(i!=this.animMaxTime){this.animMaxTime=i;this.emitEvent(S.EVENT_ANIM_MAXTIME_CHANGE)}}deleteOp(n,r,s){let a=false;for(let i=0;i<this.ops.length;i++){if(this.ops[i].id==n){const o=this.ops[i];let e=null;let t=null;if(o){a=true;if(r){if(o.portsIn.length>0&&o.portsIn[0].isLinked()&&(o.portsOut.length>0&&o.portsOut[0].isLinked())){if(o.portsIn[0].getType()==o.portsOut[0].getType()&&o.portsIn[0].links[0]){e=o.portsIn[0].links[0].getOtherPort(o.portsIn[0]);t=o.portsOut[0].links[0].getOtherPort(o.portsOut[0])}}}const l=this.ops[i];l.removeLinks();this.ops.splice(i,1);l.emitEvent("delete",l);this.emitEvent(S.EVENT_OP_DELETED,l,s);if(this.clearSubPatchCache)this.clearSubPatchCache(l.uiAttribs.subPatch);if(l.onDelete)l.onDelete(s);l.cleanUp();if(e!==null&&t!==null){this.link(e.op,e.getName(),t.op,t.getName())}delete this._opIdCache[n];break}}}if(!a)this._log.warn("core patch deleteop: not found...",n)}getFrameNum(){return this._frameNum}emitOnAnimFrameEvent(t,i){t=t||this.timer.getTime();for(let e=0;e<this.animFrameCallbacks.length;++e)if(this.animFrameCallbacks[e])this.animFrameCallbacks[e](t,this._frameNum,i);for(let e=0;e<this.animFrameOps.length;++e)if(this.animFrameOps[e].onAnimFrame)this.animFrameOps[e].onAnimFrame(t,this._frameNum,i)}renderFrame(e){this.timer.update(this.reqAnimTimeStamp);this.freeTimer.update(this.reqAnimTimeStamp);const t=this.timer.getTime();const i=performance.now();this.cgl.frameStartTime=this.timer.getTime();const n=e-this.reqAnimTimeStamp||e;this.emitOnAnimFrameEvent(null,n);this.cgl.profileData.profileFrameDelta=n;this.reqAnimTimeStamp=e;this.cgl.profileData.profileOnAnimFrameOps=performance.now()-i;this.emitEvent(S.EVENT_RENDER_FRAME,t);this._frameNum++;if(this._frameNum==1){if(this.config.onFirstFrameRendered)this.config.onFirstFrameRendered()}}exec(e){if(!this.#renderOneFrame&&(this._paused||this.aborted))return;this.emitEvent("reqAnimFrame");cancelAnimationFrame(this._animReq);this.config.fpsLimit=this.config.fpsLimit||0;if(this.config.fpsLimit){this._frameInterval=1e3/this.config.fpsLimit}const t=CABLES.now();const i=t-this._frameNext;if(this.isEditorMode()){if(!this.#renderOneFrame){if(t-this._lastFrameTime>=500&&this._lastFrameTime!==0&&!this._frameWasdelayed){this._lastFrameTime=0;setTimeout(this.exec.bind(this),500);this.emitEvent("renderDelayStart");this._frameWasdelayed=true;return}}}if(this.#renderOneFrame||this.config.fpsLimit===0||i>this._frameInterval||this._frameWasdelayed){this.renderFrame(e);if(this._frameInterval)this._frameNext=t-i%this._frameInterval}if(this._frameWasdelayed){this.emitEvent("renderDelayEnd");this._frameWasdelayed=false}if(this.#renderOneFrame){if(this.onOneFrameRendered)this.onOneFrameRendered();this.emitEvent(S.EVENT_RENDERED_ONE_FRAME);this._renderOneFrame=false}if(this.config.doRequestAnimation)this._animReq=this.cgl.canvas.ownerDocument.defaultView.requestAnimationFrame(this.exec.bind(this))}link(e,t,i,n,r=false,s=false){if(!e)return this._log.warn("link: op1 is null ");if(!i)return this._log.warn("link: op2 is null");const a=e.getPort(t,r);const o=i.getPort(n,r);if(!a)return this._log.warn("port1 not found! "+t+" ("+e.objName+")");if(!o)return this._log.warn("port2 not found! "+n+" of "+i.name+"("+i.objName+")",i);if(!a.shouldLink(a,o)||!o.shouldLink(a,o))return false;if(p.canLink(a,o)){const l=new p(this);l.link(a,o);this.emitEvent(S.EVENT_LINK,a,o,l,s);return l}}serialize(e){const t={};e=e||{};t.ops=[];t.settings=this.settings;for(let e=0;e<this.ops.length;e++){const i=this.ops[e];if(i&&i.getSerialized)t.ops.push(i.getSerialized())}(0,b.cleanJson)(t);if(e.asObject)return t;return JSON.stringify(t)}getOpsByRefId(t){const e=S.getGui().uiProfiler.start("[corepatchetend] getOpsByRefId");const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].storage&&this.ops[e].storage.ref==t)i.push(this.ops[e]);e.finish();return i}getOpById(e){return this._opIdCache[e]}getOpsByObjName(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].objName==t)i.push(this.ops[e]);return i}getOpsByOpId(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].opId==t)i.push(this.ops[e]);return i}getSubPatchOpsByName(t,i){const n=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)n.push(this.ops[e]);return n}getSubPatchOp(e,t){return this.getFirstSubPatchOpByName(e,t)}getFirstSubPatchOpByName(t,i){for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)return this.ops[e];return null}_addLink(e,t,i,n){return this.link(this.getOpById(e),i,this.getOpById(t),n,false,true)}logStartup(e){if(window.logStartup)window.logStartup(e)}deSerialize(a,e={genIds:false,createRef:false}){if(this.aborted)return;const n=[];const t=this.loading.start("core","deserialize");if(typeof a==="string")a=JSON.parse(a);if(this.#initialDeserialize){this.namespace=a.namespace||"";this.name=a.name||"";this.settings=a.settings}this.emitEvent("patchLoadStart");a.ops=a.ops||[];this.logStartup("add "+a.ops.length+" ops... ");const r=[];for(let i=0;i<a.ops.length;i++){const s=CABLES.now();const o=a.ops[i];let t=null;try{if(o.opId)t=this.addOp(o.opId,o.uiAttribs,o.id,true,o.objName);else t=this.addOp(o.objName,o.uiAttribs,o.id,true)}catch(e){this._log.error("[instancing error] op data:",o,e)}if(t){r.push(t);if(e.genIds)t.id=(0,b.shortId)();t.portsInData=o.portsIn;t._origData=JSON.parse(JSON.stringify(o));t.storage=o.storage;if(o.portsIn)for(let e=0;e<o.portsIn.length;e++){const u=o.portsIn[e];if(u&&u.hasOwnProperty("name")){const h=t.getPort(u.name);if(h&&(h.uiAttribs.display=="bool"||h.uiAttribs.type=="bool")&&!isNaN(u.value))u.value=u.value==true?1:0;if(h&&u.value!==undefined&&h.type!=v.I.TYPE_TEXTURE)h.set(u.value);if(h){h.deSerializeSettings(u)}else{t.preservedPortValues=t.preservedPortValues||{};t.preservedPortValues[u.name]=u.value}}}if(o.portsOut)for(let e=0;e<o.portsOut.length;e++){const u=o.portsOut[e];if(u&&u.hasOwnProperty("name")){const c=t.getPort(u.name);if(c){c.deSerializeSettings(u);if(c.uiAttribs.hasOwnProperty("title")){t.preservedPortTitles=t.preservedPortTitles||{};t.preservedPortTitles[c.name]=c.uiAttribs.title}if(c.type!=v.I.TYPE_TEXTURE&&u.hasOwnProperty("value"))c.set(a.ops[i].portsOut[e].value);if(u.expose)c.setUiAttribs({expose:true})}}}n.push(t)}const l=Math.round(100*(CABLES.now()-s))/100;if(!this.silent&&l>5)console.log("long op init ",a.ops[i].objName,l)}this.logStartup("add ops done");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoadedValueSet){this.ops[e].onLoadedValueSet(this.ops[e]._origData);this.ops[e].onLoadedValueSet=null;this.ops[e]._origData=null}this.ops[e].emitEvent(S.EVENT_VALUESSET)}this.logStartup("creating links");if(e.opsCreated)e.opsCreated(r);if(a.ops){for(let s=0;s<a.ops.length;s++){if(a.ops[s].portsIn){for(let t=0;t<a.ops[s].portsIn.length;t++){if(a.ops[s].portsIn[t]&&a.ops[s].portsIn[t].links){for(let e=0;e<a.ops[s].portsIn[t].links.length;e++){this._addLink(a.ops[s].portsIn[t].links[e].objIn,a.ops[s].portsIn[t].links[e].objOut,a.ops[s].portsIn[t].links[e].portIn,a.ops[s].portsIn[t].links[e].portOut)}}}}if(a.ops[s].portsOut)for(let r=0;r<a.ops[s].portsOut.length;r++)if(a.ops[s].portsOut[r]&&a.ops[s].portsOut[r].links){for(let n=0;n<a.ops[s].portsOut[r].links.length;n++){if(a.ops[s].portsOut[r].links[n]){if(a.ops[s].portsOut[r].links[n].subOpRef){const f=this.getOpById(a.ops[s].portsOut[r].links[n].objOut);let t=null;let i=0;for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==a.ops[s].portsOut[r].links[n].subOpRef&&f.uiAttribs.subPatch==this.ops[e].uiAttribs.subPatch){i=this.ops[e].patchId.get();break}}for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==a.ops[s].portsOut[r].links[n].refOp&&this.ops[e].uiAttribs.subPatch==i){t=this.ops[e];break}}if(!t)this._log.warn("could not find op for lost link");else{this._addLink(t.id,a.ops[s].portsOut[r].links[n].objOut,a.ops[s].portsOut[r].links[n].portIn,a.ops[s].portsOut[r].links[n].portOut)}}else{const i=this._addLink(a.ops[s].portsOut[r].links[n].objIn,a.ops[s].portsOut[r].links[n].objOut,a.ops[s].portsOut[r].links[n].portIn,a.ops[s].portsOut[r].links[n].portOut);if(!i){const d=this.getOpById(a.ops[s].portsOut[r].links[n].objIn);const g=this.getOpById(a.ops[s].portsOut[r].links[n].objOut);if(!d)console.log("could not find link op1");if(!g)console.log("could not find link op2");const m=a.ops[s].portsOut[r].links[n].portIn;if(d&&!d.getPort(m)){d.preservedPortLinks[m]=d.preservedPortLinks[m]||[];d.preservedPortLinks[m].push(a.ops[s].portsOut[r].links[n])}const p=a.ops[s].portsOut[r].links[n].portOut;if(g&&!g.getPort(p)){g.preservedPortLinks[m]=g.preservedPortLinks[m]||[];g.preservedPortLinks[m].push(a.ops[s].portsOut[r].links[n])}}}}}}}}this.logStartup("calling ops onloaded");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoaded){this.ops[e].onLoaded();this.ops[e].onLoaded=null}}this.logStartup("initializing ops...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].init){try{this.ops[e].init();this.ops[e].init=null}catch(e){console.error("op.init crash",e)}}}this.logStartup("initializing vars...");if(this.config.variables)for(const _ in this.config.variables)this.setVarValue(_,this.config.variables[_]);this.logStartup("initializing var ports");for(let e=0;e<this.ops.length;e++){this.ops[e].initVarPorts();delete this.ops[e].uiAttribs.pasted}setTimeout(()=>{this.loading.finished(t)},100);this.updateAnimMaxTime();if(this.config.onPatchLoaded)this.config.onPatchLoaded(this);this.emitEvent(S.EVENT_PATCHLOADEND,n,a,e.genIds);this.#initialDeserialize=false}profile(e){this.profiler=new O(this);for(let e=0;e<this.ops.length;e++)this.ops[e].profile()}setVariable(e,t){if(this._variables[e]!==undefined){this._variables[e].setValue(t)}else{this._log.warn("variable "+e+" not found!")}}_sortVars(){if(!this.isEditorMode())return;const t={};Object.keys(this._variables).sort((e,t)=>{return e.localeCompare(t,"en",{sensitivity:"base"})}).forEach(e=>{t[e]=this._variables[e]});this._variables=t}hasVar(e){return this._variables[e]!==undefined}setVarValue(e,t,i){if(this.hasVar(e)){this._variables[e].setValue(t)}else{this._variables[e]=new I(e,t,i);this._sortVars();this.emitEvent(S.EVENT_VARIABLES_CHANGED)}return this._variables[e]}getVarValue(e,t){if(this._variables.hasOwnProperty(e))return this._variables[e].getValue()}getVar(e){if(this._variables.hasOwnProperty(e))return this._variables[e]}deleteVar(i){for(let t=0;t<this.ops.length;t++)for(let e=0;e<this.ops[t].portsIn.length;e++)if(this.ops[t].portsIn[e].getVariableName()==i)this.ops[t].portsIn[e].setVariable(null);delete this._variables[i];this.emitEvent("variableDeleted",i);this.emitEvent("variablesChanged")}getVars(t){if(t===undefined)return this._variables;if(t===1)return{};const e=S.getGui().uiProfiler.start("[corepatchetend] getVars");const i=[];let n="";if(t==v.I.TYPE_STRING)n="string";else if(t==v.I.TYPE_VALUE)n="number";else if(t==v.I.TYPE_ARRAY)n="array";else if(t==v.I.TYPE_OBJECT)n="object";else if(t==v.I.TYPE_DYNAMIC)n="dynamic";else{console.log("unknown port type",t);console.log((new Error).stack)}for(const e in this._variables){if(!this._variables[e].type||this._variables[e].type==n||this._variables[e].type==t)i.push(this._variables[e])}e.finish();return i}preRenderOps(){this._log.log("prerendering...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].preRender){this.ops[e].preRender();this._log.log("prerender "+this.ops[e].objName)}}}dispose(){this.pause();this.clear();this.cgl.dispose()}pushTriggerStack(e){this._triggerStack.push(e)}popTriggerStack(){this._triggerStack.pop()}printTriggerStack(){if(this._triggerStack.length==0){return}console.groupCollapsed("trigger port stack "+this._triggerStack[this._triggerStack.length-1].op.objName+"."+this._triggerStack[this._triggerStack.length-1].name);const t=[];for(let e=0;e<this._triggerStack.length;e++){t.push(e+". "+this._triggerStack[e].op.objName+" "+this._triggerStack[e].name)}console.table(t);console.groupEnd()}get containerElement(){return this.config.containerElement||this.cgl.canvas.parentElement||null}getDocument(){return this.containerElement.ownerDocument}static getOpClass(e){const t=e.split(".");let i=null;try{if(t.length==2)i=window[t[0]][t[1]];else if(t.length==3)i=window[t[0]][t[1]][t[2]];else if(t.length==4)i=window[t[0]][t[1]][t[2]][t[3]];else if(t.length==5)i=window[t[0]][t[1]][t[2]][t[3]][t[4]];else if(t.length==6)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]];else if(t.length==7)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]];else if(t.length==8)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]];else if(t.length==9)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]];else if(t.length==10)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]][t[9]];return i}catch(e){return null}}static replaceOpIds(n,r){const t={};for(const e in n.ops){t[n.ops[e].id]=n.ops[e]}for(const i in n.ops){for(const o in n.ops[i].portsOut){const l=n.ops[i].portsOut[o].links;if(l){let e=l.length;while(e--){if(l[e]&&(!t[l[e].objIn]||!t[l[e].objOut])){if(!r.doNotUnlinkLostLinks){l.splice(e,1)}else{if(r.fixLostLinks){const u=S.getGui().corePatch().getOpById(l[e].objIn);if(!u)console.log("op not found!");else{const h=S.getGui().patchView.getSubPatchOuterOp(u.uiAttribs.subPatch);if(h){u.storage=u.storage||{};u.storage.ref=u.storage.ref||(0,b.shortId)();l[e].refOp=u.storage.ref;l[e].subOpRef=h.storage.ref}}}}}}}}}for(const t in n.ops){const u=n.ops[t];const c=u.id;let e=(0,b.shortId)();if(r.prefixHash)e=(0,b.prefixedHash)(r.prefixHash+c);else if(r.prefixId)e=r.prefixId+c;else if(r.refAsId){if(u.storage&&u.storage.ref){e=u.storage.ref;delete u.storage.ref}else{u.storage=u.storage||{};u.storage.ref=e=(0,b.shortId)()}}const f=u.id=e;if(r.oldIdAsRef){u.storage=u.storage||{};u.storage.ref=c}for(const i in n.ops){if(n.ops[i].portsIn)for(const o in n.ops[i].portsIn){if(n.ops[i].portsIn[o].links){let e=n.ops[i].portsIn[o].links.length;while(e--)if(n.ops[i].portsIn[o].links[e]===null)n.ops[i].portsIn[o].links.splice(e,1);for(e in n.ops[i].portsIn[o].links){if(n.ops[i].portsIn[o].links[e].objIn===c)n.ops[i].portsIn[o].links[e].objIn=f;if(n.ops[i].portsIn[o].links[e].objOut===c)n.ops[i].portsIn[o].links[e].objOut=f}}}if(n.ops[i].portsOut)for(const o in n.ops[i].portsOut){if(n.ops[i].portsOut[o].links){let e=n.ops[i].portsOut[o].links.length;while(e--)if(n.ops[i].portsOut[o].links[e]===null)n.ops[i].portsOut[o].links.splice(e,1);for(e in n.ops[i].portsOut[o].links){if(n.ops[i].portsOut[o].links[e].objIn===c)n.ops[i].portsOut[o].links[e].objIn=f;if(n.ops[i].portsOut[o].links[e].objOut===c)n.ops[i].portsOut[o].links[e].objOut=f}}}}}const s=[];const a=[];for(let i=0;i<n.ops.length;i++){if(n.ops[i].storage&&n.ops[i].storage.subPatchVer){for(let t=0;t<n.ops[i].portsIn.length;t++){if(n.ops[i].portsIn[t].name==="patchId"){let e=(0,b.shortId)();if(r.prefixHash)e=(0,b.prefixedHash)(r.prefixHash+n.ops[i].portsIn[t].value);const d=n.ops[i].portsIn[t].value;const g=n.ops[i].portsIn[t].value=e;s.push(g);for(let e=0;e<n.ops.length;e++){if(n.ops[e].uiAttribs){if(n.ops[e].uiAttribs.subPatch===d){n.ops[e].uiAttribs.subPatch=g;a.push(n.ops[e].id)}}}}}}}for(const m in n.ops){let t=false;for(let e=0;e<a.length;e++){if(n.ops[m].id===a[e]){t=true;break}}if(!t&&n.ops[m].uiAttribs&&r.parentSubPatchId!=null)n.ops[m].uiAttribs.subPatch=r.parentSubPatchId}return n}}class y extends v.I{constructor(e,t,i,n,r){super(e,t,i,n);this.get=()=>{let e=super.get();if(CABLES.UI){if(e===""||e===null||e===undefined||n.values&&n.values.indexOf(String(e))===-1){this.op.setUiError("invalidswitch","Invalid Value ["+this.name+']: "'+e+'"',1)}else this.op.setUiError("invalidswitch",null)}if(e===null||e===undefined)e="";return e};this.indexPort=r;this.indexPort.set=e=>{const t=n.values;if(!t){return}let i=Math.floor(e);i=Math.min(i,t.length-1);i=Math.max(i,0);this.indexPort.setValue(i);this.set(t[i]);if(this.op.patch.isEditorMode()&&performance.now()-(this.lastTime||0)>100&&S.getGui()&&S.getGui().patchView.isCurrentOp(this.op)){S.getGui().opParams.show(this.op);this.lastTime=performance.now()}}}setUiAttribs(e){const t=e.hidePort;e.hidePort=true;super.setUiAttribs(e);if(typeof t!=="undefined")this.indexPort.setUiAttribs({hidePort:t})}}class C extends y{setUiAttribs(e){if(this.indexPort.isLinked()){for(const t in e){if(t=="greyout"&&!e[t])e[t]="true"}}super.setUiAttribs(e)}}const R=2;class N extends v.I{constructor(e,i,n,r,t,s){super(e,i,v.I.TYPE_ARRAY,t);this.setUiAttribs({multiPort:true,group:this.name,order:-1});this.ports=[];this.direction=r;this._uiAttribsPorts=s;const a=()=>{const t=[];let i=1;if(this.uiAttribs.multiPortManual)i=0;for(let e=0;e<this.ports.length-i;e++)t[e]=this.ports[e];this.setRef(t)};const o=()=>{let s=!this.uiAttribs.multiPortManual||false;if(this.direction==T.a.PORT.PORT_DIR_OUT)s=false;for(let r=0;r<this.ports.length;r++){let e;let t=false;let i;let n={};if(this.op.preservedPortTitles&&this.op.preservedPortTitles[this.ports[r].name])i=this.op.preservedPortTitles[this.ports[r].name];if(r==0)e=this.ports.length;if(!this.uiAttribs.multiPortManual)if(r==this.ports.length-1){i="add port";t=true;s=true}for(const a in this._uiAttribsPorts){n[a]=this._uiAttribsPorts[a]}n.addPort=t;n.longPort=e;n.title=i;n.greyout=s;n.group=this.name;this.ports[r].setUiAttribs(n)}};this.removeInvalidPorts=()=>{for(let e=0;e<this.ports.length;e++){if(!this.ports[e])this.ports.splice(e,1)}if(!this.uiAttribs.multiPortManual){if(this.ports.length>R)for(let e=this.ports.length-1;e>1;e--){if(!this.ports[e].isLinked())this.uiAttribs.multiPortNum=e;else break}}a()};this.countPorts=()=>{const e=S.getGui();if(CABLES.UI&&!e.isRemoteClient&&e.patchView&&e.patchView.patchRenderer&&e.patchView.patchRenderer.isDraggingPort()){clearTimeout(this.retryTo);this.retryTo=setTimeout(this.countPorts.bind(this));return}this.retryTo=null;let i=false;this.removeListeners();this.removeInvalidPorts();for(let e=0;e<this.ports.length;e++){if(this.ports[e]&&this.ports[e].links.length>1){const n=this.ports[e+1];const r=this.ports[e].links[0].getOtherPort(this.ports[e]);if(!n||!r){this._log.warn("no port found?")}else{this.ports[e].links[0].remove();this.op.patch.link(this.op,n.name,r.op,r.name);i=true}break}}if(!this.uiAttribs.multiPortManual){let t=true;while(t){t=false;for(let e=this.ports.length-1;e>1;e--){if(this.ports[e]&&this.ports[e].links.length>0&&this.ports[e-1].links.length==0){const r=this.ports[e].links[0].getOtherPort(this.ports[e]);this.ports[e].links[0].remove();const n=this.ports[e-1];if(n&&this.ports[e]){this.op.patch.link(this.op,n.name,r.op,r.name);t=true;i=true;break}}}}}if(!this.uiAttribs.multiPortManual){while(this.ports.length>R&&!this.ports[this.ports.length-1].isLinked()&&!this.ports[this.ports.length-2].isLinked()){let e=this.ports.length-1;if(!this.ports[e].isLinked()&&this.ports[e-1]&&!this.ports[e-1].isLinked()){this.ports[e].setUiAttribs({removed:true});this.ports[e].remove();this.ports.splice(e,1)}}}this.removeInvalidPorts();if(!this.uiAttribs.multiPortManual&&this.ports.length>0&&this.ports[this.ports.length-1].isLinked())this.newPort();a();o();if(i)this.countPorts();else this.addListeners()};this.removeListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener)}};this.addListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];const i=e;if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);t.multiPortChangeListener=t.on("change",a.bind(this));if(t.multiPortTriggerListener)t.multiPortTriggerListener=t.off(t.multiPortTriggerListener);t.multiPortTriggerListener=t.on("trigger",()=>{this._onTriggered()});if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener);t.multiLinkChangeListener=t.on("onLinkChanged",()=>{this.countPorts();this.emitEvent("onLinkChanged")});if(t.multiLinkRemoveListener)t.multiLinkRemoveListener=t.off(t.multiLinkRemoveListener);t.multiLinkRemoveListener=t.on("onLinkRemoved",()=>{o();this.emitEvent("onLinkChanged")})}};this.newPort=()=>{const e={};e.type=n;const t=new v.I(this.op,i+"_"+this.ports.length,n,e);t.direction=r;if(this.direction==T.a.PORT.PORT_DIR_OUT)this.op.addOutPort(t);else this.op.addInPort(t,this.ports[this.ports.length-1]);this.ports.push(t);if(n==v.I.TYPE_NUMBER)t.setInitialValue(0);else if(n==v.I.TYPE_STRING)t.setInitialValue("");this.addListeners();o();a();this.emitEvent("onLinkChanged");if(this.op.preservedPortTitles&&this.op.preservedPortTitles[t.name])t.setUiAttribs({title:this.op.preservedPortTitles[t.name]});return t};this.initPorts=()=>{for(let e=0;e<R;e++)this.newPort();a();o()};this.checkNum=()=>{this.uiAttribs.multiPortNum=Math.max(R,this.uiAttribs.multiPortNum);while(this.ports.length<this.uiAttribs.multiPortNum)this.newPort();while(this.ports.length>this.uiAttribs.multiPortNum)if(this.ports[this.ports.length-1])this.ports.pop().remove();this.removeInvalidPorts()};this.incDec=e=>{this.uiAttribs.multiPortNum=this.uiAttribs.multiPortNum||R;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+e});this.checkNum();o()};this.toggleManual=()=>{this.setUiAttribs({multiPortManual:!this.uiAttribs.multiPortManual});this.op.refreshParams()};this.on("onUiAttrChange",e=>{if(e.hasOwnProperty("multiPortManual")){o();this.removeInvalidPorts();this.checkNum();this.countPorts();o()}});this.on("onUiAttrChange",this.checkNum.bind(this));this.checkNum();this.countPorts();this.removeInvalidPorts();o()}}class M extends d.A{static OP_VERSION_PREFIX="_v";static EVENT_INIT="init";static EVENT_UIATTR_CHANGE="onUiAttribsChange";#objName="";_log=new g.A("core_op");#shortOpName="";opId="";portsOut=[];patch=null;data={};storage={};portsIn=[];portsInData=[];uiAttribs={};enabled=true;onAnimFrame=null;preservedPortTitles={};preservedPortValues={};preservedPortLinks={};linkTimeRules={needsLinkedToWork:[],needsStringToWork:[],needsParentOp:null};shouldWork={};hasUiErrors=0;uiErrors={};hasAnimPort=false;patchId=null;constructor(e,t,i=null){super();this.opId=i;this.#objName=t;this.patch=e;this.#shortOpName=CABLES.getShortOpName(t);this.getTitle();this.id=i||(0,b.shortId)();this.onAddPort=null;this.onCreate=null;this.onResize=null;this.onLoaded=null;this.onDelete=null;this.onError=null;this._instances=null;this.preRender=null;this.init=null}isInBlueprint2(){return false}get name(){return this.getTitle()}set name(e){this.setTitle(e)}set _objName(e){this.#objName=e;this._log=new g.A("op "+e)}get objName(){return this.#objName}get shortName(){return this.#shortOpName}require(e){if(CABLES.platform&&CABLES.StandaloneElectron&&!CABLES.platform.frontendOptions.isElectron)this.setUiError("notstandalone","This op will only work in cables standalone version",3);return null}checkMainloopExists(){if(!CABLES.UI)return;if(!this.patch.tempData.mainloopOp)this.setUiError("nomainloop","patch should have a mainloop to use this op");else this.setUiError("nomainloop",null)}getTitle(){if(!this.uiAttribs)return"nouiattribs"+this.shortName;return this.uiAttribs.title||this.#shortOpName}setTitle(e){if(e!=this.getTitle())this._setUiAttrib({title:e})}setStorage(e){if(!e)return;this.storage=this.storage||{};let t=false;for(const i in e){if(this.storage[i]!=e[i])t=true;this.storage[i]=e[i]}if(t)this.emitEvent("onStorageChange",e)}isSubPatchOp(){if(this.patchId&&this.storage)return this.storage.subPatchVer||this.storage.blueprintVer||0;return false}setUiAttrib(e){this._setUiAttrib(e)}setUiAttribs(e){this._setUiAttrib(e)}uiAttr(e){this._setUiAttrib(e)}_setUiAttrib(e){if(!e)return;if(typeof e!="object")this._log.error("op.uiAttrib attribs are not of type object");if(!this.uiAttribs)this.uiAttribs={};let t=false;let i=false;if(CABLES.UI&&e.hasOwnProperty("translate")&&(!this.uiAttribs.translate||this.uiAttribs.translate.x!=e.translate.x||this.uiAttribs.translate.y!=e.translate.y))i=true;if(e.hasOwnProperty("title")&&e.title!=this.uiAttribs.title){this.uiAttribs.title=e.title;t=true}if(e.hasOwnProperty("disabled")){t=true;this.setEnabled(!e.disabled)}for(const n in e){if(this.uiAttribs[n]!=e[n])t=true;this.uiAttribs[n]=e[n]}if(this.uiAttribs.hasOwnProperty("highlighted")&&this.uiAttribs.highlighted==false)delete this.uiAttribs.highlighted;if(this.uiAttribs.hasOwnProperty("highlightedMore")&&this.uiAttribs.highlightedMore==false)delete this.uiAttribs.highlightedMore;if(this.uiAttribs.hasOwnProperty("selected")&&this.uiAttribs.selected==false)delete this.uiAttribs.selected;if(this.uiAttribs.hasOwnProperty("selected"))t=true;if(t){this.emitEvent(M.EVENT_UIATTR_CHANGE,e);this.patch.emitEvent("onUiAttribsChange",this,e)}if(i)this.emitEvent("move")}getName(){return this.#shortOpName}addOutPort(e){e.direction=T.a.PORT.PORT_DIR_OUT;if(e.op!=this)console.error("port op is not this...");this.portsOut.push(e);this.emitEvent("onPortAdd",e);return e}hasDynamicPort(){let e=0;for(e=0;e<this.portsIn.length;e++){if(this.portsIn[e].type==v.I.TYPE_DYNAMIC)return true;if(this.portsIn[e].getName()=="dyn")return true}for(e=0;e<this.portsOut.length;e++){if(this.portsOut[e].type==v.I.TYPE_DYNAMIC)return true;if(this.portsOut[e].getName()=="dyn")return true}return false}addInPort(e,t){e.direction=v.I.DIR_IN;e._op=this;if(!t){this.portsIn.push(e)}else{const i=this.portsIn.indexOf(t);this.portsIn.splice(i+1,0,e)}this.emitEvent("onPortAdd",e);return e}inFunction(e,t){return this.inTrigger(e,t)}inTrigger(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}inTriggerButton(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_FUNCTION,{display:"button"}));if(t!==undefined)i.set(t);return i}inUiTriggerButtons(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_FUNCTION,{display:"buttons"}));if(t!==undefined)i.set(t);return i}inValueFloat(e,t){return this.inFloat(e,t)}inValue(e,t){return this.inFloat(e,t)}inFloat(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_VALUE));i.setInitialValue(t);return i}inValueBool(e,t){return this.inBool(e,t)}inBool(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_NUMBER,{display:"bool"}));if(t===true)t=1;if(t===false)t=0;i.setInitialValue(t);return i}inMultiPort(e,t,i){const n={addPort:true,hidePort:true};const r=new N(this,e,t,v.I.DIR_IN,n,i);r.ignoreValueSerialize=true;this.addInPort(r);r.initPorts();return r}outMultiPort(e,t,i={}){const n=new N(this,e,t,T.a.PORT.PORT_DIR_OUT,{display:"multiport",hidePort:true},i);n.ignoreValueSerialize=true;this.addOutPort(n);n.initPorts();return n}inValueString(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_VALUE,{type:"string"}));i.value="";i.setInitialValue(t);return i}inString(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_STRING,{type:"string"}));t=t||"";i.setInitialValue(t);return i}inTextarea(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_STRING,{type:"string",display:"text"}));i.value="";if(t!==undefined){i.set(t);i.defaultValue=t}return i}inStringEditor(e,t,i,n=true){const r=this.addInPort(new v.I(this,e,v.I.TYPE_STRING,{type:"string",display:"editor",editShortcut:true,editorSyntax:i,hideFormatButton:n}));r.value="";if(t!==undefined){r.set(t);r.defaultValue=t}return r}inValueEditor(e,t,i,n=true){const r=this.addInPort(new v.I(this,e,v.I.TYPE_NUMBER,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:n}));r.value="";if(t!==undefined){r.set(t);r.defaultValue=t}return r}inValueSelect(e,t,i,n){return this.inDropDown(e,t,i,n)}inDropDown(e,t,i,n){let r=null;if(!n){const s=new v.I(this,e+" index",v.I.TYPE_NUMBER,{increment:"integer",hideParam:true});const a=this.addInPort(s);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new C(this,e,v.I.TYPE_NUMBER,{display:"dropdown",hidePort:true,type:"string",values:t},a);o.indexPort=s;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});s.onLinkChanged=()=>{o.setUiAttribs({greyout:s.isLinked()})};r=this.addInPort(o);if(i!==undefined){r.set(i);const l=t.findIndex(e=>{return e==i});a.setValue(l);r.defaultValue=i;a.defaultValue=l}}else{const o=new v.I(this,e,v.I.TYPE_VALUE,{display:"dropdown",hidePort:true,type:"string",values:t});r=this.addInPort(o)}return r}inSwitch(e,t,i,n){let r=null;if(!n){if(!i)i=t[0];const s=new v.I(this,e+" index",v.I.TYPE_VALUE,{increment:"integer",values:t,hideParam:true});const a=this.addInPort(s);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new y(this,e,v.I.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t},a);o.indexPort=s;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})};r=this.addInPort(o);if(i!==undefined){r.set(i);const l=t.findIndex(e=>{return e==i});a.setValue(l);r.defaultValue=i;a.defaultValue=l}}else{const o=new v.I(this,e,v.I.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t});r=this.addInPort(o)}return r}inValueInt(e,t){return this.inInt(e,t)}inInt(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_VALUE,{increment:"integer"}));if(t!==undefined){i.set(t);i.defaultValue=t}return i}inFile(e,t,i){const n=this.addInPort(new v.I(this,e,v.I.TYPE_VALUE,{display:"file",type:"string",filter:t}));if(i!==undefined){n.set(i);n.defaultValue=i}return n}inUrl(e,t,i){const n=this.addInPort(new v.I(this,e,v.I.TYPE_STRING,{display:"file",type:"string",filter:t}));if(i!==undefined){n.set(i);n.defaultValue=i}return n}inTexture(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_OBJECT,{display:"texture",objType:"texture",preview:true}));i.ignoreValueSerialize=true;if(t!==undefined)i.set(t);return i}inObject(e,t,i){const n=this.addInPort(new v.I(this,e,v.I.TYPE_OBJECT,{objType:i}));n.ignoreValueSerialize=true;if(t!==undefined)n.set(t);return n}inGradient(e,t){const i=this.addInPort(new v.I(this,e,v.I.TYPE_VALUE,{display:"gradient"}));if(t!==undefined)i.set(t);return i}getPortVisibleIndex(t){let i=this.portsIn;if(t.direction==T.a.PORT_DIR_OUT)i=this.portsOut;let n=0;for(let e=0;e<i.length;e++){if(i[e].uiAttribs.hidePort)continue;n++;if(i[e]==t)return n}}inArray(e,t=undefined,i=undefined){let n=i;if(!i&&CABLES.isNumeric(t))n=t;const r=this.addInPort(new v.I(this,e,v.I.TYPE_ARRAY,{stride:n}));if(t!==undefined&&(Array.isArray(t)||t==null))r.set(t);return r}inValueSlider(e,t,i,n){return this.inFloatSlider(e,t,i,n)}inFloatSlider(e,t,i,n){const r={display:"range"};if(i!=undefined&&n!=undefined){r.min=i;r.max=n}const s=this.addInPort(new v.I(this,e,v.I.TYPE_VALUE,r));if(t!==undefined){s.set(t);s.defaultValue=t}return s}outFunction(e,t){return this.outTrigger(e,t)}outTrigger(e,t){const i=this.addOutPort(new v.I(this,e,v.I.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}outValue(e,t){return this.outNumber(e,t)}outNumber(e,t){const i=this.addOutPort(new v.I(this,e,v.I.TYPE_VALUE));if(t!==undefined)i.set(t);return i}outValueBool(e,t){return this.outBool(e,t)}outBool(e,t){const i=this.addOutPort(new v.I(this,e,v.I.TYPE_VALUE,{display:"bool"}));if(t!==undefined)i.set(t);else i.set(0);return i}outBoolNum(e,t){const i=this.addOutPort(new v.I(this,e,v.I.TYPE_VALUE,{display:"boolnum"}));i.set=function(e){this.setValue(e?1:0)}.bind(i);if(t!==undefined)i.set(t);else i.set(0);return i}outValueString(e,t){const i=this.addOutPort(new v.I(this,e,v.I.TYPE_VALUE,{type:"string"}));if(t!==undefined)i.set(t);return i}outString(e,t){const i=this.addOutPort(new v.I(this,e,v.I.TYPE_STRING,{type:"string"}));if(t!==undefined)i.set(t);else i.set("");return i}outObject(e,t,i){const n=this.addOutPort(new v.I(this,e,v.I.TYPE_OBJECT,{objType:i||null}));n.set(t||null);n.ignoreValueSerialize=true;return n}outArray(e,t,i){if(!i&&CABLES.isNumeric(t))i=t;const n=this.addOutPort(new v.I(this,e,v.I.TYPE_ARRAY,{stride:i}));if(t!==undefined&&(Array.isArray(t)||t==null))n.set(t);n.ignoreValueSerialize=true;return n}outTexture(e,t){const i=this.addOutPort(new v.I(this,e,v.I.TYPE_OBJECT,{preview:true,objType:"texture",display:"texture"}));if(t!==undefined)i.setRef(t||_.Rq.Texture.getEmptyTexture(this.patch.cgl));i.ignoreValueSerialize=true;return i}inDynamic(e,t,i,n){const r=new v.I(this,e,v.I.TYPE_DYNAMIC,i);r.shouldLink=()=>{if(t&&Array.isArray(t))return false;return true};this.addInPort(r);if(n!==undefined){r.set(n);r.defaultValue=n}return r}removeLinks(){for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].removeLinks();for(let e=0;e<this.portsOut.length;e++)this.portsOut[e].removeLinks()}getSerialized(){const t={};if(this.opId)t.opId=this.opId;if(this.patch.storeObjNames)t.objName=this.objName;t.id=this.id;t.uiAttribs=JSON.parse(JSON.stringify(this.uiAttribs))||{};if(this.storage&&Object.keys(this.storage).length>0)t.storage=JSON.parse(JSON.stringify(this.storage));if(this.uiAttribs.hasOwnProperty("working")&&this.uiAttribs.working==true)delete this.uiAttribs.working;if(t.uiAttribs.hasOwnProperty("uierrors"))delete t.uiAttribs.uierrors;if(t.uiAttribs.hasOwnProperty("highlighted"))delete t.uiAttribs.highlighted;if(t.uiAttribs.hasOwnProperty("highlightedMore"))delete t.uiAttribs.highlightedMore;if(t.uiAttribs.title==="")delete t.uiAttribs.title;if(t.uiAttribs.color===null)delete t.uiAttribs.color;if(t.uiAttribs.comment===null)delete t.uiAttribs.comment;if(t.uiAttribs.title==this.#shortOpName||(this.uiAttribs.title||"").toLowerCase()==this.#shortOpName.toLowerCase())delete t.uiAttribs.title;t.portsIn=[];t.portsOut=[];for(let e=0;e<this.portsIn.length;e++){const i=this.portsIn[e].getSerialized();if(i)t.portsIn.push(i)}for(let e=0;e<this.portsOut.length;e++){const i=this.portsOut[e].getSerialized();if(i)t.portsOut.push(i)}if(t.portsIn.length==0)delete t.portsIn;if(t.portsOut.length==0)delete t.portsOut;(0,b.cleanJson)(t);return t}getFirstOutPortByType(t){for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].type==t)return this.portsOut[e]}getFirstInPortByType(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].type==t)return this.portsIn[e]}getPort(e,t=false){return this.getPortByName(e,t)}getPortByName(t,e=false){if(e){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName().toLowerCase()==t||this.portsIn[e].id.toLowerCase()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName().toLowerCase()==t||this.portsOut[e].id.toLowerCase()==t)return this.portsOut[e]}else{for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName()==t||this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName()==t||this.portsOut[e].id==t)return this.portsOut[e]}}getPortById(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].id==t)return this.portsOut[e]}updateAnims(){if(this.hasAnimPort)for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].updateAnim()}log(){this._log.log(...arguments)}error(){this._log.error(...arguments)}logError(){this._log.error(...arguments)}warn(){this._log.warn(...arguments)}logWarn(){this._log.warn(...arguments)}verbose(){this._log.verbose(...arguments)}logVerbose(){this._log.verbose(...arguments)}profile(){for(let e=0;e<this.portsIn.length;e++){this.portsIn[e]._onTriggered=this.portsIn[e]._onTriggeredProfiling;this.portsIn[e].set=this.portsIn[e]._onSetProfiling}}cleanUp(){if(this._instances){for(let e=0;e<this._instances.length;e++)if(this._instances[e].onDelete)this._instances[e].onDelete();this._instances.length=0}for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].setAnimated(false);if(this.onAnimFrame)this.patch.removeOnAnimFrame(this)}instanced(e){return false}initInstancable(){}hasUiError(e){return this.uiErrors.hasOwnProperty(e)&&this.uiErrors[e]}setUiError(e,t,i=2,n={}){}setEnabled(e){this.enabled=e;this.emitEvent("onEnabledChange",e)}setPortGroup(t,i){for(let e=0;e<i.length;e++){if(i[e])if(i[e].setUiAttribs)i[e].setUiAttribs({group:t});else this._log.error("setPortGroup: invalid port!")}}setUiAxisPorts(e,t,i){if(e)e.setUiAttribs({axis:"X"});if(t)t.setUiAttribs({axis:"Y"});if(i)i.setUiAttribs({axis:"Z"})}removePort(t){for(let e=0;e<this.portsIn.length;e++){if(this.portsIn[e]==t){this.portsIn.splice(e,1);this.emitEvent(M.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}for(let e=0;e<this.portsOut.length;e++){if(this.portsOut[e]==t){this.portsOut.splice(e,1);this.emitEvent(M.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}}toWorkNeedsParent(e){this.linkTimeRules.needsParentOp=e}toWorkShouldNotBeChild(e,t){if(!this.patch.isEditorMode())return;this.linkTimeRules.forbiddenParent=e;if(t!=undefined)this.linkTimeRules.forbiddenParentType=t}toWorkPortsNeedsString(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsStringToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsStringToWork.push(arguments[e])}toWorkPortsNeedToBeLinked(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsLinkedToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsLinkedToWork.push(arguments[e])}toWorkPortsNeedToBeLinkedReset(){if(!this.patch.isEditorMode())return;this.linkTimeRules.needsLinkedToWork.length=0;if(this.checkLinkTimeWarnings)this.checkLinkTimeWarnings()}initVarPorts(){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getVariableName())this.portsIn[e].setVariable(this.portsIn[e].getVariableName())}checkLinkTimeWarnings(){}_checkLinksNeededToWork(){}refreshParams(){if(this.patch&&this.patch.isEditorMode()&&this.isCurrentUiOp())S.getGui().opParams.show(this)}isCurrentUiOp(){if(this.patch.isEditorMode())return S.getGui().patchView.isCurrentOp(this)}checkGraphicsApi(e=A.G.API_WEBGL){if(this.patch.isEditorMode())if(this.patch.cg&&this.patch.cg.gApi!=e)this.setUiError("wronggapi","Wrong graphics API",2)}}const P={};P.addPatch=function(e,t){let i=e;let n=(0,b.generateUUID)();if(typeof e=="string"){n=e;i=document.getElementById(n);if(!i){console.error(n+" Polyshape Container Element not found!");return}}const r=document.createElement("canvas");r.id="glcanvas_"+n;r.width=i.clientWidth;r.height=i.clientHeight;window.addEventListener("resize",function(){this.setAttribute("width",i.clientWidth);this.height=i.clientHeight}.bind(r));i.appendChild(r);t=t||{};t.glCanvasId=r.id;if(!t.onError){t.onError=function(e){console.error(e)}}CABLES.patch=new S(t);return r};const w=function(){let t=null;const i=[];this.onChanged=function(e){i.push(e)};this.getValue=function(){return t};this.setValue=function(e){t=e;this.emitChanged()};this.emitChanged=function(){for(let e=0;e<i.length;e++){i[e]()}}};var L=t(963);CABLES=CABLES||{};CABLES={...CABLES,...T.a.PORT,...T.a.PACO,...T.a.ANIM,...T.a.OP};CABLES.EMBED=P;CABLES.Link=p;CABLES.Port=v.I;CABLES.Op=M;CABLES.Profiler=O;CABLES.Patch=S;CABLES.Timer=x.M4;CABLES.Variable=w;CABLES.LoadingStatus=E;CABLES.now=x.tB;CABLES.internalNow=x.uw;CABLES.Anim=m.k;CABLES.AnimKey=L.rA;CABLES.shortId=b.shortId;CABLES.uuid=b.uuid;CABLES.getShortOpName=b.getShortOpName;CABLES.simpleId=b.simpleId;CABLES.clamp=b.clamp;CABLES.map=b.map;CABLES.shuffleArray=b.shuffleArray;CABLES.generateUUID=b.generateUUID;CABLES.prefixedHash=b.prefixedHash;CABLES.smoothStep=b.smoothStep;CABLES.smootherStep=b.smootherStep;CABLES.cacheBust=b.cacheBust;CABLES.copyArray=b.copyArray;CABLES.basename=b.basename;CABLES.logStack=b.logStack;CABLES.filename=b.filename;CABLES.ajax=b.ajax;CABLES.request=b.request;CABLES.logErrorConsole=b.logErrorConsole;CABLES.isNumeric=b.isNumeric;CABLES.uniqueArray=b.uniqueArray;CABLES.OPS=[];CABLES.utils=b;CABLES.CONSTANTS=T.a;CABLES.GLMatrix=i;CABLES.SHARED={};CABLES.SHARED.Events=d.A;CABLES.SHARED.Logger=g.A;const D=CABLES;if(!function(){return!this}())console.warn("not in strict mode: index core")},920:(e,t,i)=>{"use strict";i.d(t,{M4:()=>a,tB:()=>s,uw:()=>r});var n=i(125);const r=function(){return window.performance.now()};const s=function(){return r()};class a extends n.A{static EVENT_PLAY_PAUSE="playPause";static EVENT_TIME_CHANGED="timeChanged";constructor(){super();this._timeStart=r();this._timeOffset=0;this._currentTime=0;this._lastTime=0;this._paused=true;this._delay=0;this.overwriteTime=-1}_internalNow(){if(this._ts)return this._ts;return r()}_getTime(){this._lastTime=(this._internalNow()-this._timeStart)/1e3;return this._lastTime+this._timeOffset}setDelay(e){this._delay=e;this.emitEvent(a.EVENT_TIME_CHANGED)}isPlaying(){return!this._paused}update(e){if(e)this._ts=e;if(this._paused)return;this._currentTime=this._getTime();return this._currentTime}getMillis(){return this.get()*1e3}get(){return this.getTime()}getTime(){if(this.overwriteTime>=0)return this.overwriteTime-this._delay;return this._currentTime-this._delay}togglePlay(){if(this._paused)this.play();else this.pause()}setTime(e){if(isNaN(e)||e<0)e=0;this._timeStart=this._internalNow();this._timeOffset=e;this._currentTime=e;this.emitEvent(a.EVENT_TIME_CHANGED)}setOffset(e){if(this._currentTime+e<0){this._timeStart=this._internalNow();this._timeOffset=0;this._currentTime=0}else{this._timeOffset+=e;this._currentTime=this._lastTime+this._timeOffset}this.emitEvent(a.EVENT_TIME_CHANGED)}play(){this._timeStart=this._internalNow();this._paused=false;this.emitEvent(a.EVENT_PLAY_PAUSE)}pause(){this._timeOffset=this._currentTime;this._paused=true;this.emitEvent(a.EVENT_PLAY_PAUSE)}static now(){return window.performance.now()}}},562:(e,t,i)=>{"use strict";i.r(t);i.d(t,{ajax:()=>S,basename:()=>x,cacheBust:()=>T,clamp:()=>b,cleanJson:()=>f,copyArray:()=>E,escapeHTML:()=>w,filename:()=>I,float32Concat:()=>s,generateUUID:()=>c,getShortOpName:()=>a,isNumeric:()=>A,logErrorConsole:()=>C,logStack:()=>O,map:()=>v,prefixedHash:()=>d,request:()=>y,shortId:()=>u,shuffleArray:()=>o,simpleId:()=>m,smoothStep:()=>p,smootherStep:()=>_,uniqueArray:()=>R,uuid:()=>h});var n=i(440);Math.randomSeed=1;Math.setRandomSeed=function(e){Math.randomSeed=e*50728129;if(e!=0){Math.randomSeed=Math.seededRandom()*17624813;Math.randomSeed=Math.seededRandom()*9737333}};Math.seededRandom=function(e,t){if(Math.randomSeed===0)Math.randomSeed=Math.random()*999;e=e||1;t=t||0;Math.randomSeed=(Math.randomSeed*9301+49297)%233280;const i=Math.randomSeed/233280;return t+i*(e-t)};String.prototype.endl=function(){return this+"\n"};String.prototype.contains=function(e){console.warn("string.contains deprecated, use string.includes");console.log((new Error).stack);return this.includes(e)};function r(){}r();function s(e,t){if(!(e instanceof Float32Array))e=new Float32Array(e);if(!(t instanceof Float32Array))t=new Float32Array(t);const i=new Float32Array(e.length+t.length);i.set(e);i.set(t,e.length);return i}const a=function(e){let t=e.split(".")[e.split(".").length-1];if(t.includes(n.a.OP.OP_VERSION_PREFIX)){const i=t.split(n.a.OP.OP_VERSION_PREFIX)[1];t=t.substring(0,t.length-(n.a.OP.OP_VERSION_PREFIX+i).length)}return t};const o=function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.seededRandom()*(e+1));const n=t[e];t[e]=t[i];t[i]=n}return t};const l={};const u=function(){let e=Math.random().toString(36).substr(2,9);if(l.hasOwnProperty(e))e=u();l[e]=true;return e};const h=function(){let i=(new Date).getTime();const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e=="x"?t:t&3|8).toString(16)});return e};const c=h;function f(t){for(const e in t){if(t[e]&&typeof objValue==="object"&&t[e].constructor===Object)t[e]=f(t[e]);if(t[e]===null||t[e]===undefined)delete t[e];else if(Array.isArray(t[e])&&t[e].length==0)delete t[e]}return t}const d=function(i,e="id"){let n=0;if(i.length>0){for(let t=0;t<i.length;t++){let e=i.charCodeAt(t);n=(n<<5)-n+e;n&=n}}return e+""+n};let g=0;const m=function(){g++;return g};const p=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*(3-2*t);return e};const _=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*t*(t*(t*6-15)+10);return e};const b=function(e,t,i){return Math.min(Math.max(e,t),i)};const v=function(e,t,i,n,r,s=0,a=true){if(a){if(e>=i)return r;if(e<=t)return n}let o=false;const l=Math.min(t,i);const u=Math.max(t,i);if(l!=t)o=true;let h=false;const c=Math.min(n,r);const f=Math.max(n,r);if(c!=n)h=true;let d=0;let g=0;if(o)d=(u-e)*(f-c)/(u-l);else d=(e-l)*(f-c)/(u-l);if(h)g=f-d;else g=d+c;if(!s)return g;if(s==1){e=Math.max(0,Math.min(1,(g-n)/(r-n)));return n+e*e*(3-2*e)*(r-n)}if(s==2){e=Math.max(0,Math.min(1,(g-n)/(r-n)));return n+e*e*e*(e*(e*6-15)+10)*(r-n)}return g};function A(e){return!isNaN(parseFloat(e))&&isFinite(e)}const T=function(e=""){if(!e)return"";if(e.startsWith("data:"))return;if(e.includes("?"))e+="&";else e+="?";return e+"cache="+CABLES.uuid()};const E=function(t,i){if(!t)return null;i=i||[];i.length=t.length;for(let e=0;e<t.length;e++)i[e]=t[e];return i};const x=function(e){let t=CABLES.filename(e);const i=t.split(".");t=i[0];return t};const O=function(){console.log("logstack",(new Error).stack)};const I=function(e){let t="";if(!e)return"";if(e.startsWith("data:")&&e.includes(":")){const i=e.split(",");return i[0]}let i=(e+"").split("/");if(i.length>0){const n=i[i.length-1];let e=n.split("?");t=e[0]}return t||""};const S=function(e,t,i,n,r,s,a={},o={}){const l={url:e,cb:t,method:i,data:n,contenttype:r,sync:false,jsonP:s,headers:a};if(o&&o.credentials)l.credentials=o.credentials;y(l)};const y=function(t){if(!t.hasOwnProperty("asynch"))t.asynch=true;let i;try{i=new XMLHttpRequest}catch(e){}i.onreadystatechange=function(){if(i.readyState!=4)return;if(t.cb){if(i.status==200||i.status==0)t.cb(false,i.responseText,i);else t.cb(true,i.responseText,i)}};try{i.open(t.method?t.method.toUpperCase():"GET",t.url,!t.sync)}catch(e){if(t.cb&&e)t.cb(true,e.msg,i)}if(typeof t.headers==="object"){if(t.headers){const n=Object.keys(t.headers);for(let e=0;e<n.length;e++){const r=n[e];const s=t.headers[r];i.setRequestHeader(r,s)}}}if(t.credentials&&t.credentials!=="omit"){i.withCredentials=true}try{if(!t.post&&!t.data){i.send()}else{i.setRequestHeader("Content-type",t.contenttype?t.contenttype:"application/x-www-form-urlencoded");i.send(t.data||t.post)}}catch(e){if(t.cb)t.cb(true,e.msg,i)}};const C=function(e){CABLES.errorConsole=CABLES.errorConsole||{log:[]};CABLES.errorConsole.log.push({initiator:e,arguments:arguments});if(!CABLES.errorConsole.ele){const t=document.createElement("div");t.id="cablesErrorConsole";t.style.width="90%";t.style.height="300px";t.style.zIndex="9999999";t.style.display="inline-block";t.style.position="absolute";t.style.padding="10px";t.style.fontFamily="monospace";t.style.color="red";t.style.backgroundColor="#200";CABLES.errorConsole.ele=t;document.body.appendChild(t)}let n="ERROR<br/>for more info, open your browsers dev tools console (Ctrl+Shift+I or Command+Alt+I)<br/>";for(let i=0;i<CABLES.errorConsole.log.length;i++){n+=CABLES.errorConsole.log[i].initiator+" ";for(let e=1;e<CABLES.errorConsole.log[i].arguments.length;e++){if(e>2)n+=", ";let t=CABLES.errorConsole.log[i].arguments[e];if(t.constructor.name.indexOf("Error")>-1||t.constructor.name.indexOf("error")>-1){let e="Uncaught ErrorEvent ";if(t.message)e+=" message: "+t.message;n+=e}else if(typeof t=="string")n+=t;else if(typeof t=="number")n+=String(t)+" "}n+="<br/>"}CABLES.errorConsole.ele.innerHTML=n};function R(i){const n={},r=[];for(let e=0,t=i.length;e<t;++e){if(!n.hasOwnProperty(i[e])){r.push(i[e]);n[i[e]]=1}}return r}const N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};const M=/[&<>"']/g;const P=RegExp(M.source);const w=function(e){return e&&P.test(e)?e.replace(M,function(e){return N[e]}):e||""}},982:(e,t,i)=>{"use strict";i.d(t,{I:()=>a});var n=i(329);var r=i(684);var s=i(562);class a{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyGeom(t){if(!t)return;if(t instanceof a){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ)}else{if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2])}this.calcCenterSize()}copy(){return new a(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!s.isNumeric(e)||!s.isNumeric(t)||!s.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}n.transformMat4(this._max,this._max,e);n.transformMat4(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();r.translate(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}},223:(e,t,i)=>{"use strict";i.d(t,{f:()=>r});var n=i(849);class r{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new n.A("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(t,i,e=false){let n=0;if(this.forceAspect){let e=t/this.forceAspect;if(e<i)n=(i-e)/2;i=e}if(this._oldWidthRp!=t*this.pixelDensity||this._oldHeightRp!=i*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=t*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=i*this.pixelDensity;if(!e){this.canvasEle.style.width=t+"px";this.canvasEle.style.height=i+"px";this.canvasEle.style.marginTop=n+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}},628:(e,t,i)=>{"use strict";i.d(t,{A:()=>c});var n=i(125);var r=i(849);var s=i(329);var a=i(684);var o=i(223);var l=i(868);var u=i(460);var h=i(294);class c extends n.A{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";gApi=0;_textureslots=[];_pMatrixStack=new l.u;_mMatrixStack=new l.u;_vMatrixStack=new l.u;canvasScale=1;constructor(e){super();this._log=new r.A("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new h.K;this._identView=s.create();this._ident=s.create();s.set(this._identView,0,0,-2);s.set(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new u.E(this);this.pMatrix=a.create();this.mMatrix=a.create();this.vMatrix=a.create();a.identity(this.mMatrix);a.identity(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new o.f({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;a.perspective(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);a.identity(this.mMatrix);a.identity(this.vMatrix);a.translate(this.mMatrix,this.mMatrix,e);a.translate(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,n){console.log("no screenshot function implemented")}saveScreenshot(i,n,e,t,r){this.patch.renderOneFrame();let s=this.canvas.clientWidth*this.pixelDensity;let a=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;s=e}if(t){this.canvas.height=t;a=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const u="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+u+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=s;this.canvas.height=a;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(n)n(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}},294:(e,t,i)=>{"use strict";i.d(t,{K:()=>s});var n=i(125);var r=i(920);class s extends n.A{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,r.tB)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,r.tB)()-this.#timeStartFrame;this.#msCounter+=e;if((0,r.tB)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,r.tB)()}}},331:(e,t,i)=>{"use strict";i.d(t,{V:()=>h});var n=i(849);var U=i(329);var V=i(842);var r=i(562);var s=i(982);class h{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new n.A("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let n="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)n="float";else if(i==2)n="vec2";else if(i==3)n="vec3";else if(i==4)n="vec4";const r={name:e,data:t,itemSize:i,type:n};this._attributes[e]=r}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,n){let r=U.create();if(t==undefined)t=1;if(i==undefined)i=1;if(n==undefined)n=1;for(let e=0;e<this.vertexNormals.length;e+=3){U.set(r,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);r[0]*=-t;r[1]*=-i;r[2]*=-n;U.normalize(r,r);this.vertexNormals[e+0]=r[0];this.vertexNormals[e+1]=r[1];this.vertexNormals[e+2]=r[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const n=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+n;this.vertices=r.float32Concat(this._vertices,t.vertices);this.texCoords=r.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=r.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=r.float32Concat(this.tangents,t.tangents);this.biTangents=r.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new h(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=U.create();const n=U.create();const r=U.create();function s(e){U.subtract(i,e[0],e[1]);U.subtract(n,e[0],e[2]);U.cross(r,i,n);U.normalize(r,r);if(t&&t.forceZUp){if(r[2]<0){r[0]*=-1;r[1]*=-1;r[2]*=-1}}return r}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const a=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=s(o);a.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=a}else{const u=[];u.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];u[e/3]=s(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=u[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const h=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];U.normalize(h,h);this.vertexNormals[this.verticesIndices[t+e]*3+0]=h[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=h[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=h[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const A=this.vertices.length/3*2;this.texCoords=new Float32Array(A);for(let e=0;e<A;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const n=[];n.length=i*2;const r=U.create();const s=U.create();const a=U.create();const o=V.create();const l=V.create();const u=V.create();const h=U.create();const c=U.create();for(let e=0;e<t;e+=1){const T=this.verticesIndices[e*3];const E=this.verticesIndices[e*3+1];const x=this.verticesIndices[e*3+2];U.set(r,this.vertices[T*3],this.vertices[T*3+1],this.vertices[T*3+2]);U.set(s,this.vertices[E*3],this.vertices[E*3+1],this.vertices[E*3+2]);U.set(a,this.vertices[x*3],this.vertices[x*3+1],this.vertices[x*3+2]);V.set(o,this.texCoords[T*2],this.texCoords[T*2+1]);V.set(l,this.texCoords[E*2],this.texCoords[E*2+1]);V.set(u,this.texCoords[x*2],this.texCoords[x*2+1]);const O=s[0]-r[0];const I=a[0]-r[0];const S=s[1]-r[1];const y=a[1]-r[1];const C=s[2]-r[2];const R=a[2]-r[2];const N=l[0]-o[0];const M=u[0]-o[0];const P=l[1]-o[1];const w=u[1]-o[1];const L=1/(N*w-M*P);U.set(h,(w*O-P*I)*L,(w*S-P*y)*L,(w*C-P*R)*L);U.set(c,(N*I-M*O)*L,(N*y-M*S)*L,(N*R-M*C)*L);n[T]=h;n[E]=h;n[x]=h;n[T+i]=c;n[E+i]=c;n[x+i]=c}const f=U.create();const d=U.create();const g=U.create();const m=U.create();const p=U.create();const _=U.create();const b=U.create();const v=U.create();for(let e=0;e<i;e+=1){if(!n[e])continue;U.set(f,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);U.set(d,n[e][0],n[e][1],n[e][2]);const D=U.dot(f,d);U.scale(p,f,D);U.subtract(_,d,p);U.normalize(v,_);U.cross(b,f,d);const k=1;U.scale(g,v,1/k);U.cross(m,f,g);this.tangents[e*3+0]=g[0];this.tangents[e*3+1]=g[1];this.tangents[e*3+2]=g[2];this.biTangents[e*3+0]=m[0];this.biTangents[e*3+1]=m[1];this.biTangents[e*3+2]=m[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const n=[];let r=0;for(let e in this._attributes){const s=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(s.itemSize==3)i.push(s.data[this.verticesIndices[t+e]*3+0],s.data[this.verticesIndices[t+e]*3+1],s.data[this.verticesIndices[t+e]*3+2]);else if(s.itemSize==4)i.push(s.data[this.verticesIndices[t+e]*4+0],s.data[this.verticesIndices[t+e]*4+1],s.data[this.verticesIndices[t+e]*4+2],s.data[this.verticesIndices[t+e]*4+3]);else if(s.itemSize==2)i.push(s.data[this.verticesIndices[t+e]*2+0],s.data[this.verticesIndices[t+e]*2+1]);else if(s.itemSize==1)i.push(s.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",s)}}this.setAttribute(s.name,i,s.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);n.push(r);r++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=n;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new s.I(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let n=0;const r=this.getBounds();const s=[r.minX+(r.maxX-r.minX)/2,r.minY+(r.maxY-r.minY)/2,r.minZ+(r.maxZ-r.minZ)/2];for(n=0;n<this.vertices.length;n+=3){if(this.vertices[n+0]==this.vertices[n+0]){if(e)this.vertices[n+0]-=s[0];if(t)this.vertices[n+1]-=s[1];if(i)this.vertices[n+2]-=s[2]}}return s}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const n=this.vertices[e*3+0];const r=this.vertices[e*3+1];this.texCoords[e*2+0]=n/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-r/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}h.buildFromFaces=function(t,e,i){const n=[];const r=[];for(let e=0;e<t.length;e+=3){const a=t[e+0];const o=t[e+1];const l=t[e+2];const u=[-1,-1,-1];if(i)for(let e=0;e<n.length;e+=3){if(n[e+0]==a[0]&&n[e+1]==a[1]&&n[e+2]==a[2])u[0]=e/3;if(n[e+0]==o[0]&&n[e+1]==o[1]&&n[e+2]==o[2])u[1]=e/3;if(n[e+0]==l[0]&&n[e+1]==l[1]&&n[e+2]==l[2])u[2]=e/3}if(u[0]==-1){n.push(a[0],a[1],a[2]);u[0]=(n.length-1)/3}if(u[1]==-1){n.push(o[0],o[1],o[2]);u[1]=(n.length-1)/3}if(u[2]==-1){n.push(l[0],l[1],l[2]);u[2]=(n.length-1)/3}r.push(u[0]);r.push(u[1]);r.push(u[2])}const s=new h(e);s.name=e;s.vertices=n;s.verticesIndices=r;return s}},868:(e,t,i)=>{"use strict";i.d(t,{u:()=>r});var n=i(684);class r{constructor(){this._arr=[n.create()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const t=n.create();this._arr.push(t)}n.copy(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}},434:(e,t,i)=>{"use strict";i.d(t,{w:()=>n});class n{_name="unknown";constructor(){}}},694:(e,t,i)=>{"use strict";i.d(t,{U:()=>s});var n=i(125);var r=i(562);class s extends n.A{id=r.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=r.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=r.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=r.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}},356:(e,t,i)=>{"use strict";i.d(t,{U:()=>l});var n=i(562);const r=8;class l{constructor(e={}){this.id=n.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||l.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=r;if(!e.height)e.height=r}}l.getDefaultTextureData=(e,s,a={})=>{if(e=="empty"){return new Uint8Array(s*s*4).fill(0)}else if(e=="color"){const r=new Uint8Array(s*s*4);let t=a.r||1;let i=a.g||1;let n=a.b||1;for(let e=0;e<s*s;e++){r[e*4+0]=t;r[e*4+1]=i;r[e*4+2]=n;r[e*4+3]=255}return r}else if(e=="randomUInt"){const r=new Uint8Array(s*s*4);for(let e=0;e<s*s;e++){r[e*4+0]=Math.random()*255;r[e*4+1]=Math.random()*255;r[e*4+2]=Math.random()*255;r[e*4+3]=255}return r}else if(e=="random"||e=="randomFloat"){const r=new Float32Array(s*s*4);for(let e=0;e<s*s;e++){r[e*4+0]=(Math.random()-.5)*2;r[e*4+1]=(Math.random()-.5)*2;r[e*4+2]=(Math.random()-.5)*2;r[e*4+3]=1}return r}else if(e=="stripes"){const o=[];let i=a.r;let n=a.g;let r=a.b;if(i===undefined)i=1;if(n===undefined)n=1;if(r===undefined)r=1;for(let t=0;t<s;t++){for(let e=0;e<s;e++){if((e+t)%64<32){o.push((200+t/s*25+e/s*25)*i);o.push((200+t/s*25+e/s*25)*n);o.push((200+t/s*25+e/s*25)*r)}else{o.push((40+t/s*25+e/s*25)*i);o.push((40+t/s*25+e/s*25)*n);o.push((40+t/s*25+e/s*25)*r)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return l.getDefaultTextureData("stripes",s,{r:1,g:0,b:0})}};l.FILTER_NEAREST=0;l.FILTER_LINEAR=1;l.FILTER_MIPMAP=2;l.WRAP_REPEAT=0;l.WRAP_MIRRORED_REPEAT=1;l.WRAP_CLAMP_TO_EDGE=2;l.TYPE_DEFAULT=0;l.TYPE_DEPTH=1;l.TYPE_FLOAT=2;l.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";l.PFORMATSTR_R8UB="R 8bit ubyte";l.PFORMATSTR_RG8UB="RG 8bit ubyte";l.PFORMATSTR_RGB8UB="RGB 8bit ubyte";l.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";l.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";l.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";l.PFORMATSTR_R16F="R 16bit float";l.PFORMATSTR_RG16F="RG 16bit float";l.PFORMATSTR_RGB16F="RGB 16bit float";l.PFORMATSTR_RGBA16F="RGBA 16bit float";l.PFORMATSTR_R32F="R 32bit float";l.PFORMATSTR_RG32F="RG 32bit float";l.PFORMATSTR_RGB32F="RGB 32bit float";l.PFORMATSTR_RGBA32F="RGBA 32bit float";l.PFORMATSTR_DEPTH="DEPTH";l.PIXELFORMATS=[l.PFORMATSTR_RGB565,l.PFORMATSTR_R8UB,l.PFORMATSTR_RG8UB,l.PFORMATSTR_RGB8UB,l.PFORMATSTR_RGBA8UB,l.PFORMATSTR_SRGBA8,l.PFORMATSTR_R11FG11FB10F,l.PFORMATSTR_R16F,l.PFORMATSTR_RG16F,l.PFORMATSTR_RGBA16F,l.PFORMATSTR_R32F,l.PFORMATSTR_RGBA32F]},475:(e,t,i)=>{"use strict";i.d(t,{v:()=>n});var h=i(849);var c=i(50);class n{constructor(e,t,i,n,r,s,a,o,l,u){this._log=new h.A("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=u;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof n=="object"&&n instanceof c.I){this._port=n;this._value=this._port.get();if(r&&s&&a){if(!(r instanceof c.I)||!(s instanceof c.I)||!(a instanceof c.I)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=r;this._port3=s;this._port4=a;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(r&&s){if(!(r instanceof c.I)||!(s instanceof c.I)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=r;this._port3=s;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(r){if(!(r instanceof c.I)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=r;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=n;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}},748:(e,t,i)=>{"use strict";var n=i(823);var r=i(522);var s=i(964);var a=i(409);var o=i(684);var l=i(221);var u=i(991);var h=i(842);var c=i(329);var f=i(796);var d=i(982);var g=i(223);var m=i(331);var p=i(294);const _={DEPTH_COMPARE_NEVER:0,DEPTH_COMPARE_LESS:1,DEPTH_COMPARE_EQUAL:2,DEPTH_COMPARE_LESSEQUAL:3,DEPTH_COMPARE_GREATER:4,DEPTH_COMPARE_NOTEQUAL:5,DEPTH_COMPARE_GREATEREQUAL:6,DEPTH_COMPARE_ALWAYS:7,CULL_NONE:0,CULL_BACK:1,CULL_FRONT:2,CULL_BOTH:3,Geometry:m.V,BoundingBox:d.I,FpsCounter:p.K,CgCanvas:g.f};window.CABLES=window.CABLES||{};window.CABLES.CG=window.CABLES.CG||_;window.CG=window.CG||_;window.glMatrix=n;window.mat2=r;window.mat2d=s;window.mat3=a;window.mat4=o;window.quat=l;window.quat2=u;window.vec2=h;window.vec3=c;window.vec4=f},264:(e,t,i)=>{"use strict";i.d(t,{C:()=>f,e:()=>o});var r=i(849);var s=i(562);var n=i(923);var c=i(997);var a=i(434);const f={};f.lastMesh=null;class o extends a.w{#cgl=null;#geom=null;#bufVerticesIndizes=null;constructor(e,t,i={}){super();this.#cgl=e;let n=i||{};if(s.isNumeric(n))n={glPrimitive:i};this._log=new r.A("cgl_mesh");this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this._indexType=this.#cgl.gl.UNSIGNED_SHORT;this._attributes=[];this._attribLocs={};this._lastShader=null;this._numInstances=0;this._glPrimitive=n.glPrimitive;this.opId=n.opId||"";this._preWireframeGeom=null;this.addVertexNumbers=false;this.feedBackAttributes=[];this.setGeom(t);this._feedBacks=[];this._feedBacksChanged=false;this._transformFeedBackLoc=-1;this._lastAttrUpdate=0;this.memFreed=false;this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name);this._queryExt=null}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,n,r){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:n,offset:r,instanced:t==c.a.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,n){if(!e)return;if(!i&&!n)return;if(!e.name)this._log.stack("no attrname?!");const r=this.#cgl.gl;r.bindBuffer(r.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=n-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=n-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(n>t.length&&!this.warned){this.warned=true;this._log.warn(this.#cgl.canvas.id+" "+e.name+" buffersubdata out of bounds ?",t.length,n,i,e);return}r.bufferSubData(r.ARRAY_BUFFER,i*4,t,i,n-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame){console.log("_bufferArray",e.length,t.name)}if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,n){this.setAttribute(e,t,i,n)}setAttribute(e,t,i,n={}){if(!t){this._log.error("mesh addAttribute - no array given! "+e);throw new Error}let r=null;let s=false;let a=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof n=="function"){r=n}if(typeof n=="object"){if(n.cb)r=n.cb;if(n.instanced)s=n.instanced}if(e==c.a.SHADER.SHADERVAR_INSTANCE_MMATRIX)s=true;for(a=0;a<this._attributes.length;a++){const h=this._attributes[a];if(h.name==e){if(h.numItems===o){}else{this._resizeAttr(t,h)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,h.buffer);this._bufferArray(t,h);return h}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let u=this.#cgl.gl.FLOAT;if(n&&n.type)u=n.type;const h={buffer:l,name:e,cb:r,itemSize:i,numItems:o,startItem:0,instanced:s,type:u};this._bufferArray(t,h);if(e==c.a.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=h;this._attributes.push(h);this._attribLocs={};return h}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(c.a.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new n.n(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this._log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this._log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this._log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this._indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;f.lastMesh=null;this.#cgl.profileData.profileMeshSetGeom++;this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const n={texCoords:c.a.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:c.a.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:c.a.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const r in i)if(i[r].data&&i[r].data.length)this.setAttribute(n[r]||r,i[r].data,i[r].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const n=this._attributes[e];if(i[e]==-1){if(n._attrLocationLastShaderTime!=t.lastCompile){n._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),n.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,n.buffer);if(n.instanced){if(n.itemSize<=4){if(!n.itemSize||n.itemSize==0)this._log.warn("instanced attrib itemsize error",this.#geom.name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(n.itemSize==16){const r=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,n.type,false,r,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,n.type,false,r,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,n.type,false,r,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,n.type,false,r,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this._log.warn("unknown instance attrib size",n.name)}}else{if(!n.itemSize||n.itemSize==0)this._log.warn("attrib itemsize error",this._name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);if(n.pointer){for(let e=0;e<n.pointer.length;e++){const s=n.pointer[e];if(s.loc==-1)s.loc=this.#cgl.glGetAttribLocation(t.getProgram(),s.name);this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(s.loc);this.#cgl.gl.vertexAttribPointer(s.loc,n.itemSize,n.type,false,s.stride,s.offset)}}if(this.bindFeedback)this.bindFeedback(n)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;f.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(f.lastMesh!=this){if(f.lastMesh)f.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();f.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==undefined)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let n=1;let r=this.#cgl.profileData.doProfileGlQuery;let s=false;if(r){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const a=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(a){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);s=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this._indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this._indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame&&this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this._log.error("mesh draw gl error");this._log.error("mesh",this);this._log.error("shader",i);const u=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const h=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this._log.error("attrib ",h)}}this.#cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/n*(this._numInstances||1);this.#cgl.profileData.profileMeshDraw++;if(r&&s){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(c.a.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}},460:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});class n{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute=[];this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){this.counts={};this.profileSingleMeshAttribute={};this.profileMeshAttributes=0;this.profileUniformCount=0;this.profileShaderGetUniform=0;this.profileShaderCompiles=0;this.profileShaderBinds=0;this.profileTextureResize=0;this.profileFrameBuffercreate=0;this.profileEffectBuffercreate=0;this.profileTextureDelete=0;this.profileMeshSetGeom=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileNonTypedAttrib=0;this.profileNonTypedAttribNames="";this.profileTextureNew=0;this.profileGenMipMap=0;this.profileFramebuffer=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.profileMeshNumElements=0;this.profileFencedPixelRead=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t){this.counts[e]=this.counts[e]||[];this.counts[e].push(t)}addHeavyEvent(e,t,i){const n={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(n);this._cgl.emitEvent("heavyEvent",n)}}},24:(e,t,i)=>{"use strict";i.d(t,{M:()=>c});var n=i(849);var r=i(684);var E=i(920);var s=i(960);var x=i(264);var O=i(997);var a=i(694);var o=i(70);var l=i(923);const u=`
{{MODULES_HEAD}}
IN vec3 vPosition; //!@
IN vec2 attrTexCoord;
IN vec3 attrVertNormal;
IN vec3 attrTangent,attrBiTangent;

IN float attrVertIndex;

OUT vec2 texCoord;
OUT vec3 norm;
UNI mat4 projMatrix;
UNI mat4 viewMatrix;
UNI mat4 modelMatrix;

void main()
{
    texCoord=attrTexCoord;
    norm=attrVertNormal;
    vec4 pos=vec4(vPosition,  1.0);
    vec3 tangent=attrTangent;
    vec3 bitangent=attrBiTangent;
    mat4 mMatrix=modelMatrix;
    gl_PointSize=10.0;

    {{MODULE_VERTEX_POSITION}}

    mat4 modelViewMatrix=viewMatrix*mMatrix;
    {{MODULE_VERTEX_MODELVIEW}}

    gl_Position = projMatrix * modelViewMatrix * pos;
}
`;let h=0;function I(){return u}function S(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+O.nl+"IN vec2 texCoord;"+O.nl+"{{MODULES_HEAD}}"+O.nl+"void main()"+O.nl+"{"+O.nl+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+O.nl+"    {{MODULE_COLOR}}"+O.nl+"    outColor = col;"+O.nl+"}"}class c extends a.U{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new n.A("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++h;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=I();this.srcFrag=S();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=r.create();this._tempCamPosMatrix=r.create();this._tempInverseViewMatrix=r.create();this._tempInverseProjMatrix=r.create();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new c(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in s.y){if(e.includes(t)){const i=new s.y[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let n="";let r="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const a="struct "+this._uniforms[i]._structName+" {"+O.nl+s+"};"+O.nl+O.nl;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")n=n.concat(a);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")r=r.concat(a);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(s);const l=r.lastIndexOf(s);n=n.slice(0,o)+t+n.slice(o-1);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(s);n=n.slice(0,o)+t+n.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=r.lastIndexOf(s);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+O.nl;if(!this._uniDeclarationsFrag.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";n=n.replace(s,"");n+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+O.nl;if(!this._uniDeclarationsVert.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(s,"");r+=i;this._uniDeclarationsVert.push(i)}}return[r,n]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+O.nl;i.srcHeadVert+="#define ATTRIB_"+e.name+O.nl;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+O.nl;if(!t)i.srcHeadVert+="#endif"+O.nl;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+O.nl;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+O.nl;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+O.nl;if(!t)i.srcHeadVert+="#endif"+O.nl;i.srcVert=""+O.nl+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+O.nl;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+O.nl;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+O.nl;if(!t)i.srcHeadFrag+="#endif"+O.nl}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.profileShaderCompiles++;this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+O.nl;let i="";if(this._defines.length)i="\n// cgl generated"+O.nl;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+O.nl;const n=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const p=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const b=this._uniforms[e];const v=p.indexOf(b._name,e+1);if(v>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+O.nl;let r="";let s="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=I();this.srcFrag=S()}r="#version 300 es"+O.nl+"// "+O.nl+"// vertex shader "+this._name+O.nl+"// "+O.nl+"precision "+this.precision+" float;"+O.nl+"precision "+this.precision+" sampler2D;"+O.nl+""+O.nl+"#define WEBGL2"+O.nl+"#define texture2D texture"+O.nl+"#define UNI uniform"+O.nl+"#define IN in"+O.nl+"#define OUT out"+O.nl;s="#version 300 es"+O.nl+"// "+O.nl+"// fragment shader "+this._name+O.nl+"// "+O.nl+"precision "+this.precision+" float;"+O.nl+"precision "+this.precision+" sampler2D;"+O.nl+""+O.nl+"#define WEBGL2"+O.nl+"#define texture2D texture"+O.nl+"#define IN in"+O.nl+"#define OUT out"+O.nl+"#define UNI uniform"+O.nl+"{{DRAWBUFFER}}"+O.nl;let a="\n// cgl generated"+O.nl;let o="\n// cgl generated"+O.nl;s+="\n// active mods: --------------- ";r+="\n// active mods: --------------- ";let l=false;let u=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;s+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){r+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";u=true}}}}if(!u)s+="\n// no mods used...";if(!l)s+="\n// no mods used...";s+="\n";r+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))a+=e+";"+t+O.nl;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+O.nl}}let h=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")h++}}if(h>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+h+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!s.includes("precision"))s="precision "+this.precision+" float;"+O.nl+s;if(!r.includes("precision"))r="precision "+this.precision+" float;"+O.nl+r;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){s+="#define MOBILE"+O.nl;r+="#define MOBILE"+O.nl}r=t+r+i+n[0]+a+"\n// -- \n"+this.srcVert;s=t+s+i+n[1]+o+"\n// -- \n"+this.srcFrag;let f="";let d="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let g=false;for(let n=0;n<this._moduleNames.length;n++){let t="";let i="";if(!g){g=true;for(let e=0;e<this._attributes.length;e++){const A=this._getAttrSrc(this._attributes[e],true);if(A.srcHeadVert)f+=A.srcHeadVert;if(A.srcVert)t+=A.srcVert;if(A.srcHeadFrag)d+=A.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const T=this._modules[e];if(T.name==this._moduleNames[n]){f+="\n//---- MOD: group:"+T.group+": idx:"+e+" - prfx:"+T.prefix+" - "+T.title+" ------\n";d+="\n//---- MOD: group:"+T.group+": idx:"+e+" - prfx:"+T.prefix+" - "+T.title+" ------\n";t+="\n\n//---- MOD: "+T.title+" / "+T.priority+" ------\n";i+="\n\n//---- MOD: "+T.title+" / "+T.priority+" ------\n";if(T.attributes)for(let e=0;e<T.attributes.length;e++){const A=this._getAttrSrc(T.attributes[e],false);if(A.srcHeadVert)f+=A.srcHeadVert;if(A.srcVert)t+=A.srcVert;if(A.srcHeadFrag)d+=A.srcHeadFrag}f+=T.srcHeadVert||"";d+=T.srcHeadFrag||"";t+=T.srcBodyVert||"";i+=T.srcBodyFrag||"";f+="\n//---- end mod ------\n";d+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,T.prefix);i=i.replace(/{{mod}}/g,T.prefix);f=f.replace(/{{mod}}/g,T.prefix);d=d.replace(/{{mod}}/g,T.prefix);t=t.replace(/MOD_/g,T.prefix);i=i.replace(/MOD_/g,T.prefix);f=f.replace(/MOD_/g,T.prefix);d=d.replace(/MOD_/g,T.prefix)}}r=r.replace("{{"+this._moduleNames[n]+"}}",t);s=s.replace("{{"+this._moduleNames[n]+"}}",i)}r=r.replace("{{MODULES_HEAD}}",f);s=s.replace("{{MODULES_HEAD}}",d);r=this._addLibs(r);s=this._addLibs(s);let m="";for(let e=0;e<16;e++)if(s.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){m="out vec4 outColor;"+O.nl;m+="#define gl_FragColor outColor"+O.nl}else{m+="#define MULTI_COLORTARGETS"+O.nl;m+="vec4 outColor;"+O.nl;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)m+="#define gl_FragColor outColor"+e+""+O.nl;m+="layout(location = "+e+") out vec4 outColor"+e+";"+O.nl;t++}}s=s.replace("{{DRAWBUFFER}}",m);if(!this._program){this._program=this._createProgram(r,s)}else{this._program=this._createProgram(r,s);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=s;this.finalShaderVert=r;x.C.lastMesh=null;x.C.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,E.tB)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;x.C.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,O.a.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,O.a.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.profileShaderBinds++;this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.profileMVPMatrixCount++;this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){r.invert(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._inverseProjMatrixUniform){r.invert(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.profileMVPMatrixCount++}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.profileMVPMatrixCount++;if(this._camPosUniform){r.invert(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.profileMVPMatrixCount++}}else{const e=r.create();r.mul(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.profileMVPMatrixCount++}if(this._normalMatrixUniform){r.invert(this._tempNormalMatrix,this._cgl.mMatrix);r.transpose(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.profileMVPMatrixCount++}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,n,r,s){const a=new l.n(this,e,t,i,n,r,s);a.shaderType="frag";return a}addUniformVert(e,t,i,n,r,s){const a=new l.n(this,e,t,i,n,r,s);a.shaderType="vert";return a}addUniformBoth(e,t,i,n,r,s){const a=new l.n(this,e,t,i,n,r,s);a.shaderType="both";return a}addUniformStructFrag(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(!this.hasUniform(i+"."+s.name)){const a=new l.n(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="frag";r[i+"."+s.name]=a}}return r}addUniformStructVert(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(!this.hasUniform(i+"."+s.name)){const a=new l.n(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="vert";r[i+"."+s.name]=a}}return r}addUniformStructBoth(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(s.type==="2i"||s.type==="i"||s.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",s.name," of type:",s.type,".");if(!this.hasUniform(i+"."+s.name)){const a=new l.n(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="both";r[i+"."+s.name]=a}}return r}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=c.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=c.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const n=this._cgl.gl.getShaderInfoLog(this.fshader);const r=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(n)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||o.g.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const n=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return n}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,n){return S(e,t,i,n)}getDefaultVertexShader(){return I()}}c.getDefaultVertexShader=I;c.getDefaultFragmentShader=S;c.getErrorFragmentShader=function(){return""+O.nl+"void main()"+O.nl+"{"+O.nl+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+O.nl+"   g= step(0.1,g);"+O.nl+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+O.nl+"}"};c.createShader=function(e,t,i,n){if(e.aborted)return;const r=e.gl.createShader(i);e.gl.shaderSource(r,t);e.gl.compileShader(r);if(!e.gl.getShaderParameter(r,e.gl.COMPILE_STATUS)){n.error={str:t,infoLog:e.gl.getShaderInfoLog(r)};if(CABLES.UI)gui.emitEvent("ShaderError",n);if(!n.error.infoLog){n._log.warn("empty shader info log",this._name);return}n.setSource(c.getDefaultVertexShader(),c.getErrorFragmentShader())}return r}},960:(e,t,i)=>{"use strict";i.d(t,{y:()=>a});var n=i(923);var r=i(771);var s=i(70);const a={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=r.p.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=r.p.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new n.n(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){s.g.getRandomTexture(e);e.setTexture(7,s.g.getRandomTexture(e).tex)}}}},923:(e,t,i)=>{"use strict";i.d(t,{n:()=>r});var n=i(475);class r extends n.v{constructor(e,t,i,n,r,s,a,o,l,u){super(e,t,i,n,r,s,a,o,l,u);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new r(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return r.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.profileUniformCount++}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.profileUniformCount++}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.profileUniformCount++;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}r.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)}},273:(e,t,i)=>{"use strict";i.d(t,{S:()=>s});var r=i(331);var n=i(264);const s={};s.getSimpleRect=function(e,t,i=1){const n=new r.V(t);n.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];n.texCoords=[1,1,0,1,1,0,0,0];n.verticesIndices=[0,1,2,2,1,3];n.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(n)};s.getSimpleCube=function(e,t){const i=new r.V(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new n.e(e,i)}},308:(e,t,i)=>{"use strict";i.d(t,{G:()=>c});var n=i(849);var r=i(562);var s=i(997);var a=i(24);var o=i(628);var l=i(264);var u=i(70);const h={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class c extends o.A{#cursor="auto";constructor(e){super(e);this.gApi=o.A.API_WEBGL;this.aborted=false;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new n.A("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new a.M(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(a.M.getDefaultVertexShader(),a.M.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.error("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,n){this._viewPortStack.push(e,t,i,n);this.setViewPort(e,t,i,n)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,n){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(n);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,n){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,n)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(o.A.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(s.a.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;r.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=u.g.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let n=this.gl.getError();if(n!=this.gl.NO_ERROR){let e="";if(n==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(n==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(n==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(n==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(n==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(n==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(n==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,n,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}n=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==s.a.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==s.a.BLEND_MODES.BLEND_NONE){}else if(e==s.a.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==s.a.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==s.a.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==s.a.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(r.isNumeric(t))t={glPrimitive:t};return new l.e(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new a.M(this,"errormaterial");this.errorShader.setSource(a.M.getDefaultVertexShader(),a.M.getErrorFragmentShader());return this.errorShader}}},70:(e,t,i)=>{"use strict";i.d(t,{g:()=>h});var n=i(849);var u=i(562);var r=i(356);const s=8;const a=new n.A("cgl_texture");class h extends r.U{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new n.A("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=h.FILTER_NEAREST;this.wrap=h.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=h.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=h.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=h.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=h.PFORMATSTR_RGBA32F;if(this.textureType==h.TYPE_DEPTH)this.pixelFormat=h.PFORMATSTR_DEPTH;this._cgl.profileData.profileTextureNew++;this.setFormat(h.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return h.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new h(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=s;if(t!=t||t<=0||!t)t=s;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(h.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.profileTextureResize++;const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,n,r){this.filter=n;this.wrap=r;if(n==undefined)this.filter=h.FILTER_LINEAR;if(r==undefined)this.wrap=h.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const s=CGL.Texture.getTempTexture(this._cgl);this.width=s.width;this.height=s.height;this.tex=s.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(h.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==h.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.profileGenMipMap++}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(h.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.profileTextureDelete++;this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return h.isPowerOfTwo(this.width)&&h.isPowerOfTwo(this.height)}printInfo(){a.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===h.FILTER_NEAREST)e+=" nearest";if(this.filter===h.FILTER_LINEAR)e+=" linear";if(this.filter===h.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===h.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===h.WRAP_REPEAT)e+=" repeat";if(this.wrap===h.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return h.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==h.TYPE_FLOAT&&this.filter==h.FILTER_MIPMAP){this.filter=h.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=h.FILTER_NEAREST;this.wrap=h.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==h.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==h.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==h.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==h.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==h.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==h.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}h.load=function(i,n,r,e){if(!n)return r({error:true});let s=null;if(!i.patch.loading.existByName(n))s=i.patch.loading.start("cgl.texture",n);const a=new h(i);a.name=n;a.image=new Image;a.image.crossOrigin="anonymous";a.loading=true;if(e&&e.hasOwnProperty("filter"))a.filter=e.filter;if(e&&e.hasOwnProperty("flip"))a.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))a.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))a.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))a.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))a.pixelFormat=e.pixelFormat;a.image.onabort=a.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",n,e);a.loading=false;if(s)i.patch.loading.finished(s);const t={error:true};if(r)r(t,a)};a.image.onload=function(e){i.addNextFrameOnceCallback(()=>{a.initTexture(a.image);if(s)i.patch.loading.finished(s);a.loading=false;if(r)r(null,a)})};a.image.src=n;return a};h.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=h.getTemporaryTexture(e,256,h.FILTER_LINEAR,h.REPEAT);return e.tempTexture};h.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=h.getTemporaryTexture(e,256,h.FILTER_LINEAR,h.REPEAT,1,.2,.2);return e.errorTexture};h.getEmptyTexture=function(e,t){if(t)return h.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new h(e,{name:"emptyTexture"});const n=h.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(n,i,i,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.tempTextureEmpty};h.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new h(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.tempTextureEmptyFloat};h.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=h.getDefaultTextureData("randomUInt",t);e.randomTexture=new h(e);e.randomTexture.initFromData(i,t,t,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.randomTexture};h.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=h.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new h(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.getRandomFloatTexture};h.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=h.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new h(e);e.blackTexture.initFromData(i,t,t,h.FILTER_NEAREST,h.WRAP_REPEAT);return e.blackTexture};h.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const n=t.gl.TEXTURE_CUBE_MAP;const r=h.FILTER_NEAREST;const s=h.WRAP_CLAMP_TO_EDGE;const a=8;const o=8;t.profileData.profileTextureNew++;t.gl.bindTexture(n,e);t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(n,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(n,null);return{id:u.uuid(),tex:e,cubemap:e,width:a,height:o,filter:r,wrap:s,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};h.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return h.getTempTexture(e)};h.getTemporaryTexture=function(e,t,i,n,r,s,a){const o=h.getDefaultTextureData("stripes",256,{r:r,g:s,b:a});const l=new h(e);l.initFromData(o,t,t,i,n);return l};h.createFromImage=function(e,t,i){i=i||{};const n=new h(e,i);n.flip=false;n.image=t;n.width=t.videoWidth||t.width||8;n.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))n.wrap=i.wrap;n.initTexture(t,i.filter);return n};h.fromImage=function(e,t,i,n){console.error("deprecated texture from image...");const r=new h(e);r.flip=false;if(i)r.filter=i;if(n)r.wrap=n;r.image=t;r.initTexture(t);return r};h.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};h.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==h.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==h.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==h.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==h.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==h.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==h.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==h.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==h.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==h.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==h.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};h.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=h.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let n=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==h.PFORMATSTR_RGBA32F)t=h.PFORMATSTR_RGBA16F;if(t==h.PFORMATSTR_RG32F)t=h.PFORMATSTR_RG16F;if(t==h.PFORMATSTR_R32F)t=h.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const r=e.enableExtension("EXT_color_buffer_half_float");if(!r){console.warn("no 16bit extension, fallback to 32bit",t);if(t==h.PFORMATSTR_RGBA16F)t=h.PFORMATSTR_RGBA32F;if(t==h.PFORMATSTR_RGB16F)t=h.PFORMATSTR_RGB32F;if(t==h.PFORMATSTR_RG16F)t=h.PFORMATSTR_RG32F;if(t==h.PFORMATSTR_R16F)t=h.PFORMATSTR_R32F}else{n=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==h.PFORMATSTR_RGBA16F||t==h.PFORMATSTR_RG16F||t==h.PFORMATSTR_R16F){const s=e.enableExtension("OES_texture_half_float");if(!s)throw new Error("no half float texture extension");n=s.HALF_FLOAT_OES}}if(t==h.PFORMATSTR_RGBA8UB){}else if(t==h.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==h.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==h.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==h.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==h.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==h.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=n}else if(t==h.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=n;i.glDataFormat=e.gl.RED}else if(t==h.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=n;i.glDataFormat=e.gl.RG}else if(t==h.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=n}else if(t==h.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=n;i.glDataFormat=e.gl.RGB}else if(t==h.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=n}else if(t==h.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{a.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==h.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=h.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)a.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};h.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};h.isPixelFormatFloat=e=>{return(e||"").includes("float")};h.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")}},771:(e,t,i)=>{"use strict";i.d(t,{p:()=>o});var n=i(849);var r=i(70);var s=i(273);class o{constructor(e,t){this._cgl=e;this._log=new n.A("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new r.g(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.profileTextureEffect++;if(this._textureTarget.filter==r.g.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=s.S.getSimpleRect(this._cgl,"texEffectRect")}}o.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};o.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};o.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};o.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};o.AddBlendSelect=function(e,t,i){const n=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return n};o.AddBlendAlphaMask=function(e,t,i){const n=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return n};o.setupBlending=function(i,n,r,e,s){const t=()=>{let e=false;if(s)e=s.get()=="On";o.onChangeBlendSelect(n,r.get(),e);let t=r.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[r,e,s]);let a=false;r.onChange=t;if(s){s.onChange=t;a=s.get()=="On"}o.onChangeBlendSelect(n,r.get(),a)}},997:(e,t,i)=>{"use strict";i.d(t,{a:()=>o,nl:()=>l});const n={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const r={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const s=180/Math.PI;const a=Math.PI/180;const o={MATH:{DEG2RAD:a,RAD2DEG:s},SHADER:n,BLEND_MODES:r};const l="\n"},772:(e,t,i)=>{"use strict";i.d(t,{Rq:()=>N});var c=i(344);var a=i(849);var l=i(70);class n{constructor(t,e,i,n){this._log=new a.A("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=n||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=l.g.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=l.g.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!n.pixelFormat){if(n.isFloatingPointTexture)this._options.pixelFormat=l.g.PFORMATSTR_RGBA32F;else this._options.pixelFormat=l.g.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new l.g(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let r=l.g.FILTER_NEAREST;if(this._options.shadowMap)r=l.g.FILTER_LINEAR;const s=512;if(this._options.depth){this._textureDepth=new l.g(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:r,shadowMap:this._options.shadowMap||false,width:e||s,height:i||s})}if(t.aborted)return;this.setSize(e||s,i||s);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const n=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const a=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,a);const o=l.g.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=l.g.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=l.g.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,a);this._colorRenderbuffers[i]=a}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let r=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)r=this._cgl.gl.DEPTH_COMPONENT16;if(n){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const s=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(s!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(s){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",s,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+s)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.profileFramebuffer++;if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==l.g.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const r=function(e){this.draw=function(e,t,i){}};const s=function(e){this.render=function(e,t){}};const o=function(e){this.render=function(e,t,i,n){}};var u=i(264);var h=i(923);var f=i(960);class d{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,n){this.coloruni.set(e,t,i,n)}}var g=i(24);var m=i(273);const p=Math.PI/180;const _=180/Math.PI;const b=null;const v=window.navigator.userAgent.includes("Windows");const A=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(v)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const n=e||t.detail;i=-(n%3?n*10:n/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const T=A;const E=A;var x=i(771);var O=i(997);var I=i(460);var S=i(331);var y=i(982);var C=i(868);var R=i(308);const N={Framebuffer2:n,Geometry:S.V,BoundingBox:y.I,Marker:r,WirePoint:s,WireCube:o,MatrixStack:C.u,Mesh:u.e,MESH:u.C,ShaderLibMods:f.y,Shader:g.M,Uniform:h.n,MESHES:m.S,getWheelSpeed:T,getWheelDelta:E,Context:R.G,Texture:l.g,TextureEffect:x.p,onLoadingAssetsFinished:b,ProfileData:I.E,UniColorShader:d,...O.a.BLEND_MODES,...O.a.SHADER,...O.a.MATH,...O.a.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL=window.CABLES.CGL||N;window.CGL=window.CGL||N;c.k.slerpQuaternion=function(e,t,i,n,r,s){if(!c.k.slerpQuaternion.q1){c.k.slerpQuaternion.q1=quat.create();c.k.slerpQuaternion.q2=quat.create()}const a=i.getKeyIndex(e);let o=a+1;if(o>=i.keys.length)o=i.keys.length-1;if(a==o){quat.set(t,i.keys[a].value,n.keys[a].value,r.keys[a].value,s.keys[a].value)}else{const l=i.keys[a].time;const u=i.keys[o].time;const h=(e-l)/(u-l);quat.set(c.k.slerpQuaternion.q1,i.keys[a].value,n.keys[a].value,r.keys[a].value,s.keys[a].value);quat.set(c.k.slerpQuaternion.q2,i.keys[o].value,n.keys[o].value,r.keys[o].value,s.keys[o].value);quat.slerp(t,c.k.slerpQuaternion.q1,c.k.slerpQuaternion.q2,h)}return t}},626:(e,t,i)=>{"use strict";var r=i(849);var n=i(628);var s=i(356);var a=i(684);var o=i(920);var l=i(475);class u extends l.v{#cgp=null;gpuBuffer=null;gpuBufferChanged=false;constructor(e,t,i,n,r,s,a){super(e,t,i,n,r,s,a);this.#cgp=e._cgp;if(!n||n.get&&!n.get()){if(this.getType()=="t"){this._value=this.#cgp.getEmptyTexture()}}}getInfo(){return{name:this.name,type:this.type,value:this.getValue()}}updateValueF(){}updateValueArrayF(){}setValueArrayF(e){this.needsUpdate=true;this._value=e}setValueF(e){this.needsUpdate=true;this._value=e}updateValue2F(){}setValue2F(e){this.needsUpdate=true;this._value=e}updateValue3F(){}setValue3F(e){this.needsUpdate=true;this._value=e}updateValue4F(){}setValue4F(e){if(e[0]==undefined){this._log.stack("uniform value undefined");console.error("uniform value undefined")}this.needsUpdate=true;this._value=e}setValueT(e){this.needsUpdate=true;this._value=e}updateValueM4(e){}setValueM4(e){this.needsUpdate=true;this._value=e}setValueAny(e){this.needsUpdate=true;this._value=e}updateValueAny(){}updateValueT(){}setGpuBuffer(e){this.gpuBufferChanged=true;this.gpuBuffer=e}copyToBuffer(t,i=0){if(this._type=="f"){t[i]=this._value}else if(this._type=="t"){}else if(this._type=="4f"){t[i]=this._value[0];t[i+1]=this._value[1];t[i+2]=this._value[2];t[i+3]=this._value[3]}else if(this._type=="2f"){t[i]=this._value[0];t[i+1]=this._value[1]}else if(this._type=="3f"){t[i]=this._value[0];t[i+1]=this._value[1];t[i+2]=this._value[2]}else if(this._type=="f[]"){for(let e=0;e<this._value.length;e++)t[i+e]=this._value[e]}else if(this._type=="m4"){for(let e=0;e<16;e++)t[i+e]=this._value[e]}else{this._log.warn("uniform copy to buffer unknown",this._type)}}getWgslTypeStr(){if(this._type=="m4")return"mat4x4f";if(this._type=="4f")return"vec4f";if(this._type=="3f")return"vec3f";if(this._type=="2f")return"vec2f";if(this._type=="f")return"f32";if(this._type=="f[]")return"array<vec4f>";if(this._type=="i")return"int";if(this._type=="sampler")return"sampler";if(this._type=="t")return"texture_2d<f32>";this._log.warn("unknown type getWgslTypeStr",this._type);return"???"}getSizeBytes(){const e=4;const t=4;if(this._type=="t")return 4;if(this._type=="sampler")return 4;if(this._type=="f")return 1*e;if(this._type=="2f")return 2*e;if(this._type=="3f")return 3*e;if(this._type=="4f")return 4*e;if(this._type=="f[]")return this._value.length*e;if(this._type=="m4")return 4*4*e;if(this._type=="i")return 1*t;if(this._type=="2i")return 2*t;this._log.warn("unknown type getSizeBytes",this._type);return 4}copy(e){const t=new u(e,this._type,this._name,this._value,this._port2,this._port3,this._port4);t.shaderType=this.shaderType;return t}}function h(e,n){if(!e){console.warn("shader preproc no shader code given")}e=e||"";const r=e.split("\n");const s=[];let a=[];for(let i=0;i<r.length;i++){let e=r[i].trim();let t=e.split(" ");if(e.startsWith("#ifdef ")){const l=n[t[1]];a.push({state:l});continue}if(e.startsWith("#ifndef ")){const l=n[t[1]];a.push({state:!l});continue}if(e.startsWith("#endif")){a.pop();continue}const o=a[a.length-1];if(e.startsWith("#else")){o.state=!o.state;continue}if(!o||o.state){s.push(r[i])}}return s.join("\n")}var c=i(694);class f{#gpuBindGroups=[];#bindings=[];name="";needsPipelineUpdate=false;bla=1;#cgp;constructor(e,t){this.#cgp=e;this.name=t}hasBinding(e){return this.#bindings.includes(e)}getBindingByName(t){for(let e=0;e<this.#bindings.length;e++){if(this.#bindings[e].name==t)return this.#bindings[e]}}removeBinding(e){const t=this.#bindings.indexOf(e);this.#bindings.splice(t,1)}addBinding(e){const t=this.getBindingByName(e.name);if(t)this.removeBinding(t);e.needsRebuildBindgroup=true;e.bindNum=this.#bindings.length;this.#bindings.push(e);return e}getLayoutEntries(t){const i=[];for(let e=0;e<this.#bindings.length;e++){i.push(this.#bindings[e].getLayoutEntry(t))}if(i.length==0){}return i}getEntries(t){const i=[];for(let e=0;e<this.#bindings.length;e++){i.push(this.#bindings[e].getBindgroupEntry(t))}if(i.length==0){}return i}getLayout(e){const t=this.#cgp.device.createBindGroupLayout({label:"bindgrouplayout "+this.name,entries:this.getLayoutEntries(e)});return t}create(e){const t={label:" "+this.name+" i"+e,layout:this.getLayout(),entries:this.getEntries(e)};this.#cgp.profileData.count("bindgroup created",this.name);try{this.#gpuBindGroups[e]=this.#cgp.device.createBindGroup(t);this.needsRebuildBindgroup=true}catch(e){console.log(t);console.error(e)}this.updateValues(e)}updateValues(t){for(let e=0;e<this.#bindings.length;e++){this.#bindings[e].updateValues(t)}}bind(t=0,e=null,i=0){for(let e=0;e<this.#bindings.length;e++)if(this.#bindings[e].needsRebuildBindgroup){this.create(t);this.#bindings[e].needsRebuildBindgroup=false;this.#gpuBindGroups=[]}if(!this.#gpuBindGroups[t])this.create(t);(e||this.#cgp.passEncoder).setBindGroup(i,this.#gpuBindGroups[t])}getShaderHeaderCode(i,n){const r={vertex:"",fragment:"",compute:""};this.#cgp.profileData.count("bindgroup shadercode",this.name);for(let t=0;t<this.#bindings.length;t++){const s=this.#bindings[t];let e="";e+=s.getShaderHeaderCode(i,n);if(s.stage&GPUShaderStage.VERTEX)r.vertex+=e;else if(s.stage===GPUShaderStage.FRAGMENT)r.fragment+=e;else if(s.stage&GPUShaderStage.COMPUTE)r.compute+=e}return r}copy(t){const i=new f(this.#cgp,this.name);for(let e=0;e<this.#bindings.length;e++){i.addBinding(this.#bindings[e].copy(t))}return i}setBindingNums(){for(let e=0;e<this.#bindings.length;e++){this.#bindings[e].setBindNum(e)}}getInfo(){const t={name:this.name,bindings:[]};for(let e=0;e<this.#bindings.length;e++){t.bindings.push(this.#bindings[e].getInfo())}return t}}var d=i(562);var g=i(997);class m{id=d.simpleId();name="";bindNum=0;stage=GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT;define="";log=new r.A("binding");needsRebuildBindgroup=false;cgp=null;constructor(e,t,i){this.cgp=e;this.name=t;if(!t)this.log.error("no binding name given");this.options=i||{};if(i.hasOwnProperty("stage"))this.stage=i.stage}getResource(e){return null}setBindNum(e){if(this.bindNum!=e)this.needsRebuildBindgroup=true;this.bindNum=e}getLayoutEntry(e){this.log.warn("unknown binding type?",this);return null}getBindgroupEntry(e){let t="layout "+this.name+" ["+this.constructor.name;t+="]";return{binding:this.bindNum,resource:this.getResource(e)}}isActiveByDefine(e){if(!this.define)return true;return true}updateValues(e){}getShaderHeaderCode(e,t){return"//getShaderHeaderCode function not emplemented "+g.nl}copy(e){return null}getInfo(){const e={name:this.name,id:this.id,class:this.constructor.name};return e}}var p=i(125);class _ extends p.A{#name="unknown";#cgp=null;#gpuBuffer=null;buffCfg=null;#length=0;id=d.shortId();floatArr=null;needsUpdate=true;#log;constructor(e,t,i=null,n={}){super();this.#log=new r.A("cgpGpubuffer");if(!e.supported)return;this.#name=t;this.buffCfg=n.buffCfg||{};if(i)this.setData(i);if(n.length)this.setLength(n.length);this.buffCfg.usage=this.buffCfg.usage||GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC;this.updateGpuBuffer(e)}setData(e){this.floatArr=new Float32Array(e);this.setLength(this.floatArr.length);this.needsUpdate=true}setLength(e){this.#length=e;if(!this.floatArr||e!=this.floatArr.length){this.floatArr=new Float32Array(this.#length);this.needsUpdate=true}}hasUsage(e){return(this.buffCfg.usage&e)===e}updateGpuBuffer(e=null){if(e)this.#cgp=e;if(!this.#cgp||!this.#cgp.device){this.#log.warn("no cgp...",this.#name,this.#cgp);return}this.#cgp.pushErrorScope("updateGpuBuffer");if(!this.#gpuBuffer||this.buffCfg.mappedAtCreation){this.buffCfg=this.buffCfg||{};this.buffCfg.label="gpuBuffer-"+this.#name;if(!this.buffCfg.hasOwnProperty("size")&&this.floatArr)this.buffCfg.size=this.floatArr.length*4;this.#gpuBuffer=this.#cgp.device.createBuffer(this.buffCfg)}if(this.floatArr){if(this.buffCfg.mappedAtCreation){new Float32Array(this.#gpuBuffer.getMappedRange()).set(this.floatArr);this.#gpuBuffer.unmap()}else this.#cgp.device.queue.writeBuffer(this.#gpuBuffer,0,this.floatArr.buffer,this.floatArr.byteOffset,this.floatArr.byteLength)}this.#cgp.popErrorScope();this.needsUpdate=false}get name(){return this.#name}get gpuBuffer(){if(!this.#gpuBuffer||this.needsUpdate)this.updateGpuBuffer();return this.#gpuBuffer}get length(){return this.#length}getSizeBytes(){return this.floatArr.length*4}dispose(){}}class b extends m{#uniforms=[];cgpBuffer=[];constructor(e,t,i){super(e,t,i);console.log("new binding uniform",this.id)}copy(n){const r=new b(this.cgp,this.name,this.options);console.log("copybinuni",this.id,r.id);r.stage=this.stage;for(let i=0;i<this.#uniforms.length;i++){let t=false;for(let e=0;e<n.worldUniforms.length;e++){if(n.worldUniforms[e].getName()==this.#uniforms[i].getName()){r.addUniform(n.worldUniforms[e]);t=true}}if(!t)r.addUniform(this.#uniforms[i])}return r}addUniform(e){this.#uniforms.push(e);this.needsRebuildBindgroup=true;console.log(this.#uniforms,this);return e}getResource(e){this.updateBuffer(e);return{buffer:this.cgpBuffer[e].gpuBuffer}}getSizeBytes(){let t=0;for(let e=0;e<this.#uniforms.length;e++)t+=this.#uniforms[e].getSizeBytes();return t}getUniform(t){for(let e=0;e<this.#uniforms.length;e++){if(this.#uniforms[e].name==t)return this.#uniforms[e]}return null}removeUniformByName(t){for(let e=0;e<this.#uniforms.length;e++)if(this.#uniforms[e].name==t){this.needsRebuildBindgroup=true;return this.#uniforms.splice(e,1)}}createBuffer(e){let t={label:this.name,size:this.getSizeBytes(),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM};this.cgpBuffer[e]=new _(this.cgp,this.name+" buff",null,{buffCfg:t})}pipelineUpdated(){this.needsRebuildBindgroup=false}needsPipeUpdate(){return this.needsRebuildBindgroup}updateBuffer(t){let i={name:this.#uniforms.length+" uniforms","stage ":T.getStageString(this.stage),uniforms:[]};let e=this.getSizeBytes()/4;i.s=this.getSizeBytes();if(e==16)e=16;if(!this.cgpBuffer[t]){this.createBuffer(t)}this.cgpBuffer[t].setLength(e);let n=0;for(let e=0;e<this.#uniforms.length;e++){this.#uniforms[e].copyToBuffer(this.cgpBuffer[t].floatArr,n);if(this.#uniforms[e].gpuBufferChanged)console.log("un changed",this.cgpBuffer[t].floatArr);i.uniforms.push(this.#uniforms[e].getInfo());n+=this.#uniforms[e].getSizeBytes()/4}if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("binding update buff",T.getStageString(this.stage),{info:i});this.cgpBuffer[t].updateGpuBuffer();if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}getShaderHeaderCode(e,t){this.cgp.profileData.count("shadercode uni",this.name);let i="";let n="";let r=this.name;i+='//   [binding_uniform] - "'+this.name+'" '+this.id+" uniforms:"+this.#uniforms.length+"\n";if(!this.isActiveByDefine(e)){i+="// "+n+" "+this.name+": excluded because define "+this.define+"\n";return i}if(this.#uniforms.length>1){n="strct_"+r;i+="struct "+n+"\n";i+="{\n";for(let e=0;e<this.#uniforms.length;e++){i+="    "+this.#uniforms[e].name+": "+this.#uniforms[e].getWgslTypeStr();if(e!=this.#uniforms.length-1)i+=",";i+="\n"}i+="};\n"}else if(this.#uniforms.length==1){n=this.#uniforms[0].getWgslTypeStr();r=this.#uniforms[0].name}else if(this.#uniforms.length==0){return i}i+="@group("+t+") ";i+="@binding("+this.bindNum+") ";i+="var<uniform> ";i+=r+": "+n+";\n";return i+"\n"}getLayoutEntry(){return{visibility:this.stage,binding:this.bindNum,minBindingSize:this.getSizeBytes(),hasDynamicOffset:0,buffer:{}}}updateValues(e){for(let e=0;e<this.#uniforms.length;e++){}return this.updateBuffer(e)}getInfo(){const t={name:this.name,id:this.id,stage:this.stage,class:this.constructor.name,uniforms:[]};for(let e=0;e<this.#uniforms.length;e++){t.uniforms.push(this.#uniforms[e].getInfo())}return t}}class v extends m{smplDesc={addressModeU:"mirror-repeat",addressModeV:"mirror-repeat",magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"};sampler=null;constructor(e,t,i){super(e,t,i);this.sampler=this.cgp.device.createSampler(this.smplDesc)}copy(){const e=new v(this.cgp,this.name,this.options);return e}getResource(){return this.sampler}getLayoutEntry(){return{visibility:this.stage,binding:this.bindNum,sampler:{}}}getShaderHeaderCode(e,t){let i="@group("+t+") @binding("+this.bindNum+") ";i+="var "+this.name+": sampler;".endl();return i}}class A extends m{sampler=null;uniform=null;constructor(e,t,i){super(e,t,i);this.uniform=i.uniform;if(this.uniform.port){this.uniform.port.on("change",()=>{this.needsRebuildBindgroup=true})}console.log(this.uniform)}copy(){const e=new A(this.cgp,this.name,this.options);return e}getResource(){if(this.uniform.getValue()&&this.uniform.getValue().gpuTexture)return this.uniform.getValue().gpuTexture.createView();else return this.cgp.getDefaultTexture().createView()}getLayoutEntry(){return{visibility:this.stage,binding:this.bindNum,texture:{}}}getShaderHeaderCode(e,t){let i="@group("+t+") @binding("+this.bindNum+") ";i+="var "+this.name+": "+this.uniform.getWgslTypeStr()+";\n";return i}}class T extends c.U{#lastCompileReason="first";uniModelMatrix;uniViewMatrix;uniProjMatrix;compilationInfo;constructor(e,t,i={}){super();if(!e)throw new Error("shader constructed without cgp "+t);this._log=new r.A("cgp_shader");this._cgp=e;this._name=t;this.options=i;this.options.compute=this.options.compute||false;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";this.gpuShaderModule=null;this.frameUsageCounter=0;this.lastFrameUsageCounter=-2;this.frameUsageFrame=-1;this._bindingIndexCount=0;this.compileCount=0;this.worldUniforms=[];this.defaultBindGroup=new f(e,this._name);this.modsBindGroup=new f(e,this._name);this.bindGroups=[this.defaultBindGroup,this.modsBindGroup];if(!this.options.compute){this.defaultUniBindingVert=new b(e,"uniVert",{stage:GPUShaderStage.VERTEX});this.defaultBindGroup.addBinding(this.defaultUniBindingVert);this.defaultUniBindingFrag=new b(e,"uniFrag",{stage:GPUShaderStage.FRAGMENT});this.defaultBindGroup.addBinding(this.defaultUniBindingFrag)}else{this.defaultUniBindingCompute=new b(e,"uniCompute",{stage:GPUShaderStage.COMPUTE});this.defaultBindGroup.addBinding(this.defaultUniBindingCompute)}if(!this.options.compute){this.uniModelMatrix=this.addUniform(new u(this,"m4","modelMatrix"),GPUShaderStage.VERTEX);this.uniViewMatrix=this.addUniform(new u(this,"m4","viewMatrix"),GPUShaderStage.VERTEX);this.uniProjMatrix=this.addUniform(new u(this,"m4","projMatrix"),GPUShaderStage.VERTEX);this.uniNormalMatrix=this.addUniform(new u(this,"m4","normalMatrix"),GPUShaderStage.VERTEX);this.uniModelViewMatrix=this.addUniform(new u(this,"m4","modelViewMatrix"),GPUShaderStage.VERTEX);this._tempNormalMatrix=a.create();this._tempModelViewMatrix=a.create();this.worldUniforms.push(this.uniModelMatrix,this.uniViewMatrix,this.uniProjMatrix,this.uniNormalMatrix,this.uniModelViewMatrix)}this._src="";this._cgp.on("deviceChange",()=>{this.gpuShaderModule=null;this.setWhyCompile("device changed")})}reInit(){}isValid(){return this._isValid}getName(){return this._name}incFrameUsageCount(){if(this.frameUsageFrame!=this._cgp.frame){this.lastFrameUsageCounter=this.frameUsageCounter;this.frameUsageCounter=0}else this.frameUsageCounter++;this.frameUsageFrame=this._cgp.frame;return this.frameUsageCounter}getNewBindingGroupIndex(){return++this._bindingIndexCount}setSource(e){this._src=e;this.setWhyCompile("Source changed")}_replaceModPrefixes(e,t){return t.replace(/MOD_/g,e.prefix)}_replaceMods(e,n){let r="";for(let i=0;i<this._moduleNames.length;i++){let t="";for(let e=0;e<this._modules.length;e++){const s=this._modules[e];if(s.name==this._moduleNames[i]){r+=g.nl+g.nl+"//---- MOD: group:"+s.group+": idx:"+e+" - prfx:"+s.prefix+" - "+s.title+" ------"+g.nl;t+=g.nl+g.nl+"//---- MOD: "+s.title+" / "+s.priority+" ------"+g.nl;if(s.attributes)for(let e=0;e<s.attributes.length;e++){const a=this._getAttrSrc(s.attributes[e],false);if(a.srcHeadVert)r+=a.srcHeadVert;if(a.srcVert)t+=a.srcVert}r+=s.srcHead||"";t+=s.srcBody||"";r+=g.nl+"//---- end mod ------"+g.nl;t+=g.nl+"//---- end mod ------"+g.nl;t=this._replaceModPrefixes(s,t);r=this._replaceModPrefixes(s,r)}}t=h(t,n);e=e.replace("{{"+this._moduleNames[i]+"}}",t)}r=h(r,n);e=e.replace("{{MODULES_HEAD}}",r);return e}_replaceVertexOutputs(r=""){const s="{{VERTEX_OUTPUT";const i=r.indexOf(s);if(i>-1){try{let e=r.substring(i+s.length,i+100);let t=e.indexOf("}}");let n=parseInt(e.substring(0,t));for(let i=0;i<this._modules.length;i++){if(!this._modules[i].outputs)continue;let e=this._modules[i].outputs;let t=0;while(e.indexOf("@location("+t+")")>-1){e=e.replaceAll("@location("+t+")","@location("+(t+n)+")")}e=this._replaceModPrefixes(this._modules[i],e);r=r.replaceAll(s+" "+n+"}}",e)}}catch(e){console.log(e)}}return r}getDefines(){return this._defines}getProcessedSource(){const t={};for(let e=0;e<this._defines.length;e++)t[this._defines[e][0]]=this._defines[e][1]||true;let r="";r+=h(this._src,t);let i="";for(let e=0;e<this._defines.length;e++)i+="// #define "+this._defines[e]+"\n";let n="";let s="";let a="";for(let e=0;e<this.bindGroups.length;e++){const r=this.bindGroups[e].getShaderHeaderCode(this,e);s+=r.fragment||"";n+=r.vertex||"";a+=r.compute||""}if(this.options.compute)r=a+"\n\n////////////////\n\n"+r;else r=s+"\n\n////////////////\n\n"+n+"\n\n////////////////\n\n"+r;r=this._replaceMods(r,t);r=this._replaceVertexOutputs(r);const o="{{VERTEX_OUTPUT";const l=r.indexOf(o);if(l>-1){try{let e=r.substring(l+o.length,l+100);let t=e.indexOf("}}");let i=parseInt(e.substring(0,t));let n="@location("+i+") pos:vec4f, // generated";r=r.replaceAll(o+" "+i+"}}",n)}catch(e){console.log(e)}}r=i+"\n"+r;let e="//"+g.nl+"// ";if(this.options.compute)e+="Compute ";else e+="Render ";e+="Shader: "+this._name+" - "+this.id+g.nl;e+="//"+g.nl;return e+r}compile(){this._isValid=true;this._cgp.pushErrorScope("cgp_shader "+this._name);if(this._cgp.branchProfiler)this._cgp.branchProfiler.push("shadercompile",this._name,{info:this.getInfo()});this._cgp.profileData.count("shader compile",this._name);this.gpuShaderModule=this._cgp.device.createShaderModule({code:this.getProcessedSource(),label:this._name});this.gpuShaderModule.getCompilationInfo().then(t=>{this.compilationInfo=t;if(t.messages.length>0){let e=false;for(const i of t.messages){switch(i.type){case"error":console.error("Shader "+i.type+" at line "+i.lineNum+":"+i.linePos+" :"+i.message);e=true;case"warning":console.warn("Shader "+i.type+" at line "+i.lineNum+":"+i.linePos+" :"+i.message);break;case"info":console.info("Shader "+i.type+" at line "+i.lineNum+":"+i.linePos+" :"+i.message);break}}if(e){console.log("has errrrrrrrrrr");CABLES.UI.showShaderErrorCgp(this,t,this.getProcessedSource())}}});this._cgp.popErrorScope(this.error.bind(this));this.#lastCompileReason=this._compileReason;this.lastCompile=(0,o.tB)();this.emitEvent("compiled",this._compileReason);this._needsRecompile=false;this._compileReason="none";this.compileCount++;if(this._cgp.branchProfiler)this._cgp.branchProfiler.pop()}error(e){this._isValid=false}bind(t=null){this.incFrameUsageCount();if(!this.options.compute){this.uniModelMatrix.setValue(this._cgp.mMatrix);this.uniViewMatrix.setValue(this._cgp.vMatrix);this.uniProjMatrix.setValue(this._cgp.pMatrix);a.mul(this._tempModelViewMatrix,this._cgp.vMatrix,this._cgp.mMatrix);this.uniModelViewMatrix.setValue(this._tempModelViewMatrix);a.copy(this._tempNormalMatrix,this._cgp.mMatrix);a.invert(this._tempNormalMatrix,this._tempNormalMatrix);a.transpose(this._tempNormalMatrix,this._tempNormalMatrix);this.uniNormalMatrix.setValue(this._tempNormalMatrix)}for(let e=0;e<this.bindGroups.length;e++){this.bindGroups[e].updateValues(this.frameUsageCounter);this.bindGroups[e].bind(this.frameUsageCounter,t,e)}if(this._needsRecompile)this.compile()}getDefaultUniBinding(e){let t=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)t=this.defaultUniBindingVert;if(this.options.compute&&e==GPUShaderStage.COMPUTE)t=this.defaultUniBindingCompute;return t}pipelineUpdated(){if(this.defaultUniBindingFrag)this.defaultUniBindingFrag.pipelineUpdated();if(this.defaultUniBindingVert)this.defaultUniBindingVert.pipelineUpdated();if(this.defaultUniBindingCompute)this.defaultUniBindingCompute.pipelineUpdated()}bindingsNeedPipeUpdate(){return this.defaultUniBindingFrag&&this.defaultUniBindingFrag.needsPipeUpdate()||this.defaultUniBindingVert&&this.defaultUniBindingVert.needsPipeUpdate()||this.defaultUniBindingCompute&&this.defaultUniBindingCompute.needsPipeUpdate()}hasUniformInStage(e,t){let i=this.getDefaultUniBinding(t);if(!i)return false;return!!i.getUniform(e)}hasUniform(e){return this.hasUniformInStage(e,GPUShaderStage.FRAGMENT)||this.hasUniformInStage(e,GPUShaderStage.VERTEX)||this.hasUniformInStage(e,GPUShaderStage.COMPUTE)}addUniform(e,t){const i=this.getDefaultUniBinding(t);if(e.type=="t")this.defaultBindGroup.addBinding(new A(this._cgp,e.name,{uniform:e}));else if(e.type=="sampler")this.defaultBindGroup.addBinding(new v(this._cgp,e.name,{uniform:e}));else{i.addUniform(e)}this.needsPipelineUpdate="add uniform";console.log("adduni2",this._name,e.name,this.id,i,T.getStageString(t));console.log("code",i.getShaderHeaderCode(this,0));return e}removeUniformByName(e){const t=this.getDefaultUniBinding(stage);t.removeUniformByName(e)}copy(){this.bind();const t=new T(this._cgp,this._name+" copy",this.options);console.log("copyyyyyy",this.id,t.id);t.setSource(this._src);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._moduleNames=this._moduleNames;t.bindGroups=[];for(let e=0;e<this.bindGroups.length;e++){const i=this.bindGroups[e].copy(t);t.bindGroups.push(i);if(this.bindGroups[e]==this.defaultBindGroup)t.defaultBindGroup=i;i.setBindingNums()}t.setWhyCompile("copy");t.compile();return t}dispose(){}static getStageString(e){if(e==GPUShaderStage.FRAGMENT)return"frag";if(e==GPUShaderStage.VERTEX)return"vertex";if(e==(GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX))return"frag+vertex";if(e==(GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE))return"frag+vertex+comp";if(e==GPUShaderStage.COMPUTE)return"compute";return"unknown"+e}getInfo(){const t={class:this.constructor.name,id:this.id,name:this._name,needsPipelineUpdate:this.needsPipelineUpdate,frameUsageCounter:this.lastFrameUsageCounter,lastCompileReason:this.#lastCompileReason,compileCount:this.compileCount,defines:this._defines,isCompute:this.options.compute,modules:[],bindgroups:[]};for(let e=0;e<this.bindGroups.length;e++){t.bindgroups.push(this.bindGroups[e].getInfo())}for(let e=0;e<this._modules.length;e++){t.modules.push(this._modules[e].title+" "+this._modules[e].name+" "+this._modules[e].group)}return t}copyUniformValues(e){}}class E extends s.U{#log=new r.A("cgp_texture");#cgp=null;gpuTexture=null;gpuTextureDescriptor=null;name="unknown";width=8;height=8;textureType="???";samplerDesc={};constructor(e,t={}){super(t);t=t||{};this.#cgp=e;if(!this.#cgp)throw new Error("no cgp");if(t.name)this.name=t.name;if(t.height&&t.width)this.setSize(t.width,t.height);this.#cgp.on("deviceChange",()=>{});this.samplerDesc={addressModeU:t.wrap||t.addressModeU||"clamp-to-edge",addressModeV:t.wrap||t.addressModeV||"clamp-to-edge",magFilter:t.magFilter||t.filter||"linear",minFilter:t.minFilter||t.filter||"linear"}}setSize(e,t){this.width=e;this.height=t}initTexture(e,t){this.width=e.width;this.height=e.height;const i="rgba8unorm";this.#cgp.pushErrorScope("inittexture",{logger:this.#log});this.gpuTextureDescriptor={size:{width:e.width,height:e.height},format:i,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.gpuTexture=this.#cgp.device.createTexture(this.gpuTextureDescriptor);this.#cgp.device.queue.copyExternalImageToTexture({source:e},{texture:this.gpuTexture},this.gpuTextureDescriptor.size);this.#cgp.popErrorScope();return this.gpuTexture}dispose(){console.log("todo dispose")}getInfo(){const e={};e.name=this.name||"???";e.size=this.width+" x "+this.height;e.textureType=this.textureType;return e}createView(){if(!this.gpuTexture){console.log("no gputexture...");return null}return this.gpuTexture.createView()}getSampler(){return this.samplerDesc}initFromData(e,t,i,n,r){if(!t||!i)this.#log.error("texture size is 0");this.width=t;this.height=i;this.gpuTexture=this.#cgp.device.createTexture({size:[t,i],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});this.#cgp.device.queue.writeTexture({texture:this.gpuTexture},e,{bytesPerRow:t*4},{width:t,height:i})}setWrap(e){this.samplerDesc.addressModeU=this.samplerDesc.addressModeV=e}setFilter(e){this.samplerDesc.minFilter=this.samplerDesc.magFilter=e}}E.load=function(i,n,r,e){fetch(n).then(e=>{const t=new E(i,{name:n});e.blob().then(e=>{createImageBitmap(e).then(e=>{t.initTexture(e);if(r)r(t);else console.log("Texture.load no onFinished callback")}).catch(e=>{if(r)r(i.getErrorTexture())})})})};class x{static TYPE_RENDER=0;static TYPE_COMPUTE=1;#log=new r.A("pipeline");name="";#cgp=null;#isValid=true;presentationFormat=null;#pipeCfg=null;bindGroupLayout=null;#shaderListeners=[];#type=-1;lastRebuildReason="first";rebuildCount=0;profile=false;bindingGroupLayoutEntries=[];constructor(e,t,i=0){if(!e)throw new Error("Pipeline constructed without cgp "+t);this.name=t;this.#cgp=e;this.#type=i}get passEncoder(){return this.#cgp.passEncoder}get log(){return this.#log}get cgp(){return this.#cgp}get isValid(){return this.#isValid}setName(e){this.name=e}getInfo(){const e={class:this.constructor.name,name:this.name,rebuildReason:this.lastRebuildReason,rebuildCount:this.rebuildCount,bindingGroupLayoutEntries:this.bindingGroupLayoutEntries};if(this.#type==x.TYPE_COMPUTE)e.type="COMPUTE";if(this.#type==x.TYPE_RENDER)e.type="RENDER";return e}pushDebug(){this.#cgp.currentPipeDebug={name:this.name,rebuildreason:this.lastRebuildReason,rebuildCount:this.rebuildCount,cfg:this.#pipeCfg,bindingGroupLayoutEntries:this.bindingGroupLayoutEntries}}_bindUniforms(e){e.bind()}dispose(){}}class O extends x{static DEPTH_COMPARE_FUNCS_STRINGS=["never","less","equal","lessequal","greater","notequal","greaterequal","always"];#isValid=true;presentationFormat=null;#pipeCfg=null;#renderPipeline=null;bindGroupLayout=null;#passEncoder;#old={};#type=O.TYPE_RENDER;lastRebuildReason="first";#rebuildNumBindingGroups=false;#compileCount=-1;constructor(e,t){super(e,t,x.TYPE_RENDER)}setPipeline(t,e=null){if(this.#type==O.TYPE_RENDER){if(!e){this.log.log("pipeline unknown mesh");return}}if(!t){this.log.log("pipeline unknown shader");return}if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("setPipeline",this.name,{info:this.getInfo(),shader:t.getInfo()});let i="";if(!this.#renderPipeline)i="no renderpipeline";if(!this.#pipeCfg)i="no pipecfg";if(this.#old.mesh!=e)i="no mesh";if(this.#old.shader!=t){i="shader changed"}if(t.needsPipelineUpdate){i="shader needs update: "+t.needsPipelineUpdate;t.needsPipelineUpdate=""}if(this.#type==O.TYPE_RENDER&&e.needsPipelineUpdate){i="mesh needs update";e.needsPipelineUpdate=false}if(this.bindingGroupLayoutEntries.length!=t.defaultBindGroup.getLayoutEntries(t).length){i="num bindgroup layouts wrong..."}if(t.bindingsNeedPipeUpdate()){console.log("binding needs uptate");i="bindings needs update";this.needsRebuildBindgroup=true}if(this.#pipeCfg){this.#pipeCfg=this.#pipeCfg||{};if(this.#pipeCfg.depthStencil.depthWriteEnabled!=this.cgp.stateDepthWrite())i="depth changed";if(this.#pipeCfg.fragment.targets[0].blend!=this.cgp.stateBlend()){i="blend changed";this.#pipeCfg.fragment.targets[0].blend=this.cgp.stateBlend()}if(this.#pipeCfg.depthStencil.depthCompare!=this.cgp.getDepthCompare())i="depth compare changed";if(this.#pipeCfg.primitive.cullMode!=this.cgp.stateCullFaceFacing())i="cullmode change";if(this.#pipeCfg.multisample.count!=this.cgp.stateMultisampling())i="multisample change"}if(this.#compileCount!=t.compileCount){i="shader compiled "+t.compileCount}this.pushDebug();if(i!=""){this.cgp.profileData.addHeavyEvent("pipeline created",this.name,i);this.lastRebuildReason=i;this.rebuildCount++;this.cgp.pushErrorScope("createPipeline",{logger:this.log});this.#rebuildNumBindingGroups=false;this.#pipeCfg=this.getPipelineObject(t);this.#old.device=this.cgp.device;this.#old.shader=t;this.#old.mesh=e;this.#isValid=true;this.#compileCount=t.compileCount;t.pipelineUpdated();try{this.#renderPipeline=this.cgp.device.createRenderPipeline(this.#pipeCfg)}catch(e){console.error("pipe error catch...",e.message,this.#pipeCfg);this.#isValid=false}this.cgp.popErrorScope(()=>{console.log("this.#pipeCfg",this.#pipeCfg)})}if(this.#renderPipeline&&this.#isValid){this.cgp.pushErrorScope("setpipeline",{logger:this.log});let e=this.cgp.passEncoder;if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("pipe updateUniforms",this.name,{shader:t.getInfo()});t.bind();e.setPipeline(this.#renderPipeline);if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop();this.cgp.popErrorScope()}if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}getPipelineObject(e){this.bindingGroupLayoutEntries=[];this.bindingGroupLayoutEntries=e.defaultBindGroup.getLayoutEntries(e);const t=[e.defaultBindGroup.getLayout(e)];const i=this.cgp.device.createPipelineLayout({label:"pipe layout "+this.name,bindGroupLayouts:t});let n=[{arrayStride:3*4,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]},{arrayStride:2*4,attributes:[{shaderLocation:2,offset:0,format:"float32x2"}]},{arrayStride:3*4,attributes:[{shaderLocation:1,offset:0,format:"float32x3"}]}];let r={label:this.name,layout:i,primitive:{topology:"triangle-list",cullMode:this.cgp.stateCullFaceFacing()},multisample:{count:this.cgp.stateMultisampling(),alphaToCoverageEnabled:false},depthStencil:{depthWriteEnabled:this.cgp.stateDepthWrite(),depthCompare:this.cgp.getDepthCompare(),format:"depth24plus"},vertex:{module:e.gpuShaderModule,entryPoint:"myVSMain",buffers:n},fragment:{module:e.gpuShaderModule,entryPoint:"myFSMain",targets:[{format:this.cgp.presentationFormat,blend:this.cgp.stateBlend()}]}};return r}dispose(){}}var I=i(434);class S extends I.w{#log=new r.A("cgl_mesh");needsPipelineUpdate=false;constructor(e,t){super();this.cgp=e;this._geom=null;this.numIndex=0;this.instances=1;this._pipe=new O(this.cgp,"pipe mesh "+t.name);this._numNonIndexed=0;this._positionBuffer=null;this._attributes=[];if(t)this.setGeom(t)}_createBuffer(e,t,i){let n={size:t.byteLength,usage:i,mappedAtCreation:true};const r=e.createBuffer(n);const s=new t.constructor(r.getMappedRange());s.set(t);r.unmap();return r}setGeom(e){this.needsPipelineUpdate=true;this._geom=e;this._disposeAttributes();this._positionBuffer=this._createBuffer(this.cgp.device,new Float32Array(e.vertices),GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST);let t=e.verticesIndices;if(!e.isIndexed())t=Array.from(Array(e.vertices.length/3).keys());this._numIndices=t.length;this._indicesBuffer=this._createBuffer(this.cgp.device,new Uint32Array(t),GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST);if(e.texCoords&&e.texCoords.length)this.setAttribute("texCoords",e.texCoords,2);if(e.vertexNormals&&e.vertexNormals.length)this.setAttribute("normals",e.vertexNormals,3);this.setAttribute("normals",e.vertexNormals,3)}_disposeAttributes(){this.needsPipelineUpdate=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].buffer.destroy();this._attributes.length=0}dispose(){this._disposeAttributes()}setAttribute(e,t,i,n={}){if(!t){this.#log.error("mesh addAttribute - no array given! "+e);throw new Error}let r=false;if(n.instanced)r=n.instanced;const s=this._createBuffer(this.cgp.device,new Float32Array(t),GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST);const a={buffer:s,name:e,instanced:r};this._attributes.push(a);return a}render(e){if(!this._positionBuffer)return;if(this.instances<=0)return;if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("mesh.render()","geom "+this._geom.name);e=e||this.cgp.getShader();if(e)e.bind();if(!e||!e.isValid){return}this._pipe.setName("mesh.render "+this._geom.name+" "+e.getName()+" "+e.id);this._pipe.setPipeline(e,this);if(this._pipe.isValid){if(this.cgp.branchProfiler)this.cgp.branchProfiler.push("mesh.render().draw","geom "+this._geom.name,{geom:this._geom.getInfo(),shader:e.getInfo(),numAttributes:this._attributes.length});this.cgp.passEncoder.setVertexBuffer(0,this._positionBuffer);for(let e=0;e<this._attributes.length;e++)this.cgp.passEncoder.setVertexBuffer(e+1,this._attributes[e].buffer);this.cgp.passEncoder.setIndexBuffer(this._indicesBuffer,"uint32");this.cgp.profileData.count("draw mesh",this._name);if(this._numNonIndexed)this.cgp.passEncoder.draw(this._numIndices,this.instances);else this.cgp.passEncoder.drawIndexed(this._numIndices,this.instances);if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}else{if(this.cgp.branchProfiler){this.cgp.branchProfiler.push("mesh invalid pipeline ","geom "+this._geom.name);this.cgp.branchProfiler.pop()}}if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}}const y=`
struct MyVSInput
{
    @location(0) position: vec3<f32>,
    @location(1) normal: vec3<f32>,
    @location(2) texcoord: vec2<f32>,
};

struct MyVSOutput
{
    @builtin(position) position: vec4<f32>,
    @location(0) normal: vec3<f32>,
    @location(1) texcoord: vec2<f32>,
};

@vertex
fn myVSMain(v: MyVSInput) -> MyVSOutput
{
    var vsOut: MyVSOutput;
    var pos =vec4<f32>(v.position, 1.0);

    var mvMatrix=uniVert.viewMatrix * uniVert.modelMatrix;
    vsOut.position = uniVert.projMatrix * mvMatrix * pos;

    vsOut.normal = v.normal;
    vsOut.texcoord = v.texcoord;
    return vsOut;
}

@fragment
fn myFSMain(v: MyVSOutput) -> @location(0) vec4<f32>
{
    return vec4<f32>(.5,.5,.5,1.0);
}
`;class C extends n.A{branchProfiler=null;constructor(e){super(e);this.patch=e;this.lastErrorMsg="";this._log=new r.A("WebGpuContext");this.gApi=n.A.API_WEBGPU;this._viewport=[0,0,256,256];this._shaderStack=[];this._simpleShader=null;this.frame=0;this.catchErrors=true;this._stackCullFaceFacing=[];this._stackDepthTest=[];this._stackCullFace=[];this._stackDepthFunc=[];this._stackDepthWrite=[];this._stackErrorScope=[];this._stackBlend=[];this._stackErrorScopeLogs=[];this._stackMultisampling=[];this.currentPipeDebug=null;this.canvasAttachments=[];this.device=null;this.passEncoder=null;this._defaultBlend={color:{operation:"add",srcFactor:"one",dstFactor:"zero"},alpha:{operation:"add",srcFactor:"one",dstFactor:"zero"}};this.DEPTH_FUNCS=["never","always","less","less-equal","greater","greater-equal","equal","not-equal"];this.CULL_MODES=["none","back","front","none"];this.presentationFormat="bgra8unorm"}get supported(){return!!navigator.gpu}renderStart(e,t,i){this.frame++;this.pushErrorScope("cgpstate internal",{scope:"internal"});this.pushErrorScope("cgpstate out-of-memory",{scope:"out-of-memory"});if(!this._simpleShader){this._simpleShader=new T(this,"simple default shader");this._simpleShader.setSource(y);this._simpleShader.addUniform(new u(this._simpleShader,"4f","color",[1,1,0,1]),GPUShaderStage.FRAGMENT)}this.fpsCounter.startFrame();this._startMatrixStacks(t,i);this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);this.pushShader(this._simpleShader);this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc("less-equal");this.pushBlend(this._defaultBlend);this._execOneTimeCallbacks();this.emitEvent("beginFrame")}renderEnd(){this._endMatrixStacks();this.popShader();this.popDepthFunc();this.popDepthWrite();this.popDepthTest();this.popErrorScope();this.popErrorScope();if(this._stackErrorScope.length>0)console.log("error scope stack length invalid...");this._stackErrorScope.length=0;this.emitEvent("endFrame");this.fpsCounter.endFrame()}setViewPort(e,t,i,n){this._viewport=[e,t,i,n]}getViewPort(){return this._viewPort}createMesh(e,t){return new S(this,e)}popViewPort(){this._viewPortStack.pop();if(this._viewPortStack.length==0)this._viewPort=[0,0,this.canvasWidth,this.canvasHeight];else this.setViewPort(this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,n){this._viewPortStack.push([e,t,i,n]);this._viewPort=[e,t,i,n]}pushShader(e){this._shaderStack.push(e)}popShader(){if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop()}getShader(){return this._shaderStack[this._shaderStack.length-1]}setDevice(e){this.device=e;if(this._emptyTexture)this._emptyTexture=this._emptyTexture.dispose();if(this._defaultTexture)this._defaultTexture=this._defaultTexture.dispose();if(this._errorTexture)this._errorTexture=this._errorTexture.dispose();this.emitEvent("deviceChange")}pushErrorScope(e,t={}){if(this.catchErrors){this._stackErrorScope.push(e);this._stackErrorScopeLogs.push(t.logger||null);this.device.pushErrorScope(t.scope||"validation")}}popErrorScope(i){if(this.catchErrors){const n=this._stackErrorScope.pop();const t=this._stackErrorScopeLogs.pop();this.device.popErrorScope().then(e=>{if(e){if(this.lastErrorMsg==e.message){}else{(t||this._log).error(e.constructor.name,"in ERROR SCOPE:",n);(t||this._log).error(e.message)}this.lastErrorMsg=e.message;if(i)i(e)}})}}pushDepthTest(e){this._stackDepthTest.push(e)}getDepthCompare(){let e=this.stateDepthFunc();if(!this.stateDepthTest())e="always";return e}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop()}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop()}pushDepthFunc(e){this._stackDepthFunc.push(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return"less"}popDepthFunc(){this._stackDepthFunc.pop()}pushCullFace(e){this._stackCullFace.push(e)}stateMultisampling(){return this._stackMultisampling[this._stackMultisampling.length-1]}pushMultisampling(e){this._stackMultisampling.push(e)}popMultisampling(){this._stackMultisampling.pop()}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e)}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop()}pushBlend(e){this._stackBlend.push(e)}popBlend(){this._stackBlend.pop()}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}getEmptyTexture(){if(this._emptyTexture)return this._emptyTexture;const e=8;this._emptyTexture=new E(this,{});this._emptyTexture.initFromData(s.U.getDefaultTextureData("empty",e),e,e);return this._emptyTexture}getErrorTexture(){const e=256;this._errorTexture=new E(this,{});this._errorTexture.initFromData(s.U.getDefaultTextureData("stripes",e,{r:1,g:0,b:0}),e,e);return this._errorTexture}getDefaultTexture(){if(this._defaultTexture)return this._defaultTexture;const e=256;this._defaultTexture=new E(this,{});this._defaultTexture.initFromData(s.U.getDefaultTextureData("stripes",e),e,e);return this._defaultTexture}screenShot(t,e,i,n){if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,n)}}}var R=i(273);class N{#canvas=null;#cgp=null;#ctx=null;constructor(e){this.#cgp=e;this.#canvas=document.createElement("canvas");this.#canvas.id="webgpucanvasOut";this.#canvas.style.width=128+"px";this.#canvas.style.height=128+"px"}get canvas(){return this.#canvas}render(e){const t=this.#cgp.canvas;if(this.#canvas.width!=t.width||this.#canvas.height!=t.height){this.#canvas.style.width=t.width+"px";this.#canvas.style.height=t.height+"px";this.#canvas.width=t.width;this.#canvas.height=t.height}if(!this.#ctx){this.#ctx=this.#canvas.getContext("webgpu");if(!this.#ctx)return console.log("no context",this.#canvas,this.#ctx);this.#ctx.configure({device:this.#cgp.device,format:this.#cgp.presentationFormat})}this.#cgp.renderPassDescriptor={label:"preview renderpass",colorAttachments:[{view:this.#ctx.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.#cgp.canvasInfo.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}};this.#cgp.passEncoder=this.#cgp.commandEncoder.beginRenderPass(this.#cgp.renderPassDescriptor);this.#cgp.textureView=this.#ctx.getCurrentTexture().createView();this.#cgp.renderStart();e();this.#cgp.tempPrevCanvas=this.#canvas;this.#cgp.renderEnd();this.#cgp.passEncoder.end()}}class M extends m{cgpbuffer=null;bindingType="read-only-storage";constructor(e,t,i){super(e,t,i);this.cgpbuffer=i.cgpBuffer||new _(e,"temp",[0,0,0,0])}copy(){const e=new M(this.cgp,this.name,this.options);return e}getResource(e){return{buffer:this.cgpbuffer.gpuBuffer}}getLayoutEntry(e=null){let t="read-only-storage";if(this.stage&GPUShaderStage.COMPUTE)if(this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_SRC)&&this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_DST))t="storage";return{visibility:this.stage,binding:this.bindNum,buffer:{type:t}}}getShaderHeaderCode(e,t){this.cgp.profileData.count("shadercode storage",this.name);let i="";let n="read";if(this.stage&GPUShaderStage.COMPUTE)if(this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_SRC)&&this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_DST))n="read_write";else if(this.cgpbuffer.hasUsage(GPUBufferUsage.COPY_DST))n="write";i+="@group("+t+") ";i+="@binding("+this.bindNum+") ";i+="var<storage,"+n+"> ";let r="array<f32>";i+=this.name+": "+r+";\n";return i+"\n"}}class P extends x{#isValid=true;presentationFormat=null;#pipeCfg=null;#computePipeline=null;bindGroupLayout=null;#computePassEncoder;#shaderListeners=[];#old={};#errorCount=0;lastRebuildReason="first";rebuildCount=0;profile=false;#rebuildNumBindingGroups=false;constructor(e,t){super(e,t,x.TYPE_COMPUTE)}setPipeline(e,t=null){if(!e){this.log.log("pipeline unknown shader");return}let i="";if(!this.#pipeCfg)i="no pipecfg";if(this.#old.mesh!=t)i="no mesh";if(this.#old.shader!=e){i="shader changed"}if(e.needsPipelineUpdate){i="shader needs update: "+e.needsPipelineUpdate;e.needsPipelineUpdate=""}if(this.#rebuildNumBindingGroups){i="num bindgroups wrong..."}this.pushDebug();if(i!=""){this.cgp.profileData.count("pipeline created",this.name);this.lastRebuildReason=i;this.rebuildCount++;this.cgp.pushErrorScope("createPipeline",{logger:this.log});this.#rebuildNumBindingGroups=false;this.#pipeCfg=this.getPipelineObject(e);console.log(this.#pipeCfg);this.#old.device=this.cgp.device;this.#old.shader=e;this.#old.mesh=t;this.#isValid=true;console.log(this.#pipeCfg);try{this.#computePipeline=this.cgp.device.createComputePipeline(this.#pipeCfg)}catch(e){console.error("pipe error catch...",e.message,this.#pipeCfg);this.#isValid=false}this.cgp.popErrorScope(()=>{console.log("this.#pipeCfg",this.#pipeCfg)})}if(this.cgp.branchProfiler)this.cgp.branchProfiler.pop()}getPipelineObject(e){this.bindingGroupLayoutEntries=[];this.bindingGroupLayoutEntries=e.defaultBindGroup.getLayoutEntries(e);const t=[e.defaultBindGroup.getLayout(e)];const i=this.cgp.device.createPipelineLayout({label:"pipe layout "+this.name,bindGroupLayouts:t});let n={label:this.name,layout:i,compute:{module:e.gpuShaderModule,entryPoint:e.options.entryPoint||"main"}};console.log("pipecft",n,t);return n}compute(e,t=[8,8]){if(!e.gpuShaderModule)e.compile();const i=this.cgp.device.createCommandEncoder();this.#computePassEncoder=i.beginComputePass({label:"computepass "+e.getName()});this.setPipeline(e);if(!this.#computePipeline){this.log.warn("no render pipe");return}this.#computePassEncoder.setPipeline(this.#computePipeline);e.bind(this.#computePassEncoder);if(t.length==1)this.#computePassEncoder.dispatchWorkgroups(t[0]||8);else if(t.length==2)this.#computePassEncoder.dispatchWorkgroups(t[0]||8,t[1]||8);else if(t.length==3)this.#computePassEncoder.dispatchWorkgroups(t[0]||8,t[1]||8,t[2]||8);else console.log("workgroups length wrong,,,");this.#computePassEncoder.end();this.cgp.profileData.count("compute pipe",this.name);const n=i.finish();this.cgp.device.queue.submit([n]);this.pushDebug()}dispose(){}}class w{onBind=null;constructor(e,t,i){this._cgl=e;this._name=t;this._origShaders={};this._uniforms=[];this._structUniforms=[];this._definesToggled={};this._defines={};this._mods=[];this._textures=[];this._boundShader=null;this._changedDefines=true;this._changedUniforms=true;this._modulesChanged=false;this.needsTexturePush=false;this._lastShader=null;this._attributes=[];if(i&&i.opId)this.opId=i.opId}bind(e,t=true){const i=e||this._cgl.getShader();if(!i)return;this._boundShader=this._origShaders[i.id];let n=false;if(this._boundShader&&this._lastShader!=this._boundShader.shader){if(!this._boundShader.shader.hasModule(this._mods[0].id))n=true}if(n)console.warn("copy because  (missingMod)");if(!this._boundShader)console.warn("copy because  (!this._boundShader)");else if(i.lastCompile!=this._boundShader.lastCompile)console.warn("copy because  shader.lastCompile");if(this._modulesChanged)console.warn("copy because  this._modulesChanged");if(i._needsRecompile)console.warn("copy because  shader._needsRecompile ",i._compileReason);if(n||!this._boundShader||i.lastCompile!=this._boundShader.lastCompile||this._modulesChanged||i._needsRecompile){if(this._boundShader)this._boundShader.shader.dispose();if(i._needsRecompile)i.compile();this.needsTexturePush=true;this._boundShader=this._origShaders[i.id]={lastCompile:i.lastCompile,orig:i,shader:i.copy()};console.log("mod shaderrrrrrrrrrr",i.getName(),this._boundShader.shader.getName());this._addModulesToShader(this._boundShader.shader);this._updateDefinesShader(this._boundShader.shader);this._updateUniformsShader(this._boundShader.shader)}this._boundShader.wireframe=i.wireframe;if(this._changedDefines)this._updateDefines();if(this._changedUniforms)this._updateUniforms();if(t){this._cgl.pushShader(this._boundShader.shader)}if(this.needsTexturePush){for(let e=0;e<this._textures.length;e++){const r=this._textures[e][0];const s=this._textures[e][1];const a=this._textures[e][2];if(this._getUniform(r)){const o=this.getPrefixedName(r);const l=this._boundShader.shader.getUniform(o);if(l)this._boundShader.shader.pushTexture(l,s,a)}}this.needsTexturePush=false;this._textures.length=0}this._modulesChanged=false;this._boundShader.shader.fromMod=this;if(this.onBind)this.onBind(this._boundShader.shader);return this._boundShader.shader}unbind(e=true){if(this._boundShader)if(e)this._cgl.popShader();this._boundShader=null}_addModulesToShader(t){let i;if(this._mods.length>1)i=this._mods[0];for(let e=0;e<this._mods.length;e++)t.addModule(this._mods[e],i)}_removeModulesFromShader(e){for(const t in this._origShaders)this._origShaders[t].shader.removeModule(e)}addModule(e){this._mods.push(e);this._modulesChanged=true}removeModule(t){const i=[];let n=false;for(let e=0;e<this._mods.length;e++){if(this._mods[e].title==t){n=true;this._removeModulesFromShader(this._mods[e]);i.push(e)}}for(let e=i.length-1;e>=0;e-=1)this._mods.splice(i[e],1);this._modulesChanged=true}_updateUniformsShader(t){for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e];const n=this.getPrefixedName(i.name);if(!t.hasUniform(n)){console.log("shadermod uni ",n,t.id,i.stage);const r=new u(t,i.type,n,i.v1,i.v2,i.v3,i.v4);console.log(i);t.addUniform(r,i.stage)}}}_updateUniforms(){for(const e in this._origShaders)this._updateUniformsShader(this._origShaders[e].shader);this._changedUniforms=false}_setUniformValue(e,t,i){const n=e.getUniform(t);if(n)n.setValue(i)}setUniformValue(e,t){const i=this._getUniform(e);if(!i)return;const n=this.getPrefixedName(e);for(const r in this._origShaders){this._setUniformValue(this._origShaders[r].shader,n,t)}}hasUniform(e){return!!this._getUniform(e)}_getUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].name==t)return this._uniforms[e]}return null}addUniform(e,t,i,n,r,s,a){if(!this._getUniform(i)){this._uniforms.push({name:i,stage:e,type:t,v1:n,v2:r,v3:s,v4:a});this._changedUniforms=true}}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t)}pushTexture(e,t,i){if(!t)throw new Error("no texture given to texturestack");this._textures.push([e,t,i]);this.needsTexturePush=true}_removeUniformFromShader(e,t){if(t.hasUniform(e))t.removeUniform(e)}removeUniform(t){if(this._getUniform(t)){for(let e=this._uniforms.length-1;e>=0;e-=1){const i=t;if(this._uniforms[e].name==t){for(const n in this._origShaders){this._removeUniformFromShader(this.getPrefixedName(i),this._origShaders[n].shader)}this._uniforms.splice(e,1)}}this._changedUniforms=true}}getPrefixedName(e){const t=this._mods[0].group;if(t===undefined){return}if(e.startsWith("MOD_")){e=e.substr("MOD_".length);e="mod"+t+"_"+e}return e}_updateDefinesShader(t){for(const e in this._defines){const i=this.getPrefixedName(e);if(this._defines[e]!==null&&this._defines[e]!==undefined)t.define(i,this._defines[e]);else t.removeDefine(i)}for(const e in this._definesToggled){const i=this.getPrefixedName(e);t.toggleDefine(i,this._definesToggled[e])}}_updateDefines(){for(const e in this._origShaders)this._updateDefinesShader(this._origShaders[e].shader);this._changedDefines=false}define(e,t){if(t===undefined)t=true;this._defines[e]=t;this._changedDefines=true}removeDefine(e){this._defines[e]=null;this._changedDefines=true}hasDefine(e){if(this._defines[e]!==null&&this._defines[e]!==undefined)return true;return false}toggleDefine(e,t){this._changedDefines=true;this._definesToggled[e]=t}currentShader(){if(!this._boundShader)return null;return this._boundShader.shader}dispose(){}}const L={Context:C,Shader:T,Mesh:S,Texture:E,Uniform:u,MESHES:R.S,GPUBuffer:_};window.CABLES=window.CABLES||{};window.CABLES.CGP=window.CABLES.CGP||L;window.CGP=window.CGP||L;window.CGP.WebGpuCanvasAttachment=N;window.CGP.RenderPipeline=O;window.CGP.ComputePipeline=P;window.CGP.ShaderModifier=w;window.CGP.BindingStorage=M;window.CGP.BindingUniform=b;window.CGP.BindingTexture=A;window.CGP.BindingSampler=v},564:(e,t,i)=>{"use strict";var a=i(440);class n{constructor(){this.toneJsInitialized=false}createAudioContext(e){window.AudioContext=window.AudioContext||window.webkitAudioContext;if(window.AudioContext){if(!window.audioContext){window.audioContext=new AudioContext}if(window.Tone&&!this.toneJsInitialized){if(Tone.setContext)Tone.setContext(window.audioContext,true);this.toneJsInitialized=true}}else{if(e.patch.config.onError)e.logError("NO_WEBAUDIO","Web Audio is not supported in this browser.");return}return window.audioContext}_getAudioContext(){return window.audioContext}createAudioInPort(i,e,t,n){if(!i||!e||!t){const s="ERROR: createAudioInPort needs three parameters, op, portName and audioNode";i.log(s);throw new Error(s)}if(!n){n=0}i.webAudio=i.webAudio||{};i.webAudio.audioInPorts=i.webAudio.audioInPorts||[];const r=i.inObject(e);r.webAudio={};r.webAudio.previousAudioInNode=null;r.webAudio.audioNode=t;i.webAudio.audioInPorts[e]=r;r.onChange=function(){const t=r.get();if(!t){if(r.webAudio.previousAudioInNode){try{if(r.webAudio.previousAudioInNode.disconnect)r.webAudio.previousAudioInNode.disconnect(r.webAudio.audioNode,0,n);i.setUiError("audioCtx",null)}catch(t){try{r.webAudio.previousAudioInNode.disconnect(r.webAudio.audioNode)}catch(e){i.log("Disconnecting audio node with in/out port index, as well as without in/out-port-index did not work ",t);if(t.printStackTrace){t.printStackTrace()}throw t}}}}else{try{if(t.connect){t.connect(r.webAudio.audioNode,0,n);i.setUiError("audioCtx",null)}else i.setUiError("audioCtx","The passed input is not an audio context. Please make sure you connect an audio context to the input.",2)}catch(e){i.log("Error: Failed to connect web audio node!",e);i.log("port.webAudio.audioNode",r.webAudio.audioNode);i.log("audioInNode: ",t);i.log("inputChannelIndex:",n);i.log("audioInNode.connect: ",t.connect);throw e}}r.webAudio.previousAudioInNode=t};return r}createAudioOutPort(e,t,i){if(!e||!t||!i){const r="ERROR: createAudioOutPort needs three parameters, op, portName and audioNode";e.log(r);throw new Error(r)}const n=e.outObject(t);n.set(i);return n}createAudioParamInPort(n,e,t,i,r){if(!n||!e||!t){n.log("ERROR: createAudioParamInPort needs three parameters, op, portName and audioNode");if(n&&n.name)n.log("opname: ",n.name);n.log("portName",e);n.log("audioNode: ",t);return}n.webAudio=n.webAudio||{};n.webAudio.audioInPorts=n.webAudio.audioInPorts||[];const s=n.inDynamic(e,[a.a.OP.OP_PORT_TYPE_VALUE,a.a.OP.OP_PORT_TYPE_OBJECT],i,r);s.webAudio={};s.webAudio.previousAudioInNode=null;s.webAudio.audioNode=t;n.webAudio.audioInPorts[e]=s;s.onChange=()=>{const e=s.get();const t=s.webAudio.audioNode;const i=this._getAudioContext();if(e!=undefined){if(typeof e==="object"&&e.connect){try{e.connect(t)}catch(e){n.log("Could not connect audio node: ",e);if(e.printStackTrace){e.printStackTrace()}throw e}s.webAudio.previousAudioInNode=e}else{if(t._param&&t._param.minValue&&t._param.maxValue){if(e>=t._param.minValue&&e<=t._param.maxValue){try{if(t.setValueAtTime){t.setValueAtTime(e,i.currentTime)}else{t.value=e}}catch(e){n.log("Possible AudioParam problem with tone.js op: ",e);if(e.printStackTrace){e.printStackTrace()}throw e}}else{n.log("Warning: The value for an audio parameter is out of range!")}}else if(t.minValue&&t.maxValue){if(e>=t.minValue&&e<=t.maxValue){try{if(t.setValueAtTime){t.setValueAtTime(e,i.currentTime)}else{t.value=e}}catch(e){n.log("AudioParam has minValue / maxValue defined, and value is in range, but setting the value failed! ",e);if(e.printStackTrace){e.printStackTrace()}throw e}}else{n.log("Warning: The value for an audio parameter is out of range!")}}else{try{if(t.setValueAtTime){t.setValueAtTime(e,i.currentTime)}else{t.value=e}}catch(e){n.log("Possible AudioParam problem (without minValue / maxValue): ",e);if(e.printStackTrace){e.printStackTrace()}throw e}}if(s.webAudio.previousAudioInNode&&s.webAudio.previousAudioInNode.disconnect){try{s.webAudio.previousAudioInNode.disconnect(t)}catch(e){n.log("Could not disconnect previous audio node: ",e);throw e}s.webAudio.previousAudioInNode=undefined}}}else{if(s.webAudio.previousAudioInNode){}}};return s}loadAudioFile(e,t,i,n,r){const s=this.createAudioContext();if(!s)n(new Error("No Audiocontext"));let a=null;if(r||r===undefined){a=e.loading.start("audio",t);if(e.isEditorMode())gui.jobs().start({id:"loadaudio"+a,title:" loading audio ("+t+")"})}const o=new XMLHttpRequest;if(!t)return;o.open("GET",t,true);o.responseType="arraybuffer";o.onload=function(){e.loading.finished(a);if(e.isEditorMode())gui.jobs().finish("loadaudio"+a);s.decodeAudioData(o.response,i,n).catch(e=>{n(e)})};o.send()}isValidToneTime(e){try{const t=new Tone.Time(e)}catch(e){return false}return true}isValidToneNote(e){try{Tone.Frequency(e)}catch(e){return false}return true}}const r=new n;window.CABLES=window.CABLES||{};window.CABLES.WEBAUDIO=r},125:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});class s{constructor(e,t,i,n){this.targetObj=e;this.id=t;this.eventName=i;this.cb=n}remove(){this.targetObj.off(this.id)}}class n{constructor(){this._simpleIdCounter=0}uuid(){let i=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e==="x"?t:t&3|8).toString(16)})}isNumeric(e){const t=parseFloat(e);return!isNaN(t)&&isFinite(t)}simpleId(){this._simpleIdCounter++;return this._simpleIdCounter}pathLookup(e,t){const i=t.split(".");if(i.length==1){return e[i[0]]}return this.pathLookup(e[i[0]],i.slice(1).join("."))}}const a=new n;var r=i(849);class o{#eventLog=new r.A("eventtarget");#listeners={};#logEvents=false;#logName="";#eventCallbacks={};#countErrorUnknowns=0;eventsPaused=false;constructor(){}on(e,t,i=""){const n=(i||"")+a.simpleId();const r=new s(this,n,e,t);if(!this.#eventCallbacks[e])this.#eventCallbacks[e]=[r];else this.#eventCallbacks[e].push(r);this.#listeners[r.id]=r;return r}removeAllEventListeners(){for(const e in this.#listeners){this.off(this.#listeners[e])}}addEventListener(e,t,i=""){return this.on(e,t,i)}hasEventListener(e,t=null){if(e&&!t){if(typeof e=="string")return!!this.#listeners[e];else return!!this.#listeners[e.id]}else{this.#eventLog.warn("old eventtarget function haseventlistener!");if(e&&t){if(this.#eventCallbacks[e]){const i=this.#eventCallbacks[e].indexOf(t);return i!==-1}}}}hasListenerForEventName(e){return this.#eventCallbacks[e]&&this.#eventCallbacks[e].length>0}removeEventListener(e){return this.off(e)}off(e){if(e===null||e===undefined){this.#eventLog.warn("removeEventListener id null",e);return}let i=e;if(e.eventName)i=e.id;if(typeof i!="string"){console.log("old function signature: removeEventListener! use listener id");return}const n=this.#listeners[i];if(!n){if(this.#countErrorUnknowns==20)this.#eventLog.warn("stopped reporting unknown events");if(this.#countErrorUnknowns<20)this.#eventLog.warn("could not find event...",i,n);this.#countErrorUnknowns++;return}let r=0;let s=true;while(s){s=false;let t=-1;for(let e=0;e<this.#eventCallbacks[n.eventName].length;e++){if(this.#eventCallbacks[n.eventName][e].id.indexOf(i)===0){s=true;t=e}}if(t!==-1){this.#eventCallbacks[n.eventName].splice(t,1);delete this.#listeners[i];r++}}if(r==0)console.log("no events removed",n.eventName,i);return}logEvents(e,t){this.#logEvents=e;this.#logName=t}emitEvent(t,i=null,n=null,r=null,s=null,a=null,o=null,l=null,u=null){if(this.eventsPaused)return;if(this.#logEvents)this.#eventLog.log("[event] ",this.#logName,t,this.#eventCallbacks);if(this.#eventCallbacks[t]){for(let e=0;e<this.#eventCallbacks[t].length;e++){if(this.#eventCallbacks[t][e]){this.#eventCallbacks[t][e].cb(i,n,r,s,a,o,l,u)}}}else{if(this.#logEvents)this.#eventLog.log("[event] has no event callback",t,this.#eventCallbacks)}}}},849:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});class n{constructor(e,t){this.initiator=e;this._options=t;if(!this.initiator){console.error("no log initator given");CABLES.logStack()}}stack(e){console.info("["+this.initiator+"] ",e);console.log((new Error).stack)}groupCollapsed(e){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments);console.groupCollapsed("["+this.initiator+"] "+e)}table(e){console.table(e)}groupEnd(){console.groupEnd()}error(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)||!CABLES.UI){console.error("["+this.initiator+"]",...arguments)}if(this._options&&this._options.onError){this._options.onError(this.initiator,...arguments)}}errorGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)}warn(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:1},...arguments)||!CABLES.logSilent)console.warn("["+this.initiator+"]",...arguments)}verbose(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}info(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.info("["+this.initiator+"]",...arguments)}log(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}logGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)}userInteraction(e){}}}};var r={};function s(e){var t=r[e];if(t!==undefined){return t.exports}var i=r[e]={exports:{}};n[e](i,i.exports,s);return i.exports}(()=>{s.d=(e,t)=>{for(var i in t){if(s.o(t,i)&&!s.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{s.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();s(748);s(772);s(626);s(564);var e=s(606);var t=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var i in e)t[i]=e[i];if(e.__esModule)Object.defineProperty(t,"__esModule",{value:true})})();var CABLES=CABLES||{};CABLES.build={timestamp:1762939324787,created:"2025-11-12T09:22:04.787Z",git:{branch:"master",commit:"e3510a22f6f8dccb8f89330c372f5c0de285d823",date:"1762939264",message:"dev"}};if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["GgjVeu"]={_id:"6737d25bb91f6fc8379ea12e",ops:[{id:"c4nbn4unw",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"Coordinates index",value:0},{name:"Coordinates",value:"-1 to 1"},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"flip y",value:1},{name:"right click prevent default",value:0},{name:"Touch support",value:0},{name:"Passive Events",value:0},{name:"Active",value:1}],portsOut:[{name:"x",links:[{portIn:"value",portOut:"x",objIn:"7b39eacc-6305-4549-9220-f95f570c738d",objOut:"c4nbn4unw"}]},{name:"y",links:[{portIn:"value",portOut:"y",objIn:"7ripfb4hq",objOut:"c4nbn4unw"}]},{name:"Button is down",value:0},{name:"Mouse is hovering",value:0},{name:"Movement X",value:-55},{name:"Movement Y",value:55}],objName:"Ops.Devices.Mouse.Mouse_v3"},{id:"7b39eacc-6305-4549-9220-f95f570c738d",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"old min",value:-1},{name:"old max",value:1},{name:"new min",value:0},{name:"new max",value:20},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"658cc009-6a0c-43ac-a52b-8dd5cdc024a1",objOut:"7b39eacc-6305-4549-9220-f95f570c738d"}]}],objName:"Ops.Math.MapRange"},{id:"7ripfb4hq",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"old min",value:-1},{name:"old max",value:1},{name:"new min",value:0},{name:"new max",value:20},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"a53ce4a5-fe8a-4e4a-ae88-bb7bd84648d9",objOut:"7ripfb4hq"}]}],objName:"Ops.Math.MapRange"},{id:"658cc009-6a0c-43ac-a52b-8dd5cdc024a1",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"number2",value:20.22}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"sead3j9rf",objOut:"658cc009-6a0c-43ac-a52b-8dd5cdc024a1"}]}],objName:"Ops.Math.Sum"},{id:"a53ce4a5-fe8a-4e4a-ae88-bb7bd84648d9",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"number2",value:-22.06}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"xd1ax0y1d",objOut:"a53ce4a5-fe8a-4e4a-ae88-bb7bd84648d9"}]}],objName:"Ops.Math.Sum"},{id:"g135m25tl",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",value:100,title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Result",value:0}],objName:"Ops.Anim.Smooth"},{id:"dk000ttew",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",value:100,title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Result",value:0}],objName:"Ops.Anim.Smooth"},{id:"d7520180-d502-4253-b524-862489fa03ae",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsOut:[{name:"Changed",links:[{portIn:"Trigger",portOut:"Changed",objIn:"e451ab65-a112-47be-b831-d3048cf11326",objOut:"d7520180-d502-4253-b524-862489fa03ae"}]}],objName:"Ops.Trigger.TriggerOnChangeString"},{id:"7ec3bd86-a299-42e3-beae-59256abd844f",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"min",value:-10},{name:"max",value:10},{name:"Integer",value:0},{name:"No consecutive duplicates",value:1}],portsOut:[{name:"result",links:[{portIn:"number2",portOut:"result",objIn:"sead3j9rf",objOut:"7ec3bd86-a299-42e3-beae-59256abd844f"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"e451ab65-a112-47be-b831-d3048cf11326",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsOut:[{name:"Next",links:[{portIn:"Generate",portOut:"Next",objIn:"7ec3bd86-a299-42e3-beae-59256abd844f",objOut:"e451ab65-a112-47be-b831-d3048cf11326"},{portIn:"Generate",portOut:"Next",objIn:"6c2tkdtx2",objOut:"e451ab65-a112-47be-b831-d3048cf11326"},{portIn:"Generate",portOut:"Next",objIn:"wf8or6sx5",objOut:"e451ab65-a112-47be-b831-d3048cf11326"}]}],objName:"Ops.Trigger.TriggerButton"},{id:"sead3j9rf",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"g135m25tl",objOut:"sead3j9rf"}]}],objName:"Ops.Math.Sum"},{id:"6c2tkdtx2",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"min",value:-10},{name:"max",value:10},{name:"Integer",value:0},{name:"No consecutive duplicates",value:1}],portsOut:[{name:"result",links:[{portIn:"number2",portOut:"result",objIn:"xd1ax0y1d",objOut:"6c2tkdtx2"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"xd1ax0y1d",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"dk000ttew",objOut:"xd1ax0y1d"}]}],objName:"Ops.Math.Sum"},{id:"wf8or6sx5",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"min",value:-10},{name:"max",value:10},{name:"Integer",value:0},{name:"No consecutive duplicates",value:1}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"2nwqj122c",objOut:"wf8or6sx5"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"vwgc5nyev",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",value:100,title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Result",value:0}],objName:"Ops.Anim.Smooth"},{id:"2nwqj122c",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"number2",value:-51.27}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"vwgc5nyev",objOut:"2nwqj122c"}]}],objName:"Ops.Math.Sum"},{id:"otdiewxu8",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"Variable",value:"imageUrl"}],portsOut:[{name:"Value",links:[{portIn:"String",portOut:"Value",objIn:"d7520180-d502-4253-b524-862489fa03ae",objOut:"otdiewxu8"}]}],objName:"Ops.Vars.VarGetString"},{id:"1912e32f-b447-4384-adf0-44cc04b0dec7",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsOut:[{name:"create port",value:0}],objName:"Ops.Ui.PatchInput"},{id:"38674664-f35b-40fc-9232-f3343d361ea9",uiAttribs:{subPatch:"d9d56413-14d4-4bc4-aa2c-67e1f8fe2dbf"},portsIn:[{name:"create port",value:0}],objName:"Ops.Ui.PatchOutput"},{id:"3e9jbf60v",uiAttribs:{},portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.TransformView trigger",portOut:"trigger",objIn:"hmrwm30er",objOut:"3e9jbf60v"}]}],objName:"Ops.Graphics.TransformView"},{id:"pymi5dwfn",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"workScroll"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"idb5vni1j",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"aboutScroll"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"h36xf2f52",uiAttribs:{},portsIn:[{name:"Value",value:"index"},{name:"Variable",value:"pageContext"}],objName:"Ops.Vars.VarSetString_v2"},{id:"cfmh16c3b",uiAttribs:{},portsIn:[{name:"Play Timeline",value:0}],portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"99nt7axny",objOut:"cfmh16c3b"},{portIn:"Execute",portOut:"Next",objIn:"o6iq01n0j",objOut:"cfmh16c3b"}]},{name:"Finished Initial Loading",value:1},{name:"Loading",value:0},{name:"Progress",links:[{portIn:"Value",portOut:"Progress",objIn:"cb0k3nn3a",objOut:"cfmh16c3b"}]},{name:"Trigger Loading Finished ",links:[{portIn:"Trigger",portOut:"Trigger Loading Finished ",objIn:"fy34a0ima",objOut:"cfmh16c3b"}]}],objName:"Ops.Cables.LoadingStatus_v2"},{id:"yycpxv7b2",uiAttribs:{},portsIn:[{name:"Variable",value:"pageContext"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"o6iq01n0j",objOut:"yycpxv7b2"}]}],objName:"Ops.Vars.VarGetString"},{id:"5cuc5vqu0",uiAttribs:{},portsIn:[{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"a",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"fvntb6ykt",objOut:"5cuc5vqu0"}]}],objName:"Ops.Gl.ClearColor"},{id:"7e4ey2fi4",uiAttribs:{},portsIn:[{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"a",value:0}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Trigger.RouteTriggerString_v2 Trigger 1",portOut:"trigger",objIn:"c3020432-d72e-41bb-8274-dbd55ba98235",objOut:"7e4ey2fi4"}]}],objName:"Ops.Gl.ClearColor"},{id:"dwq5osdkj",uiAttribs:{},portsIn:[{name:"Variable",value:"nContext"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"fy34a0ima",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"loaded"}],objName:"Ops.Trigger.TriggerSend"},{id:"cb0k3nn3a",uiAttribs:{},portsIn:[{name:"Variable",value:"loadingStatus"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"99nt7axny",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"mainLoop"}],objName:"Ops.Trigger.TriggerSend"},{id:"703egzgtr",uiAttribs:{},portsIn:[{name:"Value",value:"New String"},{name:"Variable",value:"imageUrl"}],objName:"Ops.Vars.VarSetString_v2"},{id:"whp28n8pi",uiAttribs:{},portsOut:[{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Execute",portOut:"Trigger 0",objIn:"uqyteclc3",objOut:"whp28n8pi"}]},{name:"Trigger 1",links:[{portIn:"Execute",portOut:"Trigger 1",objIn:"val0mhtoj",objOut:"whp28n8pi"}]},{name:"Trigger 2",links:[{portIn:"Execute",portOut:"Trigger 2",objIn:"tjch93q43",objOut:"whp28n8pi"}]},{name:"Highest Index",value:2}],objName:"Ops.Trigger.RouteTrigger"},{id:"rdi6zanod",uiAttribs:{},portsIn:[{name:"Variable",value:"nContext"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"whp28n8pi",objOut:"rdi6zanod"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"jvioe1871",uiAttribs:{},portsIn:[{name:"Value",value:"Media Design"},{name:"Variable",value:"stringTexture"}],objName:"Ops.Vars.VarSetString_v2"},{id:"bw5x42j1o",uiAttribs:{},portsIn:[{name:"Variable",value:"imageTexture"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"hdbfyi4so",uiAttribs:{},portsIn:[{name:"Active",value:0},{name:"Visible",value:0},{name:"Measure GPU",value:0},{name:"Position index",value:1},{name:"Position",value:"bottom"},{name:"Open",value:0},{name:"Smooth Graph",value:0},{name:"Scale",value:3},{name:"Size",value:128}],portsOut:[{name:"childs",links:[{portIn:"exe",portOut:"childs",objIn:"cfmh16c3b",objOut:"hdbfyi4so"}]},{name:"FPS",value:29}],objName:"Ops.Gl.Performance"},{id:"wuo33hidd",uiAttribs:{},portsIn:[{name:"Value",value:"mq3"},{name:"Variable",value:"mediaQuery"}],objName:"Ops.Vars.VarSetString_v2"},{id:"e0embtgzv",uiAttribs:{},portsIn:[{name:"Variable",value:"videoUrl"}],objName:"Ops.Vars.VarSetString_v2"},{id:"h042fj5j0",uiAttribs:{},portsOut:[{name:"has focus",value:1},{name:"Tab Visible",links:[{portIn:"Active",portOut:"Tab Visible",objIn:"pa2y9tgmx",objOut:"h042fj5j0"}]}],objName:"Ops.Html.WindowHasFocus"},{id:"jh3l549w8",uiAttribs:{},portsIn:[{name:"Variable",value:"mediaQuery"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"val0mhtoj",objOut:"jh3l549w8"},{portIn:"Switch Value",portOut:"Value",objIn:"uqyteclc3",objOut:"jh3l549w8"},{portIn:"Switch Value",portOut:"Value",objIn:"tjch93q43",objOut:"jh3l549w8"}]}],objName:"Ops.Vars.VarGetString"},{id:"isiuxw17x",uiAttribs:{},portsIn:[{name:"value",value:"https://vz-2feef9b1-637.b-cdn.net/547fd7bb-8937-44c8-99a7-7ea190462a68/playlist.m3u8"}],portsOut:[{name:"String",links:[{portIn:"Value",portOut:"String",objIn:"e0embtgzv",objOut:"isiuxw17x"}]}],objName:"Ops.String.String_v2"},{id:"gm13f4zcc",uiAttribs:{},portsIn:[{name:"a",value:1}],portsOut:[{name:"outr",value:0},{name:"outg",value:.00392156862745098},{name:"outb",value:1},{name:"outa",value:1},{name:"Hex",value:"0001FF"},{name:"Array",links:[{portIn:"Array In",portOut:"Array",objIn:"t8wj0g1fm",objOut:"gm13f4zcc"}]}],objName:"Ops.Color.ColorValue"},{id:"val0mhtoj",uiAttribs:{},portsIn:[{name:"String 0",value:"mq1"},{name:"String 1",value:"mq2"},{name:"String 2",value:"mq3"},{name:"String 3",value:""},{name:"String 4",value:""},{name:"String 5",value:""},{name:"String 6",value:""},{name:"String 7",value:""},{name:"String 8",value:""},{name:"String 9",value:""},{name:"String 10",value:""},{name:"String 11",value:""},{name:"String 12",value:""},{name:"String 13",value:""},{name:"String 14",value:""},{name:"String 15",value:""},{name:"String 16",value:""},{name:"String 17",value:""},{name:"String 18",value:""},{name:"String 19",value:""},{name:"String 20",value:""},{name:"String 21",value:""},{name:"String 22",value:""},{name:"String 23",value:""}],portsOut:[{name:"Switched Index",value:0},{name:"Trigger 0",links:[{portIn:"9mnoq6ams",portOut:"Trigger 0",objIn:"64opcwacl",objOut:"val0mhtoj"}]},{name:"Trigger 1",links:[{portIn:"9mnoq6ams",portOut:"Trigger 1",objIn:"3sodhmqvs",objOut:"val0mhtoj"}]},{name:"Trigger 2",links:[{portIn:"d7g5c0h5b",portOut:"Trigger 2",objIn:"bop3suw45",objOut:"val0mhtoj"}]}],objName:"Ops.Trigger.RouteTriggerString_v2"},{id:"uqyteclc3",uiAttribs:{},portsIn:[{name:"String 0",value:"mq1"},{name:"String 1",value:"mq2"},{name:"String 2",value:"mq3"},{name:"String 3",value:""},{name:"String 4",value:""},{name:"String 5",value:""},{name:"String 6",value:""},{name:"String 7",value:""},{name:"String 8",value:""},{name:"String 9",value:""},{name:"String 10",value:""},{name:"String 11",value:""},{name:"String 12",value:""},{name:"String 13",value:""},{name:"String 14",value:""},{name:"String 15",value:""},{name:"String 16",value:""},{name:"String 17",value:""},{name:"String 18",value:""},{name:"String 19",value:""},{name:"String 20",value:""},{name:"String 21",value:""},{name:"String 22",value:""},{name:"String 23",value:""}],portsOut:[{name:"Next Trigger",links:[{portIn:"Exe",portOut:"Next Trigger",objIn:"0co9dzwpn",objOut:"uqyteclc3"}]},{name:"Switched Index",links:[{portIn:"Value",portOut:"Switched Index",objIn:"400e715b-2702-4f99-acf3-b545cbb099f7",objOut:"uqyteclc3"}]},{name:"Trigger 0",links:[{portIn:"9mnoq6ams",portOut:"Trigger 0",objIn:"qish0bdl0",objOut:"uqyteclc3"}]},{name:"Trigger 1",links:[{portIn:"9mnoq6ams",portOut:"Trigger 1",objIn:"qish0bdl0",objOut:"uqyteclc3"}]},{name:"Trigger 2",links:[{portIn:"d7g5c0h5b",portOut:"Trigger 2",objIn:"4vye0rgt0",objOut:"uqyteclc3"}]}],objName:"Ops.Trigger.RouteTriggerString_v2"},{id:"o6iq01n0j",uiAttribs:{},portsIn:[{name:"String 0",value:"index"},{name:"String 1",value:"works"},{name:"String 2",value:"404"},{name:"String 3",value:""},{name:"String 4",value:""},{name:"String 5",value:""},{name:"String 6",value:""},{name:"String 7",value:""},{name:"String 8",value:""},{name:"String 9",value:""},{name:"String 10",value:""},{name:"String 11",value:""},{name:"String 12",value:""},{name:"String 13",value:""},{name:"String 14",value:""},{name:"String 15",value:""},{name:"String 16",value:""},{name:"String 17",value:""},{name:"String 18",value:""},{name:"String 19",value:""},{name:"String 20",value:""},{name:"String 21",value:""},{name:"String 22",value:""},{name:"String 23",value:""}],portsOut:[{name:"Switched Index",links:[{portIn:"Value",portOut:"Switched Index",objIn:"dwq5osdkj",objOut:"o6iq01n0j"}]},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"5cuc5vqu0",objOut:"o6iq01n0j"},{portIn:"nm7k58wq0",portOut:"Trigger 0",objIn:"z7y2n2i3i",objOut:"o6iq01n0j"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"7e4ey2fi4",objOut:"o6iq01n0j"}]},{name:"Trigger 2",links:[{portIn:"render",portOut:"Trigger 2",objIn:"o9xs3vhpa",objOut:"o6iq01n0j"}]}],objName:"Ops.Trigger.RouteTriggerString_v2"},{id:"o9o1lvbn5",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"3e9jbf60v",objOut:"o9o1lvbn5"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"3e9jbf60v",objOut:"o9o1lvbn5"}]},{name:"Z",links:[{portIn:"posZ",portOut:"Z",objIn:"3e9jbf60v",objOut:"o9o1lvbn5"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"cqjowcwqt",uiAttribs:{},portsIn:[{name:"index",value:3},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"scale",portOut:"value",objIn:"3e9jbf60v",objOut:"cqjowcwqt"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"e6ylr7btl",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"rotZ",portOut:"result",objIn:"3e9jbf60v",objOut:"e6ylr7btl"}]}],objName:"Ops.Math.Sum"},{id:"ub6p4urcu",uiAttribs:{},portsIn:[{name:"Index",value:4}],portsOut:[{name:"X",links:[{portIn:"number2",portOut:"X",objIn:"zpdk4s7hr",objOut:"ub6p4urcu"}]},{name:"Y",links:[{portIn:"number2",portOut:"Y",objIn:"sd5jtt6y5",objOut:"ub6p4urcu"}]},{name:"Z",links:[{portIn:"number2",portOut:"Z",objIn:"e6ylr7btl",objOut:"ub6p4urcu"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"zpdk4s7hr",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"rotX",portOut:"result",objIn:"3e9jbf60v",objOut:"zpdk4s7hr"}]}],objName:"Ops.Math.Sum"},{id:"sd5jtt6y5",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"rotY",portOut:"result",objIn:"3e9jbf60v",objOut:"sd5jtt6y5"}]}],objName:"Ops.Math.Sum"},{id:"d6dfe00c-a333-4385-a551-7ca5093b463e",uiAttribs:{},portsIn:[{name:"file",display:"file"},{name:"family",value:"everettLight"},{name:"Active",value:1}],portsOut:[{name:"Loaded",value:1}],objName:"Ops.Html.FontFile_v2"},{id:"fe53c691-9587-4d39-9499-356538b54e80",uiAttribs:{},portsIn:[{name:"file",display:"file"},{name:"family",value:"everettBold"},{name:"Active",value:1}],portsOut:[{name:"Loaded",value:1}],objName:"Ops.Html.FontFile_v2"},{id:"56ab535f-13e7-4255-a15c-46783459d78f",uiAttribs:{},portsIn:[{name:"value",value:"https://uploads-ssl.webflow.com/630ca11296e48c2b70f1013e/652bc291b62af154c444c7f5_TWKEverett-Bold.otf"}],portsOut:[{name:"String",links:[{portIn:"file",portOut:"String",objIn:"fe53c691-9587-4d39-9499-356538b54e80",objOut:"56ab535f-13e7-4255-a15c-46783459d78f"}]}],objName:"Ops.String.String_v2"},{id:"j64yb3d3e",uiAttribs:{},portsIn:[{name:"value",value:"https://uploads-ssl.webflow.com/630ca11296e48c2b70f1013e/652bc29129f6f7d9d2e6a5e7_TWKEverett-Light.otf"}],portsOut:[{name:"String",links:[{portIn:"file",portOut:"String",objIn:"d6dfe00c-a333-4385-a551-7ca5093b463e",objOut:"j64yb3d3e"}]}],objName:"Ops.String.String_v2"},{id:"ck7se7ko6",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"File",display:"file"},{name:"Filter index",value:2},{name:"Filter",value:"mipmap"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Data Format index",value:2},{name:"Data Format",value:"RGB"},{name:"Flip",value:0},{name:"Pre Multiplied Alpha",value:0},{name:"Save Memory",value:1},{name:"Add Cachebuster",value:0}],portsOut:[{name:"Texture",links:[{portIn:"texture1",portOut:"Texture",objIn:"wm3l5lbrt",objOut:"ck7se7ko6"}]},{name:"Width",value:8},{name:"Height",value:8},{name:"Aspect Ratio",links:[{portIn:"Value 1",portOut:"Aspect Ratio",objIn:"728bc2af-66ca-4c6f-a6d4-2b51f809033d",objOut:"ck7se7ko6"}]},{name:"Loaded",value:1},{name:"Loading",value:0}],objName:"Ops.Gl.Texture_v2"},{id:"1vm54l2e2",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"imageUrl"}],portsOut:[{name:"Value",links:[{portIn:"File",portOut:"Value",objIn:"ck7se7ko6",objOut:"1vm54l2e2"}]}],objName:"Ops.Vars.VarGetString"},{id:"wm3l5lbrt",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Default Texture Transparent",value:1}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"b0hk8u9bi",objOut:"wm3l5lbrt"}]},{name:"texture",links:[{portIn:"textureInput",portOut:"texture",objIn:"v38pi7nzw",objOut:"wm3l5lbrt"},{portIn:"textureInput",portOut:"texture",objIn:"r3u33h3hs",objOut:"wm3l5lbrt"}]}],objName:"Ops.Gl.Textures.SwitchTextures_v2"},{id:"3czynyjwm",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"result",links:[{portIn:"num",portOut:"result",objIn:"wm3l5lbrt",objOut:"3czynyjwm"}]}],objName:"Ops.Number.Number"},{id:"b4tefn2a1",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"o2rjjfyi8",objOut:"b4tefn2a1"}]}],objName:"Ops.Number.Number"},{id:"9sekcc5gw",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Coordinates index",value:0},{name:"Coordinates",value:"-1 to 1"},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"flip y",value:1},{name:"right click prevent default",value:1},{name:"Touch support",value:1},{name:"Passive Events",value:0}],portsOut:[{name:"x",value:-.9614147909967845},{name:"y",value:-.9049235993208828},{name:"click",links:[{portIn:"Execute",portOut:"click",objIn:"3j7vi0s9v",objOut:"9sekcc5gw"}]},{name:"Button is down",value:0},{name:"Mouse is hovering",value:0},{name:"Movement X",value:-55},{name:"Movement Y",value:55}],objName:"Ops.Devices.Mouse.Mouse_v3"},{id:"wo3yxin4e",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Default",value:0}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"b4tefn2a1",objOut:"wo3yxin4e"}]}],objName:"Ops.Boolean.ToggleBool_v2"},{id:"3j7vi0s9v",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Pass Through",value:1}],portsOut:[{name:"Trigger out",links:[{portIn:"trigger",portOut:"Trigger out",objIn:"wo3yxin4e",objOut:"3j7vi0s9v"}]}],objName:"Ops.Trigger.GateTrigger"},{id:"7b956q2sq",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"SearchValue",value:".png"}],portsOut:[{name:"Found",links:[{portIn:"bool 1",portOut:"Found",objIn:"dvlao3w4r",objOut:"7b956q2sq"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"dvlao3w4r",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"bool 4",value:0},{name:"bool 5",value:0},{name:"bool 6",value:0},{name:"bool 7",value:0},{name:"bool 8",value:0},{name:"bool 9",value:0},{name:"bool 10",value:0}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"3czynyjwm",objOut:"dvlao3w4r"},{portIn:"Value",portOut:"result",objIn:"jg54smpee",objOut:"dvlao3w4r"},{portIn:"Active",portOut:"result",objIn:"ck7se7ko6",objOut:"dvlao3w4r"}]}],objName:"Ops.Boolean.Or"},{id:"wer07k5pg",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"imageUrl"}],portsOut:[{name:"Value",links:[{portIn:"String",portOut:"Value",objIn:"7b956q2sq",objOut:"wer07k5pg"},{portIn:"String",portOut:"Value",objIn:"oqal79lge",objOut:"wer07k5pg"},{portIn:"String",portOut:"Value",objIn:"s00nrdmzx",objOut:"wer07k5pg"}]}],objName:"Ops.Vars.VarGetString"},{id:"oqal79lge",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"SearchValue",value:".jpg"}],portsOut:[{name:"Found",links:[{portIn:"bool 2",portOut:"Found",objIn:"dvlao3w4r",objOut:"oqal79lge"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"s00nrdmzx",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"SearchValue",value:".jpeg"}],portsOut:[{name:"Found",links:[{portIn:"bool 3",portOut:"Found",objIn:"dvlao3w4r",objOut:"s00nrdmzx"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"jg54smpee",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"isImage"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"zl9l016gb",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"in bool",portOut:"Value",objIn:"xwiak10cy",objOut:"zl9l016gb"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"xwiak10cy",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"out bool",links:[{portIn:"Active",portOut:"out bool",objIn:"9sekcc5gw",objOut:"xwiak10cy"}]}],objName:"Ops.Extension.Deprecated.ToggleBoolValue"},{id:"8o9m36la4",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoUrl"}],portsOut:[{name:"Value",links:[{portIn:"String",portOut:"Value",objIn:"r4kfaaige",objOut:"8o9m36la4"},{portIn:"file",portOut:"Value",objIn:"eyn33vy5z",objOut:"8o9m36la4"}]}],objName:"Ops.Vars.VarGetString"},{id:"r4kfaaige",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"Changed",links:[{portIn:"exe",portOut:"Changed",objIn:"8tjrih3pf",objOut:"r4kfaaige"}]}],objName:"Ops.Trigger.TriggerOnChangeString"},{id:"ldn5adez0",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"oaq4sw0ce",objOut:"ldn5adez0"},{portIn:"Value",portOut:"Value",objIn:"55vyxi8a2",objOut:"ldn5adez0"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"oaq4sw0ce",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"Next",links:[{portIn:"trigger",portOut:"Next",objIn:"wo3yxin4e",objOut:"oaq4sw0ce"}]}],objName:"Ops.Boolean.TriggerChangedFalse"},{id:"55vyxi8a2",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"Next",links:[{portIn:"reset",portOut:"Next",objIn:"wo3yxin4e",objOut:"55vyxi8a2"}]}],objName:"Ops.Boolean.TriggerChangedTrue"},{id:"8tjrih3pf",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"delay",value:.1}],portsOut:[{name:"next",links:[{portIn:"Rewind",portOut:"next",objIn:"eyn33vy5z",objOut:"8tjrih3pf"}]},{name:"Delaying",value:false}],objName:"Ops.Trigger.DelayedTrigger"},{id:"z1jnexqjf",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoAspectRatio"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"axrb9y4f6",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoLoaded"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"k66hq3ihz",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"out bool",links:[{portIn:"Value",portOut:"out bool",objIn:"axrb9y4f6",objOut:"k66hq3ihz"}]}],objName:"Ops.Extension.Deprecated.ToggleBoolValue"},{id:"xm013etp7",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"number",links:[{portIn:"play",portOut:"number",objIn:"eyn33vy5z",objOut:"xm013etp7"}]}],objName:"Ops.Trigger.NumberByTrigger"},{id:"b2sqi3l7g",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Named Trigger",value:"loaded"}],portsOut:[{name:"Triggered",links:[{portIn:"exe",portOut:"Triggered",objIn:"a4u8a1x4q",objOut:"b2sqi3l7g"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"a4u8a1x4q",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"delay",value:.1}],portsOut:[{name:"next",links:[{portIn:"1",portOut:"next",objIn:"xm013etp7",objOut:"a4u8a1x4q"},{portIn:"trigger",portOut:"next",objIn:"wo3yxin4e",objOut:"a4u8a1x4q"}]},{name:"Delaying",value:false}],objName:"Ops.Trigger.DelayedTrigger"},{id:"3fessdj9o",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Named Trigger",value:"controlPlay"}],portsOut:[{name:"Triggered",links:[{portIn:"trigger",portOut:"Triggered",objIn:"wo3yxin4e",objOut:"3fessdj9o"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"o2rjjfyi8",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"playerStatus"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"v38pi7nzw",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Fragment Code",value:"IN vec2 texCoord;\r\nUNI vec2 offset;  // Offset in X and Y directions\r\nUNI vec2 repeat;  // Repeat in X and Y directions\r\nUNI sampler2D textureInput;\r\n{{MODULES_HEAD}}\r\nvoid main()\r\n{\r\n    vec2 uv = texCoord * repeat + offset; // Apply offset and repeat\r\n    // Wrap UV coordinates to ensure they stay within the [0, 1] range\r\n    uv = fract(uv);\r\n    {{MODULE_COLOR}}\r\n    outColor = texture(textureInput, uv); // Sample the texture using modified coordinates\r\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"repeat Y",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"z1150e2ur",objOut:"v38pi7nzw"}]},{name:"Shader",links:[{portIn:"object port 2",portOut:"Shader",objIn:"vyl1eomnh",objOut:"v38pi7nzw"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"ece3100d-56f4-40e1-bd04-711aba30c988",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"create port",value:0},{name:"in0 Ops.Trigger.RouteTriggerString_v2 Trigger 1",links:[{portIn:"Update",portOut:"in0 Ops.Trigger.RouteTriggerString_v2 Trigger 1",objIn:"eyn33vy5z",objOut:"ece3100d-56f4-40e1-bd04-711aba30c988"}]}],objName:"Ops.Ui.PatchInput"},{id:"c2dfdfab-f08f-46c6-8599-9c62d64da7c1",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"create port",value:0}],objName:"Ops.Ui.PatchOutput"},{id:"c3020432-d72e-41bb-8274-dbd55ba98235",uiAttribs:{},storage:{subPatchVer:1},portsIn:[{name:"create port",value:0},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Trigger.RouteTriggerString_v2 Trigger 1","type":1}],"portsOut":[{"name":"out0 ImageCompose texture_out","type":2,"objType":"texture"},{"name":"out1 ShaderToTexture Next","type":1}]}'},{name:"patchId",value:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"}],portsOut:[{name:"create port out",value:0},{name:"out0 ImageCompose texture_out",links:[{portIn:"object port 1",portOut:"out0 ImageCompose texture_out",objIn:"8ejjb9tja",objOut:"c3020432-d72e-41bb-8274-dbd55ba98235"}]},{name:"out1 ShaderToTexture Next",links:[{portIn:"render",portOut:"out1 ShaderToTexture Next",objIn:"5m0nxxnjx",objOut:"c3020432-d72e-41bb-8274-dbd55ba98235"}]}],objName:"Ops.Ui.SubPatch"},{id:"728bc2af-66ca-4c6f-a6d4-2b51f809033d",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Value 2",value:0},{name:"Value 3",value:0},{name:"Value 4",value:0},{name:"Value 5",value:0},{name:"Value 6",value:0},{name:"Value 7",value:0},{name:"Value 8",value:0},{name:"Value 9",value:0},{name:"Value 10",value:0},{name:"Value 11",value:0},{name:"Value 12",value:0},{name:"Value 13",value:0},{name:"Value 14",value:0},{name:"Value 15",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"z1jnexqjf",objOut:"728bc2af-66ca-4c6f-a6d4-2b51f809033d"}]}],objName:"Ops.Number.SwitchNumber"},{id:"73996b48-d3cb-4a6f-8009-ad1df84c1427",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"728bc2af-66ca-4c6f-a6d4-2b51f809033d",objOut:"73996b48-d3cb-4a6f-8009-ad1df84c1427"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"mmolwn8pn",uiAttribs:{},portsIn:[{name:"Variable",value:"aboutScroll"}],portsOut:[{name:"Value",links:[{portIn:"perc",portOut:"Value",objIn:"dbus6zao0",objOut:"mmolwn8pn"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"y53d604uk",uiAttribs:{},portsIn:[{name:"Variable",value:"workScroll"}],portsOut:[{name:"Value",links:[{portIn:"perc",portOut:"Value",objIn:"0co9dzwpn",objOut:"y53d604uk"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"0co9dzwpn",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Exe",portOut:"Next",objIn:"dbus6zao0",objOut:"0co9dzwpn"}]},{name:"Result",links:[{portIn:"Array 1",portOut:"Result",objIn:"dbus6zao0",objOut:"0co9dzwpn"}]}],objName:"Ops.Array.InterpolateArrays"},{id:"ddsl6t6bk",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:.6},{name:"Y",value:1.12},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"01spwg00b",objOut:"ddsl6t6bk"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"01spwg00b",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"2kmdmhz3p",objOut:"01spwg00b"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"dbus6zao0",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"lywnyv9o4",objOut:"dbus6zao0"}]},{name:"Result",links:[{portIn:"Array In",portOut:"Result",objIn:"lywnyv9o4",objOut:"dbus6zao0"}]}],objName:"Ops.Array.InterpolateArrays"},{id:"lywnyv9o4",uiAttribs:{},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",value:30,title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"3e9jbf60v",objOut:"lywnyv9o4"}]},{name:"Array Out",links:[{portIn:"Array",portOut:"Array Out",objIn:"ub6p4urcu",objOut:"lywnyv9o4"},{portIn:"array",portOut:"Array Out",objIn:"cqjowcwqt",objOut:"lywnyv9o4"},{portIn:"Array",portOut:"Array Out",objIn:"o9o1lvbn5",objOut:"lywnyv9o4"}]}],objName:"Ops.Array.SmoothArray"},{id:"mgvdxuuuc",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:3.7},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"01spwg00b",objOut:"mgvdxuuuc"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"gnz3lfvnx",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:148.35},{name:"Y",value:-67.71},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"01spwg00b",objOut:"gnz3lfvnx"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"9ab09c55-a9f4-45b3-91f7-1438b3975417",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0},{name:"Array 8",value:0},{name:"Array 9",value:0}],portsOut:[{name:"Result",links:[{portIn:"Array 1",portOut:"Result",objIn:"0co9dzwpn",objOut:"9ab09c55-a9f4-45b3-91f7-1438b3975417"}]}],objName:"Ops.Array.SwitchArray"},{id:"400e715b-2702-4f99-acf3-b545cbb099f7",uiAttribs:{},portsIn:[{name:"Variable",value:"mediaQueryIndex"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"25dac18d-a406-44cb-a11e-6770fc5fe1e3",uiAttribs:{},portsIn:[{name:"Variable",value:"mediaQueryIndex"}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"9ab09c55-a9f4-45b3-91f7-1438b3975417",objOut:"25dac18d-a406-44cb-a11e-6770fc5fe1e3"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"xunvxt053",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0},{name:"Array 8",value:0},{name:"Array 9",value:0}],portsOut:[{name:"Result",links:[{portIn:"Array 2",portOut:"Result",objIn:"0co9dzwpn",objOut:"xunvxt053"}]}],objName:"Ops.Array.SwitchArray"},{id:"zazzu6gav",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0},{name:"Array 8",value:0},{name:"Array 9",value:0}],portsOut:[{name:"Result",links:[{portIn:"Array 2",portOut:"Result",objIn:"dbus6zao0",objOut:"zazzu6gav"}]}],objName:"Ops.Array.SwitchArray"},{id:"sokw138q9",uiAttribs:{},portsIn:[{name:"Variable",value:"mainColor"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"cretzkq7p",uiAttribs:{},portsIn:[{name:"Bytes",value:0}],portsOut:[{name:"R",links:[{portIn:"r",portOut:"R",objIn:"gm13f4zcc",objOut:"cretzkq7p"}]},{name:"G",links:[{portIn:"g",portOut:"G",objIn:"gm13f4zcc",objOut:"cretzkq7p"}]},{name:"B",links:[{portIn:"b",portOut:"B",objIn:"gm13f4zcc",objOut:"cretzkq7p"}]}],objName:"Ops.Color.HexToRGB_v2"},{id:"eus15y61d",uiAttribs:{},portsIn:[{name:"Variable",value:"mainColorHex"}],objName:"Ops.Vars.VarSetString_v2"},{id:"p2hdsw9tg",uiAttribs:{},portsIn:[{name:"value",value:"#0001ff"}],portsOut:[{name:"String",links:[{portIn:"Value",portOut:"String",objIn:"eus15y61d",objOut:"p2hdsw9tg"}]}],objName:"Ops.String.String_v2"},{id:"kf52yxg3c",uiAttribs:{},portsIn:[{name:"Variable",value:"mainColorHex"}],portsOut:[{name:"Value",links:[{portIn:"Hex",portOut:"Value",objIn:"cretzkq7p",objOut:"kf52yxg3c"}]}],objName:"Ops.Vars.VarGetString"},{id:"t8wj0g1fm",uiAttribs:{},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",value:4,title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Array Out",links:[{portIn:"Value",portOut:"Array Out",objIn:"sokw138q9",objOut:"t8wj0g1fm"}]}],objName:"Ops.Array.SmoothArray"},{id:"0dsqix305",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"mainLoop"}],portsOut:[{name:"Triggered",links:[{portIn:"Execute",portOut:"Triggered",objIn:"t8wj0g1fm",objOut:"0dsqix305"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"69ih8zk1e",uiAttribs:{},portsIn:[{name:"Variable",value:"mediaQueryIndex"}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"zazzu6gav",objOut:"69ih8zk1e"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"hargq3qo8",uiAttribs:{},portsIn:[{name:"Value",value:1},{name:"Variable",value:"videoPlay"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"qnjs57c8o",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoPlay"}],portsOut:[{name:"Value",links:[{portIn:"speed",portOut:"Value",objIn:"eyn33vy5z",objOut:"qnjs57c8o"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"c850knda1",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoMuted"}],portsOut:[{name:"Value",links:[{portIn:"mute",portOut:"Value",objIn:"eyn33vy5z",objOut:"c850knda1"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"oen4upux4",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"videoMuted"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"plo7uwjmn",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0},{name:"Array 8",value:0},{name:"Array 9",value:0}],portsOut:[{name:"Result",links:[{portIn:"array",portOut:"Result",objIn:"ls1owm8vb",objOut:"plo7uwjmn"},{portIn:"array",portOut:"Result",objIn:"gyjsxc17k",objOut:"plo7uwjmn"},{portIn:"array",portOut:"Result",objIn:"hnxcvkeen",objOut:"plo7uwjmn"}]}],objName:"Ops.Array.SwitchArray"},{id:"dck8p93pm",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"a",value:1}],portsOut:[{name:"outr",value:0},{name:"outg",value:.00392156862745098},{name:"outb",value:1},{name:"outa",value:1},{name:"Hex",value:"0001FF"},{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"plo7uwjmn",objOut:"dck8p93pm"}]}],objName:"Ops.Color.ColorValue"},{id:"3hjppckvj",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"a",value:0}],portsOut:[{name:"outr",value:0},{name:"outg",value:0},{name:"outb",value:0},{name:"outa",value:0},{name:"Hex",value:"000000"},{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"plo7uwjmn",objOut:"3hjppckvj"}]}],objName:"Ops.Color.ColorValue"},{id:"ls1owm8vb",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"index",value:0},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"r",portOut:"value",objIn:"x1nx2ee3j",objOut:"ls1owm8vb"},{portIn:"r",portOut:"value",objIn:"mmx48qgw9",objOut:"ls1owm8vb"},{portIn:"Emissive R",portOut:"value",objIn:"zzjyotgds",objOut:"ls1owm8vb"},{portIn:"R",portOut:"value",objIn:"zzjyotgds",objOut:"ls1owm8vb"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"gyjsxc17k",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"index",value:1},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"g",portOut:"value",objIn:"x1nx2ee3j",objOut:"gyjsxc17k"},{portIn:"g",portOut:"value",objIn:"mmx48qgw9",objOut:"gyjsxc17k"},{portIn:"Emissive G",portOut:"value",objIn:"zzjyotgds",objOut:"gyjsxc17k"},{portIn:"G",portOut:"value",objIn:"zzjyotgds",objOut:"gyjsxc17k"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"hnxcvkeen",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"index",value:2},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"b",portOut:"value",objIn:"x1nx2ee3j",objOut:"hnxcvkeen"},{portIn:"b",portOut:"value",objIn:"mmx48qgw9",objOut:"hnxcvkeen"},{portIn:"Emissive B",portOut:"value",objIn:"zzjyotgds",objOut:"hnxcvkeen"},{portIn:"B",portOut:"value",objIn:"zzjyotgds",objOut:"hnxcvkeen"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"q5hgcc873",uiAttribs:{subPatch:"oq0mm5hrc"},portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.TransformView trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.TransformView trigger",objIn:"3ms5xb3ej",objOut:"q5hgcc873"}]},{name:"in1 Ops.Json.ObjectToArray Array",value:0},{name:"in2 var get  Value",value:0}],objName:"Ops.Ui.PatchInput"},{id:"hmrwm30er",uiAttribs:{},storage:{subPatchVer:1},portsIn:[{name:"create port",value:0},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.TransformView trigger","type":1},{"name":"in1 Ops.Json.ObjectToArray Array","type":3,"value":null},{"name":"in2 var get  Value","type":5,"value":null}],"portsOut":[{"name":"out0 Ops.Ui.VizArrayTable Start Row","type":0},{"name":"out1 Ops.Trigger.RouteTrigger Next Trigger","type":1}]}'},{name:"patchId",value:"oq0mm5hrc"}],portsOut:[{name:"create port out",value:0}],objName:"Ops.Ui.SubPatch"},{id:"99lxruhzw",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"Amount",value:1},{name:"Target index",value:0},{name:"Target",value:"Color"},{name:"Scale",value:1},{name:"Use Texture Alpha",value:0},{name:"Pos X",value:0},{name:"Pos Y",value:0},{name:"Rot X",value:0},{name:"Rot Y",value:0},{name:"Rot Z",value:0},{name:"Mapping index",value:4},{name:"Mapping",value:"Screen"},{name:"Discard",value:0},{name:"WorldSpace",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"hjdeu0zr1",objOut:"99lxruhzw"}]}],objName:"Ops.Gl.ShaderEffects.TextureProjection_v2"},{id:"e50oqab02",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Variable",value:"textTexture"}],portsOut:[{name:"Value",links:[{portIn:"Texture",portOut:"Value",objIn:"23spdnjhn",objOut:"e50oqab02"},{portIn:"Texture",portOut:"Value",objIn:"9mk9lwfol",objOut:"e50oqab02"},{portIn:"Texture In",portOut:"Value",objIn:"b1025pxu7",objOut:"e50oqab02"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"23spdnjhn",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"blendMode index",value:6},{name:"blendMode",value:"add"},{name:"Amount",value:1},{name:"Target index",value:0},{name:"Target",value:"Color"},{name:"Scale",value:1},{name:"Use Texture Alpha",value:0},{name:"Pos X",value:0},{name:"Pos Y",value:0},{name:"Rot X",value:0},{name:"Rot Y",value:0},{name:"Rot Z",value:0},{name:"Mapping index",value:5},{name:"Mapping",value:"TexCoords 1"},{name:"Discard",value:0},{name:"WorldSpace",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"hjdeu0zr1",objOut:"23spdnjhn"}]}],objName:"Ops.Gl.ShaderEffects.TextureProjection_v2"},{id:"x1nx2ee3j",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"6szyoriwg",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Variable",value:"imageTexture"}],portsOut:[{name:"Value",links:[{portIn:"Texture",portOut:"Value",objIn:"99lxruhzw",objOut:"6szyoriwg"},{portIn:"Texture",portOut:"Value",objIn:"lgr7iccwf",objOut:"6szyoriwg"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"aghifmi60",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Variable",value:"mainColor"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"nkc7m4mpo",objOut:"aghifmi60"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"nkc7m4mpo",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"r",portOut:"X",objIn:"dck8p93pm",objOut:"nkc7m4mpo"}]},{name:"Y",links:[{portIn:"g",portOut:"Y",objIn:"dck8p93pm",objOut:"nkc7m4mpo"}]},{name:"Z",links:[{portIn:"b",portOut:"Z",objIn:"dck8p93pm",objOut:"nkc7m4mpo"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"hjdeu0zr1",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"data",value:""},{name:"glb File",value:"assets/651a88bdc6d98bfb822e8d4a_000002045050001042130030000_cubic2UV.glb",display:"file"},{name:"Draw",value:1},{name:"Camera index",value:0},{name:"Camera",value:"None"},{name:"Animation",value:""},{name:"Center index",value:0},{name:"Center",value:"None"},{name:"Rescale",value:1},{name:"Rescale Size",value:1.5},{name:"Time",value:0},{name:"Sync to timeline",value:0},{name:"Loop",value:1},{name:"Normals Format index",value:0},{name:"Normals Format",value:"XYZ"},{name:"Vertices Format index",value:0},{name:"Vertices Format",value:"XYZ"},{name:"Calc Normals index",value:0},{name:"Calc Normals",value:"Auto"},{name:"Hide Nodes",value:0},{name:"Use Material Properties",value:0},{name:"Active",value:1}],portsOut:[{name:"Generator",value:""},{name:"GLTF Version",value:2},{name:"Anim Length",value:-1},{name:"Anim Time",value:0},{name:"Loading",value:false}],objName:"Ops.Gl.GLTF.GltfScene_v4"},{id:"2kmdmhz3p",uiAttribs:{},portsIn:[{name:"Value",useVariable:"unknown"},{name:"Variable",value:"indexPSR_mq3"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"jwfjtazmg",uiAttribs:{},portsIn:[{name:"Variable",value:"indexPSR_mq3"}],portsOut:[{name:"Value",links:[{portIn:"Array 2",portOut:"Value",objIn:"9ab09c55-a9f4-45b3-91f7-1438b3975417",objOut:"jwfjtazmg"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"p70hvwc6c",uiAttribs:{},portsIn:[{name:"Variable",value:"mediaQueryIndex"}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"xunvxt053",objOut:"p70hvwc6c"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"2i8gsui6v",uiAttribs:{},portsIn:[{name:"Variable",value:"workPSR_mq3"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"exnbfhfos",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:0},{name:"Y",value:0},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"2hezwqori",objOut:"exnbfhfos"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"2hezwqori",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"2i8gsui6v",objOut:"2hezwqori"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"i4cd58a1f",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:5.44},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"2hezwqori",objOut:"i4cd58a1f"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"6bkqlotoh",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:138.85},{name:"Y",value:-28.8},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"2hezwqori",objOut:"6bkqlotoh"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"chc44agoc",uiAttribs:{},portsIn:[{name:"Variable",value:"workPSR_mq3"}],portsOut:[{name:"Value",links:[{portIn:"byk06hys1",portOut:"Value",objIn:"t94xojk09",objOut:"chc44agoc"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"pccmrol86",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"yf0cqputf",objOut:"pccmrol86"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"ggf2ud9x6",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:7.92},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"pccmrol86",objOut:"ggf2ud9x6"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"h4ozzfizw",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:2},{name:"Y",value:0},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"pccmrol86",objOut:"h4ozzfizw"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"y0g4lw34g",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:51.5},{name:"Y",value:-29.22},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"pccmrol86",objOut:"y0g4lw34g"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"yf0cqputf",uiAttribs:{},portsIn:[{name:"Variable",value:"indexWorkPSR_mq3"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"ellnqv315",uiAttribs:{},portsIn:[{name:"Variable",value:"indexWorkPSR_mq3"}],portsOut:[{name:"Value",links:[{portIn:"Array 2",portOut:"Value",objIn:"xunvxt053",objOut:"ellnqv315"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"mcbcfh35i",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:3.04},{name:"Y",value:-1.89},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"bvm6d55bb",objOut:"mcbcfh35i"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"bvm6d55bb",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"c656yrjan",objOut:"bvm6d55bb"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"w7wharqei",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:7.11},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"bvm6d55bb",objOut:"w7wharqei"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"frq6m3yxr",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:33.93},{name:"Y",value:-18.54},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"bvm6d55bb",objOut:"frq6m3yxr"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"c656yrjan",uiAttribs:{},portsIn:[{name:"Variable",value:"indexAboutPSR_mq3"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"uzyavlylt",uiAttribs:{},portsIn:[{name:"Variable",value:"indexAboutPSR_mq3"}],portsOut:[{name:"Value",links:[{portIn:"Array 2",portOut:"Value",objIn:"zazzu6gav",objOut:"uzyavlylt"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"l36s3jlsl",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:1.62},{name:"Y",value:0},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"4dksq1abi",objOut:"l36s3jlsl"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"4dksq1abi",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"h7mhzibj4",objOut:"4dksq1abi"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"zg8hsww2r",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:8.68},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"4dksq1abi",objOut:"zg8hsww2r"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"pf4ebu45x",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:332.62},{name:"Y",value:-88.18},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"4dksq1abi",objOut:"pf4ebu45x"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"h7mhzibj4",uiAttribs:{},portsIn:[{name:"Variable",value:"indexPSR_mq1"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"n2q1jok6z",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"tu8296wau",objOut:"n2q1jok6z"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"vgphyej1w",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:-3.52},{name:"Y",value:-1.67},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"n2q1jok6z",objOut:"vgphyej1w"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"mqpqb4eo4",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:15},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"n2q1jok6z",objOut:"mqpqb4eo4"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"vszs6x49d",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:333},{name:"Y",value:0},{name:"Z",value:-8.39}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"n2q1jok6z",objOut:"vszs6x49d"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"3sqb5827s",uiAttribs:{},portsIn:[{name:"Variable",value:"workPSR_mq1"}],portsOut:[{name:"Value",links:[{portIn:"byk06hys1",portOut:"Value",objIn:"6aubf72ju",objOut:"3sqb5827s"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"tu8296wau",uiAttribs:{},portsIn:[{name:"Variable",value:"workPSR_mq1"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"py33q58zb",uiAttribs:{},portsIn:[{name:"Variable",value:"indexPSR_mq1"}],portsOut:[{name:"Value",links:[{portIn:"Array 0",portOut:"Value",objIn:"9ab09c55-a9f4-45b3-91f7-1438b3975417",objOut:"py33q58zb"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"5r7i5h20c",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"91pq98h5z",objOut:"5r7i5h20c"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"ala5ig2bi",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:2.5},{name:"Y",value:-10.94},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"5r7i5h20c",objOut:"ala5ig2bi"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"upcxohqe5",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:8.68},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"5r7i5h20c",objOut:"upcxohqe5"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"9r254ayc4",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:332.62},{name:"Y",value:-88.68},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"5r7i5h20c",objOut:"9r254ayc4"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"41cjp8rgl",uiAttribs:{},portsIn:[{name:"Variable",value:"indexWorkPSR_mq1"}],portsOut:[{name:"Value",links:[{portIn:"Array 0",portOut:"Value",objIn:"xunvxt053",objOut:"41cjp8rgl"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"91pq98h5z",uiAttribs:{},portsIn:[{name:"Variable",value:"indexWorkPSR_mq1"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"yqjbwaeqk",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:-3.09},{name:"Y",value:4.9},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"5uk9wosps",objOut:"yqjbwaeqk"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"5uk9wosps",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"lm4og22cv",objOut:"5uk9wosps"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"5bpyu9pzr",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:11.08},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"5uk9wosps",objOut:"5bpyu9pzr"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"6v2w0ex5l",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:222.34},{name:"Y",value:-123.39},{name:"Z",value:11.62}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"5uk9wosps",objOut:"6v2w0ex5l"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"lm4og22cv",uiAttribs:{},portsIn:[{name:"Variable",value:"indexAboutPSR_mq1"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"764ftab6t",uiAttribs:{},portsIn:[{name:"Variable",value:"indexAboutPSR_mq1"}],portsOut:[{name:"Value",links:[{portIn:"Array 0",portOut:"Value",objIn:"zazzu6gav",objOut:"764ftab6t"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"r3u33h3hs",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Fragment Code",value:"IN vec2 texCoord;\r\nUNI vec2 offset;\r\nUNI vec2 repeat;\r\nUNI bool wrapMode;  // Add this uniform\r\nUNI sampler2D textureInput;\r\n{{MODULES_HEAD}}\r\nvoid main()\r\n{\r\n    // Start with original texture coordinates\r\n    vec2 uv = texCoord;\r\n    \r\n    // Flip Y before repetition so pattern starts from top\r\n    uv.y = 1.0 - uv.y;\r\n    \r\n    // Create vertical repetition\r\n    uv.y *= repeat.y;\r\n    \r\n    // Apply offset\r\n    uv += offset;\r\n    \r\n    // Switch between wrap and clamp modes\r\n    uv = wrapMode ? fract(uv) : clamp(uv, 0.0, 1.0);\r\n    \r\n    // Flip Y again to maintain correct image orientation\r\n    uv.y = 1.0 - uv.y;\r\n    \r\n    {{MODULE_COLOR}}\r\n    outColor = texture(textureInput, uv);\r\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"repeat X",value:1},{name:"wrapMode",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"z1150e2ur",objOut:"r3u33h3hs"}]},{name:"Shader",links:[{portIn:"object port 0",portOut:"Shader",objIn:"vyl1eomnh",objOut:"r3u33h3hs"},{portIn:"object port 1",portOut:"Shader",objIn:"vyl1eomnh",objOut:"r3u33h3hs"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"6fpmfnjy1",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"mediaQuery"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"b0hk8u9bi",objOut:"6fpmfnjy1"}]}],objName:"Ops.Vars.VarGetString"},{id:"b0hk8u9bi",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"String 0",value:"mq1"},{name:"String 1",value:"mq2"},{name:"String 2",value:"mq3"},{name:"String 3",value:""},{name:"String 4",value:""},{name:"String 5",value:""},{name:"String 6",value:""},{name:"String 7",value:""},{name:"String 8",value:""},{name:"String 9",value:""},{name:"String 10",value:""},{name:"String 11",value:""},{name:"String 12",value:""},{name:"String 13",value:""},{name:"String 14",value:""},{name:"String 15",value:""},{name:"String 16",value:""},{name:"String 17",value:""},{name:"String 18",value:""},{name:"String 19",value:""},{name:"String 20",value:""},{name:"String 21",value:""},{name:"String 22",value:""},{name:"String 23",value:""}],portsOut:[{name:"Next Trigger",links:[{portIn:"stqfp1svi",portOut:"Next Trigger",objIn:"ko5qliv40",objOut:"b0hk8u9bi"}]},{name:"Switched Index",links:[{portIn:"Object Index",portOut:"Switched Index",objIn:"vyl1eomnh",objOut:"b0hk8u9bi"}]},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"r3u33h3hs",objOut:"b0hk8u9bi"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"r3u33h3hs",objOut:"b0hk8u9bi"}]},{name:"Trigger 2",links:[{portIn:"render",portOut:"Trigger 2",objIn:"v38pi7nzw",objOut:"b0hk8u9bi"}]}],objName:"Ops.Trigger.RouteTriggerString_v2"},{id:"exw5m949c",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"result",links:[{portIn:"repeat Y",portOut:"result",objIn:"r3u33h3hs",objOut:"exw5m949c"}]}],objName:"Ops.Math.Divide"},{id:"imr8zljmp",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:.41},{name:"Y",value:6.17},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"bpyykpwd5",objOut:"imr8zljmp"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"bpyykpwd5",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"w8rz76p68",objOut:"bpyykpwd5"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"2p5xzcx54",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:12.37},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"bpyykpwd5",objOut:"2p5xzcx54"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"0zhl4oyyh",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:233.71},{name:"Y",value:-64.86},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"bpyykpwd5",objOut:"0zhl4oyyh"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"w8rz76p68",uiAttribs:{},portsIn:[{name:"Variable",value:"workPSR_mq2"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"gv5wydpvw",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:3.88},{name:"Y",value:.89},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"0aldyxi0a",objOut:"gv5wydpvw"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"0aldyxi0a",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"z9j7nqtoi",objOut:"0aldyxi0a"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"rz2flkkiq",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:5.95},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"0aldyxi0a",objOut:"rz2flkkiq"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"1ohqdvker",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:248.87},{name:"Y",value:-40.95},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"0aldyxi0a",objOut:"1ohqdvker"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"z9j7nqtoi",uiAttribs:{},portsIn:[{name:"Variable",value:"indexPSR_mq2"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"zauhxljs1",uiAttribs:{},portsIn:[{name:"Variable",value:"indexPSR_mq2"}],portsOut:[{name:"Value",links:[{portIn:"Array 1",portOut:"Value",objIn:"9ab09c55-a9f4-45b3-91f7-1438b3975417",objOut:"zauhxljs1"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"wktp2kjaz",uiAttribs:{},portsIn:[{name:"Variable",value:"workPSR_mq2"}],portsOut:[{name:"Value",links:[{portIn:"byk06hys1",portOut:"Value",objIn:"5l8gkfndg",objOut:"wktp2kjaz"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"sgxfp2dh9",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:.17},{name:"Y",value:-3.43},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"nbbh25gsp",objOut:"sgxfp2dh9"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"nbbh25gsp",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"hpl4pfw6d",objOut:"nbbh25gsp"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"0gbr5e0jd",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:9.08},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"nbbh25gsp",objOut:"0gbr5e0jd"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"obpbg4umr",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:340.51},{name:"Y",value:8.92},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"nbbh25gsp",objOut:"obpbg4umr"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"hpl4pfw6d",uiAttribs:{},portsIn:[{name:"Variable",value:"indexAboutPSR_mq2"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"j5bnp2pah",uiAttribs:{},portsIn:[{name:"Variable",value:"indexAboutPSR_mq2"}],portsOut:[{name:"Value",links:[{portIn:"Array 1",portOut:"Value",objIn:"zazzu6gav",objOut:"j5bnp2pah"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"lz04ulvsv",uiAttribs:{},portsIn:[{name:"Title",value:""}],objName:"Ops.Ui.Area"},{id:"74ixjif61",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:.41},{name:"Y",value:-6.73},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"tts0z2501",objOut:"74ixjif61"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"tts0z2501",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"5weur9rlg",objOut:"tts0z2501"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"1glgv73qv",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:8.88},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"tts0z2501",objOut:"1glgv73qv"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"zky6tth8a",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:250.28},{name:"Y",value:-45.93},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"tts0z2501",objOut:"zky6tth8a"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"5weur9rlg",uiAttribs:{},portsIn:[{name:"Variable",value:"indexWorkPSR_mq2"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"bvk5q8iei",uiAttribs:{},portsIn:[{name:"Variable",value:"indexWorkPSR_mq2"}],portsOut:[{name:"Value",links:[{portIn:"Array 1",portOut:"Value",objIn:"xunvxt053",objOut:"bvk5q8iei"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"j2v7lizv8",uiAttribs:{},portsIn:[{name:"Variable",value:"textTexture"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"3ms5xb3ej",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"String 0",value:"index"},{name:"String 1",value:"works"},{name:"String 2",value:"404"},{name:"String 3",value:""},{name:"String 4",value:""},{name:"String 5",value:""},{name:"String 6",value:""},{name:"String 7",value:""},{name:"String 8",value:""},{name:"String 9",value:""},{name:"String 10",value:""},{name:"String 11",value:""},{name:"String 12",value:""},{name:"String 13",value:""},{name:"String 14",value:""},{name:"String 15",value:""},{name:"String 16",value:""},{name:"String 17",value:""},{name:"String 18",value:""},{name:"String 19",value:""},{name:"String 20",value:""},{name:"String 21",value:""},{name:"String 22",value:""},{name:"String 23",value:""}],portsOut:[{name:"Switched Index",links:[{portIn:"Index",portOut:"Switched Index",objIn:"plo7uwjmn",objOut:"3ms5xb3ej"}]},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"x1nx2ee3j",objOut:"3ms5xb3ej"},{portIn:"Trigger In",portOut:"Trigger 0",objIn:"zzjyotgds",objOut:"3ms5xb3ej"}]},{name:"Trigger 1",links:[{portIn:"Execute",portOut:"Trigger 1",objIn:"ml4jm0lz0",objOut:"3ms5xb3ej"}]},{name:"Trigger 2",links:[{portIn:"render",portOut:"Trigger 2",objIn:"mmx48qgw9",objOut:"3ms5xb3ej"}]}],objName:"Ops.Trigger.RouteTriggerString_v2"},{id:"f31jfdtdj",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Variable",value:"pageContext"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"3ms5xb3ej",objOut:"f31jfdtdj"}]}],objName:"Ops.Vars.VarGetString"},{id:"vyl1eomnh",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"object out",links:[{portIn:"Shader",portOut:"object out",objIn:"z1150e2ur",objOut:"vyl1eomnh"}]}],objName:"Ops.Json.SwitchObject"},{id:"1rkhd6ijv",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoAspectRatio"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"exw5m949c",objOut:"1rkhd6ijv"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"233hz90n3",uiAttribs:{},portsIn:[{name:"Variable",value:"imageTextureOffset"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"rad5pr04g",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:0},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"kh45ej5sc",objOut:"rad5pr04g"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"x17czuoyb",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:-.28},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"kh45ej5sc",objOut:"x17czuoyb"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"kh45ej5sc",uiAttribs:{},portsIn:[{name:"Array 0",value:0},{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"233hz90n3",objOut:"kh45ej5sc"}]}],objName:"Ops.Array.ArrayPack"},{id:"i0q70ilkb",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"imageTextureOffset"}],portsOut:[{name:"Value",links:[{portIn:"array",portOut:"Value",objIn:"69llqqm87",objOut:"i0q70ilkb"},{portIn:"array",portOut:"Value",objIn:"y97ci5q96",objOut:"i0q70ilkb"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"69llqqm87",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"index",value:0},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"offset X",portOut:"value",objIn:"r3u33h3hs",objOut:"69llqqm87"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"y97ci5q96",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"index",value:1},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"number1",portOut:"value",objIn:"lml49srhp",objOut:"y97ci5q96"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"8gblxjhc4",uiAttribs:{},portsIn:[{name:"Variable",value:"imageTextureWrap"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"gadc7j33d",uiAttribs:{},portsIn:[{name:"value",value:0}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"8gblxjhc4",objOut:"gadc7j33d"}]}],objName:"Ops.Boolean.Boolean"},{id:"vplbf7t31",uiAttribs:{},portsIn:[{name:"Variable",value:"stringTexture"}],portsOut:[{name:"Value",links:[{portIn:"text",portOut:"Value",objIn:"fvntb6ykt",objOut:"vplbf7t31"},{portIn:"String",portOut:"Value",objIn:"pokh8f7mm",objOut:"vplbf7t31"}]}],objName:"Ops.Vars.VarGetString"},{id:"fvntb6ykt",uiAttribs:{},portsIn:[{name:"Draw Mesh",value:0},{name:"Scale Mesh",value:.5},{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"Width",value:2048},{name:"Height",value:682.6666666666666},{name:"Auto Height",value:0},{name:"Auto Line Breaks",value:0},{name:"font",value:"everettLight"},{name:"weight",value:"bold"},{name:"fontSize",value:300},{name:"align index",value:1},{name:"align",value:"center"},{name:"Vertical align index",value:1},{name:"Vertical align",value:"Middle"},{name:"Letter Spacing",value:0},{name:"Line Height Add",value:0},{name:"Padding Y Top",value:3},{name:"Padding Y Bottom",value:3},{name:"Padding X",value:0},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:0},{name:"Reuse Texture",value:1},{name:"Show Debug",value:0},{name:"Redraw On Font Load",value:1},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"background R",value:0},{name:"background G",value:0},{name:"background B",value:0},{name:"background A",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"5m0nxxnjx",objOut:"fvntb6ykt"},{portIn:"Render",portOut:"Next",objIn:"0wtkjvm38",objOut:"fvntb6ykt"}]},{name:"Ratio",value:.33642578125},{name:"texture",links:[{portIn:"Base Texture",portOut:"texture",objIn:"0wtkjvm38",objOut:"fvntb6ykt"}]},{name:"Aspect",value:2.972423802612482},{name:"Num Lines",value:1}],objName:"Ops.Gl.Textures.TextTexture_v6"},{id:"zgn2xh9jp",uiAttribs:{},portsIn:[{name:"Value",value:.08},{name:"Variable",value:"mouseTransformSpeed"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"pokh8f7mm",uiAttribs:{},portsOut:[{name:"Changed",links:[{portIn:"xz0gracpt",portOut:"Changed",objIn:"z7y2n2i3i",objOut:"pokh8f7mm"}]}],objName:"Ops.Trigger.TriggerOnChangeString"},{id:"3jdhde75y",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"xz0gracpt",portOut:"Next",objIn:"z7y2n2i3i",objOut:"3jdhde75y"}]}],objName:"Ops.Trigger.TriggerButton"},{id:"p6hjo3g1c",uiAttribs:{},portsIn:[{name:"Title",value:""}],objName:"Ops.Ui.Area"},{id:"mm8u7lfgw",uiAttribs:{},portsIn:[{name:"Title",value:""}],objName:"Ops.Ui.Area"},{id:"3es0tzeh7",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Ui.VizArrayTable Start Row",value:0}],objName:"Ops.Ui.PatchOutput"},{id:"3sodhmqvs",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"9mnoq6ams",title:"Reset"},{name:"x51l5mx3z",value:.5,title:"number1"},{name:"via20ae2r",value:0,title:"number1"},{name:"eq3wcir2y",value:0,title:"number1"},{name:"x0ic0h4fm",title:"number1"},{name:"patchId",value:"bp2sub_3sodhmqvs"}],portsOut:[{name:"fei1jpjm5",value:0,title:"Result"},{name:"o1i9iyfw1",value:0,title:"Result"},{name:"arp1806j4",value:0,title:"result"},{name:"scw0zze34",title:"Next",links:[{portIn:"2uzay3xk0",portOut:"scw0zze34",objIn:"5l8gkfndg",objOut:"3sodhmqvs"}]}],objName:"Ops.Patch.PGgjVeu.AutoTransform"},{id:"64opcwacl",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"9mnoq6ams",title:"Reset"},{name:"x51l5mx3z",value:.5,title:"number1"},{name:"via20ae2r",value:.5,title:"number1"},{name:"eq3wcir2y",value:.5,title:"number1"},{name:"x0ic0h4fm",title:"number1"},{name:"patchId",value:"bp2sub_64opcwacl"}],portsOut:[{name:"fei1jpjm5",value:2.515223015909535,title:"Result"},{name:"o1i9iyfw1",value:2.515223015909535,title:"Result"},{name:"arp1806j4",value:2.5152230159095352,title:"result"},{name:"scw0zze34",title:"Next",links:[{portIn:"2uzay3xk0",portOut:"scw0zze34",objIn:"6aubf72ju",objOut:"64opcwacl"}]}],objName:"Ops.Patch.PGgjVeu.AutoTransform"},{id:"ovzv6maxr",uiAttribs:{},portsIn:[{name:"Value",value:.3},{name:"Variable",value:"autoTransformSpeed"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"onyu94me7",uiAttribs:{},portsIn:[{name:"Variable",value:"autoTransformSpeed"}],portsOut:[{name:"Value",links:[{portIn:"x0ic0h4fm",portOut:"Value",objIn:"3sodhmqvs",objOut:"onyu94me7"},{portIn:"x0ic0h4fm",portOut:"Value",objIn:"64opcwacl",objOut:"onyu94me7"},{portIn:"x0ic0h4fm",portOut:"Value",objIn:"tiwzxtzaz",objOut:"onyu94me7"},{portIn:"x0ic0h4fm",portOut:"Value",objIn:"hj7s4mhgf",objOut:"onyu94me7"},{portIn:"ieb1lbewd",portOut:"Value",objIn:"bop3suw45",objOut:"onyu94me7"},{portIn:"ieb1lbewd",portOut:"Value",objIn:"ekewbwi0y",objOut:"onyu94me7"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"mosg1lz53",uiAttribs:{},portsOut:[{name:"object out",links:[{portIn:"Value",portOut:"object out",objIn:"j2v7lizv8",objOut:"mosg1lz53"}]}],objName:"Ops.Json.SwitchObject"},{id:"dblvyr861",uiAttribs:{},portsIn:[{name:"Variable",value:"nContext"}],portsOut:[{name:"Value",links:[{portIn:"Object Index",portOut:"Value",objIn:"mosg1lz53",objOut:"dblvyr861"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"8ejjb9tja",uiAttribs:{},portsOut:[{name:"object out",links:[{portIn:"Value",portOut:"object out",objIn:"bw5x42j1o",objOut:"8ejjb9tja"}]}],objName:"Ops.Json.SwitchObject"},{id:"hldkm0li0",uiAttribs:{},portsIn:[{name:"Variable",value:"nContext"}],portsOut:[{name:"Value",links:[{portIn:"Object Index",portOut:"Value",objIn:"8ejjb9tja",objOut:"hldkm0li0"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"ya5hiple7",uiAttribs:{},portsIn:[{name:"width",value:8},{name:"height",value:8}],portsOut:[{name:"texture",links:[{portIn:"object port 0",portOut:"texture",objIn:"8ejjb9tja",objOut:"ya5hiple7"}]}],objName:"Ops.Gl.Textures.EmptyTexture"},{id:"i8rjnteob",uiAttribs:{},portsIn:[{name:"width",value:8},{name:"height",value:8}],portsOut:[{name:"texture",links:[{portIn:"object port 1",portOut:"texture",objIn:"mosg1lz53",objOut:"i8rjnteob"}]}],objName:"Ops.Gl.Textures.EmptyTexture"},{id:"e37ngwrk6",uiAttribs:{},portsIn:[{name:"Variable",value:"autoTransformSpeed"}],portsOut:[{name:"Value",links:[{portIn:"x0ic0h4fm",portOut:"Value",objIn:"qish0bdl0",objOut:"e37ngwrk6"},{portIn:"ieb1lbewd",portOut:"Value",objIn:"4vye0rgt0",objOut:"e37ngwrk6"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"1qfvv6m0r",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseTransformSpeed"}],portsOut:[{name:"Value",links:[{portIn:"83lvt4w8p",portOut:"Value",objIn:"4vye0rgt0",objOut:"1qfvv6m0r"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"s8pdb81a8",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseTransformSpeed"}],portsOut:[{name:"Value",links:[{portIn:"83lvt4w8p",portOut:"Value",objIn:"bop3suw45",objOut:"s8pdb81a8"},{portIn:"83lvt4w8p",portOut:"Value",objIn:"ekewbwi0y",objOut:"s8pdb81a8"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"t94xojk09",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"2uzay3xk0",title:"render"},{name:"byk06hys1",title:"Array"},{name:"icoiczvtv",title:"number2"},{name:"6lhmsuqvg",title:"number2"},{name:"09lct6z2t",title:"number2"},{name:"patchId",value:"bp2sub_t94xojk09"}],portsOut:[{name:"driq8l4om",title:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.TransformView trigger",portOut:"driq8l4om",objIn:"hmrwm30er",objOut:"t94xojk09"}]}],objName:"Ops.Patch.PGgjVeu.TransfromFromArray"},{id:"5l8gkfndg",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"2uzay3xk0",title:"render"},{name:"byk06hys1",title:"Array"},{name:"icoiczvtv",value:0,title:"number2"},{name:"6lhmsuqvg",value:0,title:"number2"},{name:"09lct6z2t",value:0,title:"number2"},{name:"patchId",value:"bp2sub_5l8gkfndg"}],portsOut:[{name:"driq8l4om",title:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.TransformView trigger",portOut:"driq8l4om",objIn:"hmrwm30er",objOut:"5l8gkfndg"}]}],objName:"Ops.Patch.PGgjVeu.TransfromFromArray"},{id:"6aubf72ju",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"2uzay3xk0",title:"render"},{name:"byk06hys1",title:"Array"},{name:"icoiczvtv",value:0,title:"number2"},{name:"6lhmsuqvg",value:0,title:"number2"},{name:"09lct6z2t",value:0,title:"number2"},{name:"patchId",value:"bp2sub_6aubf72ju"}],portsOut:[{name:"driq8l4om",title:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.TransformView trigger",portOut:"driq8l4om",objIn:"hmrwm30er",objOut:"6aubf72ju"}]}],objName:"Ops.Patch.PGgjVeu.TransfromFromArray"},{id:"z1150e2ur",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Canvas"},{name:"Width",value:629},{name:"Height",value:822},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],portsOut:[{name:"Next",links:[{portIn:"out1 ShaderToTexture Next",portOut:"Next",objIn:"c2dfdfab-f08f-46c6-8599-9c62d64da7c1",objOut:"z1150e2ur"}]},{name:"Texture",links:[{portIn:"texture0",portOut:"Texture",objIn:"ckns4nxk6",objOut:"z1150e2ur"}]}],objName:"Ops.Gl.Shader.ShaderToTexture_v2"},{id:"5m0nxxnjx",uiAttribs:{},portsIn:[{name:"Identity",value:1},{name:"projection mode index",value:1},{name:"projection mode",value:"ortogonal"},{name:"frustum near",value:.01},{name:"frustum far",value:5e3},{name:"fov",value:45},{name:"Auto Aspect Ratio",value:1},{name:"Aspect Ratio",value:1},{name:"eye X",value:0},{name:"eye Y",value:0},{name:"eye Z",value:5},{name:"center X",value:0},{name:"center Y",value:0},{name:"center Z",value:0},{name:"truck",value:0},{name:"boom",value:0},{name:"dolly",value:0},{name:"tilt",value:0},{name:"pan",value:0},{name:"roll",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"whp28n8pi",objOut:"5m0nxxnjx"}]},{name:"Aspect",value:.7920203735144312}],objName:"Ops.Gl.Matrix.Camera_v2"},{id:"pa2y9tgmx",uiAttribs:{},portsIn:[{name:"Max Pixel Density (DPR)",value:2},{name:"FPS Limit",value:60},{name:"Reduce FPS unfocussed",value:0},{name:"Transparent",value:1},{name:"Focus canvas",value:1}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"9asighuzp",objOut:"pa2y9tgmx"}]},{name:"width",value:933},{name:"height",value:1178},{name:"Pixel Density",value:1}],objName:"Ops.Gl.MainLoop_v2"},{id:"tfqqg918w",uiAttribs:{},portsIn:[{name:"Coordinates index",value:0},{name:"Coordinates",value:"-1 to 1"},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"flip y",value:1},{name:"right click prevent default",value:1},{name:"Touch support",value:1},{name:"Passive Events",value:0},{name:"Active",value:1}],portsOut:[{name:"x",links:[{portIn:"Value",portOut:"x",objIn:"5nstpphfi",objOut:"tfqqg918w"}]},{name:"y",links:[{portIn:"Value",portOut:"y",objIn:"gwuti6sii",objOut:"tfqqg918w"}]},{name:"Button is down",value:0},{name:"Mouse is hovering",value:0},{name:"Movement X",value:-55},{name:"Movement Y",value:55}],objName:"Ops.Devices.Mouse.Mouse_v3"},{id:"fat5zwhg1",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"videoVolume"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"3e2tmhv2w",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoVolume"}],portsOut:[{name:"Value",links:[{portIn:"Volume",portOut:"Value",objIn:"eyn33vy5z",objOut:"3e2tmhv2w"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"yl6uo7iwd",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"create port",value:0}],objName:"Ops.Ui.PatchInput"},{id:"25x1usjms",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"create port",value:0}],objName:"Ops.Ui.PatchOutput"},{id:"mqiiyenot",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"File",display:"file"},{name:"Filter index",value:2},{name:"Filter",value:"mipmap"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Data Format index",value:2},{name:"Data Format",value:"RGB"},{name:"Flip",value:0},{name:"Pre Multiplied Alpha",value:0},{name:"Save Memory",value:1},{name:"Add Cachebuster",value:0}],portsOut:[{name:"Texture",links:[{portIn:"texture1",portOut:"Texture",objIn:"mptrubaza",objOut:"mqiiyenot"}]},{name:"Width",value:8},{name:"Height",value:8},{name:"Aspect Ratio",links:[{portIn:"Value 1",portOut:"Aspect Ratio",objIn:"v7iutdiup",objOut:"mqiiyenot"}]},{name:"Loaded",value:1},{name:"Loading",value:0}],objName:"Ops.Gl.Texture_v2"},{id:"07jpx0656",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"imageUrl"}],portsOut:[{name:"Value",links:[{portIn:"File",portOut:"Value",objIn:"mqiiyenot",objOut:"07jpx0656"}]}],objName:"Ops.Vars.VarGetString"},{id:"mptrubaza",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Default Texture Transparent",value:1}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"yajhn5w3y",objOut:"mptrubaza"}]},{name:"texture",links:[{portIn:"textureInput",portOut:"texture",objIn:"c87z0jk15",objOut:"mptrubaza"},{portIn:"textureInput",portOut:"texture",objIn:"vkffuvjs5",objOut:"mptrubaza"}]}],objName:"Ops.Gl.Textures.SwitchTextures_v2"},{id:"ltd9fwv8x",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"result",links:[{portIn:"num",portOut:"result",objIn:"mptrubaza",objOut:"ltd9fwv8x"}]}],objName:"Ops.Number.Number"},{id:"30j73084r",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"6jfaz4jx0",objOut:"30j73084r"}]}],objName:"Ops.Number.Number"},{id:"krzsl5ib2",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Coordinates index",value:0},{name:"Coordinates",value:"-1 to 1"},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"flip y",value:1},{name:"right click prevent default",value:1},{name:"Touch support",value:1},{name:"Passive Events",value:0}],portsOut:[{name:"x",value:-.9614147909967845},{name:"y",value:-.9049235993208828},{name:"click",links:[{portIn:"Execute",portOut:"click",objIn:"ug116rn9w",objOut:"krzsl5ib2"}]},{name:"Button is down",value:0},{name:"Mouse is hovering",value:0},{name:"Movement X",value:-55},{name:"Movement Y",value:55}],objName:"Ops.Devices.Mouse.Mouse_v3"},{id:"8u2tos4wn",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Default",value:0}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"30j73084r",objOut:"8u2tos4wn"}]}],objName:"Ops.Boolean.ToggleBool_v2"},{id:"ug116rn9w",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Pass Through",value:1}],portsOut:[{name:"Trigger out",links:[{portIn:"trigger",portOut:"Trigger out",objIn:"8u2tos4wn",objOut:"ug116rn9w"}]}],objName:"Ops.Trigger.GateTrigger"},{id:"vmc6cgv1j",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"SearchValue",value:".png"}],portsOut:[{name:"Found",links:[{portIn:"bool 1",portOut:"Found",objIn:"413fbfyl6",objOut:"vmc6cgv1j"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"413fbfyl6",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"bool 4",value:0},{name:"bool 5",value:0},{name:"bool 6",value:0},{name:"bool 7",value:0},{name:"bool 8",value:0},{name:"bool 9",value:0},{name:"bool 10",value:0}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"ltd9fwv8x",objOut:"413fbfyl6"},{portIn:"Value",portOut:"result",objIn:"j8kz0g92r",objOut:"413fbfyl6"},{portIn:"Active",portOut:"result",objIn:"mqiiyenot",objOut:"413fbfyl6"}]}],objName:"Ops.Boolean.Or"},{id:"0lyyb4yby",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"imageUrl"}],portsOut:[{name:"Value",links:[{portIn:"String",portOut:"Value",objIn:"vmc6cgv1j",objOut:"0lyyb4yby"},{portIn:"String",portOut:"Value",objIn:"satazrah8",objOut:"0lyyb4yby"},{portIn:"String",portOut:"Value",objIn:"gxsj3bwhu",objOut:"0lyyb4yby"}]}],objName:"Ops.Vars.VarGetString"},{id:"satazrah8",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"SearchValue",value:".jpg"}],portsOut:[{name:"Found",links:[{portIn:"bool 2",portOut:"Found",objIn:"413fbfyl6",objOut:"satazrah8"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"gxsj3bwhu",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"SearchValue",value:".jpeg"}],portsOut:[{name:"Found",links:[{portIn:"bool 3",portOut:"Found",objIn:"413fbfyl6",objOut:"gxsj3bwhu"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"j8kz0g92r",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"isImage"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"0sc5m32xg",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"in bool",portOut:"Value",objIn:"n7muwi1ew",objOut:"0sc5m32xg"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"n7muwi1ew",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"out bool",links:[{portIn:"Active",portOut:"out bool",objIn:"krzsl5ib2",objOut:"n7muwi1ew"}]}],objName:"Ops.Extension.Deprecated.ToggleBoolValue"},{id:"ne7q3e7w5",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"videoUrl"}],portsOut:[{name:"Value",links:[{portIn:"String",portOut:"Value",objIn:"ky8kt5sac",objOut:"ne7q3e7w5"}]}],objName:"Ops.Vars.VarGetString"},{id:"ky8kt5sac",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"Changed",links:[{portIn:"exe",portOut:"Changed",objIn:"0ci8k5s6u",objOut:"ky8kt5sac"}]}],objName:"Ops.Trigger.TriggerOnChangeString"},{id:"kwsjb3e3r",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"o4dg9dseu",objOut:"kwsjb3e3r"},{portIn:"Value",portOut:"Value",objIn:"sus3syf9y",objOut:"kwsjb3e3r"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"o4dg9dseu",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"Next",links:[{portIn:"trigger",portOut:"Next",objIn:"8u2tos4wn",objOut:"o4dg9dseu"}]}],objName:"Ops.Boolean.TriggerChangedFalse"},{id:"sus3syf9y",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"Next",links:[{portIn:"reset",portOut:"Next",objIn:"8u2tos4wn",objOut:"sus3syf9y"}]}],objName:"Ops.Boolean.TriggerChangedTrue"},{id:"0ci8k5s6u",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"delay",value:.1}],portsOut:[{name:"Delaying",value:false}],objName:"Ops.Trigger.DelayedTrigger"},{id:"wiyj97f1x",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"videoAspectRatio"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"4bwladdi7",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"videoLoaded"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"dpwshd4x7",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"in bool",value:0}],portsOut:[{name:"out bool",links:[{portIn:"Value",portOut:"out bool",objIn:"4bwladdi7",objOut:"dpwshd4x7"}]}],objName:"Ops.Extension.Deprecated.ToggleBoolValue"},{id:"tptvqh0nq",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"number",value:1}],objName:"Ops.Trigger.NumberByTrigger"},{id:"ax8z0tzw3",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Named Trigger",value:"loaded"}],portsOut:[{name:"Triggered",links:[{portIn:"exe",portOut:"Triggered",objIn:"stcfkxcvu",objOut:"ax8z0tzw3"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"stcfkxcvu",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"delay",value:.1}],portsOut:[{name:"next",links:[{portIn:"1",portOut:"next",objIn:"tptvqh0nq",objOut:"stcfkxcvu"},{portIn:"trigger",portOut:"next",objIn:"8u2tos4wn",objOut:"stcfkxcvu"}]},{name:"Delaying",value:false}],objName:"Ops.Trigger.DelayedTrigger"},{id:"vhr7ptkqz",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Named Trigger",value:"controlPlay"}],portsOut:[{name:"Triggered",links:[{portIn:"trigger",portOut:"Triggered",objIn:"8u2tos4wn",objOut:"vhr7ptkqz"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"6jfaz4jx0",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"playerStatus"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"c87z0jk15",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Fragment Code",value:"IN vec2 texCoord;\r\nUNI vec2 offset;  // Offset in X and Y directions\r\nUNI vec2 repeat;  // Repeat in X and Y directions\r\nUNI sampler2D textureInput;\r\n{{MODULES_HEAD}}\r\nvoid main()\r\n{\r\n    vec2 uv = texCoord * repeat + offset; // Apply offset and repeat\r\n    // Wrap UV coordinates to ensure they stay within the [0, 1] range\r\n    uv = fract(uv);\r\n    {{MODULE_COLOR}}\r\n    outColor = texture(textureInput, uv); // Sample the texture using modified coordinates\r\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"repeat Y",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"1eq7vvnuo",objOut:"c87z0jk15"}]},{name:"Shader",links:[{portIn:"object port 2",portOut:"Shader",objIn:"cwdmvq262",objOut:"c87z0jk15"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"v7iutdiup",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Value 0",value:0},{name:"Value 2",value:0},{name:"Value 3",value:0},{name:"Value 4",value:0},{name:"Value 5",value:0},{name:"Value 6",value:0},{name:"Value 7",value:0},{name:"Value 8",value:0},{name:"Value 9",value:0},{name:"Value 10",value:0},{name:"Value 11",value:0},{name:"Value 12",value:0},{name:"Value 13",value:0},{name:"Value 14",value:0},{name:"Value 15",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"wiyj97f1x",objOut:"v7iutdiup"}]}],objName:"Ops.Number.SwitchNumber"},{id:"x6fu80fvb",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"v7iutdiup",objOut:"x6fu80fvb"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"7pibudbz8",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"videoPlay"}],portsOut:[{name:"Value",value:1}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"dhvqxgqt0",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"videoMuted"}],portsOut:[{name:"Value",value:0}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"vkffuvjs5",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Fragment Code",value:"IN vec2 texCoord;\r\nUNI vec2 offset;\r\nUNI vec2 repeat;\r\nUNI bool wrapMode;  // Add this uniform\r\nUNI sampler2D textureInput;\r\n{{MODULES_HEAD}}\r\nvoid main()\r\n{\r\n    // Start with original texture coordinates\r\n    vec2 uv = texCoord;\r\n    \r\n    // Flip Y before repetition so pattern starts from top\r\n    uv.y = 1.0 - uv.y;\r\n    \r\n    // Create vertical repetition\r\n    uv.y *= repeat.y;\r\n    \r\n    // Apply offset\r\n    uv += offset;\r\n    \r\n    // Switch between wrap and clamp modes\r\n    uv = wrapMode ? fract(uv) : clamp(uv, 0.0, 1.0);\r\n    \r\n    // Flip Y again to maintain correct image orientation\r\n    uv.y = 1.0 - uv.y;\r\n    \r\n    {{MODULE_COLOR}}\r\n    outColor = texture(textureInput, uv);\r\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"repeat X",value:1},{name:"wrapMode",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"1eq7vvnuo",objOut:"vkffuvjs5"}]},{name:"Shader",links:[{portIn:"object port 0",portOut:"Shader",objIn:"cwdmvq262",objOut:"vkffuvjs5"},{portIn:"object port 1",portOut:"Shader",objIn:"cwdmvq262",objOut:"vkffuvjs5"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"gph059tic",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"mediaQuery"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"yajhn5w3y",objOut:"gph059tic"}]}],objName:"Ops.Vars.VarGetString"},{id:"yajhn5w3y",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"String 0",value:"mq1"},{name:"String 1",value:"mq2"},{name:"String 2",value:"mq3"},{name:"String 3",value:""},{name:"String 4",value:""},{name:"String 5",value:""},{name:"String 6",value:""},{name:"String 7",value:""},{name:"String 8",value:""},{name:"String 9",value:""},{name:"String 10",value:""},{name:"String 11",value:""},{name:"String 12",value:""},{name:"String 13",value:""},{name:"String 14",value:""},{name:"String 15",value:""},{name:"String 16",value:""},{name:"String 17",value:""},{name:"String 18",value:""},{name:"String 19",value:""},{name:"String 20",value:""},{name:"String 21",value:""},{name:"String 22",value:""},{name:"String 23",value:""}],portsOut:[{name:"Next Trigger",links:[{portIn:"0b4ut0hih",portOut:"Next Trigger",objIn:"3gkuygz7u",objOut:"yajhn5w3y"}]},{name:"Switched Index",links:[{portIn:"Object Index",portOut:"Switched Index",objIn:"cwdmvq262",objOut:"yajhn5w3y"}]},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"vkffuvjs5",objOut:"yajhn5w3y"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"vkffuvjs5",objOut:"yajhn5w3y"}]},{name:"Trigger 2",links:[{portIn:"render",portOut:"Trigger 2",objIn:"c87z0jk15",objOut:"yajhn5w3y"}]}],objName:"Ops.Trigger.RouteTriggerString_v2"},{id:"rtx16k20q",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"result",links:[{portIn:"repeat Y",portOut:"result",objIn:"vkffuvjs5",objOut:"rtx16k20q"}]}],objName:"Ops.Math.Divide"},{id:"cwdmvq262",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsOut:[{name:"object out",links:[{portIn:"Shader",portOut:"object out",objIn:"1eq7vvnuo",objOut:"cwdmvq262"}]}],objName:"Ops.Json.SwitchObject"},{id:"ev6i2yr9f",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"videoAspectRatio"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"rtx16k20q",objOut:"ev6i2yr9f"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"y6og2hwzq",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Variable",value:"imageTextureOffset"}],portsOut:[{name:"Value",links:[{portIn:"array",portOut:"Value",objIn:"y7v7c5bfn",objOut:"y6og2hwzq"},{portIn:"array",portOut:"Value",objIn:"c0b9l9hl0",objOut:"y6og2hwzq"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"y7v7c5bfn",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"index",value:0},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"offset X",portOut:"value",objIn:"vkffuvjs5",objOut:"y7v7c5bfn"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"c0b9l9hl0",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"index",value:1},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"offset Y",portOut:"value",objIn:"vkffuvjs5",objOut:"c0b9l9hl0"},{portIn:"offset Y",portOut:"value",objIn:"c87z0jk15",objOut:"c0b9l9hl0"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"1eq7vvnuo",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},portsIn:[{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"Width",value:629},{name:"Height",value:822},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],objName:"Ops.Gl.Shader.ShaderToTexture_v2"},{id:"3gkuygz7u",uiAttribs:{subPatch:"ada365e8-754a-450f-9fdb-6dc6f8348b73"},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"0b4ut0hih",title:"Next"},{name:"nwr6evmz4",value:0,title:"number2"},{name:"patchId",value:"bp2sub_3gkuygz7u"}],portsOut:[{name:"2u90hfuze",title:"result",links:[{portIn:"repeat X",portOut:"2u90hfuze",objIn:"c87z0jk15",objOut:"3gkuygz7u"}]},{name:"5vd4oouaz",title:"result",links:[{portIn:"offset X",portOut:"5vd4oouaz",objIn:"c87z0jk15",objOut:"3gkuygz7u"}]},{name:"0c3imfas6",title:"Aspect Ratio",links:[{portIn:"number2",portOut:"0c3imfas6",objIn:"rtx16k20q",objOut:"3gkuygz7u"}]}],objName:"Ops.Patch.PGgjVeu.CalcAspectRatio"},{id:"xtuub3saj",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"create port",value:0}],objName:"Ops.Ui.PatchInput"},{id:"fen6fhqkq",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"create port",value:0}],objName:"Ops.Ui.PatchOutput"},{id:"tu2a8v5ck",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"File",display:"file"},{name:"Filter index",value:2},{name:"Filter",value:"mipmap"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Data Format index",value:2},{name:"Data Format",value:"RGB"},{name:"Flip",value:0},{name:"Pre Multiplied Alpha",value:0},{name:"Save Memory",value:1},{name:"Add Cachebuster",value:0}],portsOut:[{name:"Texture",links:[{portIn:"texture1",portOut:"Texture",objIn:"bdmwf26v0",objOut:"tu2a8v5ck"}]},{name:"Width",value:8},{name:"Height",value:8},{name:"Aspect Ratio",links:[{portIn:"Value 1",portOut:"Aspect Ratio",objIn:"80ajp6rzd",objOut:"tu2a8v5ck"}]},{name:"Loaded",value:1},{name:"Loading",value:0}],objName:"Ops.Gl.Texture_v2"},{id:"p1253zkoi",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"imageUrl"}],portsOut:[{name:"Value",links:[{portIn:"File",portOut:"Value",objIn:"tu2a8v5ck",objOut:"p1253zkoi"}]}],objName:"Ops.Vars.VarGetString"},{id:"bdmwf26v0",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Default Texture Transparent",value:1}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"z8uq6ktyr",objOut:"bdmwf26v0"}]},{name:"texture",links:[{portIn:"textureInput",portOut:"texture",objIn:"enqnruvga",objOut:"bdmwf26v0"},{portIn:"textureInput",portOut:"texture",objIn:"cqqbqd5vt",objOut:"bdmwf26v0"}]}],objName:"Ops.Gl.Textures.SwitchTextures_v2"},{id:"fsmchdfgj",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"result",links:[{portIn:"num",portOut:"result",objIn:"bdmwf26v0",objOut:"fsmchdfgj"}]}],objName:"Ops.Number.Number"},{id:"5jiuge1ek",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"5hrnuaisr",objOut:"5jiuge1ek"}]}],objName:"Ops.Number.Number"},{id:"qwie2xjyr",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Coordinates index",value:0},{name:"Coordinates",value:"-1 to 1"},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"flip y",value:1},{name:"right click prevent default",value:1},{name:"Touch support",value:1},{name:"Passive Events",value:0}],portsOut:[{name:"x",value:-.9614147909967845},{name:"y",value:-.9049235993208828},{name:"click",links:[{portIn:"Execute",portOut:"click",objIn:"p6cx7vfg4",objOut:"qwie2xjyr"}]},{name:"Button is down",value:0},{name:"Mouse is hovering",value:0},{name:"Movement X",value:-55},{name:"Movement Y",value:55}],objName:"Ops.Devices.Mouse.Mouse_v3"},{id:"uuhhvqn7z",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Default",value:0}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"5jiuge1ek",objOut:"uuhhvqn7z"}]}],objName:"Ops.Boolean.ToggleBool_v2"},{id:"p6cx7vfg4",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Pass Through",value:1}],portsOut:[{name:"Trigger out",links:[{portIn:"trigger",portOut:"Trigger out",objIn:"uuhhvqn7z",objOut:"p6cx7vfg4"}]}],objName:"Ops.Trigger.GateTrigger"},{id:"735d88za5",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"SearchValue",value:".png"}],portsOut:[{name:"Found",links:[{portIn:"bool 1",portOut:"Found",objIn:"edkkq9raq",objOut:"735d88za5"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"edkkq9raq",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"bool 4",value:0},{name:"bool 5",value:0},{name:"bool 6",value:0},{name:"bool 7",value:0},{name:"bool 8",value:0},{name:"bool 9",value:0},{name:"bool 10",value:0}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"fsmchdfgj",objOut:"edkkq9raq"},{portIn:"Value",portOut:"result",objIn:"rnxqejn8u",objOut:"edkkq9raq"},{portIn:"Active",portOut:"result",objIn:"tu2a8v5ck",objOut:"edkkq9raq"}]}],objName:"Ops.Boolean.Or"},{id:"tsslfu5ih",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"imageUrl"}],portsOut:[{name:"Value",links:[{portIn:"String",portOut:"Value",objIn:"735d88za5",objOut:"tsslfu5ih"},{portIn:"String",portOut:"Value",objIn:"3ecmdnjtw",objOut:"tsslfu5ih"},{portIn:"String",portOut:"Value",objIn:"t05194lr2",objOut:"tsslfu5ih"}]}],objName:"Ops.Vars.VarGetString"},{id:"3ecmdnjtw",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"SearchValue",value:".jpg"}],portsOut:[{name:"Found",links:[{portIn:"bool 2",portOut:"Found",objIn:"edkkq9raq",objOut:"3ecmdnjtw"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"t05194lr2",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"SearchValue",value:".jpeg"}],portsOut:[{name:"Found",links:[{portIn:"bool 3",portOut:"Found",objIn:"edkkq9raq",objOut:"t05194lr2"}]},{name:"Index",value:-1}],objName:"Ops.String.StringContains_v2"},{id:"rnxqejn8u",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"isImage"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"tykdjmkog",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"in bool",portOut:"Value",objIn:"f7sf7txz2",objOut:"tykdjmkog"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"f7sf7txz2",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"out bool",links:[{portIn:"Active",portOut:"out bool",objIn:"qwie2xjyr",objOut:"f7sf7txz2"}]}],objName:"Ops.Extension.Deprecated.ToggleBoolValue"},{id:"ifvd8th9a",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"videoUrl"}],portsOut:[{name:"Value",links:[{portIn:"String",portOut:"Value",objIn:"enosh9xcr",objOut:"ifvd8th9a"}]}],objName:"Ops.Vars.VarGetString"},{id:"enosh9xcr",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"Changed",links:[{portIn:"exe",portOut:"Changed",objIn:"o2rijj0hg",objOut:"enosh9xcr"}]}],objName:"Ops.Trigger.TriggerOnChangeString"},{id:"ooqrxtc97",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"rbkbwqaud",objOut:"ooqrxtc97"},{portIn:"Value",portOut:"Value",objIn:"qudnck0cb",objOut:"ooqrxtc97"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"rbkbwqaud",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"Next",links:[{portIn:"trigger",portOut:"Next",objIn:"uuhhvqn7z",objOut:"rbkbwqaud"}]}],objName:"Ops.Boolean.TriggerChangedFalse"},{id:"qudnck0cb",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"Next",links:[{portIn:"reset",portOut:"Next",objIn:"uuhhvqn7z",objOut:"qudnck0cb"}]}],objName:"Ops.Boolean.TriggerChangedTrue"},{id:"o2rijj0hg",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"delay",value:.1}],portsOut:[{name:"Delaying",value:false}],objName:"Ops.Trigger.DelayedTrigger"},{id:"sleqw2ws1",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"videoAspectRatio"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"qoxy7lel2",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"videoLoaded"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"1id45v5nd",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"in bool",value:0}],portsOut:[{name:"out bool",links:[{portIn:"Value",portOut:"out bool",objIn:"qoxy7lel2",objOut:"1id45v5nd"}]}],objName:"Ops.Extension.Deprecated.ToggleBoolValue"},{id:"bgx1jya8s",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"number",value:1}],objName:"Ops.Trigger.NumberByTrigger"},{id:"i2yx42fpy",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Named Trigger",value:"loaded"}],portsOut:[{name:"Triggered",links:[{portIn:"exe",portOut:"Triggered",objIn:"fa5uqih6e",objOut:"i2yx42fpy"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"fa5uqih6e",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"delay",value:.1}],portsOut:[{name:"next",links:[{portIn:"1",portOut:"next",objIn:"bgx1jya8s",objOut:"fa5uqih6e"},{portIn:"trigger",portOut:"next",objIn:"uuhhvqn7z",objOut:"fa5uqih6e"}]},{name:"Delaying",value:false}],objName:"Ops.Trigger.DelayedTrigger"},{id:"ibookfh8c",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Named Trigger",value:"controlPlay"}],portsOut:[{name:"Triggered",links:[{portIn:"trigger",portOut:"Triggered",objIn:"uuhhvqn7z",objOut:"ibookfh8c"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"5hrnuaisr",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"playerStatus"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"enqnruvga",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Fragment Code",value:"IN vec2 texCoord;\r\nUNI vec2 offset;  // Offset in X and Y directions\r\nUNI vec2 repeat;  // Repeat in X and Y directions\r\nUNI sampler2D textureInput;\r\n{{MODULES_HEAD}}\r\nvoid main()\r\n{\r\n    vec2 uv = texCoord * repeat + offset; // Apply offset and repeat\r\n    // Wrap UV coordinates to ensure they stay within the [0, 1] range\r\n    uv = fract(uv);\r\n    {{MODULE_COLOR}}\r\n    outColor = texture(textureInput, uv); // Sample the texture using modified coordinates\r\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"repeat Y",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"adnq29ti7",objOut:"enqnruvga"}]},{name:"Shader",links:[{portIn:"object port 2",portOut:"Shader",objIn:"nb84w66p0",objOut:"enqnruvga"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"80ajp6rzd",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Value 0",value:0},{name:"Value 2",value:0},{name:"Value 3",value:0},{name:"Value 4",value:0},{name:"Value 5",value:0},{name:"Value 6",value:0},{name:"Value 7",value:0},{name:"Value 8",value:0},{name:"Value 9",value:0},{name:"Value 10",value:0},{name:"Value 11",value:0},{name:"Value 12",value:0},{name:"Value 13",value:0},{name:"Value 14",value:0},{name:"Value 15",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"sleqw2ws1",objOut:"80ajp6rzd"}]}],objName:"Ops.Number.SwitchNumber"},{id:"3gdenl6ie",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"isImage"}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"80ajp6rzd",objOut:"3gdenl6ie"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"exefzqhe7",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"videoPlay"}],portsOut:[{name:"Value",value:1}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"rq5vdxas2",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"videoMuted"}],portsOut:[{name:"Value",value:0}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"cqqbqd5vt",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Fragment Code",value:"IN vec2 texCoord;\r\nUNI vec2 offset;\r\nUNI vec2 repeat;\r\nUNI bool wrapMode;  // Add this uniform\r\nUNI sampler2D textureInput;\r\n{{MODULES_HEAD}}\r\nvoid main()\r\n{\r\n    // Start with original texture coordinates\r\n    vec2 uv = texCoord;\r\n    \r\n    // Flip Y before repetition so pattern starts from top\r\n    uv.y = 1.0 - uv.y;\r\n    \r\n    // Create vertical repetition\r\n    uv.y *= repeat.y;\r\n    \r\n    // Apply offset\r\n    uv += offset;\r\n    \r\n    // Switch between wrap and clamp modes\r\n    uv = wrapMode ? fract(uv) : clamp(uv, 0.0, 1.0);\r\n    \r\n    // Flip Y again to maintain correct image orientation\r\n    uv.y = 1.0 - uv.y;\r\n    \r\n    {{MODULE_COLOR}}\r\n    outColor = texture(textureInput, uv);\r\n}"},{name:"Vertex Code",value:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},{name:"Use As Material",value:0},{name:"repeat X",value:1},{name:"wrapMode",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"adnq29ti7",objOut:"cqqbqd5vt"}]},{name:"Shader",links:[{portIn:"object port 0",portOut:"Shader",objIn:"nb84w66p0",objOut:"cqqbqd5vt"},{portIn:"object port 1",portOut:"Shader",objIn:"nb84w66p0",objOut:"cqqbqd5vt"}]},{name:"Has Errors",value:false}],objName:"Ops.Gl.Shader.CustomShader_v2"},{id:"xygfzibgc",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"mediaQuery"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"z8uq6ktyr",objOut:"xygfzibgc"}]}],objName:"Ops.Vars.VarGetString"},{id:"z8uq6ktyr",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"String 0",value:"mq1"},{name:"String 1",value:"mq2"},{name:"String 2",value:"mq3"},{name:"String 3",value:""},{name:"String 4",value:""},{name:"String 5",value:""},{name:"String 6",value:""},{name:"String 7",value:""},{name:"String 8",value:""},{name:"String 9",value:""},{name:"String 10",value:""},{name:"String 11",value:""},{name:"String 12",value:""},{name:"String 13",value:""},{name:"String 14",value:""},{name:"String 15",value:""},{name:"String 16",value:""},{name:"String 17",value:""},{name:"String 18",value:""},{name:"String 19",value:""},{name:"String 20",value:""},{name:"String 21",value:""},{name:"String 22",value:""},{name:"String 23",value:""}],portsOut:[{name:"Next Trigger",links:[{portIn:"0b4ut0hih",portOut:"Next Trigger",objIn:"ni0uhikgc",objOut:"z8uq6ktyr"}]},{name:"Switched Index",links:[{portIn:"Object Index",portOut:"Switched Index",objIn:"nb84w66p0",objOut:"z8uq6ktyr"}]},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"cqqbqd5vt",objOut:"z8uq6ktyr"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"cqqbqd5vt",objOut:"z8uq6ktyr"}]},{name:"Trigger 2",links:[{portIn:"render",portOut:"Trigger 2",objIn:"enqnruvga",objOut:"z8uq6ktyr"}]}],objName:"Ops.Trigger.RouteTriggerString_v2"},{id:"ie3zj6zws",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"result",links:[{portIn:"repeat Y",portOut:"result",objIn:"cqqbqd5vt",objOut:"ie3zj6zws"}]}],objName:"Ops.Math.Divide"},{id:"nb84w66p0",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsOut:[{name:"object out",links:[{portIn:"Shader",portOut:"object out",objIn:"adnq29ti7",objOut:"nb84w66p0"}]}],objName:"Ops.Json.SwitchObject"},{id:"et1ufqrpt",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"videoAspectRatio"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"ie3zj6zws",objOut:"et1ufqrpt"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"ef9v64zzt",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"imageTextureOffset"}],portsOut:[{name:"Value",links:[{portIn:"array",portOut:"Value",objIn:"vpigyv7x7",objOut:"ef9v64zzt"},{portIn:"array",portOut:"Value",objIn:"s72c0eehd",objOut:"ef9v64zzt"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"vpigyv7x7",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"index",value:0},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"offset X",portOut:"value",objIn:"cqqbqd5vt",objOut:"vpigyv7x7"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"s72c0eehd",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"index",value:1},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"offset Y",portOut:"value",objIn:"cqqbqd5vt",objOut:"s72c0eehd"},{portIn:"offset Y",portOut:"value",objIn:"enqnruvga",objOut:"s72c0eehd"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"adnq29ti7",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"Width",value:629},{name:"Height",value:822},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Num Textures index",value:0},{name:"Num Textures",value:"1"}],objName:"Ops.Gl.Shader.ShaderToTexture_v2"},{id:"ni0uhikgc",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"0b4ut0hih",title:"Next"},{name:"nwr6evmz4",value:0,title:"number2"},{name:"patchId",value:"bp2sub_ni0uhikgc"}],portsOut:[{name:"2u90hfuze",title:"result",links:[{portIn:"repeat X",portOut:"2u90hfuze",objIn:"enqnruvga",objOut:"ni0uhikgc"}]},{name:"5vd4oouaz",title:"result",links:[{portIn:"offset X",portOut:"5vd4oouaz",objIn:"enqnruvga",objOut:"ni0uhikgc"}]},{name:"0c3imfas6",title:"Aspect Ratio",links:[{portIn:"number2",portOut:"0c3imfas6",objIn:"ie3zj6zws",objOut:"ni0uhikgc"}]}],objName:"Ops.Patch.PGgjVeu.CalcAspectRatio"},{id:"vw4za3uwo",uiAttribs:{subPatch:"13704e35-26e9-43b4-a28f-ca3749c1ccbe"},portsIn:[{name:"Variable",value:"videoVolume"}],portsOut:[{name:"Value",value:0}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"ko5qliv40",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"5zoeeizsf",value:0,title:"number2"},{name:"stqfp1svi",title:"trigger"},{name:"patchId",value:"bp2sub_ko5qliv40"}],portsOut:[{name:"4kaudq7u5",title:"result",links:[{portIn:"offset X",portOut:"4kaudq7u5",objIn:"v38pi7nzw",objOut:"ko5qliv40"}]},{name:"9zwxt98wb",title:"result",links:[{portIn:"repeat X",portOut:"9zwxt98wb",objIn:"v38pi7nzw",objOut:"ko5qliv40"}]},{name:"bf11i75lz",title:"Aspect Ratio",links:[{portIn:"number2",portOut:"bf11i75lz",objIn:"exw5m949c",objOut:"ko5qliv40"}]}],objName:"Ops.User.srcphag.CalcAspectRatio"},{id:"eyn33vy5z",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"file",display:"file"},{name:"loop",value:1},{name:"Update FPS",value:30},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:2},{name:"Wrap",value:"clamp to edge"},{name:"flip",value:1},{name:"set time",value:0},{name:"Preload",value:1},{name:"Show Interaction needed Button",value:0}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"rdlyyv1x4",objOut:"eyn33vy5z"}]},{name:"texture",links:[{portIn:"texture0",portOut:"texture",objIn:"wm3l5lbrt",objOut:"eyn33vy5z"},{portIn:"texture1",portOut:"texture",objIn:"ckns4nxk6",objOut:"eyn33vy5z"}]},{name:"duration",value:90.52},{name:"progress",value:.4076185594343792},{name:"Interaction Needed",value:0},{name:"CurrentTime",value:36.897632},{name:"Loading",links:[{portIn:"in bool",portOut:"Loading",objIn:"k66hq3ihz",objOut:"eyn33vy5z"}]},{name:"Playing",value:1},{name:"Can Play Through",value:1},{name:"Width",value:2560},{name:"Height",value:1440},{name:"Aspect Ratio",links:[{portIn:"Value 0",portOut:"Aspect Ratio",objIn:"728bc2af-66ca-4c6f-a6d4-2b51f809033d",objOut:"eyn33vy5z"}]},{name:"Has Error",value:0},{name:"Auto FPS",value:1},{name:"Error Message",value:""}],objName:"Ops.User.srcphag.videoTextureHLS2"},{id:"6gtc49w78",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"pfte9k45v",objOut:"6gtc49w78"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"mojndcesc",objOut:"6gtc49w78"},{portIn:"Image",portOut:"texture_out",objIn:"a5t68mtsd",objOut:"6gtc49w78"}]},{name:"Aspect Ratio",value:.7920203735144312},{name:"Texture Width",value:933},{name:"Texture Height",value:1178}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"c42c5i0kd",uiAttribs:{},portsIn:[{name:"Scale index",value:1},{name:"Scale",value:"Fit"},{name:"Flip Y",value:0},{name:"Flip X",value:0}],objName:"Ops.Gl.Meshes.FullscreenRectangle_v2"},{id:"9asighuzp",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"jhe4er6a9",objOut:"9asighuzp"}]},{name:"trigger 2",links:[{portIn:"exe",portOut:"trigger 2",objIn:"w4s56n8zo",objOut:"9asighuzp"}]},{name:"trigger 3",links:[{portIn:"Render",portOut:"trigger 3",objIn:"6gtc49w78",objOut:"9asighuzp"}]},{name:"trigger 4",links:[{portIn:"Render",portOut:"trigger 4",objIn:"gc2e4sas5",objOut:"9asighuzp"}]},{name:"trigger 15",links:[{portIn:"render",portOut:"trigger 15",objIn:"c42c5i0kd",objOut:"9asighuzp"}]}],objName:"Ops.Trigger.Sequence"},{id:"mojndcesc",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"jhe4er6a9",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Canvas"},{name:"texture width",value:933},{name:"texture height",value:1178},{name:"Auto Aspect",value:1},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"Repeat"},{name:"MSAA index",value:0},{name:"MSAA",value:"none"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Depth",value:1},{name:"Clear",value:1}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"hdbfyi4so",objOut:"jhe4er6a9"}]},{name:"texture",links:[{portIn:"Value",portOut:"texture",objIn:"s53gq52lt",objOut:"jhe4er6a9"}]}],objName:"Ops.Gl.RenderToTexture_v3"},{id:"jc64np4cs",uiAttribs:{},portsIn:[{name:"Size index",value:1},{name:"Size",value:"Canvas"},{name:"Width",value:200},{name:"Height",value:200},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"eivf5lesh",objOut:"jc64np4cs"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"qxadgrvdt",objOut:"jc64np4cs"},{portIn:"Texture",portOut:"texture_out",objIn:"dg83r11dd",objOut:"jc64np4cs"},{portIn:"image",portOut:"texture_out",objIn:"nxslzhd8k",objOut:"jc64np4cs"},{portIn:"Value",portOut:"texture_out",objIn:"7c0t7n96s",objOut:"jc64np4cs"}]},{name:"Aspect Ratio",value:.7920203735144312},{name:"Texture Width",value:933},{name:"Texture Height",value:1178}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"qxadgrvdt",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"jhu7n8je2",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Shape index",value:3},{name:"Shape",value:"box"},{name:"Mirror X",value:0},{name:"Mirror Y",value:0},{name:"fillShape",value:1},{name:"Line thickness",value:0},{name:"Invert color",value:0},{name:"width",title:"Width"},{name:"Rotate",value:0},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"dmgmkfdso",objOut:"jhu7n8je2"}]}],objName:"Ops.Gl.ImageCompose.Shapes2d_v2"},{id:"nxslzhd8k",uiAttribs:{},portsIn:[{name:"Amount",value:1},{name:"Method index",value:1},{name:"Method",value:"Mul"},{name:"Invert",value:0},{name:"method index",value:0},{name:"method",value:"luminance"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"vt4xre74r",objOut:"nxslzhd8k"}]}],objName:"Ops.Gl.ImageCompose.AlphaMask_v2"},{id:"pfte9k45v",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:6},{name:"Blend Mode",value:"add"},{name:"Amount",value:1},{name:"width",value:100},{name:"height",value:100}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"nxslzhd8k",objOut:"pfte9k45v"}]}],objName:"Ops.Gl.ImageCompose.Pixelate_v2"},{id:"4lio9i46g",uiAttribs:{},portsIn:[{name:"Amount",value:.862},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Seed",value:1.2},{name:"frequency",value:1},{name:"strength",value:1},{name:"Block size small x",value:100},{name:"Block size small y",value:100},{name:"Block size large x",value:49.77},{name:"Block size large y",value:25.62},{name:"Scroll X",value:-1.732},{name:"Scroll Y",value:0}],objName:"Ops.Gl.ImageCompose.Noise.GlitchNoise_v2"},{id:"4ttdxv9y1",uiAttribs:{},portsIn:[{name:"Size index",value:1},{name:"Size",value:"Canvas"},{name:"Width",value:500},{name:"Height",value:500},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"4lio9i46g",objOut:"4ttdxv9y1"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"6b25k4muz",objOut:"4ttdxv9y1"},{portIn:"displaceTex",portOut:"texture_out",objIn:"dmgmkfdso",objOut:"4ttdxv9y1"},{portIn:"Image",portOut:"texture_out",objIn:"4f06jwk3u",objOut:"4ttdxv9y1"}]},{name:"Aspect Ratio",value:.7920203735144312},{name:"Texture Width",value:933},{name:"Texture Height",value:1178}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"6b25k4muz",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"w4s56n8zo",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"Update",portOut:"trigger 0",objIn:"n0t34buql",objOut:"w4s56n8zo"},{portIn:"Update",portOut:"trigger 0",objIn:"e1yfqfuvz",objOut:"w4s56n8zo"}]},{name:"trigger 1",links:[{portIn:"Render",portOut:"trigger 1",objIn:"4ttdxv9y1",objOut:"w4s56n8zo"}]},{name:"trigger 2",links:[{portIn:"Render",portOut:"trigger 2",objIn:"jc64np4cs",objOut:"w4s56n8zo"}]},{name:"trigger 3",links:[{portIn:"render",portOut:"trigger 3",objIn:"dg83r11dd",objOut:"w4s56n8zo"}]}],objName:"Ops.Trigger.Sequence"},{id:"dmgmkfdso",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"amount X",value:.1},{name:"amount Y",value:.1},{name:"Wrap index",value:1},{name:"Wrap",value:"Clamp"},{name:"Input index",value:0},{name:"Input",value:"Luminance"},{name:"Zero Displace index",value:1},{name:"Zero Displace",value:"Black"},{name:"Pixel Mapping index",value:0},{name:"Pixel Mapping",value:"Stretch"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"pn57ashc4",objOut:"dmgmkfdso"}]}],objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"},{id:"dg83r11dd",uiAttribs:{},portsIn:[{name:"use original size",value:1},{name:"width",value:933},{name:"height",value:1178},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"A"},{name:"Convert Greyscale index",value:0},{name:"Convert Greyscale",value:"Off"},{name:"Invert R",value:0},{name:"Invert G",value:0},{name:"Invert B",value:0},{name:"Invert A",value:0},{name:"Flip X",value:0},{name:"Flip Y",value:0}],portsOut:[{name:"texture_out",links:[{portIn:"Image",portOut:"texture_out",objIn:"eivf5lesh",objOut:"dg83r11dd"}]},{name:"Aspect Ratio",value:.7920203735144312}],objName:"Ops.Gl.Textures.CopyTexture_v3"},{id:"eivf5lesh",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"jhu7n8je2",objOut:"eivf5lesh"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"a5t68mtsd",uiAttribs:{},portsIn:[{name:"blendMode index",value:12},{name:"blendMode",value:"screen"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"gc2e4sas5",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"ydxp9snhu",objOut:"gc2e4sas5"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"c42c5i0kd",objOut:"gc2e4sas5"},{portIn:"Texture In",portOut:"texture_out",objIn:"i3920ylwn",objOut:"gc2e4sas5"}]},{name:"Aspect Ratio",value:.7920203735144312},{name:"Texture Width",value:933},{name:"Texture Height",value:1178}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"s53gq52lt",uiAttribs:{},portsIn:[{name:"Variable",value:"mainRender"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"c80f30bcl",uiAttribs:{},portsIn:[{name:"Variable",value:"mainRender"}],portsOut:[{name:"Value",links:[{portIn:"Base Texture",portOut:"Value",objIn:"gc2e4sas5",objOut:"c80f30bcl"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"2yp9szl68",uiAttribs:{},portsIn:[{name:"Value",value:1},{name:"Variable",value:"trailAmmount"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"c55i36n9u",uiAttribs:{},portsIn:[{name:"Variable",value:"trailAmmount"}],portsOut:[{name:"Value",links:[{portIn:"Amount",portOut:"Value",objIn:"jhu7n8je2",objOut:"c55i36n9u"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"0jpqp8o1c",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Reset",portOut:"Next",objIn:"vsyg6lild",objOut:"0jpqp8o1c"},{portIn:"Generate",portOut:"Next",objIn:"s35yb63wr",objOut:"0jpqp8o1c"},{portIn:"Reset",portOut:"Next",objIn:"lbtbcoo3y",objOut:"0jpqp8o1c"}]},{name:"Number",value:-.9049235993208828}],objName:"Ops.Number.TriggerOnChangeNumber"},{id:"vsyg6lild",uiAttribs:{},portsIn:[{name:"Speed",value:1.5},{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"value",portOut:"Time",objIn:"t4cg4mkdx",objOut:"vsyg6lild"}]}],objName:"Ops.Anim.Timer_v2"},{id:"3ctso0yt3",uiAttribs:{},portsIn:[{name:"Value 1",value:0},{name:"Value 2",value:0},{name:"Percentage",value:0}],portsOut:[{name:"Result",value:0}],objName:"Ops.Math.Interpolate"},{id:"t4cg4mkdx",uiAttribs:{},portsIn:[{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:1},{name:"new max",value:0},{name:"Easing index",value:1},{name:"Easing",value:"Smoothstep"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"amount",portOut:"result",objIn:"eivf5lesh",objOut:"t4cg4mkdx"},{portIn:"a",portOut:"result",objIn:"jhu7n8je2",objOut:"t4cg4mkdx"},{portIn:"Value",portOut:"result",objIn:"htkoml9bj",objOut:"t4cg4mkdx"}]}],objName:"Ops.Math.MapRange"},{id:"pn57ashc4",uiAttribs:{},portsIn:[{name:"contrast",value:.5},{name:"brightness",value:.5}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"4f06jwk3u",objOut:"pn57ashc4"}]}],objName:"Ops.Gl.ImageCompose.BrightnessContrast"},{id:"ydxp9snhu",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Wrap index",value:1},{name:"Wrap",value:"Clamp"},{name:"Input index",value:0},{name:"Input",value:"Luminance"},{name:"Zero Displace index",value:1},{name:"Zero Displace",value:"Black"},{name:"Pixel Mapping index",value:1},{name:"Pixel Mapping",value:"Repeat"}],objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"},{id:"i3920ylwn",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"7c0t7n96s",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseTexture"}],objName:"Ops.Vars.VarSetTexture_v2"},{id:"xfjtlvmay",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseTexture"}],portsOut:[{name:"Value",links:[{portIn:"displaceTex",portOut:"Value",objIn:"ydxp9snhu",objOut:"xfjtlvmay"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"nsundjdr5",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseTexture"}],portsOut:[{name:"Value",links:[{portIn:"Base Texture",portOut:"Value",objIn:"6gtc49w78",objOut:"nsundjdr5"}]}],objName:"Ops.Vars.VarGetTexture_v2"},{id:"vt4xre74r",uiAttribs:{},portsIn:[{name:"amount",value:1},{name:"Invert Mask",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"9mcy78k1n",objOut:"vt4xre74r"}]}],objName:"Ops.Gl.ImageCompose.Desaturate"},{id:"9mcy78k1n",uiAttribs:{},portsIn:[{name:"In Min",value:0},{name:"Midpoint",value:.5},{name:"In Max",value:1},{name:"Out Min",value:.106},{name:"Out Max",value:1}],objName:"Ops.Gl.ImageCompose.Levels_v2"},{id:"4f06jwk3u",uiAttribs:{},portsIn:[{name:"blendMode index",value:3},{name:"blendMode",value:"multiply"},{name:"amount",value:.514},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"fu8upjak6",uiAttribs:{},portsIn:[{name:"Width",value:10},{name:"Height",value:10},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Color",value:0},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Integer",value:1},{name:"Seed",value:1},{name:"Channel R",value:1},{name:"Min R",value:0},{name:"Max R",value:1},{name:"Channel G",value:1},{name:"Min G",value:0},{name:"Max G",value:1},{name:"Channel B",value:1},{name:"Min B",value:0},{name:"Max B",value:1},{name:"Channel A",value:1},{name:"Min A",value:1},{name:"Max A",value:1}],portsOut:[{name:"Texture",links:[{portIn:"Image",portOut:"Texture",objIn:"kvw0sm4aa",objOut:"fu8upjak6"}]},{name:"Total Pixel",value:100}],objName:"Ops.Gl.Textures.NoiseTexture"},{id:"awa7wargo",uiAttribs:{},portsIn:[{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:0},{name:"new max",value:.226},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"amount Y",portOut:"result",objIn:"ydxp9snhu",objOut:"awa7wargo"},{portIn:"amount X",portOut:"result",objIn:"ydxp9snhu",objOut:"awa7wargo"}]}],objName:"Ops.Math.MapRange"},{id:"htkoml9bj",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseTimeOut"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"p59o02knr",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseTimeOut"}],portsOut:[{name:"Value",links:[{portIn:"value",portOut:"Value",objIn:"awa7wargo",objOut:"p59o02knr"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"5nstpphfi",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseX"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"gwuti6sii",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseY"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"ypxc8a1hd",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseX"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"n0t34buql",objOut:"ypxc8a1hd"},{portIn:"Value",portOut:"Value",objIn:"0jpqp8o1c",objOut:"ypxc8a1hd"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"7jbywmk4l",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseY"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"e1yfqfuvz",objOut:"7jbywmk4l"},{portIn:"Value",portOut:"Value",objIn:"0jpqp8o1c",objOut:"7jbywmk4l"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"n0t34buql",uiAttribs:{},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",value:10,title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Result",links:[{portIn:"Offset X",portOut:"Result",objIn:"jhu7n8je2",objOut:"n0t34buql"}]}],objName:"Ops.Anim.Smooth"},{id:"e1yfqfuvz",uiAttribs:{},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",value:10,title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Result",links:[{portIn:"Offset Y",portOut:"Result",objIn:"jhu7n8je2",objOut:"e1yfqfuvz"}]}],objName:"Ops.Anim.Smooth"},{id:"o9xs3vhpa",uiAttribs:{},portsIn:[{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"a",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"6s5iwbhzc",objOut:"o9xs3vhpa"}]}],objName:"Ops.Gl.ClearColor"},{id:"6s5iwbhzc",uiAttribs:{},portsIn:[{name:"text",value:"404 "},{name:"Draw Mesh",value:0},{name:"Scale Mesh",value:.5},{name:"Size index",value:1},{name:"Size",value:"Manual"},{name:"Width",value:2048},{name:"Height",value:2048},{name:"Auto Height",value:0},{name:"Auto Line Breaks",value:0},{name:"font",value:"everettLight"},{name:"weight",value:"bold"},{name:"fontSize",value:956.09},{name:"align index",value:1},{name:"align",value:"center"},{name:"Vertical align index",value:1},{name:"Vertical align",value:"Middle"},{name:"Letter Spacing",value:0},{name:"Line Height Add",value:0},{name:"Padding Y Top",value:0},{name:"Padding Y Bottom",value:0},{name:"Padding X",value:0},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:0},{name:"Reuse Texture",value:1},{name:"Show Debug",value:0},{name:"Redraw On Font Load",value:1},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"Opacity",value:1},{name:"background R",value:0},{name:"background G",value:0},{name:"background B",value:0},{name:"background A",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"5m0nxxnjx",objOut:"6s5iwbhzc"}]},{name:"Ratio",value:1},{name:"texture",links:[{portIn:"object port 2",portOut:"texture",objIn:"mosg1lz53",objOut:"6s5iwbhzc"},{portIn:"Texture In",portOut:"texture",objIn:"gxezgby9h",objOut:"6s5iwbhzc"}]},{name:"Aspect",value:1},{name:"Num Lines",value:1}],objName:"Ops.Gl.Textures.TextTexture_v6"},{id:"tjch93q43",uiAttribs:{},portsIn:[{name:"String 0",value:"mq1"},{name:"String 1",value:"mq2"},{name:"String 2",value:"mq3"},{name:"String 3",value:""},{name:"String 4",value:""},{name:"String 5",value:""},{name:"String 6",value:""},{name:"String 7",value:""},{name:"String 8",value:""},{name:"String 9",value:""},{name:"String 10",value:""},{name:"String 11",value:""},{name:"String 12",value:""},{name:"String 13",value:""},{name:"String 14",value:""},{name:"String 15",value:""},{name:"String 16",value:""},{name:"String 17",value:""},{name:"String 18",value:""},{name:"String 19",value:""},{name:"String 20",value:""},{name:"String 21",value:""},{name:"String 22",value:""},{name:"String 23",value:""}],portsOut:[{name:"Switched Index",value:2},{name:"Trigger 0",links:[{portIn:"9mnoq6ams",portOut:"Trigger 0",objIn:"tiwzxtzaz",objOut:"tjch93q43"}]},{name:"Trigger 1",links:[{portIn:"9mnoq6ams",portOut:"Trigger 1",objIn:"hj7s4mhgf",objOut:"tjch93q43"}]},{name:"Trigger 2",links:[{portIn:"d7g5c0h5b",portOut:"Trigger 2",objIn:"ekewbwi0y",objOut:"tjch93q43"}]}],objName:"Ops.Trigger.RouteTriggerString_v2"},{id:"xwullk18b",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:.6},{name:"Y",value:1.12},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"sjcn93uzi",objOut:"xwullk18b"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"sjcn93uzi",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"al6v6db10",objOut:"sjcn93uzi"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"eslpdvsv9",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:3.7},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"sjcn93uzi",objOut:"eslpdvsv9"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"awwaalsl7",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:148.35},{name:"Y",value:-67.71},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"sjcn93uzi",objOut:"awwaalsl7"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"pgzg8ma34",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:1.62},{name:"Y",value:0},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"p9loqfq56",objOut:"pgzg8ma34"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"p9loqfq56",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"s8716txow",objOut:"p9loqfq56"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"15ao6bl6f",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:8.68},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"p9loqfq56",objOut:"15ao6bl6f"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"y9ufeibir",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:332.62},{name:"Y",value:-88.18},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"p9loqfq56",objOut:"y9ufeibir"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"5da6uhknz",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:3.88},{name:"Y",value:.89},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 0",portOut:"Array",objIn:"pm7wluk73",objOut:"5da6uhknz"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"pm7wluk73",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"r0tuv5hd6",objOut:"pm7wluk73"}]},{name:"Array length",value:7}],objName:"Ops.Array.ArrayMerge_v3"},{id:"r5ej5u0s3",uiAttribs:{},portsIn:[{name:"Array length",value:1},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:5.95},{name:"Reverse",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"pm7wluk73",objOut:"r5ej5u0s3"}]},{name:"Array length out",value:1}],objName:"Ops.Array.Array_v3"},{id:"nqdhfscj9",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"X",value:248.87},{name:"Y",value:-40.95},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"pm7wluk73",objOut:"nqdhfscj9"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"al6v6db10",uiAttribs:{},portsIn:[{name:"Variable",value:"errorPSR_mq3"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"s8716txow",uiAttribs:{},portsIn:[{name:"Variable",value:"errorPSR_mq2"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"r0tuv5hd6",uiAttribs:{},portsIn:[{name:"Variable",value:"errorPSR_mq1"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"1an36f0vs",uiAttribs:{},portsIn:[{name:"Variable",value:"errorPSR_mq1"}],portsOut:[{name:"Value",links:[{portIn:"byk06hys1",portOut:"Value",objIn:"3pes842n0",objOut:"1an36f0vs"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"ztceytpm5",uiAttribs:{},portsIn:[{name:"Variable",value:"errorPSR_mq2"}],portsOut:[{name:"Value",links:[{portIn:"byk06hys1",portOut:"Value",objIn:"s1jyboif2",objOut:"ztceytpm5"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"t16yxgjge",uiAttribs:{},portsIn:[{name:"Variable",value:"errorPSR_mq3"}],portsOut:[{name:"Value",links:[{portIn:"byk06hys1",portOut:"Value",objIn:"t0a9jtv61",objOut:"t16yxgjge"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"t0a9jtv61",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"2uzay3xk0",title:"render"},{name:"byk06hys1",title:"Array"},{name:"icoiczvtv",title:"number2"},{name:"6lhmsuqvg",title:"number2"},{name:"09lct6z2t",title:"number2"},{name:"patchId",value:"bp2sub_t0a9jtv61"}],portsOut:[{name:"driq8l4om",title:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.TransformView trigger",portOut:"driq8l4om",objIn:"hmrwm30er",objOut:"t0a9jtv61"}]}],objName:"Ops.Patch.PGgjVeu.TransfromFromArray"},{id:"s1jyboif2",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"2uzay3xk0",title:"render"},{name:"byk06hys1",title:"Array"},{name:"icoiczvtv",value:0,title:"number2"},{name:"6lhmsuqvg",value:0,title:"number2"},{name:"09lct6z2t",value:0,title:"number2"},{name:"patchId",value:"bp2sub_s1jyboif2"}],portsOut:[{name:"driq8l4om",title:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.TransformView trigger",portOut:"driq8l4om",objIn:"hmrwm30er",objOut:"s1jyboif2"}]}],objName:"Ops.Patch.PGgjVeu.TransfromFromArray"},{id:"3pes842n0",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"2uzay3xk0",title:"render"},{name:"byk06hys1",title:"Array"},{name:"icoiczvtv",value:0,title:"number2"},{name:"6lhmsuqvg",value:0,title:"number2"},{name:"09lct6z2t",value:0,title:"number2"},{name:"patchId",value:"bp2sub_3pes842n0"}],portsOut:[{name:"driq8l4om",title:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.TransformView trigger",portOut:"driq8l4om",objIn:"hmrwm30er",objOut:"3pes842n0"}]}],objName:"Ops.Patch.PGgjVeu.TransfromFromArray"},{id:"hj7s4mhgf",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"9mnoq6ams",title:"Reset"},{name:"x51l5mx3z",value:.5,title:"number1"},{name:"via20ae2r",value:0,title:"number1"},{name:"eq3wcir2y",value:0,title:"number1"},{name:"x0ic0h4fm",title:"number1"},{name:"patchId",value:"bp2sub_hj7s4mhgf"}],portsOut:[{name:"fei1jpjm5",value:0,title:"Result"},{name:"o1i9iyfw1",value:0,title:"Result"},{name:"arp1806j4",value:0,title:"result"},{name:"scw0zze34",title:"Next",links:[{portIn:"2uzay3xk0",portOut:"scw0zze34",objIn:"s1jyboif2",objOut:"hj7s4mhgf"}]}],objName:"Ops.Patch.PGgjVeu.AutoTransform"},{id:"tiwzxtzaz",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"9mnoq6ams",title:"Reset"},{name:"x51l5mx3z",value:.5,title:"number1"},{name:"via20ae2r",value:0,title:"number1"},{name:"eq3wcir2y",value:0,title:"number1"},{name:"x0ic0h4fm",title:"number1"},{name:"patchId",value:"bp2sub_tiwzxtzaz"}],portsOut:[{name:"fei1jpjm5",value:17.281836431257368,title:"Result"},{name:"o1i9iyfw1",value:0,title:"Result"},{name:"arp1806j4",value:0,title:"result"},{name:"scw0zze34",title:"Next",links:[{portIn:"2uzay3xk0",portOut:"scw0zze34",objIn:"3pes842n0",objOut:"tiwzxtzaz"}]}],objName:"Ops.Patch.PGgjVeu.AutoTransform"},{id:"71ntvis15",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"r",value:.961},{name:"g",value:.125},{name:"b",value:0},{name:"a",value:0}],portsOut:[{name:"outr",value:.961},{name:"outg",value:.125},{name:"outb",value:0},{name:"outa",value:0},{name:"Hex",value:"F52000"},{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"plo7uwjmn",objOut:"71ntvis15"}]}],objName:"Ops.Color.ColorValue"},{id:"7ucir53hh",uiAttribs:{},portsIn:[{name:"Variable",value:"mousePosition"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"maqfpr9z7",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Value",portOut:"Array",objIn:"7ucir53hh",objOut:"maqfpr9z7"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"w138k92t1",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseX"}],portsOut:[{name:"Value",links:[{portIn:"X",portOut:"Value",objIn:"maqfpr9z7",objOut:"w138k92t1"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"owv4dx8m3",uiAttribs:{},portsIn:[{name:"Variable",value:"mouseY"}],portsOut:[{name:"Value",links:[{portIn:"Y",portOut:"Value",objIn:"maqfpr9z7",objOut:"owv4dx8m3"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"gxezgby9h",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"lk91ozdv7",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Translate X",value:1},{name:"Translate Y",value:0},{name:"Repeat X",value:1},{name:"Repeat Y",value:1},{name:"Flip X",value:0},{name:"Flip Y",value:0},{name:"Rotation",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"render",portOut:"Trigger",objIn:"9mk9lwfol",objOut:"lk91ozdv7"}]}],objName:"Ops.Gl.ShaderEffects.TransformTextureCoordinates"},{id:"mmx48qgw9",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"lk91ozdv7",objOut:"mmx48qgw9"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"9mk9lwfol",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"blendMode index",value:6},{name:"blendMode",value:"add"},{name:"Amount",value:1},{name:"Target index",value:0},{name:"Target",value:"Color"},{name:"Scale",value:1},{name:"Use Texture Alpha",value:0},{name:"Pos X",value:0},{name:"Pos Y",value:0},{name:"Rot X",value:0},{name:"Rot Y",value:0},{name:"Rot Z",value:0},{name:"Mapping index",value:5},{name:"Mapping",value:"TexCoords 1"},{name:"Discard",value:0},{name:"WorldSpace",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"hjdeu0zr1",objOut:"9mk9lwfol"}]}],objName:"Ops.Gl.ShaderEffects.TextureProjection_v2"},{id:"b1025pxu7",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:"8x8 RGBA 8bit ubyte nearest clamp\n"}],objName:"Ops.Ui.VizTexture"},{id:"s35yb63wr",uiAttribs:{},portsIn:[{name:"min",value:.9},{name:"max",value:1},{name:"Integer",value:0},{name:"No consecutive duplicates",value:0}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"g1byf20ve",objOut:"s35yb63wr"},{portIn:"number1",portOut:"result",objIn:"fthm9ia3l",objOut:"s35yb63wr"}]}],objName:"Ops.Math.TriggerRandomNumber_v2"},{id:"g1byf20ve",uiAttribs:{},portsIn:[{name:"number2",value:.015}],portsOut:[{name:"result",links:[{portIn:"height",portOut:"result",objIn:"jhu7n8je2",objOut:"g1byf20ve"},{portIn:"width",portOut:"result",objIn:"jhu7n8je2",objOut:"g1byf20ve"}]}],objName:"Ops.Math.Multiply"},{id:"yxrh21yi6",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:1},{name:"Alpha Mask",value:"On"},{name:"Amount",value:.01},{name:"Shape index",value:3},{name:"Shape",value:"box"},{name:"Mirror X",value:0},{name:"Mirror Y",value:0},{name:"Offset X",value:0},{name:"Offset Y",value:0},{name:"fillShape",value:1},{name:"Line thickness",value:0},{name:"Invert color",value:0},{name:"width",value:1,title:"Width"},{name:"height",value:1},{name:"Rotate",value:0},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"kvw0sm4aa",objOut:"yxrh21yi6"}]}],objName:"Ops.Gl.ImageCompose.Shapes2d_v2"},{id:"qvp3rze0d",uiAttribs:{},portsIn:[{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:1},{name:"new max",value:0},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"a",portOut:"result",objIn:"yxrh21yi6",objOut:"qvp3rze0d"}]}],objName:"Ops.Math.MapRange"},{id:"lbtbcoo3y",uiAttribs:{},portsIn:[{name:"Speed",value:5},{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"value",portOut:"Time",objIn:"qvp3rze0d",objOut:"lbtbcoo3y"}]}],objName:"Ops.Anim.Timer_v2"},{id:"fthm9ia3l",uiAttribs:{},portsIn:[{name:"number2",value:10}],portsOut:[{name:"result",value:9.376395792946363}],objName:"Ops.Math.Multiply"},{id:"kvw0sm4aa",uiAttribs:{},portsIn:[{name:"blendMode index",value:3},{name:"blendMode",value:"multiply"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:1},{name:"Mask Src",value:"luminance"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"8y2fp640r",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"videoFullscreen"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"lgr7iccwf",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Scale index",value:1},{name:"Scale",value:"Fit"},{name:"Flip Y",value:0},{name:"Flip X",value:0}],objName:"Ops.Gl.Meshes.FullscreenRectangle_v2"},{id:"ml4jm0lz0",uiAttribs:{subPatch:"oq0mm5hrc"},portsOut:[{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"99lxruhzw",objOut:"ml4jm0lz0"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"mj4jfqzhy",objOut:"ml4jm0lz0"}]},{name:"Highest Index",value:1}],objName:"Ops.Trigger.RouteTrigger"},{id:"7fxd86cp0",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Variable",value:"videoFullscreen"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"ml4jm0lz0",objOut:"7fxd86cp0"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"rdlyyv1x4",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"exec",portOut:"Trigger 0",objIn:"wm3l5lbrt",objOut:"rdlyyv1x4"}]},{name:"Trigger 1",links:[{portIn:"exec",portOut:"Trigger 1",objIn:"ckns4nxk6",objOut:"rdlyyv1x4"}]},{name:"Highest Index",value:1}],objName:"Ops.Trigger.RouteTrigger"},{id:"8dq82j75d",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoFullscreen"}],portsOut:[{name:"Value",links:[{portIn:"num",portOut:"Value",objIn:"ckns4nxk6",objOut:"8dq82j75d"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"ckns4nxk6",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Default Texture Transparent",value:1}],portsOut:[{name:"Next",links:[{portIn:"out1 ShaderToTexture Next",portOut:"Next",objIn:"c2dfdfab-f08f-46c6-8599-9c62d64da7c1",objOut:"ckns4nxk6"}]},{name:"texture",links:[{portIn:"out0 ImageCompose texture_out",portOut:"texture",objIn:"c2dfdfab-f08f-46c6-8599-9c62d64da7c1",objOut:"ckns4nxk6"}]}],objName:"Ops.Gl.Textures.SwitchTextures_v2"},{id:"47j2bunmq",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoFullscreen"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"rdlyyv1x4",objOut:"47j2bunmq"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"mj4jfqzhy",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"a",value:.93}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"lgr7iccwf",objOut:"mj4jfqzhy"}]}],objName:"Ops.Gl.ClearColor"},{id:"z7y2n2i3i",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"xz0gracpt",title:"Changed"},{name:"nm7k58wq0",title:"Trigger 0"},{name:"patchId",value:"bp2sub_z7y2n2i3i"}],portsOut:[{name:"ce2ob73kl",title:"Opacity",links:[{portIn:"Opacity",portOut:"ce2ob73kl",objIn:"fvntb6ykt",objOut:"z7y2n2i3i"}]}],objName:"Ops.User.srcphag.Strobe"},{id:"p1g8wrfh7",uiAttribs:{},portsIn:[{name:"Value",value:"#ededed"},{name:"Variable",value:"backFullScreenColorHex"}],objName:"Ops.Vars.VarSetString_v2"},{id:"8u45kzlf4",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Bytes",value:0}],portsOut:[{name:"R",links:[{portIn:"r",portOut:"R",objIn:"mj4jfqzhy",objOut:"8u45kzlf4"}]},{name:"G",links:[{portIn:"g",portOut:"G",objIn:"mj4jfqzhy",objOut:"8u45kzlf4"}]},{name:"B",links:[{portIn:"b",portOut:"B",objIn:"mj4jfqzhy",objOut:"8u45kzlf4"}]}],objName:"Ops.Color.HexToRGB_v2"},{id:"90bia1wzr",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"Variable",value:"backFullScreenColorHex"}],portsOut:[{name:"Value",links:[{portIn:"Hex",portOut:"Value",objIn:"8u45kzlf4",objOut:"90bia1wzr"}]}],objName:"Ops.Vars.VarGetString"},{id:"v0tlrpg3m",uiAttribs:{},portsIn:[{name:"Show Info",value:0},{name:"Visualize outside 0-1 index",value:1},{name:"Visualize outside 0-1",value:"Anim"},{name:"Alpha index",value:0},{name:"Alpha",value:"A"},{name:"Show Color",value:0},{name:"X",value:.5},{name:"Y",value:.5}],portsOut:[{name:"Info",value:""}],objName:"Ops.Ui.VizTexture"},{id:"y0ubrodna",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"x",value:1},{name:"y",value:3},{name:"Clear",value:1}],objName:"Ops.Gl.ImageCompose.RepeatTexture_v2"},{id:"0wtkjvm38",uiAttribs:{},portsIn:[{name:"Size index",value:2},{name:"Size",value:"Manual"},{name:"Width",value:2048},{name:"Height",value:2048},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:1},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"y0ubrodna",objOut:"0wtkjvm38"}]},{name:"texture_out",links:[{portIn:"Texture In",portOut:"texture_out",objIn:"v0tlrpg3m",objOut:"0wtkjvm38"},{portIn:"object port 0",portOut:"texture_out",objIn:"mosg1lz53",objOut:"0wtkjvm38"}]},{name:"Aspect Ratio",value:1},{name:"Texture Width",value:2048},{name:"Texture Height",value:2048}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"zzjyotgds",uiAttribs:{subPatch:"oq0mm5hrc"},portsIn:[{name:"A",value:1},{name:"Enable",value:1},{name:"Albedo",value:1},{name:"Roughness",value:1},{name:"Active",value:0},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:1},{name:"Color Intensity",value:.909},{name:"Shininess",value:1},{name:"Specular Amount",value:0},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:0},{name:"Double Sided Material",value:0},{name:"Falloff Mode index",value:1},{name:"Falloff Mode",value:"B"},{name:"Colorize Texture",value:0},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"AO UV Channel index",value:0},{name:"AO UV Channel",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:0}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"23spdnjhn",objOut:"zzjyotgds"}]}],objName:"Ops.Gl.Phong.PhongMaterial_v6"},{id:"qish0bdl0",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"9mnoq6ams",title:"Reset"},{name:"x51l5mx3z",value:1,title:"number1"},{name:"via20ae2r",value:1,title:"number1"},{name:"eq3wcir2y",value:1,title:"number1"},{name:"x0ic0h4fm",title:"number1"},{name:"patchId",value:"bp2sub_qish0bdl0"}],portsOut:[{name:"fei1jpjm5",title:"Result",links:[{portIn:"number1",portOut:"fei1jpjm5",objIn:"zpdk4s7hr",objOut:"qish0bdl0"}]},{name:"o1i9iyfw1",title:"Result",links:[{portIn:"number1",portOut:"o1i9iyfw1",objIn:"sd5jtt6y5",objOut:"qish0bdl0"}]},{name:"arp1806j4",title:"result",links:[{portIn:"number1",portOut:"arp1806j4",objIn:"e6ylr7btl",objOut:"qish0bdl0"}]}],objName:"Ops.Patch.PGgjVeu.AutoTransform"},{id:"bq10hctt6",uiAttribs:{},portsIn:[{name:"Value",value:0},{name:"Variable",value:"videoTextureOffsetY"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"lml49srhp",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsOut:[{name:"result",links:[{portIn:"offset Y",portOut:"result",objIn:"r3u33h3hs",objOut:"lml49srhp"},{portIn:"offset Y",portOut:"result",objIn:"v38pi7nzw",objOut:"lml49srhp"}]}],objName:"Ops.Math.Sum"},{id:"xdq6fhdix",uiAttribs:{subPatch:"0ff66c6c-0dc3-43ce-bbac-906b76f3f60b"},portsIn:[{name:"Variable",value:"videoTextureOffsetY"}],portsOut:[{name:"Value",links:[{portIn:"number2",portOut:"Value",objIn:"lml49srhp",objOut:"xdq6fhdix"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"4vye0rgt0",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"d7g5c0h5b",title:"Trigger 2"},{name:"ieb1lbewd",title:"Value"},{name:"83lvt4w8p",title:"Value"},{name:"patchId",value:"bp2sub_4vye0rgt0"}],portsOut:[{name:"d58ks5o1j",title:"Result",links:[{portIn:"number1",portOut:"d58ks5o1j",objIn:"zpdk4s7hr",objOut:"4vye0rgt0"}]},{name:"eqbeofk6o",title:"Result",links:[{portIn:"number1",portOut:"eqbeofk6o",objIn:"sd5jtt6y5",objOut:"4vye0rgt0"}]},{name:"vy0njf6dp",title:"Result",links:[{portIn:"number1",portOut:"vy0njf6dp",objIn:"e6ylr7btl",objOut:"4vye0rgt0"}]}],objName:"Ops.Patch.PGgjVeu.MouseInteract"},{id:"bop3suw45",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"d7g5c0h5b",title:"Trigger 2"},{name:"ieb1lbewd",title:"Value"},{name:"83lvt4w8p",title:"Value"},{name:"patchId",value:"bp2sub_bop3suw45"}],portsOut:[{name:"d58ks5o1j",title:"Result",links:[{portIn:"icoiczvtv",portOut:"d58ks5o1j",objIn:"t94xojk09",objOut:"bop3suw45"}]},{name:"eqbeofk6o",title:"Result",links:[{portIn:"6lhmsuqvg",portOut:"eqbeofk6o",objIn:"t94xojk09",objOut:"bop3suw45"}]},{name:"vy0njf6dp",title:"Result",links:[{portIn:"09lct6z2t",portOut:"vy0njf6dp",objIn:"t94xojk09",objOut:"bop3suw45"}]},{name:"cq7ouht1r",title:"Next",links:[{portIn:"2uzay3xk0",portOut:"cq7ouht1r",objIn:"t94xojk09",objOut:"bop3suw45"}]}],objName:"Ops.Patch.PGgjVeu.MouseInteract"},{id:"ekewbwi0y",uiAttribs:{},storage:{blueprintVer:2,subPatchVer:2},portsIn:[{name:"d7g5c0h5b",title:"Trigger 2"},{name:"ieb1lbewd",title:"Value"},{name:"83lvt4w8p",title:"Value"},{name:"patchId",value:"bp2sub_ekewbwi0y"}],portsOut:[{name:"d58ks5o1j",title:"Result",links:[{portIn:"icoiczvtv",portOut:"d58ks5o1j",objIn:"t0a9jtv61",objOut:"ekewbwi0y"}]},{name:"eqbeofk6o",title:"Result",links:[{portIn:"6lhmsuqvg",portOut:"eqbeofk6o",objIn:"t0a9jtv61",objOut:"ekewbwi0y"}]},{name:"vy0njf6dp",title:"Result",links:[{portIn:"09lct6z2t",portOut:"vy0njf6dp",objIn:"t0a9jtv61",objOut:"ekewbwi0y"}]},{name:"cq7ouht1r",title:"Next",links:[{portIn:"2uzay3xk0",portOut:"cq7ouht1r",objIn:"t0a9jtv61",objOut:"ekewbwi0y"}]}],objName:"Ops.Patch.PGgjVeu.MouseInteract"}],export:{time:"2025-11-13 10:38",service:"html",exportNumber:62}};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["GgjVeu"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Ui=Ops.Ui||{};Ops.Anim=Ops.Anim||{};Ops.Html=Ops.Html||{};Ops.Json=Ops.Json||{};Ops.Math=Ops.Math||{};Ops.User=Ops.User||{};Ops.Vars=Ops.Vars||{};Ops.Array=Ops.Array||{};Ops.Color=Ops.Color||{};Ops.Patch=Ops.Patch||{};Ops.Cables=Ops.Cables||{};Ops.Number=Ops.Number||{};Ops.String=Ops.String||{};Ops.Boolean=Ops.Boolean||{};Ops.Devices=Ops.Devices||{};Ops.Gl.GLTF=Ops.Gl.GLTF||{};Ops.Trigger=Ops.Trigger||{};Ops.Gl.Phong=Ops.Gl.Phong||{};Ops.Graphics=Ops.Graphics||{};Ops.Extension=Ops.Extension||{};Ops.Gl.Matrix=Ops.Gl.Matrix||{};Ops.Gl.Meshes=Ops.Gl.Meshes||{};Ops.Gl.Shader=Ops.Gl.Shader||{};Ops.Gl.Textures=Ops.Gl.Textures||{};Ops.Math.Compare=Ops.Math.Compare||{};Ops.User.srcphag=Ops.User.srcphag||{};Ops.Devices.Mouse=Ops.Devices.Mouse||{};Ops.Patch.PGgjVeu=Ops.Patch.PGgjVeu||{};Ops.Gl.ImageCompose=Ops.Gl.ImageCompose||{};Ops.Gl.ShaderEffects=Ops.Gl.ShaderEffects||{};Ops.Extension.Deprecated=Ops.Extension.Deprecated||{};Ops.Gl.ImageCompose.Noise=Ops.Gl.ImageCompose.Noise||{};Ops.Ui.SubPatch=class extends CABLES.Op{constructor(){super(...arguments);const u=this;const e=u.attachments={};u.dyn=u.addInPort(new CABLES.Port(u,"create port",CABLES.OP_PORT_TYPE_DYNAMIC));u.dynOut=u.addOutPort(new CABLES.Port(u,"create port out",CABLES.OP_PORT_TYPE_DYNAMIC));const t=u.addInPort(new CABLES.Port(u,"dataStr",CABLES.OP_PORT_TYPE_VALUE,{display:"readonly"}));u.patchId=u.addInPort(new CABLES.Port(u,"patchId",CABLES.OP_PORT_TYPE_VALUE,{display:"readonly"}));t.setUiAttribs({hideParam:true});u.patchId.setUiAttribs({hidePort:true});let h={ports:[],portsOut:[]};let i=CABLES.generateUUID();u.patchId.set(i);g();d();let c=false;u.saveData=a;u.init=()=>{u.setStorage({subPatchVer:1})};u.patchId.onChange=function(){if(!u.patch.isEditorMode())return;const t=u.patch.getSubPatchOps(i);if(t.length===2){if(u.patch.isEditorMode())CABLES.UI.undo.pause();for(let e=0;e<t.length;e++){u.patch.deleteOp(t[e].id)}if(u.patch.isEditorMode())CABLES.UI.undo.resume()}};u.onLoaded=function(){};u.onLoadedValueSet=function(){h=JSON.parse(t.get());if(!h){h={ports:[],portsOut:[]}}s()};function n(){}t.onChange=function(){if(c)return;if(!t.get())return;try{n()}catch(e){u.logError("cannot load subpatch data...");u.logError(e)}};function a(){try{t.set(JSON.stringify(h))}catch(e){u.log(e)}}u.addPortListener=f;function f(i,e){if(!i.hasSubpatchLstener){i.hasSubpatchLstener=true;i.addEventListener("onUiAttrChange",function(t){if(t.title){let e=0;for(e=0;e<h.portsOut.length;e++)if(h.portsOut[e].name==i.name)h.portsOut[e].title=t.title;for(e=0;e<h.ports.length;e++)if(h.ports[e].name==i.name)h.ports[e].title=t.title;a()}})}if(i.direction==CABLES.PORT_DIR_IN){if(i.type==CABLES.OP_PORT_TYPE_FUNCTION){i.onTriggered=function(){if(e.isLinked())e.trigger()}}else{i.onChange=function(){e.set(i.get());if(!i.isLinked()){for(let e=0;e<h.ports.length;e++){if(h.ports[e].name===i.name){h.ports[e].value=i.get()}}a()}}}}}u.setupPorts=s;function s(){if(!u.patchId.get())return;const e=h.ports||[];const t=h.portsOut||[];let i=0;for(i=0;i<e.length;i++){if(!u.getPortByName(e[i].name)){const n=u.addInPort(new CABLES.Port(u,e[i].name,e[i].type));const r=g();const s=r.addOutPort(new CABLES.Port(r,e[i].name,e[i].type));n.ignoreValueSerialize=true;n.setUiAttribs({editableTitle:true});if(e[i].title){n.setUiAttribs({title:e[i].title});s.setUiAttribs({title:e[i].title})}if(e[i].objType){n.setUiAttribs({objType:e[i].objType});s.setUiAttribs({objType:e[i].objType})}if(e[i].value){n.set(e[i].value);s.set(e[i].value)}f(n,s)}}for(i=0;i<t.length;i++){if(!u.getPortByName(t[i].name)){const a=u.addOutPort(new CABLES.Port(u,t[i].name,t[i].type));const o=d();const l=o.addInPort(new CABLES.Port(o,t[i].name,t[i].type));a.ignoreValueSerialize=true;a.setUiAttribs({editableTitle:true});if(t[i].title){a.setUiAttribs({title:t[i].title});l.setUiAttribs({title:t[i].title})}if(t[i].objType){a.setUiAttribs({objType:t[i].objType});l.setUiAttribs({objType:t[i].objType})}f(l,a)}}c=true}u.addNewInPort=function(e,t,i){const n="in"+h.ports.length+" "+e.op.name+" "+e.name;const r={name:n,type:e.type};if(e.uiAttribs.objType)r.objType=e.uiAttribs.objType;h.ports.push(r);s();return n};u.dyn.onLinkChanged=function(){if(u.dyn.isLinked()){const e=u.dyn.links[0].getOtherPort(u.dyn);u.dyn.removeLinks();e.removeLinkTo(u.dyn);u.log("dyn link changed!!!");const t=u.addNewInPort(e);const i=gui.scene().link(e.op,e.getName(),u,t);c=true;a()}else{setTimeout(function(){u.dyn.removeLinks()},100)}};u.addNewOutPort=function(e,t,i){const n="out"+h.portsOut.length+" "+e.op.name+" "+e.name;const r={name:n,type:e.type};if(e.uiAttribs.objType)r.objType=e.uiAttribs.objType;h.portsOut.push(r);s();return n};u.dynOut.onLinkChanged=function(){if(u.dynOut.isLinked()){const e=u.dynOut.links[0].getOtherPort(u.dynOut);u.dynOut.removeLinks();if(e){e.removeLinkTo(u.dynOut);const t=u.addNewOutPort(e);gui.scene().link(e.op,e.getName(),u,t)}c=true;a()}else{setTimeout(function(){u.dynOut.removeLinks()},100);u.log("dynOut unlinked...")}};function d(){let e=u.patch.getSubPatchOp(u.patchId.get(),"Ops.Ui.PatchOutput");if(!e){u.patch.addOp("Ops.Ui.PatchOutput",{subPatch:u.patchId.get(),translate:{x:0,y:0}});e=u.patch.getSubPatchOp(u.patchId.get(),"Ops.Ui.PatchOutput");if(!e)u.warn("no patchoutput!")}return e}function g(){let e=u.patch.getSubPatchOp(u.patchId.get(),"Ops.Ui.PatchInput");if(!e){u.patch.addOp("Ops.Ui.PatchInput",{subPatch:u.patchId.get(),translate:{x:0,y:0}});e=u.patch.getSubPatchOp(u.patchId.get(),"Ops.Ui.PatchInput");if(!e)u.warn("no patchinput2!")}return e}u.addSubLink=function(e,t){const i=h.ports.length;const n="in"+(i-1)+" "+t.op.name+" "+t.name;if(e.direction==CABLES.PORT_DIR_IN){gui.scene().link(e.op,e.getName(),g(),n)}else{const s=h.portsOut.length;gui.scene().link(e.op,e.getName(),d(),"out"+(s-1)+" "+t.op.name+" "+t.name)}const r=gui.patchView.getSubPatchBounds(u.patchId.get());g().uiAttr({translate:{x:r.minx,y:r.miny-100}});d().uiAttr({translate:{x:r.minx,y:r.maxy+100}});a();return n};u.onDelete=function(){for(let e=u.patch.ops.length-1;e>=0;e--)if(u.patch.ops[e]&&u.patch.ops[e].uiAttribs&&u.patch.ops[e].uiAttribs.subPatch==u.patchId.get())u.patch.deleteOp(u.patch.ops[e].id)};u.rebuildListeners=()=>{u.log("rebuild listeners...");const t=d();for(let e=0;e<t.portsIn.length;e++){if(t.portsIn[e].isLinked()){f(t.portsIn[e],this.portsOut[e])}}}}};CABLES.OPS["84d9a6f0-ed7a-466d-b386-225ed9e89c60"]={f:Ops.Ui.SubPatch,objName:"Ops.Ui.SubPatch"};Ops.Patch.PGgjVeu.AutoTransform=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const i=e.attachments={inc_gen_ports_js:'const port_9mnoq6ams=op.inTrigger("9mnoq6ams");\nport_9mnoq6ams.setUiAttribs({title:"Reset",display:"button",});\n\nconst port_x51l5mx3z=op.inFloat("x51l5mx3z",1);\nport_x51l5mx3z.setUiAttribs({title:"number1",});\n\nconst port_via20ae2r=op.inFloat("via20ae2r",1);\nport_via20ae2r.setUiAttribs({title:"number1",});\n\nconst port_eq3wcir2y=op.inFloat("eq3wcir2y",1);\nport_eq3wcir2y.setUiAttribs({title:"number1",});\n\nconst port_x0ic0h4fm=op.inFloat("x0ic0h4fm",1);\nport_x0ic0h4fm.setUiAttribs({title:"number1",});\n\nconst port_fei1jpjm5=op.outNumber("fei1jpjm5");\nport_fei1jpjm5.setUiAttribs({title:"Result",});\n\nconst port_o1i9iyfw1=op.outNumber("o1i9iyfw1");\nport_o1i9iyfw1.setUiAttribs({title:"Result",});\n\nconst port_arp1806j4=op.outNumber("arp1806j4");\nport_arp1806j4.setUiAttribs({title:"result",});\n\nconst port_scw0zze34=op.outTrigger("scw0zze34");\nport_scw0zze34.setUiAttribs({title:"Next",});\n\nop.initInnerPorts=function(addedOps)\n{\n  for(let i=0;i<addedOps.length;i++)\n  {\n    if(addedOps[i].innerInput)\n    {\nconst innerOut_9mnoq6ams = addedOps[i].outTrigger("innerOut_9mnoq6ams");\ninnerOut_9mnoq6ams.setUiAttribs({title:"Reset"});\nport_9mnoq6ams.onTriggered = () => { innerOut_9mnoq6ams.trigger(); };\n\nconst innerOut_x51l5mx3z = addedOps[i].outNumber("innerOut_x51l5mx3z");\ninnerOut_x51l5mx3z.set(port_x51l5mx3z.get() );\ninnerOut_x51l5mx3z.setUiAttribs({title:"number1"});\nport_x51l5mx3z.on("change", (a,v) => { innerOut_x51l5mx3z.set(a); });\n\nconst innerOut_via20ae2r = addedOps[i].outNumber("innerOut_via20ae2r");\ninnerOut_via20ae2r.set(port_via20ae2r.get() );\ninnerOut_via20ae2r.setUiAttribs({title:"number1"});\nport_via20ae2r.on("change", (a,v) => { innerOut_via20ae2r.set(a); });\n\nconst innerOut_eq3wcir2y = addedOps[i].outNumber("innerOut_eq3wcir2y");\ninnerOut_eq3wcir2y.set(port_eq3wcir2y.get() );\ninnerOut_eq3wcir2y.setUiAttribs({title:"number1"});\nport_eq3wcir2y.on("change", (a,v) => { innerOut_eq3wcir2y.set(a); });\n\nconst innerOut_x0ic0h4fm = addedOps[i].outNumber("innerOut_x0ic0h4fm");\ninnerOut_x0ic0h4fm.set(port_x0ic0h4fm.get() );\ninnerOut_x0ic0h4fm.setUiAttribs({title:"number1"});\nport_x0ic0h4fm.on("change", (a,v) => { innerOut_x0ic0h4fm.set(a); });\n\n    }\nif(addedOps[i].innerOutput)\n{\nconst innerIn_fei1jpjm5 = addedOps[i].inFloat("innerIn_fei1jpjm5");\ninnerIn_fei1jpjm5.setUiAttribs({title:"Result"});\ninnerIn_fei1jpjm5.on("change", (a,v) => { port_fei1jpjm5.set(a); });\n\nconst innerIn_o1i9iyfw1 = addedOps[i].inFloat("innerIn_o1i9iyfw1");\ninnerIn_o1i9iyfw1.setUiAttribs({title:"Result"});\ninnerIn_o1i9iyfw1.on("change", (a,v) => { port_o1i9iyfw1.set(a); });\n\nconst innerIn_arp1806j4 = addedOps[i].inFloat("innerIn_arp1806j4");\ninnerIn_arp1806j4.setUiAttribs({title:"result"});\ninnerIn_arp1806j4.on("change", (a,v) => { port_arp1806j4.set(a); });\n\nconst innerIn_scw0zze34 = addedOps[i].inTrigger("innerIn_scw0zze34");\ninnerIn_scw0zze34.setUiAttribs({title:"Next"});\ninnerIn_scw0zze34.onTriggered = () => { port_scw0zze34.trigger(); };\n\n}\n}\n};\n',subpatch_json:'{"ops":[{"id":"sp1-0","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsIn":[{"name":"Sync to timeline","value":0}],"portsOut":[{"name":"Time","links":[{"portIn":"number2","portOut":"Time","objIn":"sp1-6","objOut":"sp1-0"},{"portIn":"number2","portOut":"Time","objIn":"sp1-7","objOut":"sp1-0"},{"portIn":"number2","portOut":"Time","objIn":"sp1-9","objOut":"sp1-0"}]}],"objName":"Ops.Anim.Timer_v2"},{"id":"sp1-1","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsIn":[{"name":"Separate inc/dec","value":0},{"name":"Inc factor","value":10,"title":"Inc/Dec factor"},{"name":"Dec factor","value":4}],"portsOut":[{"name":"Next","links":[{"portIn":"render","portOut":"Next","objIn":"sp1-10","objOut":"sp1-1"}]},{"name":"Result","links":[{"portIn":"rotX","portOut":"Result","objIn":"sp1-10","objOut":"sp1-1"},{"portIn":"innerIn_fei1jpjm5","portOut":"Result","objIn":"sp1-5","objOut":"sp1-1"}]}],"objName":"Ops.Anim.Smooth"},{"id":"sp1-2","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsIn":[{"name":"Separate inc/dec","value":0},{"name":"Inc factor","value":10,"title":"Inc/Dec factor"},{"name":"Dec factor","value":4}],"portsOut":[{"name":"Result","links":[{"portIn":"rotY","portOut":"Result","objIn":"sp1-10","objOut":"sp1-2"},{"portIn":"innerIn_o1i9iyfw1","portOut":"Result","objIn":"sp1-5","objOut":"sp1-2"}]}],"objName":"Ops.Anim.Smooth"},{"id":"sp1-3","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsOut":[{"name":"has focus","links":[{"portIn":"number2","portOut":"has focus","objIn":"sp1-11","objOut":"sp1-3"}]},{"name":"Tab Visible","links":[{"portIn":"Play","portOut":"Tab Visible","objIn":"sp1-0","objOut":"sp1-3"}]}],"objName":"Ops.Html.WindowHasFocus"},{"id":"sp1-4","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsOut":[{"name":"innerOut_9mnoq6ams","title":"Reset","links":[{"portIn":"Update","portOut":"innerOut_9mnoq6ams","objIn":"sp1-1","objOut":"sp1-4"},{"portIn":"Update","portOut":"innerOut_9mnoq6ams","objIn":"sp1-2","objOut":"sp1-4"},{"portIn":"Update","portOut":"innerOut_9mnoq6ams","objIn":"sp1-8","objOut":"sp1-4"}]},{"name":"innerOut_x51l5mx3z","title":"number1","links":[{"portIn":"number1","portOut":"innerOut_x51l5mx3z","objIn":"sp1-6","objOut":"sp1-4"}]},{"name":"innerOut_via20ae2r","title":"number1","links":[{"portIn":"number1","portOut":"innerOut_via20ae2r","objIn":"sp1-7","objOut":"sp1-4"}]},{"name":"innerOut_eq3wcir2y","title":"number1","links":[{"portIn":"number1","portOut":"innerOut_eq3wcir2y","objIn":"sp1-9","objOut":"sp1-4"}]},{"name":"innerOut_x0ic0h4fm","title":"number1","links":[{"portIn":"number1","portOut":"innerOut_x0ic0h4fm","objIn":"sp1-11","objOut":"sp1-4"}]}],"objName":"Ops.Ui.SubPatchInput"},{"id":"sp1-5","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsIn":[{"name":"innerIn_fei1jpjm5","title":"Result"},{"name":"innerIn_o1i9iyfw1","title":"Result"},{"name":"innerIn_arp1806j4","title":"result"},{"name":"innerIn_scw0zze34","title":"Next"}],"objName":"Ops.Ui.SubPatchOutput"},{"id":"sp1-6","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"Value","portOut":"result","objIn":"sp1-1","objOut":"sp1-6"}]}],"objName":"Ops.Math.Multiply"},{"id":"sp1-7","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"Value","portOut":"result","objIn":"sp1-2","objOut":"sp1-7"}]}],"objName":"Ops.Math.Multiply"},{"id":"sp1-8","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsIn":[{"name":"Separate inc/dec","value":0},{"name":"Inc factor","value":10,"title":"Inc/Dec factor"},{"name":"Dec factor","value":4}],"portsOut":[{"name":"Result","links":[{"portIn":"rotZ","portOut":"Result","objIn":"sp1-10","objOut":"sp1-8"},{"portIn":"innerIn_arp1806j4","portOut":"Result","objIn":"sp1-5","objOut":"sp1-8"}]}],"objName":"Ops.Anim.Smooth"},{"id":"sp1-9","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"Value","portOut":"result","objIn":"sp1-8","objOut":"sp1-9"}]}],"objName":"Ops.Math.Multiply"},{"id":"sp1-10","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsIn":[{"name":"posX","value":0},{"name":"posY","value":0},{"name":"posZ","value":0},{"name":"scale","value":1}],"portsOut":[{"name":"trigger","links":[{"portIn":"innerIn_scw0zze34","portOut":"trigger","objIn":"sp1-5","objOut":"sp1-10"}]}],"objName":"Ops.Graphics.TransformView"},{"id":"sp1-11","uiAttribs":{"subPatch":"ux4t6aw2j"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"Speed","portOut":"result","objIn":"sp1-0","objOut":"sp1-11"}]}],"objName":"Ops.Math.Multiply"}]}'};const c=e.inTrigger("9mnoq6ams");c.setUiAttribs({title:"Reset",display:"button"});const f=e.inFloat("x51l5mx3z",1);f.setUiAttribs({title:"number1"});const d=e.inFloat("via20ae2r",1);d.setUiAttribs({title:"number1"});const g=e.inFloat("eq3wcir2y",1);g.setUiAttribs({title:"number1"});const m=e.inFloat("x0ic0h4fm",1);m.setUiAttribs({title:"number1"});const p=e.outNumber("fei1jpjm5");p.setUiAttribs({title:"Result"});const _=e.outNumber("o1i9iyfw1");_.setUiAttribs({title:"Result"});const b=e.outNumber("arp1806j4");b.setUiAttribs({title:"result"});const v=e.outTrigger("scw0zze34");v.setUiAttribs({title:"Next"});e.initInnerPorts=function(t){for(let e=0;e<t.length;e++){if(t[e].innerInput){const i=t[e].outTrigger("innerOut_9mnoq6ams");i.setUiAttribs({title:"Reset"});c.onTriggered=()=>{i.trigger()};const n=t[e].outNumber("innerOut_x51l5mx3z");n.set(f.get());n.setUiAttribs({title:"number1"});f.on("change",(e,t)=>{n.set(e)});const r=t[e].outNumber("innerOut_via20ae2r");r.set(d.get());r.setUiAttribs({title:"number1"});d.on("change",(e,t)=>{r.set(e)});const s=t[e].outNumber("innerOut_eq3wcir2y");s.set(g.get());s.setUiAttribs({title:"number1"});g.on("change",(e,t)=>{s.set(e)});const a=t[e].outNumber("innerOut_x0ic0h4fm");a.set(m.get());a.setUiAttribs({title:"number1"});m.on("change",(e,t)=>{a.set(e)})}if(t[e].innerOutput){const o=t[e].inFloat("innerIn_fei1jpjm5");o.setUiAttribs({title:"Result"});o.on("change",(e,t)=>{p.set(e)});const l=t[e].inFloat("innerIn_o1i9iyfw1");l.setUiAttribs({title:"Result"});l.on("change",(e,t)=>{_.set(e)});const u=t[e].inFloat("innerIn_arp1806j4");u.setUiAttribs({title:"result"});u.on("change",(e,t)=>{b.set(e)});const h=t[e].inTrigger("innerIn_scw0zze34");h.setUiAttribs({title:"Next"});h.onTriggered=()=>{v.trigger()}}}};const n="bp2sub_"+e.id;new CABLES.SubPatchOp(e,{subId:n});t();function t(){if(!i||!i.subpatch_json)return;const t=JSON.parse(i.subpatch_json);CABLES.Patch.replaceOpIds(t,{parentSubPatchId:n,prefixHash:n,oldIdAsRef:true,doNotUnlinkLostLinks:true});for(let e=0;e<t.ops.length;e++){t.ops[e].uiAttribs.blueprintSubpatch2=true}e.loadDependencies(t,()=>{e.patch.deSerialize(t,{opsCreated:e.initInnerPorts});if(CABLES.UI)gui.savedState.setSaved("blueprintloaded",n);e.patch.emitEvent("subpatchExpose",n);e.setStorage({blueprintVer:2});e.patch.emitEvent("subpatchExpose",n)})}}};CABLES.OPS["36b9d4ca-c0a7-4aeb-8ac1-0e5d1b5fcb96"]={f:Ops.Patch.PGgjVeu.AutoTransform,objName:"Ops.Patch.PGgjVeu.AutoTransform"};Ops.Patch.PGgjVeu.TransfromFromArray=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const i=e.attachments={inc_gen_ports_js:'const port_2uzay3xk0=op.inTrigger("2uzay3xk0");\nport_2uzay3xk0.setUiAttribs({title:"render",});\n\nconst port_byk06hys1=op.inArray("byk06hys1");\nport_byk06hys1.setUiAttribs({title:"Array",});\n\nconst port_icoiczvtv=op.inFloat("icoiczvtv",0);\nport_icoiczvtv.setUiAttribs({title:"number2",});\n\nconst port_6lhmsuqvg=op.inFloat("6lhmsuqvg",0);\nport_6lhmsuqvg.setUiAttribs({title:"number2",});\n\nconst port_09lct6z2t=op.inFloat("09lct6z2t",0);\nport_09lct6z2t.setUiAttribs({title:"number2",});\n\nconst port_driq8l4om=op.outTrigger("driq8l4om");\nport_driq8l4om.setUiAttribs({title:"trigger",});\n\nop.initInnerPorts=function(addedOps)\n{\n  for(let i=0;i<addedOps.length;i++)\n  {\n    if(addedOps[i].innerInput)\n    {\nconst innerOut_2uzay3xk0 = addedOps[i].outTrigger("innerOut_2uzay3xk0");\ninnerOut_2uzay3xk0.setUiAttribs({title:"render"});\nport_2uzay3xk0.onTriggered = () => { innerOut_2uzay3xk0.trigger(); };\n\nconst innerOut_byk06hys1 = addedOps[i].outArray("innerOut_byk06hys1");\ninnerOut_byk06hys1.setUiAttribs({title:"Array"});\nport_byk06hys1.on("change", (a,v) => { innerOut_byk06hys1.setRef(a); });\n\nconst innerOut_icoiczvtv = addedOps[i].outNumber("innerOut_icoiczvtv");\ninnerOut_icoiczvtv.set(port_icoiczvtv.get() );\ninnerOut_icoiczvtv.setUiAttribs({title:"number2"});\nport_icoiczvtv.on("change", (a,v) => { innerOut_icoiczvtv.set(a); });\n\nconst innerOut_6lhmsuqvg = addedOps[i].outNumber("innerOut_6lhmsuqvg");\ninnerOut_6lhmsuqvg.set(port_6lhmsuqvg.get() );\ninnerOut_6lhmsuqvg.setUiAttribs({title:"number2"});\nport_6lhmsuqvg.on("change", (a,v) => { innerOut_6lhmsuqvg.set(a); });\n\nconst innerOut_09lct6z2t = addedOps[i].outNumber("innerOut_09lct6z2t");\ninnerOut_09lct6z2t.set(port_09lct6z2t.get() );\ninnerOut_09lct6z2t.setUiAttribs({title:"number2"});\nport_09lct6z2t.on("change", (a,v) => { innerOut_09lct6z2t.set(a); });\n\n    }\nif(addedOps[i].innerOutput)\n{\nconst innerIn_driq8l4om = addedOps[i].inTrigger("innerIn_driq8l4om");\ninnerIn_driq8l4om.setUiAttribs({title:"trigger"});\ninnerIn_driq8l4om.onTriggered = () => { port_driq8l4om.trigger(); };\n\n}\n}\n};\n',subpatch_json:'{"ops":[{"id":"sp2-0","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsOut":[{"name":"trigger","links":[{"portIn":"innerIn_driq8l4om","portOut":"trigger","objIn":"sp2-3","objOut":"sp2-0"}]}],"objName":"Ops.Graphics.TransformView"},{"id":"sp2-1","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsIn":[{"name":"Index","value":0}],"portsOut":[{"name":"X","links":[{"portIn":"posX","portOut":"X","objIn":"sp2-0","objOut":"sp2-1"}]},{"name":"Y","links":[{"portIn":"posY","portOut":"Y","objIn":"sp2-0","objOut":"sp2-1"}]},{"name":"Z","links":[{"portIn":"posZ","portOut":"Z","objIn":"sp2-0","objOut":"sp2-1"}]}],"objName":"Ops.Array.Array3GetNumbers"},{"id":"sp2-2","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsOut":[{"name":"innerOut_2uzay3xk0","title":"render","links":[{"portIn":"Execute","portOut":"innerOut_2uzay3xk0","objIn":"sp2-6","objOut":"sp2-2"}]},{"name":"innerOut_byk06hys1","title":"Array","links":[{"portIn":"Array In","portOut":"innerOut_byk06hys1","objIn":"sp2-6","objOut":"sp2-2"}]},{"name":"innerOut_icoiczvtv","title":"number2","links":[{"portIn":"number2","portOut":"innerOut_icoiczvtv","objIn":"sp2-7","objOut":"sp2-2"}]},{"name":"innerOut_6lhmsuqvg","title":"number2","links":[{"portIn":"number2","portOut":"innerOut_6lhmsuqvg","objIn":"sp2-8","objOut":"sp2-2"}]},{"name":"innerOut_09lct6z2t","title":"number2","links":[{"portIn":"number2","portOut":"innerOut_09lct6z2t","objIn":"sp2-9","objOut":"sp2-2"}]}],"objName":"Ops.Ui.SubPatchInput"},{"id":"sp2-3","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsIn":[{"name":"innerIn_driq8l4om","title":"trigger"}],"objName":"Ops.Ui.SubPatchOutput"},{"id":"sp2-4","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsIn":[{"name":"index","value":3},{"name":"Value Invalid Index","value":0}],"portsOut":[{"name":"value","links":[{"portIn":"scale","portOut":"value","objIn":"sp2-0","objOut":"sp2-4"}]},{"name":"Valid Index","value":1}],"objName":"Ops.Array.ArrayGetNumber"},{"id":"sp2-5","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsIn":[{"name":"Index","value":4}],"portsOut":[{"name":"X","links":[{"portIn":"number1","portOut":"X","objIn":"sp2-7","objOut":"sp2-5"}]},{"name":"Y","links":[{"portIn":"number1","portOut":"Y","objIn":"sp2-8","objOut":"sp2-5"}]},{"name":"Z","links":[{"portIn":"number1","portOut":"Z","objIn":"sp2-9","objOut":"sp2-5"}]}],"objName":"Ops.Array.Array3GetNumbers"},{"id":"sp2-6","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsIn":[{"name":"Separate inc/dec","value":0},{"name":"Inc factor","value":30,"title":"Inc/Dec factor"},{"name":"Dec factor","value":4}],"portsOut":[{"name":"Next","links":[{"portIn":"render","portOut":"Next","objIn":"sp2-0","objOut":"sp2-6"}]},{"name":"Array Out","links":[{"portIn":"Array","portOut":"Array Out","objIn":"sp2-1","objOut":"sp2-6"},{"portIn":"array","portOut":"Array Out","objIn":"sp2-4","objOut":"sp2-6"},{"portIn":"Array","portOut":"Array Out","objIn":"sp2-5","objOut":"sp2-6"}]}],"objName":"Ops.Array.SmoothArray"},{"id":"sp2-7","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"rotX","portOut":"result","objIn":"sp2-0","objOut":"sp2-7"}]}],"objName":"Ops.Math.Sum"},{"id":"sp2-8","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"rotY","portOut":"result","objIn":"sp2-0","objOut":"sp2-8"}]}],"objName":"Ops.Math.Sum"},{"id":"sp2-9","uiAttribs":{"subPatch":"wn6chtu8w"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"rotZ","portOut":"result","objIn":"sp2-0","objOut":"sp2-9"}]}],"objName":"Ops.Math.Sum"}]}'};const l=e.inTrigger("2uzay3xk0");l.setUiAttribs({title:"render"});const u=e.inArray("byk06hys1");u.setUiAttribs({title:"Array"});const h=e.inFloat("icoiczvtv",0);h.setUiAttribs({title:"number2"});const c=e.inFloat("6lhmsuqvg",0);c.setUiAttribs({title:"number2"});const f=e.inFloat("09lct6z2t",0);f.setUiAttribs({title:"number2"});const d=e.outTrigger("driq8l4om");d.setUiAttribs({title:"trigger"});e.initInnerPorts=function(t){for(let e=0;e<t.length;e++){if(t[e].innerInput){const i=t[e].outTrigger("innerOut_2uzay3xk0");i.setUiAttribs({title:"render"});l.onTriggered=()=>{i.trigger()};const n=t[e].outArray("innerOut_byk06hys1");n.setUiAttribs({title:"Array"});u.on("change",(e,t)=>{n.setRef(e)});const r=t[e].outNumber("innerOut_icoiczvtv");r.set(h.get());r.setUiAttribs({title:"number2"});h.on("change",(e,t)=>{r.set(e)});const s=t[e].outNumber("innerOut_6lhmsuqvg");s.set(c.get());s.setUiAttribs({title:"number2"});c.on("change",(e,t)=>{s.set(e)});const a=t[e].outNumber("innerOut_09lct6z2t");a.set(f.get());a.setUiAttribs({title:"number2"});f.on("change",(e,t)=>{a.set(e)})}if(t[e].innerOutput){const o=t[e].inTrigger("innerIn_driq8l4om");o.setUiAttribs({title:"trigger"});o.onTriggered=()=>{d.trigger()}}}};const n="bp2sub_"+e.id;new CABLES.SubPatchOp(e,{subId:n});t();function t(){if(!i||!i.subpatch_json)return;const t=JSON.parse(i.subpatch_json);CABLES.Patch.replaceOpIds(t,{parentSubPatchId:n,prefixHash:n,oldIdAsRef:true,doNotUnlinkLostLinks:true});for(let e=0;e<t.ops.length;e++){t.ops[e].uiAttribs.blueprintSubpatch2=true}e.loadDependencies(t,()=>{e.patch.deSerialize(t,{opsCreated:e.initInnerPorts});if(CABLES.UI)gui.savedState.setSaved("blueprintloaded",n);e.patch.emitEvent("subpatchExpose",n);e.setStorage({blueprintVer:2});e.patch.emitEvent("subpatchExpose",n)})}}};CABLES.OPS["fe53a267-5d09-45e5-a791-f1a574055dc4"]={f:Ops.Patch.PGgjVeu.TransfromFromArray,objName:"Ops.Patch.PGgjVeu.TransfromFromArray"};Ops.Patch.PGgjVeu.CalcAspectRatio=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const i=e.attachments={inc_gen_ports_js:'const port_0b4ut0hih=op.inTrigger("0b4ut0hih");\nport_0b4ut0hih.setUiAttribs({title:"Next",});\n\nconst port_nwr6evmz4=op.inFloat("nwr6evmz4",0);\nport_nwr6evmz4.setUiAttribs({title:"number2",});\n\nconst port_5q93l0dx5=op.outTrigger("5q93l0dx5");\nport_5q93l0dx5.setUiAttribs({title:"Next",});\n\nconst port_2u90hfuze=op.outNumber("2u90hfuze");\nport_2u90hfuze.setUiAttribs({title:"result",});\n\nconst port_5vd4oouaz=op.outNumber("5vd4oouaz");\nport_5vd4oouaz.setUiAttribs({title:"result",});\n\nconst port_0c3imfas6=op.outNumber("0c3imfas6");\nport_0c3imfas6.setUiAttribs({title:"Aspect Ratio",});\n\nop.initInnerPorts=function(addedOps)\n{\n  for(let i=0;i<addedOps.length;i++)\n  {\n    if(addedOps[i].innerInput)\n    {\nconst innerOut_0b4ut0hih = addedOps[i].outTrigger("innerOut_0b4ut0hih");\ninnerOut_0b4ut0hih.setUiAttribs({title:"Next"});\nport_0b4ut0hih.onTriggered = () => { innerOut_0b4ut0hih.trigger(); };\n\nconst innerOut_nwr6evmz4 = addedOps[i].outNumber("innerOut_nwr6evmz4");\ninnerOut_nwr6evmz4.set(port_nwr6evmz4.get() );\ninnerOut_nwr6evmz4.setUiAttribs({title:"number2"});\nport_nwr6evmz4.on("change", (a,v) => { innerOut_nwr6evmz4.set(a); });\n\n    }\nif(addedOps[i].innerOutput)\n{\nconst innerIn_5q93l0dx5 = addedOps[i].inTrigger("innerIn_5q93l0dx5");\ninnerIn_5q93l0dx5.setUiAttribs({title:"Next"});\ninnerIn_5q93l0dx5.onTriggered = () => { port_5q93l0dx5.trigger(); };\n\nconst innerIn_2u90hfuze = addedOps[i].inFloat("innerIn_2u90hfuze");\ninnerIn_2u90hfuze.setUiAttribs({title:"result"});\ninnerIn_2u90hfuze.on("change", (a,v) => { port_2u90hfuze.set(a); });\n\nconst innerIn_5vd4oouaz = addedOps[i].inFloat("innerIn_5vd4oouaz");\ninnerIn_5vd4oouaz.setUiAttribs({title:"result"});\ninnerIn_5vd4oouaz.on("change", (a,v) => { port_5vd4oouaz.set(a); });\n\nconst innerIn_0c3imfas6 = addedOps[i].inFloat("innerIn_0c3imfas6");\ninnerIn_0c3imfas6.setUiAttribs({title:"Aspect Ratio"});\ninnerIn_0c3imfas6.on("change", (a,v) => { port_0c3imfas6.set(a); });\n\n}\n}\n};\n',subpatch_json:'{"ops":[{"id":"sp3-0","uiAttribs":{"subPatch":"ta5yict98"},"storage":{},"portsIn":[{"name":"Variable","value":"videoAspectRatio"}],"portsOut":[{"name":"Value","links":[{"portIn":"number1","portOut":"Value","objIn":"sp3-2","objOut":"sp3-0"},{"portIn":"number2","portOut":"Value","objIn":"sp3-1","objOut":"sp3-0"}]}],"objName":"Ops.Vars.VarGetNumber_v2"},{"id":"sp3-1","uiAttribs":{"subPatch":"ta5yict98"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"innerIn_2u90hfuze","portOut":"result","objIn":"sp3-6","objOut":"sp3-1"}]}],"objName":"Ops.Math.Divide"},{"id":"sp3-2","uiAttribs":{"subPatch":"ta5yict98"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"number1","portOut":"result","objIn":"sp3-3","objOut":"sp3-2"}]}],"objName":"Ops.Math.Subtract"},{"id":"sp3-3","uiAttribs":{"subPatch":"ta5yict98"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"innerIn_5vd4oouaz","portOut":"result","objIn":"sp3-6","objOut":"sp3-3"}]}],"objName":"Ops.Math.Sum"},{"id":"sp3-4","uiAttribs":{"subPatch":"ta5yict98"},"storage":{},"portsOut":[{"name":"CSS Width","value":629},{"name":"CSS Height","value":822},{"name":"Pixel Ratio","value":1},{"name":"Pixel Width","value":629},{"name":"Pixel Height","value":822},{"name":"Aspect Ratio","links":[{"portIn":"number1","portOut":"Aspect Ratio","objIn":"sp3-1","objOut":"sp3-4"},{"portIn":"number2","portOut":"Aspect Ratio","objIn":"sp3-2","objOut":"sp3-4"},{"portIn":"innerIn_0c3imfas6","portOut":"Aspect Ratio","objIn":"sp3-6","objOut":"sp3-4"}]},{"name":"Landscape","value":0}],"objName":"Ops.Gl.CanvasInfo_v3"},{"id":"sp3-5","uiAttribs":{"subPatch":"ta5yict98"},"storage":{},"portsOut":[{"name":"innerOut_0b4ut0hih","title":"Next","links":[{"portIn":"innerIn_5q93l0dx5","portOut":"innerOut_0b4ut0hih","objIn":"sp3-6","objOut":"sp3-5"}]},{"name":"innerOut_nwr6evmz4","title":"number2","links":[{"portIn":"number2","portOut":"innerOut_nwr6evmz4","objIn":"sp3-3","objOut":"sp3-5"}]}],"objName":"Ops.Ui.SubPatchInput"},{"id":"sp3-6","uiAttribs":{"subPatch":"ta5yict98"},"storage":{},"portsIn":[{"name":"innerIn_5q93l0dx5","title":"Next"},{"name":"innerIn_2u90hfuze","title":"result"},{"name":"innerIn_5vd4oouaz","title":"result"},{"name":"innerIn_0c3imfas6","title":"Aspect Ratio"}],"objName":"Ops.Ui.SubPatchOutput"}]}'};const l=e.inTrigger("0b4ut0hih");l.setUiAttribs({title:"Next"});const u=e.inFloat("nwr6evmz4",0);u.setUiAttribs({title:"number2"});const h=e.outTrigger("5q93l0dx5");h.setUiAttribs({title:"Next"});const c=e.outNumber("2u90hfuze");c.setUiAttribs({title:"result"});const f=e.outNumber("5vd4oouaz");f.setUiAttribs({title:"result"});const d=e.outNumber("0c3imfas6");d.setUiAttribs({title:"Aspect Ratio"});e.initInnerPorts=function(t){for(let e=0;e<t.length;e++){if(t[e].innerInput){const i=t[e].outTrigger("innerOut_0b4ut0hih");i.setUiAttribs({title:"Next"});l.onTriggered=()=>{i.trigger()};const n=t[e].outNumber("innerOut_nwr6evmz4");n.set(u.get());n.setUiAttribs({title:"number2"});u.on("change",(e,t)=>{n.set(e)})}if(t[e].innerOutput){const r=t[e].inTrigger("innerIn_5q93l0dx5");r.setUiAttribs({title:"Next"});r.onTriggered=()=>{h.trigger()};const s=t[e].inFloat("innerIn_2u90hfuze");s.setUiAttribs({title:"result"});s.on("change",(e,t)=>{c.set(e)});const a=t[e].inFloat("innerIn_5vd4oouaz");a.setUiAttribs({title:"result"});a.on("change",(e,t)=>{f.set(e)});const o=t[e].inFloat("innerIn_0c3imfas6");o.setUiAttribs({title:"Aspect Ratio"});o.on("change",(e,t)=>{d.set(e)})}}};const n="bp2sub_"+e.id;new CABLES.SubPatchOp(e,{subId:n});t();function t(){if(!i||!i.subpatch_json)return;const t=JSON.parse(i.subpatch_json);CABLES.Patch.replaceOpIds(t,{parentSubPatchId:n,prefixHash:n,oldIdAsRef:true,doNotUnlinkLostLinks:true});for(let e=0;e<t.ops.length;e++){t.ops[e].uiAttribs.blueprintSubpatch2=true}e.loadDependencies(t,()=>{e.patch.deSerialize(t,{opsCreated:e.initInnerPorts});if(CABLES.UI)gui.savedState.setSaved("blueprintloaded",n);e.patch.emitEvent("subpatchExpose",n);e.setStorage({blueprintVer:2});e.patch.emitEvent("subpatchExpose",n)})}}};CABLES.OPS["91dbc7d1-e730-48ba-99bd-609e655bb71d"]={f:Ops.Patch.PGgjVeu.CalcAspectRatio,objName:"Ops.Patch.PGgjVeu.CalcAspectRatio"};Ops.User.srcphag.CalcAspectRatio=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const i=e.attachments={inc_gen_ports_js:'const port_5zoeeizsf=op.inFloat("5zoeeizsf",0);\nport_5zoeeizsf.setUiAttribs({title:"number2",});\n\nconst port_stqfp1svi=op.inTrigger("stqfp1svi");\nport_stqfp1svi.setUiAttribs({title:"trigger",});\n\nconst port_4kaudq7u5=op.outNumber("4kaudq7u5");\nport_4kaudq7u5.setUiAttribs({title:"result",});\n\nconst port_9zwxt98wb=op.outNumber("9zwxt98wb");\nport_9zwxt98wb.setUiAttribs({title:"result",});\n\nconst port_bf11i75lz=op.outNumber("bf11i75lz");\nport_bf11i75lz.setUiAttribs({title:"Aspect Ratio",});\n\nconst port_ctfhbmcpr=op.outTrigger("ctfhbmcpr");\nport_ctfhbmcpr.setUiAttribs({title:"trigger",});\n\nop.initInnerPorts=function(addedOps)\n{\n  for(let i=0;i<addedOps.length;i++)\n  {\n    if(addedOps[i].innerInput)\n    {\nconst innerOut_5zoeeizsf = addedOps[i].outNumber("innerOut_5zoeeizsf");\ninnerOut_5zoeeizsf.set(port_5zoeeizsf.get() );\ninnerOut_5zoeeizsf.setUiAttribs({title:"number2"});\nport_5zoeeizsf.on("change", (a,v) => { innerOut_5zoeeizsf.set(a); });\n\nconst innerOut_stqfp1svi = addedOps[i].outTrigger("innerOut_stqfp1svi");\ninnerOut_stqfp1svi.setUiAttribs({title:"trigger"});\nport_stqfp1svi.onTriggered = () => { innerOut_stqfp1svi.trigger(); };\n\n    }\nif(addedOps[i].innerOutput)\n{\nconst innerIn_4kaudq7u5 = addedOps[i].inFloat("innerIn_4kaudq7u5");\ninnerIn_4kaudq7u5.setUiAttribs({title:"result"});\ninnerIn_4kaudq7u5.on("change", (a,v) => { port_4kaudq7u5.set(a); });\n\nconst innerIn_9zwxt98wb = addedOps[i].inFloat("innerIn_9zwxt98wb");\ninnerIn_9zwxt98wb.setUiAttribs({title:"result"});\ninnerIn_9zwxt98wb.on("change", (a,v) => { port_9zwxt98wb.set(a); });\n\nconst innerIn_bf11i75lz = addedOps[i].inFloat("innerIn_bf11i75lz");\ninnerIn_bf11i75lz.setUiAttribs({title:"Aspect Ratio"});\ninnerIn_bf11i75lz.on("change", (a,v) => { port_bf11i75lz.set(a); });\n\nconst innerIn_ctfhbmcpr = addedOps[i].inTrigger("innerIn_ctfhbmcpr");\ninnerIn_ctfhbmcpr.setUiAttribs({title:"trigger"});\ninnerIn_ctfhbmcpr.onTriggered = () => { port_ctfhbmcpr.trigger(); };\n\n}\n}\n};\n',subpatch_json:'{"ops":[{"id":"sp4-0","uiAttribs":{"subPatch":"72hec4f2d"},"storage":{},"portsOut":[{"name":"innerOut_5zoeeizsf","title":"number2","links":[{"portIn":"number2","portOut":"innerOut_5zoeeizsf","objIn":"sp4-5","objOut":"sp4-0"}]},{"name":"innerOut_stqfp1svi","title":"trigger","links":[{"portIn":"innerIn_ctfhbmcpr","portOut":"innerOut_stqfp1svi","objIn":"sp4-1","objOut":"sp4-0"}]}],"objName":"Ops.Ui.SubPatchInput"},{"id":"sp4-1","uiAttribs":{"subPatch":"72hec4f2d"},"storage":{},"portsIn":[{"name":"innerIn_4kaudq7u5","title":"result"},{"name":"innerIn_9zwxt98wb","title":"result"},{"name":"innerIn_bf11i75lz","title":"Aspect Ratio"},{"name":"innerIn_ctfhbmcpr","title":"trigger"}],"objName":"Ops.Ui.SubPatchOutput"},{"id":"sp4-2","uiAttribs":{"subPatch":"72hec4f2d"},"storage":{},"portsIn":[{"name":"Variable","value":"videoAspectRatio"}],"portsOut":[{"name":"Value","links":[{"portIn":"number1","portOut":"Value","objIn":"sp4-4","objOut":"sp4-2"},{"portIn":"number2","portOut":"Value","objIn":"sp4-3","objOut":"sp4-2"}]}],"objName":"Ops.Vars.VarGetNumber_v2"},{"id":"sp4-3","uiAttribs":{"subPatch":"72hec4f2d"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"innerIn_9zwxt98wb","portOut":"result","objIn":"sp4-1","objOut":"sp4-3"}]}],"objName":"Ops.Math.Divide"},{"id":"sp4-4","uiAttribs":{"subPatch":"72hec4f2d"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"number1","portOut":"result","objIn":"sp4-5","objOut":"sp4-4"}]}],"objName":"Ops.Math.Subtract"},{"id":"sp4-5","uiAttribs":{"subPatch":"72hec4f2d"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"innerIn_4kaudq7u5","portOut":"result","objIn":"sp4-1","objOut":"sp4-5"}]}],"objName":"Ops.Math.Sum"},{"id":"sp4-6","uiAttribs":{"subPatch":"72hec4f2d"},"storage":{},"portsOut":[{"name":"CSS Width","value":629},{"name":"CSS Height","value":822},{"name":"Pixel Ratio","value":1},{"name":"Pixel Width","value":629},{"name":"Pixel Height","value":822},{"name":"Aspect Ratio","links":[{"portIn":"number1","portOut":"Aspect Ratio","objIn":"sp4-3","objOut":"sp4-6"},{"portIn":"number2","portOut":"Aspect Ratio","objIn":"sp4-4","objOut":"sp4-6"},{"portIn":"innerIn_bf11i75lz","portOut":"Aspect Ratio","objIn":"sp4-1","objOut":"sp4-6"}]},{"name":"Landscape","value":0}],"objName":"Ops.Gl.CanvasInfo_v3"}]}'};const l=e.inFloat("5zoeeizsf",0);l.setUiAttribs({title:"number2"});const u=e.inTrigger("stqfp1svi");u.setUiAttribs({title:"trigger"});const h=e.outNumber("4kaudq7u5");h.setUiAttribs({title:"result"});const c=e.outNumber("9zwxt98wb");c.setUiAttribs({title:"result"});const f=e.outNumber("bf11i75lz");f.setUiAttribs({title:"Aspect Ratio"});const d=e.outTrigger("ctfhbmcpr");d.setUiAttribs({title:"trigger"});e.initInnerPorts=function(t){for(let e=0;e<t.length;e++){if(t[e].innerInput){const i=t[e].outNumber("innerOut_5zoeeizsf");i.set(l.get());i.setUiAttribs({title:"number2"});l.on("change",(e,t)=>{i.set(e)});const n=t[e].outTrigger("innerOut_stqfp1svi");n.setUiAttribs({title:"trigger"});u.onTriggered=()=>{n.trigger()}}if(t[e].innerOutput){const r=t[e].inFloat("innerIn_4kaudq7u5");r.setUiAttribs({title:"result"});r.on("change",(e,t)=>{h.set(e)});const s=t[e].inFloat("innerIn_9zwxt98wb");s.setUiAttribs({title:"result"});s.on("change",(e,t)=>{c.set(e)});const a=t[e].inFloat("innerIn_bf11i75lz");a.setUiAttribs({title:"Aspect Ratio"});a.on("change",(e,t)=>{f.set(e)});const o=t[e].inTrigger("innerIn_ctfhbmcpr");o.setUiAttribs({title:"trigger"});o.onTriggered=()=>{d.trigger()}}}};const n="bp2sub_"+e.id;new CABLES.SubPatchOp(e,{subId:n});t();function t(){if(!i||!i.subpatch_json)return;const t=JSON.parse(i.subpatch_json);CABLES.Patch.replaceOpIds(t,{parentSubPatchId:n,prefixHash:n,oldIdAsRef:true,doNotUnlinkLostLinks:true});for(let e=0;e<t.ops.length;e++){t.ops[e].uiAttribs.blueprintSubpatch2=true}e.loadDependencies(t,()=>{e.patch.deSerialize(t,{opsCreated:e.initInnerPorts});if(CABLES.UI)gui.savedState.setSaved("blueprintloaded",n);e.patch.emitEvent("subpatchExpose",n);e.setStorage({blueprintVer:2});e.patch.emitEvent("subpatchExpose",n)})}}};CABLES.OPS["b54b86be-5009-4cc4-b3f3-70281c667af5"]={f:Ops.User.srcphag.CalcAspectRatio,objName:"Ops.User.srcphag.CalcAspectRatio"};Ops.User.srcphag.Strobe=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const i=e.attachments={inc_gen_ports_js:'const port_xz0gracpt=op.inTrigger("xz0gracpt");\nport_xz0gracpt.setUiAttribs({title:"Changed",});\n\nconst port_nm7k58wq0=op.inTrigger("nm7k58wq0");\nport_nm7k58wq0.setUiAttribs({title:"Trigger 0",});\n\nconst port_ce2ob73kl=op.outNumber("ce2ob73kl");\nport_ce2ob73kl.setUiAttribs({title:"Opacity",display:"range",});\n\nop.initInnerPorts=function(addedOps)\n{\n  for(let i=0;i<addedOps.length;i++)\n  {\n    if(addedOps[i].innerInput)\n    {\nconst innerOut_xz0gracpt = addedOps[i].outTrigger("innerOut_xz0gracpt");\ninnerOut_xz0gracpt.setUiAttribs({title:"Changed"});\nport_xz0gracpt.onTriggered = () => { innerOut_xz0gracpt.trigger(); };\n\nconst innerOut_nm7k58wq0 = addedOps[i].outTrigger("innerOut_nm7k58wq0");\ninnerOut_nm7k58wq0.setUiAttribs({title:"Trigger 0"});\nport_nm7k58wq0.onTriggered = () => { innerOut_nm7k58wq0.trigger(); };\n\n    }\nif(addedOps[i].innerOutput)\n{\nconst innerIn_ce2ob73kl = addedOps[i].inFloat("innerIn_ce2ob73kl");\ninnerIn_ce2ob73kl.setUiAttribs({title:"Opacity"});\ninnerIn_ce2ob73kl.on("change", (a,v) => { port_ce2ob73kl.set(a); });\n\n}\n}\n};\n',subpatch_json:'{"ops":[{"id":"sp5-0","uiAttribs":{"subPatch":"sltfzq478"},"storage":{},"portsOut":[{"name":"innerOut_xz0gracpt","title":"Changed","links":[{"portIn":"Reset","portOut":"innerOut_xz0gracpt","objIn":"sp5-3","objOut":"sp5-0"}]},{"name":"innerOut_nm7k58wq0","title":"Trigger 0","links":[{"portIn":"Generate","portOut":"innerOut_nm7k58wq0","objIn":"sp5-2","objOut":"sp5-0"}]}],"objName":"Ops.Ui.SubPatchInput"},{"id":"sp5-1","uiAttribs":{"subPatch":"sltfzq478"},"storage":{},"portsIn":[{"name":"innerIn_ce2ob73kl","title":"Opacity"}],"objName":"Ops.Ui.SubPatchOutput"},{"id":"sp5-2","uiAttribs":{"subPatch":"sltfzq478"},"portsIn":[{"name":"min","value":0},{"name":"max","value":1},{"name":"Integer","value":1},{"name":"No consecutive duplicates","value":0}],"portsOut":[{"name":"result","links":[{"portIn":"Value 1","portOut":"result","objIn":"sp5-5","objOut":"sp5-2"}]}],"storage":{"ref":"sp5-2"},"objName":"Ops.Math.TriggerRandomNumber_v2"},{"id":"sp5-3","uiAttribs":{"subPatch":"sltfzq478"},"portsIn":[{"name":"Speed","value":1},{"name":"Play","value":1},{"name":"Sync to timeline","value":0}],"portsOut":[{"name":"Time","links":[{"portIn":"number1","portOut":"Time","objIn":"sp5-4","objOut":"sp5-3"}]}],"storage":{"ref":"sp5-3"},"objName":"Ops.Anim.Timer_v2"},{"id":"sp5-4","uiAttribs":{"subPatch":"sltfzq478"},"portsIn":[{"name":"number2","value":0.2}],"portsOut":[{"name":"result","links":[{"portIn":"Index","portOut":"result","objIn":"sp5-5","objOut":"sp5-4"}]}],"storage":{"ref":"sp5-4"},"objName":"Ops.Math.Compare.LessThan"},{"id":"sp5-5","uiAttribs":{"subPatch":"sltfzq478"},"portsIn":[{"name":"Value 0","value":1},{"name":"Value 2","value":0},{"name":"Value 3","value":0},{"name":"Value 4","value":0},{"name":"Value 5","value":0},{"name":"Value 6","value":0},{"name":"Value 7","value":0},{"name":"Value 8","value":0},{"name":"Value 9","value":0},{"name":"Value 10","value":0},{"name":"Value 11","value":0},{"name":"Value 12","value":0},{"name":"Value 13","value":0},{"name":"Value 14","value":0},{"name":"Value 15","value":0}],"portsOut":[{"name":"Result","links":[{"portIn":"innerIn_ce2ob73kl","portOut":"Result","objIn":"sp5-1","objOut":"sp5-5"}]}],"storage":{"ref":"sp5-5"},"objName":"Ops.Number.SwitchNumber"}]}'};const s=e.inTrigger("xz0gracpt");s.setUiAttribs({title:"Changed"});const a=e.inTrigger("nm7k58wq0");a.setUiAttribs({title:"Trigger 0"});const o=e.outNumber("ce2ob73kl");o.setUiAttribs({title:"Opacity",display:"range"});e.initInnerPorts=function(t){for(let e=0;e<t.length;e++){if(t[e].innerInput){const i=t[e].outTrigger("innerOut_xz0gracpt");i.setUiAttribs({title:"Changed"});s.onTriggered=()=>{i.trigger()};const n=t[e].outTrigger("innerOut_nm7k58wq0");n.setUiAttribs({title:"Trigger 0"});a.onTriggered=()=>{n.trigger()}}if(t[e].innerOutput){const r=t[e].inFloat("innerIn_ce2ob73kl");r.setUiAttribs({title:"Opacity"});r.on("change",(e,t)=>{o.set(e)})}}};const n="bp2sub_"+e.id;new CABLES.SubPatchOp(e,{subId:n});t();function t(){if(!i||!i.subpatch_json)return;const t=JSON.parse(i.subpatch_json);CABLES.Patch.replaceOpIds(t,{parentSubPatchId:n,prefixHash:n,oldIdAsRef:true,doNotUnlinkLostLinks:true});for(let e=0;e<t.ops.length;e++){t.ops[e].uiAttribs.blueprintSubpatch2=true}e.loadDependencies(t,()=>{e.patch.deSerialize(t,{opsCreated:e.initInnerPorts});if(CABLES.UI)gui.savedState.setSaved("blueprintloaded",n);e.patch.emitEvent("subpatchExpose",n);e.setStorage({blueprintVer:2});e.patch.emitEvent("subpatchExpose",n)})}}};CABLES.OPS["0db46c93-d83c-4e48-88d0-de9e2cbb7251"]={f:Ops.User.srcphag.Strobe,objName:"Ops.User.srcphag.Strobe"};Ops.Patch.PGgjVeu.MouseInteract=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const i=e.attachments={inc_gen_ports_js:'const port_d7g5c0h5b=op.inTrigger("d7g5c0h5b");\nport_d7g5c0h5b.setUiAttribs({title:"Trigger 2",});\n\nconst port_ieb1lbewd=op.inFloat("ieb1lbewd",0.1);\nport_ieb1lbewd.setUiAttribs({title:"Value",});\n\nconst port_83lvt4w8p=op.inFloat("83lvt4w8p",1);\nport_83lvt4w8p.setUiAttribs({title:"Value",});\n\nconst port_d58ks5o1j=op.outNumber("d58ks5o1j");\nport_d58ks5o1j.setUiAttribs({title:"Result",});\n\nconst port_eqbeofk6o=op.outNumber("eqbeofk6o");\nport_eqbeofk6o.setUiAttribs({title:"Result",});\n\nconst port_vy0njf6dp=op.outNumber("vy0njf6dp");\nport_vy0njf6dp.setUiAttribs({title:"Result",});\n\nconst port_cq7ouht1r=op.outTrigger("cq7ouht1r");\nport_cq7ouht1r.setUiAttribs({title:"Next",});\n\nop.initInnerPorts=function(addedOps)\n{\n  for(let i=0;i<addedOps.length;i++)\n  {\n    if(addedOps[i].innerInput)\n    {\nconst innerOut_d7g5c0h5b = addedOps[i].outTrigger("innerOut_d7g5c0h5b");\ninnerOut_d7g5c0h5b.setUiAttribs({title:"Trigger 2"});\nport_d7g5c0h5b.onTriggered = () => { innerOut_d7g5c0h5b.trigger(); };\n\nconst innerOut_ieb1lbewd = addedOps[i].outNumber("innerOut_ieb1lbewd");\ninnerOut_ieb1lbewd.set(port_ieb1lbewd.get() );\ninnerOut_ieb1lbewd.setUiAttribs({title:"Value"});\nport_ieb1lbewd.on("change", (a,v) => { innerOut_ieb1lbewd.set(a); });\n\nconst innerOut_83lvt4w8p = addedOps[i].outNumber("innerOut_83lvt4w8p");\ninnerOut_83lvt4w8p.set(port_83lvt4w8p.get() );\ninnerOut_83lvt4w8p.setUiAttribs({title:"Value"});\nport_83lvt4w8p.on("change", (a,v) => { innerOut_83lvt4w8p.set(a); });\n\n    }\nif(addedOps[i].innerOutput)\n{\nconst innerIn_d58ks5o1j = addedOps[i].inFloat("innerIn_d58ks5o1j");\ninnerIn_d58ks5o1j.setUiAttribs({title:"Result"});\ninnerIn_d58ks5o1j.on("change", (a,v) => { port_d58ks5o1j.set(a); });\n\nconst innerIn_eqbeofk6o = addedOps[i].inFloat("innerIn_eqbeofk6o");\ninnerIn_eqbeofk6o.setUiAttribs({title:"Result"});\ninnerIn_eqbeofk6o.on("change", (a,v) => { port_eqbeofk6o.set(a); });\n\nconst innerIn_vy0njf6dp = addedOps[i].inFloat("innerIn_vy0njf6dp");\ninnerIn_vy0njf6dp.setUiAttribs({title:"Result"});\ninnerIn_vy0njf6dp.on("change", (a,v) => { port_vy0njf6dp.set(a); });\n\nconst innerIn_cq7ouht1r = addedOps[i].inTrigger("innerIn_cq7ouht1r");\ninnerIn_cq7ouht1r.setUiAttribs({title:"Next"});\ninnerIn_cq7ouht1r.onTriggered = () => { port_cq7ouht1r.trigger(); };\n\n}\n}\n};\n',subpatch_json:'{"ops":[{"id":"sp6-0","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Play","value":1},{"name":"Sync to timeline","value":0}],"portsOut":[{"name":"Time","links":[{"portIn":"number2","portOut":"Time","objIn":"sp6-1","objOut":"sp6-0"},{"portIn":"number2","portOut":"Time","objIn":"sp6-2","objOut":"sp6-0"},{"portIn":"number2","portOut":"Time","objIn":"sp6-12","objOut":"sp6-0"}]}],"objName":"Ops.Anim.Timer_v2"},{"id":"sp6-1","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"Value","portOut":"result","objIn":"sp6-4","objOut":"sp6-1"}]}],"objName":"Ops.Math.Sum"},{"id":"sp6-2","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"Value","portOut":"result","objIn":"sp6-5","objOut":"sp6-2"}]}],"objName":"Ops.Math.Sum"},{"id":"sp6-3","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Default Value","value":0}],"portsOut":[{"name":"Current value","links":[{"portIn":"number1","portOut":"Current value","objIn":"sp6-1","objOut":"sp6-3"}]}],"objName":"Ops.Math.Accumulator"},{"id":"sp6-4","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Separate inc/dec","value":0},{"name":"Inc factor","value":10,"title":"Inc/Dec factor"},{"name":"Dec factor","value":4}],"portsOut":[{"name":"Next","links":[{"portIn":"innerIn_cq7ouht1r","portOut":"Next","objIn":"sp6-14","objOut":"sp6-4"}]},{"name":"Result","links":[{"portIn":"innerIn_d58ks5o1j","portOut":"Result","objIn":"sp6-14","objOut":"sp6-4"}]}],"objName":"Ops.Anim.Smooth"},{"id":"sp6-5","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Separate inc/dec","value":0},{"name":"Inc factor","value":10,"title":"Inc/Dec factor"},{"name":"Dec factor","value":4}],"portsOut":[{"name":"Result","links":[{"portIn":"innerIn_eqbeofk6o","portOut":"Result","objIn":"sp6-14","objOut":"sp6-5"}]}],"objName":"Ops.Anim.Smooth"},{"id":"sp6-6","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Default Value","value":0}],"portsOut":[{"name":"Current value","links":[{"portIn":"number1","portOut":"Current value","objIn":"sp6-2","objOut":"sp6-6"}]}],"objName":"Ops.Math.Accumulator"},{"id":"sp6-7","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsOut":[{"name":"has focus","links":[{"portIn":"number1","portOut":"has focus","objIn":"sp6-20","objOut":"sp6-7"}]},{"name":"Tab Visible","links":[{"portIn":"number2","portOut":"Tab Visible","objIn":"sp6-20","objOut":"sp6-7"}]}],"objName":"Ops.Html.WindowHasFocus"},{"id":"sp6-8","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Play","value":1},{"name":"Sync to timeline","value":0}],"portsOut":[{"name":"Time","links":[{"portIn":"number1","portOut":"Time","objIn":"sp6-18","objOut":"sp6-8"}]}],"objName":"Ops.Anim.Timer_v2"},{"id":"sp6-9","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsOut":[{"name":"Number","value":-0.8713826366559485}],"objName":"Ops.Number.TriggerOnChangeNumber"},{"id":"sp6-10","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Add to number","value":0},{"name":"Default Value","value":0}],"portsOut":[{"name":"Current value","links":[{"portIn":"number1","portOut":"Current value","objIn":"sp6-12","objOut":"sp6-10"}]}],"objName":"Ops.Math.Accumulator"},{"id":"sp6-11","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Separate inc/dec","value":0},{"name":"Inc factor","value":10,"title":"Inc/Dec factor"},{"name":"Dec factor","value":4}],"portsOut":[{"name":"Result","value":49.21075216427015}],"objName":"Ops.Anim.Smooth"},{"id":"sp6-12","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"Value","portOut":"result","objIn":"sp6-11","objOut":"sp6-12"}]}],"objName":"Ops.Math.Sum"},{"id":"sp6-13","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsOut":[{"name":"innerOut_d7g5c0h5b","title":"Trigger 2","links":[{"portIn":"Execute","portOut":"innerOut_d7g5c0h5b","objIn":"sp6-19","objOut":"sp6-13"}]},{"name":"innerOut_ieb1lbewd","title":"Value","links":[{"portIn":"number2","portOut":"innerOut_ieb1lbewd","objIn":"sp6-22","objOut":"sp6-13"}]},{"name":"innerOut_83lvt4w8p","title":"Value","links":[{"portIn":"number2","portOut":"innerOut_83lvt4w8p","objIn":"sp6-21","objOut":"sp6-13"}]}],"objName":"Ops.Ui.SubPatchInput"},{"id":"sp6-14","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"innerIn_d58ks5o1j","title":"Result"},{"name":"innerIn_eqbeofk6o","title":"Result"},{"name":"innerIn_vy0njf6dp","value":0,"title":"Result"},{"name":"innerIn_cq7ouht1r","title":"Next"}],"objName":"Ops.Ui.SubPatchOutput"},{"id":"sp6-15","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"old min","value":0},{"name":"old max","value":1},{"name":"new min","value":0},{"name":"new max","value":1},{"name":"Easing index","value":1},{"name":"Easing","value":"Smoothstep"},{"name":"Clamp","value":1}],"portsOut":[{"name":"result","links":[{"portIn":"Multiplier to add number","portOut":"result","objIn":"sp6-10","objOut":"sp6-15"},{"portIn":"Multiplier to add number","portOut":"result","objIn":"sp6-6","objOut":"sp6-15"},{"portIn":"Multiplier to add number","portOut":"result","objIn":"sp6-3","objOut":"sp6-15"}]}],"objName":"Ops.Math.MapRange"},{"id":"sp6-16","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Index","value":0}],"portsOut":[{"name":"X","links":[{"portIn":"Value","portOut":"X","objIn":"sp6-9","objOut":"sp6-16"},{"portIn":"Add to number","portOut":"X","objIn":"sp6-6","objOut":"sp6-16"}]},{"name":"Y","links":[{"portIn":"Add to number","portOut":"Y","objIn":"sp6-3","objOut":"sp6-16"}]},{"name":"Z","value":0}],"objName":"Ops.Array.Array3GetNumbers"},{"id":"sp6-17","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"Variable","value":"mousePosition"}],"portsOut":[{"name":"Value","links":[{"portIn":"Array","portOut":"Value","objIn":"sp6-16","objOut":"sp6-17"}]}],"objName":"Ops.Vars.VarGetArray_v2"},{"id":"sp6-18","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsIn":[{"name":"number2","value":1}],"portsOut":[{"name":"result","links":[{"portIn":"value","portOut":"result","objIn":"sp6-15","objOut":"sp6-18"}]}],"objName":"Ops.Math.Multiply"},{"id":"sp6-19","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsOut":[{"name":"Switched Value","value":1},{"name":"Trigger 1","links":[{"portIn":"Trigger in","portOut":"Trigger 1","objIn":"sp6-3","objOut":"sp6-19"},{"portIn":"Trigger in","portOut":"Trigger 1","objIn":"sp6-6","objOut":"sp6-19"},{"portIn":"Trigger in","portOut":"Trigger 1","objIn":"sp6-10","objOut":"sp6-19"},{"portIn":"Update","portOut":"Trigger 1","objIn":"sp6-4","objOut":"sp6-19"},{"portIn":"Update","portOut":"Trigger 1","objIn":"sp6-5","objOut":"sp6-19"},{"portIn":"Update","portOut":"Trigger 1","objIn":"sp6-11","objOut":"sp6-19"}]},{"name":"Highest Index","value":1}],"objName":"Ops.Trigger.RouteTrigger"},{"id":"sp6-20","uiAttribs":{"subPatch":"6ilpr9ir4"},"storage":{},"portsOut":[{"name":"result","links":[{"portIn":"Switch Value","portOut":"result","objIn":"sp6-19","objOut":"sp6-20"},{"portIn":"number1","portOut":"result","objIn":"sp6-21","objOut":"sp6-20"},{"portIn":"number1","portOut":"result","objIn":"sp6-22","objOut":"sp6-20"}]}],"objName":"Ops.Math.Compare.Equals"},{"id":"sp6-21","uiAttribs":{"subPatch":"6ilpr9ir4"},"portsOut":[{"name":"result","links":[{"portIn":"Speed","portOut":"result","objIn":"sp6-8","objOut":"sp6-21"}]}],"storage":{"ref":"sp6-21"},"objName":"Ops.Math.Multiply"},{"id":"sp6-22","uiAttribs":{"subPatch":"6ilpr9ir4"},"portsOut":[{"name":"result","links":[{"portIn":"Speed","portOut":"result","objIn":"sp6-0","objOut":"sp6-22"}]}],"storage":{"ref":"sp6-22"},"objName":"Ops.Math.Multiply"}]}'};const u=e.inTrigger("d7g5c0h5b");u.setUiAttribs({title:"Trigger 2"});const h=e.inFloat("ieb1lbewd",.1);h.setUiAttribs({title:"Value"});const c=e.inFloat("83lvt4w8p",1);c.setUiAttribs({title:"Value"});const f=e.outNumber("d58ks5o1j");f.setUiAttribs({title:"Result"});const d=e.outNumber("eqbeofk6o");d.setUiAttribs({title:"Result"});const g=e.outNumber("vy0njf6dp");g.setUiAttribs({title:"Result"});const m=e.outTrigger("cq7ouht1r");m.setUiAttribs({title:"Next"});e.initInnerPorts=function(t){for(let e=0;e<t.length;e++){if(t[e].innerInput){const i=t[e].outTrigger("innerOut_d7g5c0h5b");i.setUiAttribs({title:"Trigger 2"});u.onTriggered=()=>{i.trigger()};const n=t[e].outNumber("innerOut_ieb1lbewd");n.set(h.get());n.setUiAttribs({title:"Value"});h.on("change",(e,t)=>{n.set(e)});const r=t[e].outNumber("innerOut_83lvt4w8p");r.set(c.get());r.setUiAttribs({title:"Value"});c.on("change",(e,t)=>{r.set(e)})}if(t[e].innerOutput){const s=t[e].inFloat("innerIn_d58ks5o1j");s.setUiAttribs({title:"Result"});s.on("change",(e,t)=>{f.set(e)});const a=t[e].inFloat("innerIn_eqbeofk6o");a.setUiAttribs({title:"Result"});a.on("change",(e,t)=>{d.set(e)});const o=t[e].inFloat("innerIn_vy0njf6dp");o.setUiAttribs({title:"Result"});o.on("change",(e,t)=>{g.set(e)});const l=t[e].inTrigger("innerIn_cq7ouht1r");l.setUiAttribs({title:"Next"});l.onTriggered=()=>{m.trigger()}}}};const n="bp2sub_"+e.id;new CABLES.SubPatchOp(e,{subId:n});t();function t(){if(!i||!i.subpatch_json)return;const t=JSON.parse(i.subpatch_json);CABLES.Patch.replaceOpIds(t,{parentSubPatchId:n,prefixHash:n,oldIdAsRef:true,doNotUnlinkLostLinks:true});for(let e=0;e<t.ops.length;e++){t.ops[e].uiAttribs.blueprintSubpatch2=true}e.loadDependencies(t,()=>{e.patch.deSerialize(t,{opsCreated:e.initInnerPorts});if(CABLES.UI)gui.savedState.setSaved("blueprintloaded",n);e.patch.emitEvent("subpatchExpose",n);e.setStorage({blueprintVer:2});e.patch.emitEvent("subpatchExpose",n)})}}};CABLES.OPS["38017d40-69c5-4b36-ac8d-f29966617da3"]={f:Ops.Patch.PGgjVeu.MouseInteract,objName:"Ops.Patch.PGgjVeu.MouseInteract"};Ops.Anim.Timer_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const s=e.inValue("Speed",1),i=e.inValueBool("Play",true),n=e.inTriggerButton("Reset"),r=e.inValueBool("Sync to timeline",false),a=e.outNumber("Time");e.setPortGroup("Controls",[i,n,s]);const o=new CABLES.Timer;let l=null;let u=0;let h=false;i.onChange=c;c();function c(){if(i.get()){o.play();e.patch.addOnAnimFrame(e)}else{o.pause();e.patch.removeOnAnimFrame(e)}}n.onTriggered=f;function f(){u=0;l=null;o.setTime(0);a.set(0)}r.onChange=function(){h=r.get();i.setUiAttribs({greyout:h});n.setUiAttribs({greyout:h})};e.onAnimFrame=function(e,t,i){if(o.isPlaying()){if(CABLES.overwriteTime!==undefined){a.set(CABLES.overwriteTime*s.get())}else if(h){a.set(e*s.get())}else{o.update();const n=o.get();if(l===null){l=n;return}const r=Math.abs(n-l);l=n;u+=r*s.get();if(u!=u)u=0;a.set(u)}}}}};CABLES.OPS["aac7f721-208f-411a-adb3-79adae2e471a"]={f:Ops.Anim.Timer_v2,objName:"Ops.Anim.Timer_v2"};Ops.Anim.Smooth=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Update"),n=e.inBool("Separate inc/dec",false),r=e.inValue("Value"),s=e.outTrigger("Next"),a=e.inValue("Inc factor",4),o=e.inValue("Dec factor",4),l=e.outNumber("Result",0);let u=0;let h=0;let c=0;let f=0;e.toWorkPortsNeedToBeLinked(i);let d;let g;let m=4;let p=true;let _=0;const b=0;const v=1;A();T();n.setUiAttribs({hidePort:true});a.onChange=o.onChange=T;n.onChange=A;E();function A(){const e=n.get();if(!e)_=b;else _=v;if(_==b){o.setUiAttribs({greyout:true});a.setUiAttribs({title:"Inc/Dec factor"})}else if(_==v){o.setUiAttribs({greyout:false});a.setUiAttribs({title:"Inc factor"})}T();E()}function T(){if(_==b){d=a.get();g=a.get()}else if(_==v){d=a.get();g=o.get()}if(d<=.2||d!=d)d=.2;if(g<=.2||g!=g)g=.2}r.onChange=function(){p=false;let e=h;h=r.get()};a.onChange=function(){T()};function E(){let e=1;if(performance.now()-f>500||f===0)u=r.get()||0;else e=(performance.now()-f)/(performance.now()-f);f=performance.now();if(u!=u)u=0;if(m<=0)m=1e-4;const t=h-u;if(t>=0)u+=t/(g*e);else u+=t/(d*e);if(Math.abs(t)<1e-5)u=h;if(m!=m)u=0;if(u!=u||u==-Infinity||u==Infinity)u=r.get();if(c!=u){l.set(u);c=u}if(u==h&&!p){p=true;l.set(u)}}i.onTriggered=function(){E();s.trigger()}}};CABLES.OPS["5677b5b5-753a-4fbf-9e91-64c81ec68a2f"]={f:Ops.Anim.Smooth,objName:"Ops.Anim.Smooth"};Ops.Html.WindowHasFocus=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.outBoolNum("has focus"),n=t.outBoolNum("Tab Visible",true);const r=true;i.set(t.patch.getDocument().hasFocus());window.addEventListener("blur",a);window.addEventListener("focus",s);t.patch.getDocument().addEventListener("visibilitychange",o);t.onDelete=function(){t.patch.getDocument().removeEventListener("visibilitychange",o)};function s(){i.set(true)}function a(){i.set(false)}function o(e){n.set(!t.patch.getDocument().hidden)}}};CABLES.OPS["6542896e-aa13-4b57-81e0-163597f4149a"]={f:Ops.Html.WindowHasFocus,objName:"Ops.Html.WindowHasFocus"};Ops.Ui.SubPatchInput=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};t.innerInput=true;const i=t.inTriggerButton("Goto SubPatchOp");i.setUiAttribs({hidePort:true});i.onTriggered=()=>{const e=t.patch.getSubPatchOuterOp(t.uiAttribs.subPatch);gui.patchView.centerSelectOp(e.id)}}};CABLES.OPS["c4e4e933-136e-479e-8de8-0b35b75d9217"]={f:Ops.Ui.SubPatchInput,objName:"Ops.Ui.SubPatchInput"};Ops.Ui.SubPatchOutput=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};e.innerOutput=true}};CABLES.OPS["02d45073-7936-4830-81ad-59a162febf1f"]={f:Ops.Ui.SubPatchOutput,objName:"Ops.Ui.SubPatchOutput"};Ops.Math.Multiply=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),n=e.inValueFloat("number2",1),r=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=n.onChange=s;s();function s(){const e=i.get();const t=n.get();r.set(e*t)}}};CABLES.OPS["1bbdae06-fbb2-489b-9bcc-36c9d65bd441"]={f:Ops.Math.Multiply,objName:"Ops.Math.Multiply"};Ops.Graphics.TransformView=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inTrigger("render"),n=i.inValueFloat("posX"),r=i.inValueFloat("posY"),s=i.inValueFloat("posZ"),a=i.inValueFloat("scale"),o=i.inValueFloat("rotX"),l=i.inValueFloat("rotY"),u=i.inValueFloat("rotZ"),h=i.outTrigger("trigger");i.setPortGroup("Position",[n,r,s]);i.setPortGroup("Scale",[a]);i.setPortGroup("Rotation",[o,u,l]);const c=vec3.create();const f=vec3.create();const d=mat4.create();mat4.identity(d);let g=false;let m=false;let p=true;let _=true;let b=true;t.onTriggered=function(){const e=i.patch.cg||i.patch.cgl;let t=false;if(p){A();t=true}if(_){T();t=true}if(b){t=true}if(t)v();e.pushViewMatrix();mat4.multiply(e.vMatrix,e.vMatrix,d);h.trigger();e.popViewMatrix();if(i.isCurrentUiOp())gui.setTransformGizmo({posX:n,posY:r,posZ:s})};i.transform3d=function(){return{pos:[n,r,s]}};function v(){mat4.identity(d);if(m)mat4.translate(d,d,c);if(o.get()!==0)mat4.rotateX(d,d,o.get()*CGL.DEG2RAD);if(l.get()!==0)mat4.rotateY(d,d,l.get()*CGL.DEG2RAD);if(u.get()!==0)mat4.rotateZ(d,d,u.get()*CGL.DEG2RAD);if(g)mat4.scale(d,d,f);O=false}function A(){m=false;if(n.get()!==0||r.get()!==0||s.get()!==0)m=true;vec3.set(c,n.get(),r.get(),s.get());p=false}function T(){g=false;if(a.get()!==0)g=true;vec3.set(f,a.get(),a.get(),a.get());x=false}function E(){p=true}function x(){_=true}function O(){b=true}o.onChange=l.onChange=u.onChange=O;a.onChange=x;n.onChange=r.onChange=s.onChange=E;o.set(0);l.set(0);u.set(0);a.set(1);n.set(0);r.set(0);s.set(0);v()}};CABLES.OPS["0b3e04f7-323e-4ac8-8a22-a21e2f36e0e9"]={f:Ops.Graphics.TransformView,objName:"Ops.Graphics.TransformView"};Ops.Array.Array3GetNumbers=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Array",3),n=e.inValueInt("Index"),r=e.outNumber("X"),s=e.outNumber("Y"),a=e.outNumber("Z");e.toWorkPortsNeedToBeLinked(i);i.onChange=n.onChange=o;function o(){let e=i.get();if(!e){r.set(0);s.set(0);a.set(0);return}let t=Math.min(e.length-3,n.get()*3);if(e){r.set(e[t+0]);s.set(e[t+1]);a.set(e[t+2])}}}};CABLES.OPS["56882cc4-c40d-4dc0-bf7c-db1b5a7acad0"]={f:Ops.Array.Array3GetNumbers,objName:"Ops.Array.Array3GetNumbers"};Ops.Array.ArrayGetNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("array"),n=e.inValueInt("index"),r=e.inFloat("Value Invalid Index",0),s=e.outNumber("value"),a=e.outBoolNum("Valid Index",true);i.ignoreValueSerialize=true;e.toWorkPortsNeedToBeLinked(i);n.onChange=i.onChange=o;function o(){if(i.get()){const e=i.get()[n.get()];if(isNaN(e)){s.set(r.get());a.set(false)}else{a.set(true);s.set(parseFloat(e))}}}}};CABLES.OPS["d1189078-70cf-437d-9a37-b2ebe89acdaf"]={f:Ops.Array.ArrayGetNumber,objName:"Ops.Array.ArrayGetNumber"};Ops.Array.SmoothArray=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Execute"),r=e.inArray("Array In"),n=e.inBool("Separate inc/dec",false),s=e.inValue("Inc factor",4),a=e.inValue("Dec factor",4),o=e.outTrigger("Next"),l=e.outArray("Array Out");let u=[];let h=false;let c=0;let f=[];l.set(f);let d;let g;let m=false;p();_();function p(){m=n.get();if(!m){a.setUiAttribs({greyout:true});s.setUiAttribs({title:"Inc/Dec factor"})}else{a.setUiAttribs({greyout:false});s.setUiAttribs({title:"Inc factor"})}_();v()}function _(){d=s.get();if(m==false)g=s.get();else g=a.get();if(d<=0||d!=d)d=1e-4;if(g<=0||g!=g)g=1e-4;if(d<=1)d=1;if(g<=1)g=1}r.onLinkChanged=()=>{if(r)r.copyLinkedUiAttrib("stride",l)};r.onChange=function(){let t=r.get();if(!t)return;for(let e=0;e<t.length;e++){u[e]=t[e]||0}};let b=0;function v(){let e=r.get();if(!e)return;if(f.length!=e.length){f.length=e.length||0;h=true}let i=1;if(CABLES.now()-c>500||c===0)h=true;else i=(CABLES.now()-c)/17;c=CABLES.now();if(h){for(var n=0;n<e.length;n++){f[n]=e[n]}h=false}for(var n=0;n<e.length;n++){let e=f[n];let t=u[n]-e;if(t>=0)e+=t/(g*i);else e+=t/(d*i);if(e>0&&e<1e-9)e=0;if(!e)e=0;if(f[n]!=e){f[n]=e;b=e}}l.setRef(f);o.trigger()}i.onTriggered=function(){v()};s.onChange=a.onChange=_;n.onChange=p;v()}};CABLES.OPS["8fd2ed9b-02e5-4349-b7bc-6665ca240ffa"]={f:Ops.Array.SmoothArray,objName:"Ops.Array.SmoothArray"};Ops.Math.Sum=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",0),n=e.inValueFloat("number2",0),r=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=n.onChange=s;s();function s(){const e=i.get()+n.get();if(!isNaN(e))r.set(e)}}};CABLES.OPS["c8fb181e-0b03-4b41-9e55-06b6267bc634"]={f:Ops.Math.Sum,objName:"Ops.Math.Sum"};Ops.Vars.VarGetNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outNumber("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"number",e.varName,i)}};CABLES.OPS["421f5b52-c0fa-47c4-8b7a-012b9e1c864a"]={f:Ops.Vars.VarGetNumber_v2,objName:"Ops.Vars.VarGetNumber_v2"};Ops.Math.Divide=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),n=e.inValueFloat("number2",2),r=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=n.onChange=s;s();function s(){r.set(i.get()/n.get())}}};CABLES.OPS["86fcfd8c-038d-4b91-9820-a08114f6b7eb"]={f:Ops.Math.Divide,objName:"Ops.Math.Divide"};Ops.Math.Subtract=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("number1",1),n=e.inValue("number2",1),r=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=n.onChange=s;s();function s(){let e=i.get()-n.get();if(!isNaN(e))r.set(e)}}};CABLES.OPS["a4ffe852-d200-4b96-9347-68feb01122ca"]={f:Ops.Math.Subtract,objName:"Ops.Math.Subtract"};Ops.Gl.CanvasInfo_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.outNumber("CSS Width"),n=t.outNumber("CSS Height"),r=t.outNumber("Pixel Ratio"),s=t.outNumber("Pixel Width"),a=t.outNumber("Pixel Height"),o=t.outNumber("Aspect Ratio"),l=t.outBool("Landscape"),u=t.outObject("Canvas","element"),h=t.outObject("Canvas Parent","element"),c=t.outTrigger("Resized");let f=t.patch.cgl;u.set(t.patch.cgl.canvas);h.set(t.patch.cgl.canvas.parentElement);f.on("resize",()=>{c.trigger();d()});d();function d(){let e=1;if(f.canvasHeight==0)setTimeout(d,100);n.set(f.canvasHeight/t.patch.cgl.pixelDensity);i.set(f.canvasWidth/t.patch.cgl.pixelDensity);s.set(f.canvasWidth);a.set(f.canvasHeight);r.set(t.patch.cgl.pixelDensity);o.set(f.canvasWidth/f.canvasHeight);l.set(f.canvasWidth>f.canvasHeight?1:0)}}};CABLES.OPS["be186ff9-427e-409f-b6a4-f8d957bf7bc7"]={f:Ops.Gl.CanvasInfo_v3,objName:"Ops.Gl.CanvasInfo_v3"};Ops.Math.TriggerRandomNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Generate"),n=e.inValue("min",0),r=e.inValue("max",1),s=e.outTrigger("next"),a=e.outNumber("result"),o=e.inValueBool("Integer",false),l=e.inValueBool("No consecutive duplicates",false);e.setPortGroup("Value Range",[n,r]);i.onTriggered=r.onChange=n.onChange=o.onChange=u;u();function u(){let e=Math.random()*(r.get()-n.get())+n.get();if(o.get())e=h();if(n.get()!=r.get()&&r.get()>n.get())while(l.get()&&e==a.get())e=h();a.set(e);s.trigger()}function h(){return Math.floor(Math.random()*(r.get()-n.get()+1)+n.get())}}};CABLES.OPS["26f446cc-9107-4164-8209-5254487fa132"]={f:Ops.Math.TriggerRandomNumber_v2,objName:"Ops.Math.TriggerRandomNumber_v2"};Ops.Math.Compare.LessThan=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("number1");const n=e.inValue("number2");const r=e.outBoolNum("result");e.setUiAttribs({mathTitle:true});i.onChange=s;n.onChange=s;s();function s(){r.set(i.get()<n.get())}}};CABLES.OPS["04fd113f-ade1-43fb-99fa-f8825f8814c0"]={f:Ops.Math.Compare.LessThan,objName:"Ops.Math.Compare.LessThan"};Ops.Number.SwitchNumber=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inValueInt("Index");const n=[];const r=i.outNumber("Result");t.onChange=s;for(let t=0;t<16;t++){let e=i.inValueFloat("Value "+t);n.push(e);e.onChange=s}function s(){const e=t.get();if(e>=0&&n[e]){r.set(n[e].get())}}}};CABLES.OPS["fbb89f72-f2e3-4d34-ad01-7d884a1bcdc0"]={f:Ops.Number.SwitchNumber,objName:"Ops.Number.SwitchNumber"};Ops.Math.Accumulator=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Trigger in"),n=e.inValueFloat("Add to number",0),r=e.inValueFloat("Multiplier to add number",1),s=e.inValueFloat("Default Value",1),a=e.inTriggerButton("Set Default Value"),o=e.outNumber("Current value");let l=performance.now();let u=0;let h=true;a.onTriggered=c;function c(){u=s.get();o.set(u);h=true}i.onTriggered=function(){if(!h){let e=(performance.now()-l)/100;u+=n.get()*e*r.get();o.set(u)}l=performance.now();h=false}}};CABLES.OPS["460574ca-dca2-4283-8c37-57a8c446a51f"]={f:Ops.Math.Accumulator,objName:"Ops.Math.Accumulator"};Ops.Number.TriggerOnChangeNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inFloat("Value"),n=e.outTrigger("Next"),r=e.outNumber("Number");i.onChange=function(){r.set(i.get());n.trigger()}}};CABLES.OPS["f5c8c433-ce13-49c4-9a33-74e98f110ed0"]={f:Ops.Number.TriggerOnChangeNumber,objName:"Ops.Number.TriggerOnChangeNumber"};Ops.Math.MapRange=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const f=e.inValueFloat("value",0),d=e.inValueFloat("old min",0),g=e.inValueFloat("old max",1),m=e.inValueFloat("new min",0),p=e.inValueFloat("new max",1),i=e.inValueSelect("Easing",["Linear","Smoothstep","Smootherstep"],"Linear"),n=e.inBool("Clamp",true),_=e.outNumber("result",0);e.setPortGroup("Input Range",[d,g]);e.setPortGroup("Output Range",[m,p]);let b=true;let v=0;let A=0;f.onChange=d.onChange=g.onChange=m.onChange=p.onChange=r;r();n.onChange=()=>{b=n.get();r()};i.onChange=function(){if(i.get()=="Smoothstep")v=1;else if(i.get()=="Smootherstep")v=2;else v=0};function r(){const e=m.get();const t=p.get();const i=d.get();const n=g.get();let r=f.get();if(b){if(r>=Math.max(n,i)){_.set(t);return}else if(r<=Math.min(n,i)){_.set(e);return}}let s=false;const a=Math.min(i,n);const o=Math.max(i,n);if(a!=i)s=true;let l=false;const u=Math.min(e,t);const h=Math.max(e,t);if(u!=e)l=true;let c=0;if(s)c=(o-r)*(h-u)/(o-a);else c=(r-a)*(h-u)/(o-a);if(l)A=h-c;else A=c+u;if(v===0){_.set(A)}else if(v==1){r=Math.max(0,Math.min(1,(A-e)/(t-e)));_.set(e+r*r*(3-2*r)*(t-e))}else if(v==2){r=Math.max(0,Math.min(1,(A-e)/(t-e)));_.set(e+r*r*r*(r*(r*6-15)+10)*(t-e))}}}};CABLES.OPS["2617b407-60a0-4ff6-b4a7-18136cfa7817"]={f:Ops.Math.MapRange,objName:"Ops.Math.MapRange"};Ops.Vars.VarGetArray_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outArray("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"array",e.varName,i)}};CABLES.OPS["afa79294-aa9c-43bc-a49a-cade000a1de5"]={f:Ops.Vars.VarGetArray_v2,objName:"Ops.Vars.VarGetArray_v2"};Ops.Trigger.RouteTrigger=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=24;const n=t.inTriggerButton("Execute"),r=t.inValueInt("Switch Value"),s=t.outTrigger("Next Trigger"),a=t.outNumber("Switched Value");const o=[];n.onTriggered=h;r.setUiAttribs({tlEase:1});for(let e=0;e<i;e++){o[e]=t.outTrigger("Trigger "+e);o[e].onLinkChanged=c}const l=t.outTrigger("Default Trigger"),u=t.outNumber("Highest Index");function h(){const e=Math.round(r.get());if(e>=0&&e<i){a.set(e);o[e].trigger()}else{a.set(-1);l.trigger()}s.trigger()}function c(){let t=0;for(let e=0;e<o.length;e++)if(o[e]&&o[e].isLinked())t=e;u.set(t)}}};CABLES.OPS["44ceb5d8-b040-4722-b189-a6fb8172517d"]={f:Ops.Trigger.RouteTrigger,objName:"Ops.Trigger.RouteTrigger"};Ops.Math.Compare.Equals=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("number1",1),n=e.inValue("number2",1),r=e.outBoolNum("result");i.onChange=n.onChange=s;s();function s(){r.set(i.get()==n.get())}}};CABLES.OPS["4dd3cc55-eebc-4187-9d4e-2e053a956fab"]={f:Ops.Math.Compare.Equals,objName:"Ops.Math.Compare.Equals"};Ops.Devices.Mouse.Mouse_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const D=t.attachments={};const e=t.inSwitch("Coordinates",["-1 to 1","Pixel Display","Pixel","0 to 1"],"-1 to 1"),r=t.inValueSelect("Area",["Canvas","Document","Parent Element","Canvas Area"],"Canvas"),s=t.inValueBool("flip y",true),i=t.inBool("right click prevent default",true),n=t.inValueBool("Touch support",true),a=t.inValueBool("Passive Events",false),o=t.inValueBool("Active",true),l=t.outNumber("x",0),u=t.outNumber("y",0),h=t.outTrigger("click"),c=t.outTrigger("click right"),f=t.outBoolNum("Button is down"),d=t.outBoolNum("Mouse is hovering"),g=t.outNumber("Movement X",0),m=t.outNumber("Movement Y",0);const p=t.patch.cgl;let _=1;let b=null;let v=null;a.onChange=r.onChange=L;e.onChange=U;t.onDelete=w;L();t.on("loadedValueSet",A);function A(){if(_==0){if(v.clientWidth===0)setTimeout(A,50);l.set(v.clientWidth/2);u.set(v.clientHeight/2)}else if(_==1){l.set(0);u.set(0)}else if(_==2){l.set(.5);u.set(.5)}else if(_==3){if(v.clientWidth===0){setTimeout(A,50)}l.set(v.clientWidth/2/p.pixelDensity);u.set(v.clientHeight/2/p.pixelDensity)}else console.error("unknown normalize mouse",_)}function k(r,s){r=r||0;s=s||0;if(_==0){l.set(r);u.set(s)}else if(_==3){l.set(r*p.pixelDensity);u.set(s*p.pixelDensity)}else{let i=v.clientWidth/p.pixelDensity;let n=v.clientHeight/p.pixelDensity;i=i||1;n=n||1;if(_==1){let e=r/i*2-1;let t=s/n*2-1;e=CABLES.clamp(e,-1,1);t=CABLES.clamp(t,-1,1);l.set(e);u.set(t)}else if(_==2){let e=r/i;let t=s/n;e=CABLES.clamp(e,0,1);t=CABLES.clamp(t,0,1);l.set(e);u.set(t)}}}function T(e){if(!v)return;const t=v.getBoundingClientRect();return e.clientX>t.left&&e.clientX<t.left+t.width&&e.clientY>t.top&&e.clientY<t.top+t.height}n.onChange=function(){w();L()};o.onChange=function(){if(b)w();if(o.get())L()};function U(){if(e.get()=="Pixel")_=0;else if(e.get()=="-1 to 1")_=1;else if(e.get()=="0 to 1")_=2;else if(e.get()=="Pixel Display")_=3}function E(e){f.set(false);d.set(T(e))}function x(e){if(!T(e))return;f.set(true)}function O(e){f.set(false)}function I(e){if(!T(e))return;c.trigger();if(i.get())e.preventDefault()}function S(e){if(!T(e))return;h.trigger()}function y(e){f.set(false);d.set(T(e))}function C(e){let t=e.clientX;let i=e.clientY;if(r.get()!="Document"){t=e.offsetX;i=e.offsetY}if(r.get()==="Canvas Area"){const n=v.getBoundingClientRect();t=e.clientX-n.left;i=e.clientY-n.top;if(t<0||t>n.width||i>n.height||i<0)return;t=CABLES.clamp(t,0,n.width);i=CABLES.clamp(i,0,n.height)}if(s.get())i=v.clientHeight-i;k(t/p.pixelDensity,i/p.pixelDensity)}function R(e){d.set(T(e));if(r.get()==="Canvas Area"){const t=v.getBoundingClientRect();const i=e.clientX-t.left;const n=e.clientY-t.top;if(i<0||i>t.width||n>t.height||n<0)return}C(e);g.set(e.movementX/p.pixelDensity);m.set(e.movementY/p.pixelDensity)}function N(e){if(event.touches&&event.touches.length>0)C(e.touches[0])}function M(e){f.set(true);if(e.touches&&e.touches.length>0)x(e.touches[0])}function P(e){f.set(false);O()}function w(){if(!b)return;b.removeEventListener("touchend",P);b.removeEventListener("touchstart",M);b.removeEventListener("touchmove",N);b.removeEventListener("click",S);b.removeEventListener("mousemove",R);b.removeEventListener("mouseleave",y);b.removeEventListener("mousedown",x);b.removeEventListener("mouseup",O);b.removeEventListener("mouseenter",E);b.removeEventListener("contextmenu",I);b=null}function L(){if(b||!o.get())w();if(!o.get())return;b=v=p.canvas;if(r.get()=="Canvas Area"){v=p.canvas.parentElement;b=document.body}if(r.get()=="Document")v=b=document.body;if(r.get()=="Parent Element")b=v=p.canvas.parentElement;if(!v){t.setUiError("noarea","could not find area element for mouse",2);return}t.setUiError("noarea",null);let e=false;if(a.get())e={passive:true};if(n.get()){b.addEventListener("touchend",P,e);b.addEventListener("touchstart",M,e);b.addEventListener("touchmove",N,e)}b.addEventListener("mousemove",R,e);b.addEventListener("mouseleave",y,e);b.addEventListener("mousedown",x,e);b.addEventListener("mouseup",O,e);b.addEventListener("mouseenter",E,e);b.addEventListener("contextmenu",I,e);b.addEventListener("click",S,e)}}};CABLES.OPS["6d1edbc0-088a-43d7-9156-918fb3d7f24b"]={f:Ops.Devices.Mouse.Mouse_v3,objName:"Ops.Devices.Mouse.Mouse_v3"};Ops.Trigger.TriggerOnChangeString=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("String"),n=e.outTrigger("Changed"),r=e.outString("Result");r.ignoreValueSerialize=true;i.onChange=function(){r.set(i.get());n.trigger()}}};CABLES.OPS["319d07e0-5cbe-4bc1-89fb-a934fd41b0c4"]={f:Ops.Trigger.TriggerOnChangeString,objName:"Ops.Trigger.TriggerOnChangeString"};Ops.Trigger.TriggerButton=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Trigger"),n=e.outTrigger("Next");i.onTriggered=function(){n.trigger()}}};CABLES.OPS["21630924-39e4-4df5-9965-b9136510d156"]={f:Ops.Trigger.TriggerButton,objName:"Ops.Trigger.TriggerButton"};Ops.Vars.VarGetString=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};var i=e.outString("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"string",e.varName,i)}};CABLES.OPS["3ad08cfc-bce6-4175-9746-fef2817a3b12"]={f:Ops.Vars.VarGetString,objName:"Ops.Vars.VarGetString"};Ops.Ui.PatchInput=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={};const s=r.addOutPort(new CABLES.Port(r,"create port",CABLES.OP_PORT_TYPE_DYNAMIC));function a(){for(let e in r.patch.ops){if(r.patch.ops[e].patchId){if(r.patch.ops[e].patchId.get()==r.uiAttribs.subPatch){return r.patch.ops[e]}}}}s.onLinkChanged=()=>{const e=a();if(!s.links.length||!e||!e.addNewInPort)return;const t=s.links[0].getOtherPort(s);s.removeLinks();const i=e.addNewInPort(t);const n=gui.scene().link(t.parent,t.getName(),r,i);e.saveData()}}};CABLES.OPS["e3f68bc3-892a-4c78-9974-aca25c27025d"]={f:Ops.Ui.PatchInput,objName:"Ops.Ui.PatchInput"};Ops.Ui.PatchOutput=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={};const s=r.addInPort(new CABLES.Port(r,"create port",CABLES.OP_PORT_TYPE_DYNAMIC));function a(){for(let e in r.patch.ops){if(r.patch.ops[e].patchId){if(r.patch.ops[e].patchId.get()==r.uiAttribs.subPatch){return r.patch.ops[e]}}}}s.onLinkChanged=()=>{const e=a();if(!s.links.length)return;const t=s.links[0].getOtherPort(s);s.removeLinks();const i=e.addNewOutPort(t);const n=gui.scene().link(t.parent,t.getName(),r,i);e.saveData()}}};CABLES.OPS["851b44cb-5667-4140-9800-5aeb7031f1d7"]={f:Ops.Ui.PatchOutput,objName:"Ops.Ui.PatchOutput"};Ops.Vars.VarSetNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("Value",0);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"number",i,e.varName)}};CABLES.OPS["b5249226-6095-4828-8a1c-080654e192fa"]={f:Ops.Vars.VarSetNumber_v2,objName:"Ops.Vars.VarSetNumber_v2"};Ops.Vars.VarSetString_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("Value","New String");e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"string",i,e.varName)}};CABLES.OPS["0b4d9229-8024-4a30-9cc0-f6653942c2e4"]={f:Ops.Vars.VarSetString_v2,objName:"Ops.Vars.VarSetString_v2"};Ops.Cables.LoadingStatus_v2=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inTrigger("exe"),r=n.inBool("Play Timeline",true),i=n.outTrigger("Next"),s=n.outBoolNum("Finished Initial Loading",false),a=n.outBoolNum("Loading"),o=n.outNumber("Progress"),l=n.outArray("Jobs"),u=n.outTrigger("Trigger Loading Finished ");n.toWorkPortsNeedToBeLinked(t);const h=n.patch;let c=false;const f=[];let d=true;let g=0;document.body.classList.add("cables-loading");let m=h.loading.start("loadingStatusInit","loadingStatusInit",n);n.patch.loading.on("finishedTask",p.bind(this));n.patch.loading.on("startTask",p.bind(this));function p(){const e=n.patch.loading.getListJobs();o.set(h.loading.getProgress());let t=e.length===0;const i=!t;if(i){l.set(n.patch.loading.getListJobs())}if(i){if(d){n.patch.timer.setTime(0);if(r.get()){n.patch.timer.play()}else{n.patch.timer.pause()}}d=false;document.body.classList.remove("cables-loading");document.body.classList.add("cables-loaded")}else{c=true;l.set(n.patch.loading.getListJobs());if(h.loading.getProgress()<1){n.patch.timer.setTime(0);n.patch.timer.pause()}}s.set(c);if(a.get()&&t)u.trigger();a.set(i);n.setUiAttribs({loading:i})}t.onTriggered=()=>{p();i.trigger();if(m){h.loading.finished(m);m=null}}}};CABLES.OPS["e62f7f4c-7436-437e-8451-6bc3c28545f7"]={f:Ops.Cables.LoadingStatus_v2,objName:"Ops.Cables.LoadingStatus_v2"};Ops.Gl.ClearColor=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("render"),n=e.outTrigger("trigger"),r=e.inFloatSlider("r",.1),s=e.inFloatSlider("g",.1),a=e.inFloatSlider("b",.1),o=e.inFloatSlider("a",1);r.setUiAttribs({colorPick:true});const l=e.patch.cgl;i.onTriggered=function(){l.gl.clearColor(r.get(),s.get(),a.get(),o.get());l.gl.clear(l.gl.COLOR_BUFFER_BIT|l.gl.DEPTH_BUFFER_BIT);n.trigger()}}};CABLES.OPS["19b441eb-9f63-4f35-ba08-b87841517c4d"]={f:Ops.Gl.ClearColor,objName:"Ops.Gl.ClearColor"};Ops.Trigger.TriggerSend=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inTriggerButton("Trigger"),i=n.outTrigger("Next");n.varName=n.inValueSelect("Named Trigger",[],"",true);n.varName.onChange=s;t.onTriggered=a;n.patch.addEventListener("namedTriggersChanged",r);r();n.varName.setUiAttribs({_triggerSelect:true});function r(){if(CABLES.UI){let e=[];const t=n.patch.namedTriggers;e.push("+ create new one");for(const i in t)e.push(i);e=e.sort();n.varName.uiAttribs.values=e}}function s(){if(CABLES.UI){if(n.varName.get()=="+ create new one"){new CABLES.UI.ModalDialog({prompt:true,title:"New Trigger",text:"Enter a name for the new trigger",promptValue:"",promptOk:e=>{n.varName.set(e);n.patch.namedTriggers[e]=n.patch.namedTriggers[e]||[];r()}});return}n.refreshParams()}if(!n.patch.namedTriggers[n.varName.get()]){n.patch.namedTriggers[n.varName.get()]=n.patch.namedTriggers[n.varName.get()]||[];n.patch.emitEvent("namedTriggersChanged")}n.setTitle(">"+n.varName.get());n.refreshParams();n.patch.emitEvent("opTriggerNameChanged",n,n.varName.get())}function a(){const t=n.patch.namedTriggers[n.varName.get()];n.patch.emitEvent("namedTriggerSent",n.varName.get());if(!t){n.setUiError("unknowntrigger","unknown trigger");return}else n.setUiError("unknowntrigger",null);for(let e=0;e<t.length;e++){t[e]()}i.trigger()}}};CABLES.OPS["ce1eaf2b-943b-4dc0-ab5e-ee11b63c9ed0"]={f:Ops.Trigger.TriggerSend,objName:"Ops.Trigger.TriggerSend"};Ops.Vars.VarSetTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTexture("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"object",i,e.varName)}};CABLES.OPS["4fbfc71e-1429-439f-8591-ad35961252ed"]={f:Ops.Vars.VarSetTexture_v2,objName:"Ops.Vars.VarSetTexture_v2"};Ops.Gl.Performance=class extends CABLES.Op{constructor(){super(...arguments);const a=this;const k=a.attachments={};const e=a.inTrigger("exe"),o=a.inValueBool("Active",true),l=a.inValueBool("Visible",true),U=a.inValueBool("Measure GPU",true),u=a.outTrigger("childs"),t=a.inSwitch("Position",["top","bottom"],"top"),i=a.inBool("Open",false),V=a.inBool("Smooth Graph",true),F=a.inFloat("Scale",3),h=a.inFloat("Size",128),j=a.outObject("Canvas"),B=a.outNumber("FPS");const n=a.patch.cgl;const r=document.createElement("div");let s=null;let c=null;let f=false;let d=0;let g=0;let m=0;let p=0;let _=0;const b=[];const v=[];const A=[];const T=[];let E=0;let x=0;let O=null;let G=0;let z=0;const I=["|","/","-","\\"];let S=true;const H="#007f9c";const X="#aaaaaa";const q="#222222";const y="#003f5c";const C="#7a5195";const R="#ef5675";const Y="#ffa600";let W=false;let N=0;let M=0;let P=0;a.toWorkPortsNeedToBeLinked(e,u);const K=a.patch.cgl.gl;const Q=K.getExtension("EXT_disjoint_timer_query_webgl2");o.onChange=e.onLinkChanged=l.onChange=()=>{D();J()};t.onChange=Z;h.onChange=L;r.id="performance";r.style.position="absolute";r.style.left="0px";r.style.opacity="0.8";r.style.padding="10px";r.style.cursor="pointer";r.style.background="#222";r.style.color="white";r.style["font-family"]="monospace";r.style["font-size"]="12px";r.style["z-index"]="99999";r.innerHTML="&nbsp;";r.addEventListener("click",$);const w=a.patch.cgl.canvas.parentElement;w.appendChild(r);L();D();Z();J();a.onDelete=function(){if(O)O.remove();if(r)r.remove()};function Z(){O.style["pointer-events"]="none";if(t.get()=="top"){O.style.top=r.style.top="0px";O.style.bottom=r.style.bottom="initial"}else{O.style.bottom=r.style.bottom="0px";O.style.top=r.style.top="initial"}}function J(){if(!l.get()||!e.isLinked()||!o.get()){r.style.display="none";r.style.opacity=0;O.style.display="none"}else{r.style.display="block";r.style.opacity=1;O.style.display="block"}}function L(){if(!O)return;const t=Math.max(0,parseInt(h.get()));O.width=t;O.height=t;r.style.left=t+"px";b.length=0;v.length=0;A.length=0;T.length=0;for(let e=0;e<t;e++){b[e]=-1;v[e]=-1;A[e]=-1;T[e]=-1}}i.onChange=function(){f=i.get();D()};function $(){if(!l.get())return;r.style.opacity=1;f=!f;D()}function D(){ie();if(!O)te();if(f){O.style.display="block";r.style.left=h.get()+"px";r.style["min-height"]="56px"}else{O.style.display="none";r.style.left="0px";r.style["min-height"]="auto"}}function ee(){const t=O.height;const i=F.get();c.fillStyle=q;c.fillRect(0,0,O.width,t);c.fillStyle=y;let n=0;const r=Math.max(0,parseInt(h.get()));for(n=r;n>=0;n--){if(b[n]>30)c.fillStyle=H;if(b[n]>60)c.fillStyle=X;c.fillRect(r-n,t-b[n]*i,1,b[n]*i);if(b[n]>30)c.fillStyle=y}for(n=r;n>=0;n--){let e=0;c.fillStyle=C;e=v[n];c.fillRect(r-n,t-e*i,1,v[n]*i);c.fillStyle=R;e+=A[n];c.fillRect(r-n,t-e*i,1,A[n]*i);c.fillStyle=Y;e+=T[n];c.fillRect(r-n,t-e*i,1,T[n]*i)}for(let e=10;e<t;e+=10){c.fillStyle="#888";const s=t-e*i;c.fillRect(O.width-5,s,5,1);c.font="8px arial";c.fillText(e+"ms",O.width-27,s+3)}c.fillStyle="#fff";c.fillRect(O.width-5,t-1e3/g*i,5,1);c.fillText(Math.round(1e3/g)+"ms",O.width-27,t-1e3/g*i)}function te(){O=document.createElement("canvas");O.id="performance_"+a.patch.config.glCanvasId;O.width=h.get();O.height=h.get();O.style.display="block";O.style.opacity=.9;O.style.position="absolute";O.style.left="0px";O.style.cursor="pointer";O.style.top="-64px";O.style["z-index"]="99998";w.appendChild(O);c=O.getContext("2d");O.addEventListener("click",$);L()}function ie(){if(!l.get())return;let e="";if(a.patch.cgl.profileData.profileShaderCompiles>0)e+="Shader compile ("+a.patch.cgl.profileData.profileShaderCompileName+") ";if(a.patch.cgl.profileData.profileShaderGetUniform>0)e+="Shader get uni loc! ("+a.patch.cgl.profileData.profileShaderGetUniformName+")";if(a.patch.cgl.profileData.profileTextureResize>0)e+="Texture resize! ";if(a.patch.cgl.profileData.profileFrameBuffercreate>0)e+="Framebuffer create! ";if(a.patch.cgl.profileData.profileEffectBuffercreate>0)e+="Effectbuffer create! ";if(a.patch.cgl.profileData.profileTextureDelete>0)e+="Texture delete! ";if(a.patch.cgl.profileData.profileNonTypedAttrib>0)e+="Not-Typed Buffer Attrib! "+a.patch.cgl.profileData.profileNonTypedAttribNames;if(a.patch.cgl.profileData.profileTextureNew>0)e+="new texture created! ";if(a.patch.cgl.profileData.profileGenMipMap>0)e+="generating mip maps!";if(e.length>0){e='| <span style="color:#f80;">WARNING: '+e+"<span>"}let t="";if(f){t+='<span style="color:'+y+'"></span> '+g+" fps ";t+='<span style="color:'+C+'"></span> '+Math.round(M*100)/100+"ms mainloop ";t+='<span style="color:'+R+'"></span> '+Math.round(P*100)/100+"ms onframe ";if(N)t+='<span style="color:'+Y+'"></span> '+Math.round(N*100)/100+"ms GPU";t+=e;r.innerHTML=t}else{t+=g+" fps / ";t+="CPU: "+Math.round(a.patch.cgl.profileData.profileOnAnimFrameOps*100)/100+"ms / ";if(N)t+="GPU: "+Math.round(N*100)/100+"ms  ";r.innerHTML=t}if(a.patch.loading.getProgress()!=1){r.innerHTML+="<br/>loading "+Math.round(a.patch.loading.getProgress()*100)+"% "+I[++z%I.length]}if(f){let t=0;E=0;_=0;for(let e=b.length;e>b.length-b.length/3;e--){if(b[e]>-1){E+=b[e];t++}if(v[e]>-1)_+=v[e]}E/=t;_/=t;r.innerHTML+="<br/> "+n.canvasWidth+" x "+n.canvasHeight+" (x"+n.pixelDensity+") ";r.innerHTML+="<br/>frame avg: "+Math.round(_*100)/100+" ms ("+Math.round(_/E*100)+"%) / "+Math.round(E*100)/100+" ms";r.innerHTML+=" (self: "+Math.round(x*100)/100+" ms) ";r.innerHTML+="<br/>shader binds: "+Math.ceil(a.patch.cgl.profileData.profileShaderBinds/g)+" uniforms: "+Math.ceil(a.patch.cgl.profileData.profileUniformCount/g)+" mvp_uni_mat4: "+Math.ceil(a.patch.cgl.profileData.profileMVPMatrixCount/g)+" num glPrimitives: "+Math.ceil(a.patch.cgl.profileData.profileMeshNumElements/g)+" fenced pixelread: "+Math.ceil(a.patch.cgl.profileData.profileFencedPixelRead)+" mesh.setGeom: "+a.patch.cgl.profileData.profileMeshSetGeom+" videos: "+a.patch.cgl.profileData.profileVideosPlaying+" tex preview: "+a.patch.cgl.profileData.profileTexPreviews;r.innerHTML+=" draw meshes: "+Math.ceil(a.patch.cgl.profileData.profileMeshDraw/g)+" framebuffer blit: "+Math.ceil(a.patch.cgl.profileData.profileFramebuffer/g)+" texeffect blit: "+Math.ceil(a.patch.cgl.profileData.profileTextureEffect/g);r.innerHTML+=" all shader compiletime: "+Math.round(a.patch.cgl.profileData.shaderCompileTime*100)/100}a.patch.cgl.profileData.clear()}function ne(e){e.style.padding="0px";e.style.margin="0px"}function re(t,e,i,n){const r=20;t.usedAvg=t.usedAvg||t.used;if(!t.ele||S){const a=document.createElement("div");t.ele=a;if(t.childs&&t.childs.length>0)a.style.height="500px";else a.style.height=r+"px";a.style.overflow="hidden";a.style.display="inline-block";if(!t.isRoot){a.innerHTML='<div style="min-height:'+r+'px;width:100%;overflow:hidden;color:black;position:relative">&nbsp;'+t.name+"</div>";a.style["background-color"]="rgb("+t.colR+","+t.colG+","+t.colB+")";a.style["border-left"]="1px solid black"}e.appendChild(a)}if(!t.isRoot){if(performance.now()-t.lastTime>200){t.ele.style.display="none";t.hidden=true}else{if(t.hidden){t.ele.style.display="inline-block";t.hidden=false}}t.ele.style.float="left";t.ele.style.width=Math.floor(t.usedAvg/i*98)+"%"}else{t.ele.style.width="100%";t.ele.style.clear="both";t.ele.style.float="none"}if(t&&t.childs&&t.childs.length>0){let e=0;for(var s=0;s<t.childs.length;s++){t.childs[s].usedAvg=(t.childs[s].usedAvg||t.childs[s].used)*.95+t.childs[s].used*.05;e+=t.childs[s].usedAvg}for(var s=0;s<t.childs.length;s++){re(t.childs[s],t.ele,e,n+1)}}}function se(t){for(let e=0;e<t.childs.length;e++)se(t.childs[e]);t.childs.length=0}function ae(){if(!CGL.performanceMeasures)return;if(!s){a.log("create measure ele");s=document.createElement("div");s.style.width="100%";s.style["background-color"]="#444";s.style.bottom="10px";s.style.height="100px";s.style.opacity="1";s.style.position="absolute";s.style["z-index"]="99999";s.innerHTML="";w.appendChild(s)}let t=0;const i=CGL.performanceMeasures[0];for(let e=0;e<i.childs.length;e++)t+=i.childs[e].used;re(CGL.performanceMeasures[0],s,t,0);i.childs.length=0;se(CGL.performanceMeasures[0]);CGL.performanceMeasures.length=0;S=false}e.onTriggered=oe;function oe(){const e=performance.now();if(o.get()){d++;if(Q&&U.get()&&l.get())a.patch.cgl.profileData.doProfileGlQuery=true;else a.patch.cgl.profileData.doProfileGlQuery=false;if(m===0)m=Date.now();if(Date.now()-m>=1e3){g=d;d=0;B.set(g);if(l.get())ie();m=Date.now()}const i=a.patch.cgl.profileData.glQueryData;N=0;if(i){let t=0;for(let e in i){t++;if(i[e].time)N+=i[e].time}}if(l.get()){ae();if(f&&!a.patch.cgl.profileData.pause){b.push(a.patch.cgl.profileData.profileFrameDelta);b.shift();v.push(p);v.shift();A.push(a.patch.cgl.profileData.profileOnAnimFrameOps-a.patch.cgl.profileData.profileMainloopMs);A.shift();T.push(N);T.shift();ee()}}G=performance.now();x=performance.now()-e;j.setRef(O)}const t=performance.now();u.trigger();if(o.get()){const n=performance.now()-t;const r=a.patch.cgl.profileData.profileMainloopMs;const s=a.patch.cgl.profileData.profileOnAnimFrameOps-a.patch.cgl.profileData.profileMainloopMs;if(V.get()){p=p*.9+n*.1;M=M*.5+r*.5;P=P*.5+s*.5}else{p=n;M=r;P=s}a.patch.cgl.profileData.clearGlQuery()}}}};CABLES.OPS["9cd2d9de-000f-4a14-bd13-e7d5f057583c"]={f:Ops.Gl.Performance,objName:"Ops.Gl.Performance"};Ops.String.String_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("value",""),n=e.outString("String");i.setUiAttribs({display:"text"});i.onChange=function(){if(!i.isLinked())e.setUiAttrib({extendTitle:i.get()});n.set(i.get())}}};CABLES.OPS["d697ff82-74fd-4f31-8f54-295bc64e713d"]={f:Ops.String.String_v2,objName:"Ops.String.String_v2"};Ops.Color.ColorValue=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueSlider("r",Math.random());const n=e.inValueSlider("g",Math.random());const r=e.inValueSlider("b",Math.random());i.setUiAttribs({colorPick:true});const s=e.inValueSlider("a",1);const a=e.outNumber("outr");const o=e.outNumber("outg");const l=e.outNumber("outb");const u=e.outNumber("outa");const h=e.outNumber("Hex","000000");const c=e.outArray("Array");i.onChange=n.onChange=r.onChange=s.onChange=d;function f(e){let t=Math.round(e*255).toString(16);if(t.length===1){t="0"+t}return t.toUpperCase()}function d(){a.set(i.get());o.set(n.get());l.set(r.get());u.set(s.get());let e=f(i.get())+f(n.get())+f(r.get());h.set(e);c.set([i.get(),n.get(),r.get(),s.get()])}d()}};CABLES.OPS["7caa37c8-f2a7-49f2-a29c-96af362abca0"]={f:Ops.Color.ColorValue,objName:"Ops.Color.ColorValue"};Ops.Trigger.RouteTriggerString_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=24,n=t.inTriggerButton("Execute"),r=t.inString("Switch Value"),s=t.outTrigger("Next Trigger"),a=t.outNumber("Switched Index");let o=-1;const l=[];const u=[];for(let e=0;e<i;e++){l[e]=t.outTrigger("Trigger "+e);u[e]=t.inString("String "+e);u[e].onChange=h}t.onLoad=t.onInit=r.onChange=h;function h(){o=-1;for(let e=0;e<u.length;e++){if(u[e].get()==r.get()){o=e;break}}}n.onTriggered=()=>{if(o>=0)l[o].trigger();a.set(o);s.trigger()}}};CABLES.OPS["13bdac27-5da7-4311-890b-6a7e49d72040"]={f:Ops.Trigger.RouteTriggerString_v2,objName:"Ops.Trigger.RouteTriggerString_v2"};Ops.Html.FontFile_v2=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={};const s=r.inUrl("file",[".otf",".ttf",".woff",".woff2"]),a=r.inString("family"),o=r.inBool("Active",true),l=r.outBoolNum("Loaded"),u=r.outTrigger("Loaded Trigger");let h=null;let c;let f=null;let t=null;let d=null;let g="";s.onChange=function(){l.set(false);n(null)};o.onChange=a.onChange=()=>{i()};function i(){clearTimeout(t);t=setTimeout(()=>{n(null)},50)}r.patch.on("windowChanged",e=>{c=null;n(e.document)});function n(e){if(d)d.remove();if(c){const t=f.fonts.delete(c);c=null;setTimeout(()=>{r.patch.emitEvent("fontLoaded",g)},100)}if(!o.get())return;f=e||f||r.patch.cgl.canvas.ownerDocument||document;if(h)h=r.patch.cgl.patch.loading.finished(h);r.setUiError("loadingerror",null);g=a.get();if(s.get()&&a.get()){if(f.fonts){let e='url("'+r.patch.getFilePath(String(s.get()))+'")';c=new FontFace(a.get(),e);h=r.patch.cgl.patch.loading.start("FontFile",s.get(),r);f.fonts.add(c);c.loaded.then(e=>{l.set(true);u.trigger();h=r.patch.cgl.patch.loading.finished(h);r.patch.emitEvent("fontLoaded",a.get())},e=>{r.setUiError("loadingerror","Font loading error: "+c.status+"("+s.get()+")");h=r.patch.cgl.patch.loading.finished(h);l.set(true)}).catch(e=>{h=r.patch.cgl.patch.loading.finished(h);console.error("catch ",e)});c.load()}else{const i=r.patch.getFilePath(String(s.get()));const n="".endl()+"@font-face".endl()+"{".endl()+'  font-family: "'+a.get()+'";'.endl()+'  src: url("'+i+'") format("truetype");'.endl()+"}";d=document.createElement("style");d.classList.add("cablesEle");d.type="text/css";d.innerHTML=n;document.getElementsByTagName("head")[document.getElementsByTagName("head").length-1].appendChild(d)}}}}};CABLES.OPS["68177370-116e-4c76-aef3-3b10d68e7227"]={f:Ops.Html.FontFile_v2,objName:"Ops.Html.FontFile_v2"};Ops.Gl.Texture_v2=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={};const s=r.inUrl("File",[".jpg",".png",".webp",".jpeg",".avif"]),t=r.inSwitch("Filter",["nearest","linear","mipmap"]),i=r.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"clamp to edge"),n=r.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),a=r.inSwitch("Data Format",["R","RG","RGB","RGBA","SRGBA"],"RGBA"),o=r.inValueBool("Flip",false),l=r.inValueBool("Pre Multiplied Alpha",false),u=r.inValueBool("Active",true),h=r.inBool("Save Memory",true),c=r.outTexture("Texture"),f=r.inBool("Add Cachebuster",false),d=r.inTriggerButton("Reload"),g=r.outNumber("Width"),m=r.outNumber("Height"),p=r.outNumber("Aspect Ratio"),_=r.outBoolNum("Loaded",0),b=r.outBoolNum("Loading",0);const v=r.patch.cgl;r.toWorkPortsNeedToBeLinked(c);r.setPortGroup("Size",[g,m]);let A=null;let T=null;let E=null;let x=CGL.Texture.FILTER_MIPMAP;let O=CGL.Texture.WRAP_REPEAT;let I=0;let S=0;l.setUiAttribs({hidePort:true});l.onChange=s.onChange=a.onChange=f.onChange=o.onChange=C;n.onChange=t.onChange=M;i.onChange=P;t.set("mipmap");i.set("repeat");c.setRef(CGL.Texture.getEmptyTexture(v));d.onTriggered=C;u.onChange=function(){if(u.get()){if(A!=s.get()||!E)C();else c.setRef(E)}else{c.setRef(CGL.Texture.getEmptyTexture(v));g.set(CGL.Texture.getEmptyTexture(v).width);m.set(CGL.Texture.getEmptyTexture(v).height);if(E)E.delete();r.setUiAttrib({extendTitle:""});E=null}};const y=function(){const e=CGL.Texture.getTempTexture(v);c.setRef(e)};function C(e){clearTimeout(S);S=setTimeout(function(){N(e)},1)}function R(){if(a.get()=="R")return CGL.Texture.PFORMATSTR_R8UB;if(a.get()=="RG")return CGL.Texture.PFORMATSTR_RG8UB;if(a.get()=="RGB")return CGL.Texture.PFORMATSTR_RGB8UB;if(a.get()=="SRGBA")return CGL.Texture.PFORMATSTR_SRGBA8;return CGL.Texture.PFORMATSTR_RGBA8UB}function N(e){r.checkMainloopExists();if(!u.get())return;if(T)T=v.patch.loading.finished(T);T=v.patch.loading.start(r.objName,s.get(),r);let t=r.patch.getFilePath(String(s.get()));if(f.get()||e===true)t=CABLES.cacheBust(t);if(String(s.get()).indexOf("data:")==0)t=s.get();let i=false;A=s.get();if(s.get()&&s.get().length>1){_.set(false);b.set(true);const n=s.get();r.setUiAttrib({extendTitle:CABLES.basename(t)});if(i)r.refreshParams();v.patch.loading.addAssetLoadingTask(()=>{r.setUiError("urlerror",null);CGL.Texture.load(v,t,function(e,t){if(s.get()!=n){T=v.patch.loading.finished(T);return}if(E)E.delete();if(e){const i=CGL.Texture.getErrorTexture(v);c.setRef(i);r.setUiError("urlerror",'could not load texture: "'+s.get()+'"',2);T=v.patch.loading.finished(T);return}g.set(t.width);m.set(t.height);p.set(t.width/t.height);E=t;c.setRef(E);b.set(false);_.set(true);if(h.get())E.image=null;if(T){T=v.patch.loading.finished(T)}r.checkMainloopExists()},{anisotropic:I,wrap:O,flip:o.get(),unpackAlpha:l.get(),pixelFormat:R(),filter:x});r.checkMainloopExists()})}else{y();T=v.patch.loading.finished(T)}}function M(){if(t.get()=="nearest")x=CGL.Texture.FILTER_NEAREST;else if(t.get()=="linear")x=CGL.Texture.FILTER_LINEAR;else if(t.get()=="mipmap")x=CGL.Texture.FILTER_MIPMAP;else if(t.get()=="Anisotropic")x=CGL.Texture.FILTER_ANISOTROPIC;n.setUiAttribs({greyout:x!=CGL.Texture.FILTER_MIPMAP});I=parseFloat(n.get());C()}function P(){if(i.get()=="repeat")O=CGL.Texture.WRAP_REPEAT;if(i.get()=="mirrored repeat")O=CGL.Texture.WRAP_MIRRORED_REPEAT;if(i.get()=="clamp to edge")O=CGL.Texture.WRAP_CLAMP_TO_EDGE;C()}r.onFileChanged=function(e){if(s.get()&&s.get().indexOf(e)>-1){c.setRef(CGL.Texture.getEmptyTexture(r.patch.cgl));c.setRef(CGL.Texture.getTempTexture(v));N(true)}}}};CABLES.OPS["790f3702-9833-464e-8e37-6f0f813f7e16"]={f:Ops.Gl.Texture_v2,objName:"Ops.Gl.Texture_v2"};Ops.Gl.Textures.SwitchTextures_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("exec"),n=this.inValueInt("num"),r=t.inValueBool("Default Texture Transparent",true),s=t.outTrigger("Next"),a=this.outTexture("texture");const o=t.patch.cgl;const l=[];let u=0;let h=-1;let c=CGL.Texture.getEmptyTexture(o);t.toWorkPortsNeedToBeLinked(i);i.onTriggered=function(){d();s.trigger()};r.onChange=function(){if(r.get())c=CGL.Texture.getEmptyTexture(o);else c=CGL.Texture.getTempTexture(o);d(true)};for(let e=0;e<16;e++){const g=t.inTexture("texture"+e);l.push(g);g.onChange=f}function f(){d(true)}function d(e){u=parseInt(n.get(),10);if(!e){if(u==h)return;if(u!=u)return}if(isNaN(u)||u<0||u>l.length-1)u=0;if(l[u].get())a.setRef(l[u].get());else a.setRef(c);h=u}}};CABLES.OPS["a82ae429-ac07-4760-882b-595a857c7ae0"]={f:Ops.Gl.Textures.SwitchTextures_v2,objName:"Ops.Gl.Textures.SwitchTextures_v2"};Ops.Number.Number=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("value"),n=e.outNumber("result");i.onChange=s;let r=false;i.onLinkChanged=()=>{if(!r&&i.isLinked())e.setUiAttribs({extendTitle:null});r=i.isLinked()};function s(){if(CABLES.UI&&!r)e.setUiAttribs({extendTitle:i.get()});n.set(Number(i.get()))}}};CABLES.OPS["8fb2bb5d-665a-4d0a-8079-12710ae453be"]={f:Ops.Number.Number,objName:"Ops.Number.Number"};Ops.Boolean.ToggleBool_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("trigger"),n=e.inTriggerButton("reset"),r=e.inBool("Default",false),s=e.outTrigger("Next"),a=e.outBoolNum("result");let o=false;e.onLoadedValueSet=()=>{o=r.get();a.set(r.get());s.trigger()};i.onTriggered=function(){o=!o;a.set(o);s.trigger()};n.onTriggered=function(){o=r.get();a.set(o);s.trigger()}}};CABLES.OPS["4313d9bb-96b6-43bc-9190-6068cfb2593c"]={f:Ops.Boolean.ToggleBool_v2,objName:"Ops.Boolean.ToggleBool_v2"};Ops.Trigger.GateTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Execute"),n=e.inValueBool("Pass Through",true),r=e.outTrigger("Trigger out");i.onTriggered=function(){if(n.get())r.trigger()}}};CABLES.OPS["65e8b8a2-ba13-485f-883a-2bcf377989da"]={f:Ops.Trigger.GateTrigger,objName:"Ops.Trigger.GateTrigger"};Ops.String.StringContains_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("String"),n=e.inString("SearchValue"),r=e.outBoolNum("Found",false),s=e.outNumber("Index",-1);n.onChange=i.onChange=a;a();function a(){if(i.get()&&n.get()&&n.get().length>0){const e=i.get().indexOf(n.get());s.set(e);r.set(e>-1)}else{s.set(-1);r.set(false)}}}};CABLES.OPS["2ca3e5d7-e6b4-46a7-8381-3fe1ad8b6879"]={f:Ops.String.StringContains_v2,objName:"Ops.String.StringContains_v2"};Ops.Boolean.Or=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueBool("bool 1"),n=e.inValueBool("bool 2"),r=e.inValueBool("bool 3"),s=e.inValueBool("bool 4"),a=e.inValueBool("bool 5"),o=e.inValueBool("bool 6"),l=e.inValueBool("bool 7"),u=e.inValueBool("bool 8"),h=e.inValueBool("bool 9"),c=e.inValueBool("bool 10"),f=e.outBoolNum("result");i.onChange=n.onChange=r.onChange=s.onChange=a.onChange=o.onChange=l.onChange=u.onChange=h.onChange=c.onChange=d;function d(){f.set(i.get()||n.get()||r.get()||s.get()||a.get()||o.get()||l.get()||u.get()||h.get()||c.get())}}};CABLES.OPS["b3b36238-4592-4e11-afe3-8361c4fd6be5"]={f:Ops.Boolean.Or,objName:"Ops.Boolean.Or"};Ops.Extension.Deprecated.ToggleBoolValue=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueBool("in bool"),n=e.outBoolNum("out bool");i.changeAlways=true;i.onChange=function(){n.set(!(i.get()==true))}}};CABLES.OPS["7b1abd02-3aad-4106-9848-7f4c3cfab6a9"]={f:Ops.Extension.Deprecated.ToggleBoolValue,objName:"Ops.Extension.Deprecated.ToggleBoolValue"};Ops.Boolean.TriggerChangedFalse=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};let i=e.inValueBool("Value",false);let n=e.outTrigger("Next");let r=0;i.onChange=function(){let e=i.get();if(r&&!e){r=false;n.trigger()}else{r=true}}}};CABLES.OPS["6387bcb0-6091-4199-8ab7-f96ad4aa3c7d"]={f:Ops.Boolean.TriggerChangedFalse,objName:"Ops.Boolean.TriggerChangedFalse"};Ops.Boolean.TriggerChangedTrue=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};let i=e.inValueBool("Value",false);let n=e.outTrigger("Next");let r=0;i.onChange=function(){let e=i.get();if(!r&&e){r=true;n.trigger()}else{r=false}}}};CABLES.OPS["385197e1-8b34-4d1c-897f-d1386d99e3b3"]={f:Ops.Boolean.TriggerChangedTrue,objName:"Ops.Boolean.TriggerChangedTrue"};Ops.Trigger.DelayedTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("exe"),n=e.inValueFloat("delay",1),r=e.inTriggerButton("Cancel"),s=e.outTrigger("next"),a=e.outBool("Delaying");let o=null;r.onTriggered=function(){if(o)clearTimeout(o);o=null};i.onTriggered=function(){a.set(true);if(o)clearTimeout(o);o=setTimeout(function(){a.set(false);o=null;s.trigger()},n.get()*1e3)}}};CABLES.OPS["f4ff66b0-8500-46f7-9117-832aea0c2750"]={f:Ops.Trigger.DelayedTrigger,objName:"Ops.Trigger.DelayedTrigger"};Ops.Trigger.NumberByTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("0"),n=e.inTriggerButton("1"),r=e.inTriggerButton("2"),s=e.inTriggerButton("3"),a=e.inTriggerButton("4"),o=e.inTriggerButton("5"),l=e.inTriggerButton("6"),u=e.inTriggerButton("7"),h=e.outNumber("number");h.changeAlways=true;const c=e.outTrigger("Triggered");i.onTriggered=function(){h.set(0);c.trigger()};n.onTriggered=function(){h.set(1);c.trigger()};r.onTriggered=function(){h.set(2);c.trigger()};s.onTriggered=function(){h.set(3);c.trigger()};a.onTriggered=function(){h.set(4);c.trigger()};o.onTriggered=function(){h.set(5);c.trigger()};l.onTriggered=function(){h.set(6);c.trigger()};u.onTriggered=function(){h.set(7);c.trigger()}}};CABLES.OPS["43ed1123-1312-4383-b843-27b8ec540c09"]={f:Ops.Trigger.NumberByTrigger,objName:"Ops.Trigger.NumberByTrigger"};Ops.Trigger.TriggerReceive=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.outTrigger("Triggered");n.varName=n.inValueSelect("Named Trigger",[],"",true);n.varName.setUiAttribs({_triggerSelect:true});s();n.patch.addEventListener("namedTriggersChanged",s);let i=null;function r(){t.trigger()}function s(){if(CABLES.UI){let t=[];let i=n.patch.namedTriggers;for(let e in i)t.push(e);t=t.sort();n.varName.uiAttribs.values=t}}n.varName.onChange=function(){if(i){let e=n.patch.namedTriggers[i];let t=e.indexOf(r);if(t!=-1)e.splice(t,1)}n.setTitle(">"+n.varName.get());n.patch.namedTriggers[n.varName.get()]=n.patch.namedTriggers[n.varName.get()]||[];let e=n.patch.namedTriggers[n.varName.get()];e.push(r);i=n.varName.get();a();n.patch.emitEvent("opTriggerNameChanged",n,n.varName.get())};n.on("uiParamPanel",a);function a(){if(!n.varName.get()){n.setUiError("unknowntrigger","unknown trigger")}else n.setUiError("unknowntrigger",null)}}};CABLES.OPS["0816c999-f2db-466b-9777-2814573574c5"]={f:Ops.Trigger.TriggerReceive,objName:"Ops.Trigger.TriggerReceive"};Ops.Gl.Shader.CustomShader_v2=class extends CABLES.Op{constructor(){super(...arguments);const _=this;const e=_.attachments={};const t=_.inTrigger("render"),i=_.inStringEditor("Fragment Code"),n=_.inStringEditor("Vertex Code"),r=_.inValueBool("Use As Material",true),s=_.outTrigger("trigger"),a=_.outObject("Shader",null,"shader"),o=_.outBool("Has Errors");const b=7;const v=_.patch.cgl;const A=[];const T=[];const E=[];_.toWorkPortsNeedToBeLinked(t);i.setUiAttribs({editorSyntax:"glsl"});n.setUiAttribs({editorSyntax:"glsl"});const x=new CGL.Shader(v,"customshader",_);x.logError=false;x.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);_.setPortGroup("Source Code",[i,n]);_.setPortGroup("Options",[r]);i.set(CGL.Shader.getDefaultFragmentShader());n.set(CGL.Shader.getDefaultVertexShader());i.onChange=n.onChange=function(){if(i.isLinked()&&!i.get())return;u=true};t.onTriggered=c;let l=0;let u=true;_.onLoadedValueSet=h;function h(i){p();if(!i)return;for(let t=0;t<A.length;t++)for(let e=0;e<i.portsIn.length;e++)if(A[t]&&A[t].name==i.portsIn[e].name){A[t].set(i.portsIn[e].value);A[t].deSerializeSettings(i.portsIn[e])}}_.init=function(){p()};function c(){R();if(u)p();if(r.get())v.pushShader(x);f();s.trigger();x.popTextures();if(r.get())v.popShader()}function f(){for(let e=0;e<T.length;e++)if(T[e]&&T[e].get()&&T[e].get().tex)x.pushTexture(T[e].uniform,T[e].get().tex);else x.pushTexture(T[e],CGL.Texture.getEmptyTexture(v))}function d(){for(let e=0;e<T.length;e++)if(T[e]&&T[e].get()&&T[e].get().tex)v.setTexture(0+e+b,T[e].get().tex)}function O(t){for(let e=0;e<A.length;e++)if(A[e]&&A[e].name==t)return true;for(let e=0;e<T.length;e++)if(T[e]&&T[e].name==t)return true;return false}const g=mat4.create();const I=["modelMatrix","viewMatrix","normalMatrix","mvMatrix","projMatrix","inverseViewMatrix","camPos"];let S=0;const y=[];function m(e){const t=e.split("\n");const r=[];for(let e=0;e<t.length;e++){const i=t[e].split(";");for(let e=0;e<i.length;e++){let n=i[e].split(" ");for(let e=0;e<n.length;e++)n[e]=(n[e]+"").trim();if(n[0]==="UNI"||n[0]==="uniform"){let t=n[2];if(n.length>4)for(let e=3;e<n.length;e++)t+=n[e];n=n.filter(function(e){return e!==""});const s=n[1];let i=[];if(t){i=[t];if(t.indexOf(",")>-1)i=t.split(",")}for(let e=0;e<i.length;e++){if(I.indexOf(i[e])>-1)continue;const a=i[e].trim().replace(/\[\d+\]$/,"");if(s==="float"){y.push(a);if(!O(a)){const o=i[e].trim().match(/\[\d+\]$/);if(o){const l=parseInt(o[0].trim().slice(1,-1));const u=_.inArray(a,[]);u.uniform=new CGL.Uniform(x,"f[]",a,new Float32Array(l));A.push(u);r.push(u);const h={name:a,num:l,port:u,uni:u.uniform,changed:false};u.onChange=function(){this.changed=true}.bind(h);E.push(h)}else{const u=_.inFloat(a,0);u.uniform=new CGL.Uniform(x,"f",a,u);A.push(u);r.push(u)}}}else if(s==="int"){y.push(a);if(!O(a)){const u=_.inInt(a,0);u.uniform=new CGL.Uniform(x,"i",a,u);A.push(u);r.push(u)}}else if(s==="bool"){y.push(a);if(!O(a)){const u=_.inBool(a,false);u.uniform=new CGL.Uniform(x,"b",a,u);A.push(u);r.push(u)}}else if(s==="mat4"){y.push(a);if(!O(a)){const u=_.inArray(a,0);u.uniform=new CGL.Uniform(x,"m4",a,u);A.push(u);r.push(u);const h={name:a,num:16,port:u,uni:u.uniform,changed:false};u.onChange=function(){this.changed=true}.bind(h);E.push(h)}}else if(s==="sampler2D"||s==="samplerCube"){y.push(a);if(!O(a)){const c=_.inObject(a);let e="t";if(s==="samplerCube")e="tc";c.uniform=new CGL.Uniform(x,e,a,b+T.length);T.push(c);r.push(c);c.set(CGL.Texture.getTempTexture(v));c.on("change",(e,t)=>{if(!e)t.set(CGL.Texture.getTempTexture(v))});S++}}else if(s==="vec3"||s==="vec2"||s==="vec4"){let e=2;if(s==="vec4")e=4;if(s==="vec3")e=3;y.push(a+" X");y.push(a+" Y");if(e>2)y.push(a+" Z");if(e>3)y.push(a+" W");if(!O(a+" X")){const f=[];const h={name:a,num:e,changed:false};E.push(h);C(h);const d=_.inFloat(a+" X",0);d.onChange=function(){this.changed=true}.bind(h);A.push(d);f.push(d);h.x=d;const g=_.inFloat(a+" Y",0);g.onChange=function(){this.changed=true}.bind(h);A.push(g);f.push(g);h.y=g;if(e>2){const m=_.inFloat(a+" Z",0);m.onChange=function(){this.changed=true}.bind(h);A.push(m);f.push(m);h.z=m}if(e>3){const p=_.inFloat(a+" W",0);p.onChange=function(){this.changed=true}.bind(h);A.push(p);f.push(p);h.w=p}_.setPortGroup(a,f)}}}}}}_.setPortGroup("uniforms",r)}function p(){if(!x)return;let e=false;l++;if(l>2)e=true;x.setSource(n.get(),i.get(),e);if(v.glVersion==1){v.enableExtension("OES_standard_derivatives");x.enableExtension("GL_OES_standard_derivatives")}S=0;y.length=0;m(n.get());m(i.get());for(let t=0;t<T.length;t++)for(let e=0;e<y.length;e++)if(T[t]&&y.indexOf(T[t].name)==-1){T[t].remove();T[t]=null}for(let t=0;t<A.length;t++)for(let e=0;e<y.length;e++)if(A[t]&&y.indexOf(A[t].name)==-1){A[t].remove();A[t]=null}for(let e=0;e<E.length;e++){C(E[e]);E[e].changed=true}for(let e=0;e<A.length;e++)if(A[e]&&A[e].uniform)A[e].uniform.needsUpdate=true;x.compile();_.refreshParams();a.setRef(x);u=false;if(x.hasErrors())_.setUiError("compile","Shader has errors",2,{button:"show",buttonCb:()=>{CABLES.UI.showShaderError(x)}});else _.setUiError("compile",null);o.set(x.hasErrors())}function C(e){if(e.num==2)e.uni=new CGL.Uniform(x,"2f",e.name,[0,0]);else if(e.num==3)e.uni=new CGL.Uniform(x,"3f",e.name,[0,0,0]);else if(e.num==4)e.uni=new CGL.Uniform(x,"4f",e.name,[0,0,0,0])}function R(){for(let e=0;e<E.length;e++){const t=E[e];if(t.changed){if(t.num===2)t.uni.setValue([t.x.get(),t.y.get()]);else if(t.num===3)t.uni.setValue([t.x.get(),t.y.get(),t.z.get()]);else if(t.num===4)t.uni.setValue([t.x.get(),t.y.get(),t.z.get(),t.w.get()]);else if(t.num>4){t.uni.setValue(t.port.get())}t.changed=false}}}}};CABLES.OPS["a165fc89-a35b-4d39-8930-7345b098bd9d"]={f:Ops.Gl.Shader.CustomShader_v2,objName:"Ops.Gl.Shader.CustomShader_v2"};Ops.Array.InterpolateArrays=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Exe"),o=e.inArray("Array 1"),l=e.inArray("Array 2"),u=e.inValueSlider("perc"),h=e.outTrigger("Next"),c=e.outArray("Result");let f=true;let d=[];e.toWorkPortsNeedToBeLinked(o,l);o.onChange=l.onChange=u.onChange=n;i.onTriggered=r;function n(){f=true}function r(){let i=o.get();let n=l.get();let r;let s;let a;if(!i||!n||i.length<n.length){c.set(null);return}if(f){if(d.length!=i.length)d.length=i.length;let t=u.get();for(let e=0;e<i.length;e++){r=i[e];s=n[e];a=(s-r)*t+r;d[e]=a}f=false;c.setRef(d)}h.trigger()}o.onLinkChanged=l.onLinkChanged=function(){let e=o.get();let t=l.get();if(!e||!t){c.set(null);return}let i=e[0];let n=t[0];if(typeof i==="string"||typeof n==="string"){c.set(null)}}}};CABLES.OPS["09296117-7312-4f80-982b-7b4a81d22cf8"]={f:Ops.Array.InterpolateArrays,objName:"Ops.Array.InterpolateArrays"};Ops.Array.Array3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const s=e.inValueInt("Num Triplets",100),a=e.inValueFloat("X",0),o=e.inValueFloat("Y",0),l=e.inValueFloat("Z",0),u=e.outArray("Array",null,3),h=e.outNumber("Total points"),c=e.outNumber("Array length");s.onChange=a.onChange=o.onChange=l.onChange=i;let f=[];i();function i(){let t=Math.floor(s.get()*3);if(t<0)t=0;if(f.length!=t)f.length=t;const i=a.get();const n=o.get();const r=l.get();for(let e=0;e<t;e+=3){f[e]=i;f[e+1]=n;f[e+2]=r}u.setRef(f);h.set(t/3);c.set(t)}}};CABLES.OPS["2766606a-3ea0-4204-8613-b8950a124435"]={f:Ops.Array.Array3,objName:"Ops.Array.Array3"};Ops.Array.ArrayMerge_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=8;const n=[];for(let e=0;e<i;e++){n[e]=t.inArray("Array "+e);n[e].onChange=function(){o()}}const r=t.outArray("Result"),s=t.outNumber("Array length");let a=[];function o(){a.length=0;for(let e=0;e<i;e++){const t=n[e].get();if(t)a=a.concat(t)}r.setRef(a);s.set(a.length)}}};CABLES.OPS["753d053a-04a3-44c7-abf0-ae2676ced13e"]={f:Ops.Array.ArrayMerge_v3,objName:"Ops.Array.ArrayMerge_v3"};Ops.Array.Array_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const n=t.inValueInt("Array length",10),i=t.inSwitch("Mode select",["Number","1,2,3,4","0-1"],"Number"),r=t.inValueFloat("Default Value"),s=t.inBool("Reverse",false),a=t.outArray("Array"),o=t.outNumber("Array length out");let l=[];let u=0;const h=0;const c=1;const f=2;i.onChange=d;s.onChange=r.onChange=n.onChange=g;d();g();function d(){let e=i.get();if(e==="Number")u=h;else if(e==="1,2,3,4")u=c;else if(e==="0-1")u=f;r.setUiAttribs({greyout:u!==h});t.setUiAttrib({extendTitle:i.get()});g()}function g(){l.length=0;let e=n.get();let t=r.get();let i;if(u===h){for(i=0;i<e;i++){l[i]=t}}else if(u===c){for(i=0;i<e;i++){l[i]=i}}else if(u===f){if(e>1){for(i=0;i<e;i++){l[i]=i/(e-1)}}else{l=[0]}}if(s.get())l=l.reverse();a.setRef(l);o.set(l.length)}}};CABLES.OPS["e4d31a46-bf64-42a8-be34-4cbb2bbc2600"]={f:Ops.Array.Array_v3,objName:"Ops.Array.Array_v3"};Ops.Array.SwitchArray=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};let t=i.inValueInt("Index");let n=[];let r=i.outArray("Result");t.onChange=s;t.onLinkChanged=s;i.on("init",s);for(let t=0;t<10;t++){let e=i.inArray("Array "+t);n.push(e);e.onChange=s;e.onLinkChanged=s}function s(){if(t.get()>=0&&n[t.get()]&&n[t.get()].isLinked()){r.setRef(n[t.get()].get())}else r.setRef([])}}};CABLES.OPS["3fab881c-c2cf-42a0-9c42-2d8edfd93f57"]={f:Ops.Array.SwitchArray,objName:"Ops.Array.SwitchArray"};Ops.Vars.VarSetArray_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"array",i,e.varName)}};CABLES.OPS["8088290f-45d4-4312-b4ca-184d34ca4667"]={f:Ops.Vars.VarSetArray_v2,objName:"Ops.Vars.VarSetArray_v2"};Ops.Color.HexToRGB_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const r=e.inString("Hex","#ff0000"),s=e.inValueBool("Bytes"),a=e.outNumber("R"),o=e.outNumber("G"),l=e.outNumber("B"),u=e.outArray("RGB Array");function h(e){return parseInt(i(e).substring(0,2),16)||0}function c(e){return parseInt(i(e).substring(2,4),16)||0}function f(e){return parseInt(i(e).substring(4,6),16)||0}function i(e=""){return e.charAt(0)=="#"?e.substring(1,7):e}r.onChange=n;s.onChange=n;function n(){let e=r.get()||"";let t=h(e);let i=c(e);let n=f(e);if(!s.get()){t/=255;i/=255;n/=255}a.set(t);l.set(n);o.set(i);u.set([t,i,n])}}};CABLES.OPS["9877f198-8dac-48e5-9310-244ef1a8dec5"]={f:Ops.Color.HexToRGB_v2,objName:"Ops.Color.HexToRGB_v2"};Ops.Gl.ShaderEffects.TextureProjection_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={maptexture_frag:"IN vec2 MOD_tc;\n\n#ifdef MOD_MAP_TRIPLANAR\n    IN vec2 MOD_tc1;\n    IN vec2 MOD_tc2;\n    IN vec3 MOD_blendingTri;\n#endif\n\n\n{{CGL.BLENDMODES3}}",maptexture_vert:"vec3 MOD_pos;\n\n#ifndef MOD_WORLDSPACE\n   MOD_pos=(vec4(vPosition,1.0)*1.0/MOD_scale).xyz;\n#endif\n#ifdef MOD_WORLDSPACE\n   MOD_pos=(mMatrix*pos).xyz*1.0/MOD_scale;\n#endif\n\nMOD_pos=(vec4(MOD_pos,1.0)*MOD_rotationX(MOD_rotX*MOD_DEG2RAD)).xyz;\nMOD_pos=(vec4(MOD_pos,1.0)*MOD_rotationY(MOD_rotY*MOD_DEG2RAD)).xyz;\nMOD_pos=(vec4(MOD_pos,1.0)*MOD_rotationZ(MOD_rotZ*MOD_DEG2RAD)).xyz;\n\n#ifdef MOD_MAP_XY\n    MOD_tc=MOD_pos.xy;\n#endif\n#ifdef MOD_MAP_XZ\n    MOD_tc=MOD_pos.xz;\n#endif\n#ifdef MOD_MAP_YZ\n    MOD_tc=MOD_pos.yz;\n#endif\n\nMOD_tc.xy+=vec2(0.5,0.5);\nMOD_tc.xy+=MOD_offset;\n\n\n#ifdef MOD_TARGET_POINTSIZE\n\n    gl_PointSize+=(texture(MOD_tex,MOD_tc).x*MOD_amount);\n\n#endif\n\n\n#ifdef MOD_MAP_TRIPLANAR\n    mapTriplanar((mMatrix*vec4(attrVertNormal,1.0)).xyz,MOD_pos);\n#endif\n\n",maptexture_body_frag:"#ifndef MOD_TARGET_POINTSIZE\n\n\n    vec4 MOD_color;\n\n    #ifdef MOD_MAP_TRIPLANAR\n        vec4 xaxis = texture( MOD_tex, MOD_tc);\n        vec4 yaxis = texture( MOD_tex, MOD_tc1);\n        vec4 zaxis = texture( MOD_tex, MOD_tc2);\n        MOD_color = xaxis *MOD_blendingTri.x + yaxis *MOD_blendingTri.y + zaxis *MOD_blendingTri.z;\n        MOD_color.a=1.0;\n    #endif\n\n\n    vec2 MOD_ntc=MOD_tc;\n\n    #ifdef MOD_MAP_SCREEN\n        MOD_ntc=(vec2(gl_FragCoord.x,gl_FragCoord.y)/vec2(MOD_viewPortW,MOD_viewPortH));\n\n        MOD_ntc-=vec2(0.5,0.5);\n        MOD_ntc*=1.0/MOD_scale;\n        MOD_ntc+=vec2(0.5,0.5);\n        MOD_ntc-=MOD_offset;\n    #endif\n\n    #ifdef MOD_MAP_TEXCOORD\n        MOD_ntc=texCoord*1.0/MOD_scale-MOD_offset;\n    #endif\n\n    #ifdef MOD_MAP_TEXCOORD1\n        MOD_ntc=texCoord1*1.0/MOD_scale-MOD_offset;\n    #endif\n\n    #ifdef MOD_MAP_TEXCOORD2\n        MOD_ntc=texCoord2*1.0/MOD_scale-MOD_offset;\n    #endif\n\n\n    #ifdef MOD_DISCARD\n    if(MOD_ntc.x>0.0 && MOD_ntc.x<1.0 && MOD_ntc.y>0.0 && MOD_ntc.y<1.0)\n    {\n    #endif\n\n        #ifndef MOD_MAP_TRIPLANAR\n            MOD_color=texture(MOD_tex,MOD_ntc);\n        #endif\n\n        #ifdef MOD_USE_IMGALPHA\n            col.a=MOD_color.a;\n        #endif\n\n        #ifdef MOD_TARGET_COLOR\n        col=cgl_blendPixel(col,MOD_color,MOD_amount*col.a);\n        #endif\n        #ifdef MOD_TARGET_ALPHA\n        col.a=1.0-MOD_color.r*MOD_amount;\n        #endif\n\n    #ifdef MOD_DISCARD\n    }\n\n    #endif\n#endif\n",maptexture_body_vert:"OUT vec2 MOD_tc;\n\nconst float MOD_DEG2RAD = 0.017453292519943;\n\n#ifdef MOD_MAP_TRIPLANAR\n\n    OUT vec2 MOD_tc1;\n    OUT vec2 MOD_tc2;\n    OUT vec3 MOD_blendingTri;\n\n    void mapTriplanar(vec3 wNorm,vec3 pos)\n    {\n        vec3 blending = abs( wNorm );\n        blending = normalize(max(blending, 0.1));\n        float b = (blending.x + blending.y + blending.z);\n        blending /= vec3(b);\n        MOD_blendingTri=blending;\n\n        MOD_tc = pos.yz;\n        MOD_tc1 = pos.xz;\n        MOD_tc2 = pos.xy;\n    }\n\n#endif\n\nmat4 MOD_rotationX( in float angle ) {\n\treturn mat4(\t1.0,\t\t0,\t\t\t0,\t\t\t0,\n\t\t\t \t\t0, \tcos(angle),\t-sin(angle),\t\t0,\n\t\t\t\t\t0, \tsin(angle),\t cos(angle),\t\t0,\n\t\t\t\t\t0, \t\t\t0,\t\t\t  0, \t\t1);\n}\n\nmat4 MOD_rotationY( in float angle ) {\n\treturn mat4(\tcos(angle),\t\t0,\t\tsin(angle),\t0,\n\t\t\t \t\t\t\t0,\t\t1.0,\t\t\t 0,\t0,\n\t\t\t\t\t-sin(angle),\t0,\t\tcos(angle),\t0,\n\t\t\t\t\t\t\t0, \t\t0,\t\t\t\t0,\t1);\n}\n\nmat4 MOD_rotationZ( in float angle ) {\n\treturn mat4(\tcos(angle),\t\t-sin(angle),\t0,\t0,\n\t\t\t \t\tsin(angle),\t\tcos(angle),\t\t0,\t0,\n\t\t\t\t\t\t\t0,\t\t\t\t0,\t\t1,\t0,\n\t\t\t\t\t\t\t0,\t\t\t\t0,\t\t0,\t1);\n}\n"};const i=e.inTrigger("render"),n=e.outTrigger("trigger"),r=e.inTexture("Texture"),s=CGL.TextureEffect.AddBlendSelect(e,"blendMode"),a=e.inValueSlider("Amount",.3),o=e.inSwitch("Target",["Color","Pointsize","Alpha"],"Color"),l=e.inValue("Scale",10),u=e.inBool("Use Texture Alpha",false),h=e.inFloat("Pos X",0),c=e.inFloat("Pos Y",0),f=e.inFloat("Rot X",0),d=e.inFloat("Rot Y",0),g=e.inFloat("Rot Z",0),m=e.inValueSelect("Mapping",["Triplanar","XY","XZ","YZ","Screen","TexCoords 1","TexCoords 2","TexCoords 3"],"XY"),p=e.inValueBool("Discard"),_=e.inValueBool("WorldSpace");const b=e.patch.cgl;i.onLinkChanged=u.onChange=o.onChange=s.onChange=p.onChange=_.onChange=r.onLinkChanged=m.onChange=x;e.toWorkPortsNeedToBeLinked(r,n);e.setPortGroup("Rotation",[f,d,g]);e.setPortGroup("Position",[h,c]);const v=new CGL.ShaderModifier(b,e.name,{opId:e.id});v.addModule({title:e.name,name:"MODULE_VERTEX_POSITION",srcHeadVert:t.maptexture_body_vert,srcBodyVert:t.maptexture_vert,attributes:[{type:"vec2",name:"attrTexCoord1",nameFrag:"texCoord1"},{type:"vec2",name:"attrTexCoord2",nameFrag:"texCoord2"}]});let A=t.maptexture_frag;v.addModule({title:e.name,name:"MODULE_COLOR",srcHeadFrag:A,srcBodyFrag:t.maptexture_body_frag});v.addUniformBoth("f","MOD_rotX",f);v.addUniformBoth("f","MOD_rotY",d);v.addUniformBoth("f","MOD_rotZ",g);v.addUniformBoth("t","MOD_tex");v.addUniformBoth("f","MOD_scale",l);v.addUniformBoth("f","MOD_amount",a);v.addUniformBoth("2f","MOD_offset",h,c);const T=v.addUniformFrag("f","MOD_viewPortW");const E=v.addUniformFrag("f","MOD_viewPortH");CGL.TextureEffect.setupBlending(e,v,s,a);x();function x(){v.toggleDefine("MOD_USE_IMGALPHA",u.get());v.toggleDefine("MOD_WORLDSPACE",_.get());v.toggleDefine("MOD_MAP_XY",m.get()=="XY");v.toggleDefine("MOD_MAP_XZ",m.get()=="XZ");v.toggleDefine("MOD_MAP_YZ",m.get()=="YZ");v.toggleDefine("MOD_MAP_TEXCOORD",m.get()=="TexCoords 1");v.toggleDefine("MOD_MAP_TEXCOORD1",m.get()=="TexCoords 2");v.toggleDefine("MOD_MAP_TEXCOORD2",m.get()=="TexCoords 3");v.toggleDefine("MOD_MAP_SCREEN",m.get()=="Screen");v.toggleDefine("MOD_MAP_TRIPLANAR",m.get()=="Triplanar");v.toggleDefine("MOD_DISCARD",p.get());v.toggleDefine("MOD_BLEND_NORMAL",s.get()=="Normal");v.toggleDefine("MOD_BLEND_ADD",s.get()=="Add");v.toggleDefine("MOD_BLEND_MUL",s.get()=="Mul");v.toggleDefine("MOD_BLEND_MUL",s.get()=="Mul");v.toggleDefine("MOD_TARGET_ALPHA",o.get()=="Alpha");v.toggleDefine("MOD_TARGET_COLOR",o.get()=="Color");v.toggleDefine("MOD_TARGET_POINTSIZE",o.get()=="Pointsize");if(o.get()=="Pointsize"&&m.get()=="Screen")e.setUiError("pointscreen","This combination of Mapping and Target is not possible",1);else e.setUiError("pointscreen",null);CGL.TextureEffect.setupBlending(e,v,s,a)}i.onTriggered=function(){const e=b.getViewPort();v.bind();v.setUniformValue("MOD_viewPortW",e[2]);v.setUniformValue("MOD_viewPortH",e[3]);let t=r.get();if(!t)t=CGL.Texture.getEmptyTexture(b).tex;else t=t.tex;v.pushTexture("MOD_tex",t);n.trigger();v.unbind()}}};CABLES.OPS["9be647c2-7afd-40ed-b669-9826ea6a50ca"]={f:Ops.Gl.ShaderEffects.TextureProjection_v2,objName:"Ops.Gl.ShaderEffects.TextureProjection_v2"};Ops.Vars.VarGetTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outTexture("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"object",e.varName,i)}};CABLES.OPS["5f8ce5fc-9787-45c9-9a83-0eebd2c6de15"]={f:Ops.Vars.VarGetTexture_v2,objName:"Ops.Vars.VarGetTexture_v2"};Ops.Gl.Shader.BasicMaterial_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={basicmaterial_frag:"{{MODULES_HEAD}}\n\nIN vec2 texCoord;\n\n#ifdef VERTEX_COLORS\nIN vec4 vertCol;\n#endif\n\n#ifdef HAS_TEXTURES\n    IN vec2 texCoordOrig;\n    #ifdef HAS_TEXTURE_DIFFUSE\n        UNI sampler2D tex;\n    #endif\n    #ifdef HAS_TEXTURE_OPACITY\n        UNI sampler2D texOpacity;\n   #endif\n#endif\n\n\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n    vec4 col=color;\n\n\n    #ifdef HAS_TEXTURES\n        vec2 uv=texCoord;\n\n        #ifdef CROP_TEXCOORDS\n            if(uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0) discard;\n        #endif\n\n        #ifdef HAS_TEXTURE_DIFFUSE\n            col=texture(tex,uv);\n\n            #ifdef COLORIZE_TEXTURE\n                col.r*=color.r;\n                col.g*=color.g;\n                col.b*=color.b;\n            #endif\n        #endif\n        col.a*=color.a;\n        #ifdef HAS_TEXTURE_OPACITY\n            #ifdef TRANSFORMALPHATEXCOORDS\n                uv=texCoordOrig;\n            #endif\n            #ifdef ALPHA_MASK_IR\n                col.a*=1.0-texture(texOpacity,uv).r;\n            #endif\n            #ifdef ALPHA_MASK_IALPHA\n                col.a*=1.0-texture(texOpacity,uv).a;\n            #endif\n            #ifdef ALPHA_MASK_ALPHA\n                col.a*=texture(texOpacity,uv).a;\n            #endif\n            #ifdef ALPHA_MASK_LUMI\n                col.a*=dot(vec3(0.2126,0.7152,0.0722), texture(texOpacity,uv).rgb);\n            #endif\n            #ifdef ALPHA_MASK_R\n                col.a*=texture(texOpacity,uv).r;\n            #endif\n            #ifdef ALPHA_MASK_G\n                col.a*=texture(texOpacity,uv).g;\n            #endif\n            #ifdef ALPHA_MASK_B\n                col.a*=texture(texOpacity,uv).b;\n            #endif\n            // #endif\n        #endif\n    #endif\n\n    {{MODULE_COLOR}}\n\n    #ifdef DISCARDTRANS\n        if(col.a<0.2) discard;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        col*=vertCol;\n    #endif\n\n    outColor = col;\n}\n",basicmaterial_vert:"\n{{MODULES_HEAD}}\n\nOUT vec2 texCoord;\nOUT vec2 texCoordOrig;\n\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\n#ifdef HAS_TEXTURES\n    UNI float diffuseRepeatX;\n    UNI float diffuseRepeatY;\n    UNI float texOffsetX;\n    UNI float texOffsetY;\n#endif\n\n#ifdef VERTEX_COLORS\n    in vec4 attrVertColor;\n    out vec4 vertCol;\n\n#endif\n\n\nvoid main()\n{\n    mat4 mMatrix=modelMatrix;\n    mat4 modelViewMatrix;\n\n    norm=attrVertNormal;\n    texCoordOrig=attrTexCoord;\n    texCoord=attrTexCoord;\n    #ifdef HAS_TEXTURES\n        texCoord.x=texCoord.x*diffuseRepeatX+texOffsetX;\n        texCoord.y=(1.0-texCoord.y)*diffuseRepeatY+texOffsetY;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        vertCol=attrVertColor;\n    #endif\n\n    vec4 pos = vec4(vPosition, 1.0);\n\n    #ifdef BILLBOARD\n       vec3 position=vPosition;\n       modelViewMatrix=viewMatrix*modelMatrix;\n\n       gl_Position = projMatrix * modelViewMatrix * vec4((\n           position.x * vec3(\n               modelViewMatrix[0][0],\n               modelViewMatrix[1][0],\n               modelViewMatrix[2][0] ) +\n           position.y * vec3(\n               modelViewMatrix[0][1],\n               modelViewMatrix[1][1],\n               modelViewMatrix[2][1]) ), 1.0);\n    #endif\n\n    {{MODULE_VERTEX_POSITION}}\n\n    #ifndef BILLBOARD\n        modelViewMatrix=viewMatrix * mMatrix;\n\n        {{MODULE_VERTEX_MODELVIEW}}\n\n    #endif\n\n    // mat4 modelViewMatrix=viewMatrix*mMatrix;\n\n    #ifndef BILLBOARD\n        // gl_Position = projMatrix * viewMatrix * modelMatrix * pos;\n        gl_Position = projMatrix * modelViewMatrix * pos;\n    #endif\n}\n"};const i=e.inTrigger("render");const n=e.outTrigger("trigger");const r=e.outObject("shader",null,"shader");r.ignoreValueSerialize=true;e.toWorkPortsNeedToBeLinked(i);e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);const s=e.patch.cgl;const a=new CGL.Shader(s,"basicmaterial",this);a.addAttribute({type:"vec3",name:"vPosition"});a.addAttribute({type:"vec2",name:"attrTexCoord"});a.addAttribute({type:"vec3",name:"attrVertNormal",nameFrag:"norm"});a.addAttribute({type:"float",name:"attrVertIndex"});a.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);a.setSource(t.basicmaterial_vert,t.basicmaterial_frag);r.setRef(a);i.onTriggered=y;const o=e.inValueSlider("r",Math.random());const l=e.inValueSlider("g",Math.random());const u=e.inValueSlider("b",Math.random());const h=e.inValueSlider("a",1);o.setUiAttribs({colorPick:true});const c=a.addUniformFrag("4f","color",o,l,u,h);a.uniformColorDiffuse=c;const f=e.inTexture("texture");let d=null;f.onChange=R;const g=e.inValueBool("colorizeTexture",false);const m=e.inValueBool("Vertex Colors",false);const p=e.inTexture("textureOpacity");let _=null;const b=e.inSwitch("Alpha Mask Source",["Luminance","R","G","B","A","1-A","1-R"],"Luminance");b.setUiAttribs({greyout:true});p.onChange=C;const v=e.inValueBool("Opacity TexCoords Transform",false);const A=e.inValueBool("Discard Transparent Pixels");const T=e.inValue("diffuseRepeatX",1),E=e.inValue("diffuseRepeatY",1),x=e.inValue("Tex Offset X",0),O=e.inValue("Tex Offset Y",0),I=e.inBool("Crop TexCoords",false);a.addUniformFrag("f","diffuseRepeatX",T);a.addUniformFrag("f","diffuseRepeatY",E);a.addUniformFrag("f","texOffsetX",x);a.addUniformFrag("f","texOffsetY",O);const S=e.inValueBool("billboard",false);b.onChange=S.onChange=A.onChange=v.onChange=I.onChange=m.onChange=g.onChange=M;e.setPortGroup("Color",[o,l,u,h]);e.setPortGroup("Color Texture",[f,m,g]);e.setPortGroup("Opacity",[p,b,A,v]);e.setPortGroup("Texture Transform",[T,E,x,O,I]);C();R();e.preRender=function(){a.bind();y();if(!a)return};function y(){e.checkGraphicsApi();s.pushShader(a);a.popTextures();if(d&&f.get())a.pushTexture(d,f.get());if(_&&p.get())a.pushTexture(_,p.get());n.trigger();s.popShader()}function C(){if(p.get()){if(_!==null)return;a.removeUniform("texOpacity");a.define("HAS_TEXTURE_OPACITY");if(!_)_=new CGL.Uniform(a,"t","texOpacity")}else{a.removeUniform("texOpacity");a.removeDefine("HAS_TEXTURE_OPACITY");_=null}M()}function R(){if(f.get()){if(!a.hasDefine("HAS_TEXTURE_DIFFUSE"))a.define("HAS_TEXTURE_DIFFUSE");if(!d)d=new CGL.Uniform(a,"t","texDiffuse")}else{a.removeUniform("texDiffuse");a.removeDefine("HAS_TEXTURE_DIFFUSE");d=null}N()}function N(){const e=f.isLinked()||p.isLinked();T.setUiAttribs({greyout:!e});E.setUiAttribs({greyout:!e});x.setUiAttribs({greyout:!e});O.setUiAttribs({greyout:!e});g.setUiAttribs({greyout:!e});b.setUiAttribs({greyout:!p.get()});v.setUiAttribs({greyout:!p.get()});let t=true;t=f.get()&&!g.get();o.setUiAttribs({greyout:t});l.setUiAttribs({greyout:t});u.setUiAttribs({greyout:t})}function M(){a.toggleDefine("VERTEX_COLORS",m.get());a.toggleDefine("CROP_TEXCOORDS",I.get());a.toggleDefine("COLORIZE_TEXTURE",g.get());a.toggleDefine("TRANSFORMALPHATEXCOORDS",v.get());a.toggleDefine("DISCARDTRANS",A.get());a.toggleDefine("BILLBOARD",S.get());a.toggleDefine("ALPHA_MASK_ALPHA",b.get()=="A");a.toggleDefine("ALPHA_MASK_IALPHA",b.get()=="1-A");a.toggleDefine("ALPHA_MASK_IR",b.get()=="1-R");a.toggleDefine("ALPHA_MASK_LUMI",b.get()=="Luminance");a.toggleDefine("ALPHA_MASK_R",b.get()=="R");a.toggleDefine("ALPHA_MASK_G",b.get()=="G");a.toggleDefine("ALPHA_MASK_B",b.get()=="B");N()}}};CABLES.OPS["ec55d252-3843-41b1-b731-0482dbd9e72b"]={f:Ops.Gl.Shader.BasicMaterial_v3,objName:"Ops.Gl.Shader.BasicMaterial_v3"};Ops.Gl.GLTF.GltfScene_v4=class extends CABLES.Op{constructor(){super(...arguments);const T=this;const l=T.attachments={inc_camera_js:"const gltfCamera = class\n{\n    constructor(gltf, node)\n    {\n        this.node = node;\n        this.name = node.name;\n        // console.log(gltf);\n        this.config = gltf.json.cameras[node.camera];\n\n        this.pos = vec3.create();\n        this.quat = quat.create();\n        this.vCenter = vec3.create();\n        this.vUp = vec3.create();\n        this.vMat = mat4.create();\n    }\n\n    updateAnim(time)\n    {\n        if (this.node && this.node._animTrans)\n        {\n            vec3.set(this.pos,\n                this.node._animTrans[0].getValue(time),\n                this.node._animTrans[1].getValue(time),\n                this.node._animTrans[2].getValue(time));\n\n            quat.set(this.quat,\n                this.node._animRot[0].getValue(time),\n                this.node._animRot[1].getValue(time),\n                this.node._animRot[2].getValue(time),\n                this.node._animRot[3].getValue(time));\n        }\n    }\n\n    start(time)\n    {\n        if (cgl.tempData.shadowPass) return;\n\n        this.updateAnim(time);\n        const asp = cgl.getViewPort()[2] / cgl.getViewPort()[3];\n\n        cgl.pushPMatrix();\n        // mat4.perspective(\n        //     cgl.pMatrix,\n        //     this.config.perspective.yfov*0.5,\n        //     asp,\n        //     this.config.perspective.znear,\n        //     this.config.perspective.zfar);\n\n        cgl.pushViewMatrix();\n        // mat4.identity(cgl.vMatrix);\n\n        // if(this.node && this.node.parent)\n        // {\n        //     console.log(this.node.parent)\n        // vec3.add(this.pos,this.pos,this.node.parent._node.translation);\n        // vec3.sub(this.vCenter,this.vCenter,this.node.parent._node.translation);\n        // mat4.translate(cgl.vMatrix,cgl.vMatrix,\n        // [\n        //     -this.node.parent._node.translation[0],\n        //     -this.node.parent._node.translation[1],\n        //     -this.node.parent._node.translation[2]\n        // ])\n        // }\n\n        // vec3.set(this.vUp, 0, 1, 0);\n        // vec3.set(this.vCenter, 0, -1, 0);\n        // // vec3.set(this.vCenter, 0, 1, 0);\n        // vec3.transformQuat(this.vCenter, this.vCenter, this.quat);\n        // vec3.normalize(this.vCenter, this.vCenter);\n        // vec3.add(this.vCenter, this.vCenter, this.pos);\n\n        // mat4.lookAt(cgl.vMatrix, this.pos, this.vCenter, this.vUp);\n\n        let mv = mat4.create();\n        mat4.invert(mv, this.node.modelMatAbs());\n\n        // console.log(this.node.modelMatAbs());\n\n        this.vMat = mv;\n\n        mat4.identity(cgl.vMatrix);\n        // console.log(mv);\n        mat4.mul(cgl.vMatrix, cgl.vMatrix, mv);\n    }\n\n    end()\n    {\n        if (cgl.tempData.shadowPass) return;\n        cgl.popPMatrix();\n        cgl.popViewMatrix();\n    }\n};\n",inc_gltf_js:'const le = true; // little endian\n\nconst Gltf = class\n{\n    constructor()\n    {\n        this.json = {};\n        this.accBuffers = [];\n        this.meshes = [];\n        this.nodes = [];\n        this.shaders = [];\n        this.timing = [];\n        this.cams = [];\n        this.startTime = performance.now();\n        this.bounds = new CABLES.CG.BoundingBox();\n        this.loaded = Date.now();\n        this.accBuffersDelete = [];\n    }\n\n    getNode(n)\n    {\n        for (let i = 0; i < this.nodes.length; i++)\n        {\n            if (this.nodes[i].name == n) return this.nodes[i];\n        }\n    }\n\n    unHideAll()\n    {\n        for (let i = 0; i < this.nodes.length; i++)\n        {\n            this.nodes[i].unHide();\n        }\n    }\n};\n\nfunction Utf8ArrayToStr(array)\n{\n    if (window.TextDecoder) return new TextDecoder("utf-8").decode(array);\n\n    let out, i, len, c;\n    let char2, char3;\n\n    out = "";\n    len = array.length;\n    i = 0;\n    while (i < len)\n    {\n        c = array[i++];\n        switch (c >> 4)\n        {\n        case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7:\n            // 0xxxxxxx\n            out += String.fromCharCode(c);\n            break;\n        case 12: case 13:\n            // 110x xxxx   10xx xxxx\n            char2 = array[i++];\n            out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));\n            break;\n        case 14:\n            // 1110 xxxx  10xx xxxx  10xx xxxx\n            char2 = array[i++];\n            char3 = array[i++];\n            out += String.fromCharCode(((c & 0x0F) << 12) |\n                    ((char2 & 0x3F) << 6) |\n                    ((char3 & 0x3F) << 0));\n            break;\n        }\n    }\n\n    return out;\n}\n\nfunction readChunk(dv, bArr, arrayBuffer, offset)\n{\n    const chunk = {};\n\n    if (offset >= dv.byteLength)\n    {\n        // op.log("could not read chunk...");\n        return;\n    }\n    chunk.size = dv.getUint32(offset + 0, le);\n\n    // chunk.type = new TextDecoder("utf-8").decode(bArr.subarray(offset+4, offset+4+4));\n    chunk.type = Utf8ArrayToStr(bArr.subarray(offset + 4, offset + 4 + 4));\n\n    if (chunk.type == "BIN\\0")\n    {\n        // console.log(chunk.size,arrayBuffer.length,offset);\n        // try\n        // {\n        chunk.dataView = new DataView(arrayBuffer, offset + 8, chunk.size);\n        // }\n        // catch(e)\n        // {\n        //     chunk.dataView = null;\n        //     console.log(e);\n        // }\n    }\n    else\n    if (chunk.type == "JSON")\n    {\n        const json = Utf8ArrayToStr(bArr.subarray(offset + 8, offset + 8 + chunk.size));\n\n        try\n        {\n            const obj = JSON.parse(json);\n            chunk.data = obj;\n            outGenerator.set(obj.asset.generator);\n        }\n        catch (e)\n        {\n        }\n    }\n    else\n    {\n        op.warn("unknown type", chunk.type);\n    }\n\n    return chunk;\n}\n\nfunction loadAnims(gltf)\n{\n    const uniqueAnimNames = {};\n    maxTimeDict = {};\n\n    for (let i = 0; i < gltf.json.animations.length; i++)\n    {\n        const an = gltf.json.animations[i];\n\n        an.name = an.name || "unknown";\n\n        for (let ia = 0; ia < an.channels.length; ia++)\n        {\n            const chan = an.channels[ia];\n\n            const node = gltf.nodes[chan.target.node];\n            const sampler = an.samplers[chan.sampler];\n\n            const acc = gltf.json.accessors[sampler.input];\n            const bufferIn = gltf.accBuffers[sampler.input];\n\n            const accOut = gltf.json.accessors[sampler.output];\n            const bufferOut = gltf.accBuffers[sampler.output];\n\n            gltf.accBuffersDelete.push(sampler.output, sampler.input);\n\n            if (bufferIn && bufferOut)\n            {\n                let numComps = 1;\n                if (accOut.type === "VEC2")numComps = 2;\n                else if (accOut.type === "VEC3")numComps = 3;\n                else if (accOut.type === "VEC4")numComps = 4;\n                else if (accOut.type === "SCALAR")\n                {\n                    numComps = bufferOut.length / bufferIn.length; // is this really the way to find out ? cant find any other way,except number of morph targets, but not really connected...\n                }\n                else op.log("[] UNKNOWN accOut.type", accOut.type);\n\n                const anims = [];\n\n                uniqueAnimNames[an.name] = true;\n\n                for (let k = 0; k < numComps; k++)\n                {\n                    const newAnim = new CABLES.Anim();\n                    // newAnim.name=an.name;\n                    newAnim.batchMode = true;\n                    anims.push(newAnim);\n                }\n\n                if (sampler.interpolation === "LINEAR") {}\n                else if (sampler.interpolation === "STEP") for (let k = 0; k < numComps; k++) anims[k].defaultEasing = CABLES.EASING_ABSOLUTE;\n                else if (sampler.interpolation === "CUBICSPLINE") for (let k = 0; k < numComps; k++) anims[k].defaultEasing = CABLES.EASING_CUBICSPLINE;\n                else op.warn("unknown interpolation", sampler.interpolation);\n\n                // console.log(bufferOut)\n\n                // if there is no keyframe for time 0 copy value of first keyframe at time 0\n                if (bufferIn[0] !== 0.0)\n                    for (let k = 0; k < numComps; k++)\n                        anims[k].setValue(0, bufferOut[0 * numComps + k]);\n\n                for (let j = 0; j < bufferIn.length; j++)\n                {\n                    // maxTime = Math.max(bufferIn[j], maxTime);\n                    maxTimeDict[an.name] = bufferIn[j];\n\n                    for (let k = 0; k < numComps; k++)\n                    {\n                        if (anims[k].defaultEasing === CABLES.EASING_CUBICSPLINE)\n                        {\n                            const idx = ((j * numComps) * 3 + k);\n\n                            const key = anims[k].setValue(bufferIn[j], bufferOut[idx + numComps]);\n                            key.bezTangIn = bufferOut[idx];\n                            key.bezTangOut = bufferOut[idx + (numComps * 2)];\n\n                            // console.log(an.name,k,bufferOut[idx+1]);\n                        }\n                        else\n                        {\n                            // console.log(an.name,k,bufferOut[j * numComps + k]);\n                            anims[k].setValue(bufferIn[j], bufferOut[j * numComps + k]);\n                        }\n                    }\n                }\n                for (let k = 0; k < numComps; k++)anims[k].batchMode = false;\n\n                node.setAnim(chan.target.path, an.name, anims);\n            }\n            else\n            {\n                op.warn("loadAmins bufferIn undefined ", bufferIn === undefined);\n                op.warn("loadAmins bufferOut undefined ", bufferOut === undefined);\n                op.warn("loadAmins ", an.name, sampler, accOut);\n                op.warn("loadAmins num accBuffers", gltf.accBuffers.length);\n                op.warn("loadAmins num accessors", gltf.json.accessors.length);\n            }\n        }\n    }\n\n    gltf.uniqueAnimNames = uniqueAnimNames;\n\n    outAnims.setRef(Object.keys(uniqueAnimNames));\n}\n\nfunction loadCams(gltf)\n{\n    if (!gltf || !gltf.json.cameras) return;\n\n    gltf.cameras = gltf.cameras || [];\n\n    for (let i = 0; i < gltf.nodes.length; i++)\n    {\n        if (gltf.nodes[i].hasOwnProperty("camera"))\n        {\n            const cam = new gltfCamera(gltf, gltf.nodes[i]);\n            gltf.cameras.push(cam);\n        }\n    }\n}\n\nfunction loadAfterDraco()\n{\n    if (!window.DracoDecoder)\n    {\n        setTimeout(() =>\n        {\n            loadAfterDraco();\n        }, 100);\n    }\n\n    reloadSoon();\n}\n\nfunction parseGltf(arrayBuffer)\n{\n    const CHUNK_HEADER_SIZE = 8;\n\n    let j = 0, i = 0;\n\n    const gltf = new Gltf();\n    gltf.timing.push(["Start parsing", Math.round((performance.now() - gltf.startTime))]);\n\n    if (!arrayBuffer) return;\n    const byteArray = new Uint8Array(arrayBuffer);\n    let pos = 0;\n\n    // var string = new TextDecoder("utf-8").decode(byteArray.subarray(pos, 4));\n    const string = Utf8ArrayToStr(byteArray.subarray(pos, 4));\n    pos += 4;\n    if (string != "glTF") return;\n\n    gltf.timing.push(["dataview", Math.round((performance.now() - gltf.startTime))]);\n\n    const dv = new DataView(arrayBuffer);\n    const version = dv.getUint32(pos, le);\n    pos += 4;\n    const size = dv.getUint32(pos, le);\n    pos += 4;\n\n    outVersion.set(version);\n\n    const chunks = [];\n    gltf.chunks = chunks;\n\n    chunks.push(readChunk(dv, byteArray, arrayBuffer, pos));\n    pos += chunks[0].size + CHUNK_HEADER_SIZE;\n    gltf.json = chunks[0].data;\n\n    gltf.cables = {\n        "fileUrl": inFile.get(),\n        "shortFileName": CABLES.basename(inFile.get())\n    };\n\n    outJson.setRef(gltf.json);\n    outExtensions.setRef(gltf.json.extensionsUsed || []);\n\n    let ch = readChunk(dv, byteArray, arrayBuffer, pos);\n    while (ch)\n    {\n        chunks.push(ch);\n        pos += ch.size + CHUNK_HEADER_SIZE;\n        ch = readChunk(dv, byteArray, arrayBuffer, pos);\n    }\n\n    gltf.chunks = chunks;\n\n    const views = chunks[0].data.bufferViews;\n    const accessors = chunks[0].data.accessors;\n\n    gltf.timing.push(["Parse buffers", Math.round((performance.now() - gltf.startTime))]);\n\n    if (gltf.json.extensionsUsed && gltf.json.extensionsUsed.indexOf("KHR_draco_mesh_compression") > -1)\n    {\n        if (!window.DracoDecoder)\n        {\n            op.setUiError("gltfdraco", "GLTF draco compression lib not found / add draco op to your patch!");\n\n            loadAfterDraco();\n            return gltf;\n        }\n        else\n        {\n            gltf.useDraco = true;\n        }\n    }\n\n    op.setUiError("gltfdraco", null);\n    // let accPos = (view.byteOffset || 0) + (acc.byteOffset || 0);\n\n    if (views)\n    {\n        for (i = 0; i < accessors.length; i++)\n        {\n            const acc = accessors[i];\n            const view = views[acc.bufferView];\n\n            let numComps = 0;\n            if (acc.type == "SCALAR")numComps = 1;\n            else if (acc.type == "VEC2")numComps = 2;\n            else if (acc.type == "VEC3")numComps = 3;\n            else if (acc.type == "VEC4")numComps = 4;\n            else if (acc.type == "MAT4")numComps = 16;\n            else console.error("unknown accessor type", acc.type);\n\n            //   const decoder = new decoderModule.Decoder();\n            //   const decodedGeometry = decodeDracoData(data, decoder);\n            //   // Encode mesh\n            //   encodeMeshToFile(decodedGeometry, decoder);\n\n            //   decoderModule.destroy(decoder);\n            //   decoderModule.destroy(decodedGeometry);\n\n            // 5120 (BYTE)\t1\n            // 5121 (UNSIGNED_BYTE)\t1\n            // 5122 (SHORT)\t2\n\n            if (chunks[1].dataView)\n            {\n                if (view)\n                {\n                    const num = acc.count * numComps;\n                    let accPos = (view.byteOffset || 0) + (acc.byteOffset || 0);\n                    let stride = view.byteStride || 0;\n                    let dataBuff = null;\n\n                    if (acc.componentType == 5126 || acc.componentType == 5125) // 4byte FLOAT or INT\n                    {\n                        stride = stride || 4;\n\n                        const isInt = acc.componentType == 5125;\n                        if (isInt)dataBuff = new Uint32Array(num);\n                        else dataBuff = new Float32Array(num);\n\n                        dataBuff.cblStride = numComps;\n\n                        for (j = 0; j < num; j++)\n                        {\n                            if (isInt) dataBuff[j] = chunks[1].dataView.getUint32(accPos, le);\n                            else dataBuff[j] = chunks[1].dataView.getFloat32(accPos, le);\n\n                            if (stride != 4 && (j + 1) % numComps === 0)accPos += stride - (numComps * 4);\n                            accPos += 4;\n                        }\n                    }\n                    else if (acc.componentType == 5123) // UNSIGNED_SHORT\n                    {\n                        stride = stride || 2;\n\n                        dataBuff = new Uint16Array(num);\n                        dataBuff.cblStride = stride;\n\n                        for (j = 0; j < num; j++)\n                        {\n                            dataBuff[j] = chunks[1].dataView.getUint16(accPos, le);\n\n                            if (stride != 2 && (j + 1) % numComps === 0) accPos += stride - (numComps * 2);\n\n                            accPos += 2;\n                        }\n                    }\n                    else if (acc.componentType == 5121) // UNSIGNED_BYTE\n                    {\n                        stride = stride || 1;\n\n                        dataBuff = new Uint8Array(num);\n                        dataBuff.cblStride = stride;\n\n                        for (j = 0; j < num; j++)\n                        {\n                            dataBuff[j] = chunks[1].dataView.getUint8(accPos, le);\n\n                            if (stride != 1 && (j + 1) % numComps === 0) accPos += stride - (numComps * 1);\n\n                            accPos += 1;\n                        }\n                    }\n\n                    else\n                    {\n                        console.error("unknown component type", acc.componentType);\n                    }\n\n                    gltf.accBuffers.push(dataBuff);\n                }\n                else\n                {\n                    // console.log("has no dataview");\n                }\n            }\n        }\n    }\n\n    gltf.timing.push(["Parse mesh groups", Math.round((performance.now() - gltf.startTime))]);\n\n    gltf.json.meshes = gltf.json.meshes || [];\n\n    if (gltf.json.meshes)\n    {\n        for (i = 0; i < gltf.json.meshes.length; i++)\n        {\n            const mesh = new gltfMeshGroup(gltf, gltf.json.meshes[i]);\n            gltf.meshes.push(mesh);\n        }\n    }\n\n    gltf.timing.push(["Parse nodes", Math.round((performance.now() - gltf.startTime))]);\n\n    for (i = 0; i < gltf.json.nodes.length; i++)\n    {\n        if (gltf.json.nodes[i].children)\n            for (j = 0; j < gltf.json.nodes[i].children.length; j++)\n            {\n                gltf.json.nodes[gltf.json.nodes[i].children[j]].isChild = true;\n            }\n    }\n\n    for (i = 0; i < gltf.json.nodes.length; i++)\n    {\n        const node = new gltfNode(gltf.json.nodes[i], gltf);\n        gltf.nodes.push(node);\n    }\n\n    for (i = 0; i < gltf.nodes.length; i++)\n    {\n        const node = gltf.nodes[i];\n\n        if (!node.children) continue;\n        for (let j = 0; j < node.children.length; j++)\n        {\n            gltf.nodes[node.children[j]].parent = node;\n        }\n    }\n\n    for (i = 0; i < gltf.nodes.length; i++)\n    {\n        gltf.nodes[i].initSkin();\n    }\n\n    needsMatUpdate = true;\n\n    gltf.timing.push(["load anims", Math.round((performance.now() - gltf.startTime))]);\n\n    if (gltf.json.animations) loadAnims(gltf);\n\n    gltf.timing.push(["load cameras", Math.round((performance.now() - gltf.startTime))]);\n\n    if (gltf.json.cameras) loadCams(gltf);\n\n    gltf.timing.push(["finished", Math.round((performance.now() - gltf.startTime))]);\n    return gltf;\n}\n',inc_mesh_js:'let gltfMesh = class\n{\n    constructor(name, prim, gltf, finished)\n    {\n        this.POINTS = 0;\n        this.LINES = 1;\n        this.LINE_LOOP = 2;\n        this.LINE_STRIP = 3;\n        this.TRIANGLES = 4;\n        this.TRIANGLE_STRIP = 5;\n        this.TRIANGLE_FAN = 6;\n\n        this.test = 0;\n        this.name = name;\n        this.submeshIndex = 0;\n        this.material = prim.material;\n        this.mesh = null;\n        this.geom = new CGL.Geometry("gltf_" + this.name);\n        this.geom.verticesIndices = [];\n        this.bounds = null;\n        this.primitive = 4;\n        this.morphTargetsRenderMod = null;\n        this.weights = prim.weights;\n\n        if (prim.hasOwnProperty("mode")) this.primitive = prim.mode;\n\n        if (prim.hasOwnProperty("indices")) this.geom.verticesIndices = gltf.accBuffers[prim.indices];\n\n        gltf.loadingMeshes = gltf.loadingMeshes || 0;\n        gltf.loadingMeshes++;\n\n        this.materialJson =\n            this._matPbrMetalness =\n            this._matPbrRoughness =\n            this._matDiffuseColor = null;\n\n        if (gltf.json.materials)\n        {\n            if (this.material != -1) this.materialJson = gltf.json.materials[this.material];\n\n            if (this.materialJson && this.materialJson.pbrMetallicRoughness)\n            {\n                if (!this.materialJson.pbrMetallicRoughness.hasOwnProperty("baseColorFactor"))\n                {\n                    this._matDiffuseColor = [1, 1, 1, 1];\n                }\n                else\n                {\n                    this._matDiffuseColor = this.materialJson.pbrMetallicRoughness.baseColorFactor;\n                }\n\n                this._matDiffuseColor = this.materialJson.pbrMetallicRoughness.baseColorFactor;\n\n                if (!this.materialJson.pbrMetallicRoughness.hasOwnProperty("metallicFactor"))\n                {\n                    this._matPbrMetalness = 1.0;\n                }\n                else\n                {\n                    this._matPbrMetalness = this.materialJson.pbrMetallicRoughness.metallicFactor || null;\n                }\n\n                if (!this.materialJson.pbrMetallicRoughness.hasOwnProperty("roughnessFactor"))\n                {\n                    this._matPbrRoughness = 1.0;\n                }\n                else\n                {\n                    this._matPbrRoughness = this.materialJson.pbrMetallicRoughness.roughnessFactor || null;\n                }\n            }\n        }\n\n        if (gltf.useDraco && prim.extensions.KHR_draco_mesh_compression)\n        {\n            const view = gltf.chunks[0].data.bufferViews[prim.extensions.KHR_draco_mesh_compression.bufferView];\n            const num = view.byteLength;\n            const dataBuff = new Int8Array(num);\n            let accPos = (view.byteOffset || 0);// + (acc.byteOffset || 0);\n            for (let j = 0; j < num; j++)\n            {\n                dataBuff[j] = gltf.chunks[1].dataView.getInt8(accPos, le);\n                accPos++;\n            }\n\n            const dracoDecoder = window.DracoDecoder;\n            dracoDecoder.decodeGeometry(dataBuff.buffer, (geometry) =>\n            {\n                const geom = new CGL.Geometry("draco mesh " + name);\n\n                for (let i = 0; i < geometry.attributes.length; i++)\n                {\n                    const attr = geometry.attributes[i];\n\n                    if (attr.name === "position") geom.vertices = attr.array;\n                    else if (attr.name === "normal") geom.vertexNormals = attr.array;\n                    else if (attr.name === "uv") geom.texCoords = attr.array;\n                    else if (attr.name === "color") geom.vertexColors = this.calcVertexColors(attr.array);\n                    else if (attr.name === "joints") geom.setAttribute("attrJoints", Array.from(attr.array), 4);\n                    else if (attr.name === "weights")\n                    {\n                        const arr4 = new Float32Array(attr.array.length / attr.itemSize * 4);\n\n                        for (let k = 0; k < attr.array.length / attr.itemSize; k++)\n                        {\n                            arr4[k * 4] = arr4[k * 4 + 1] = arr4[k * 4 + 2] = arr4[k * 4 + 3] = 0;\n                            for (let j = 0; j < attr.itemSize; j++)\n                                arr4[k * 4 + j] = attr.array[k * attr.itemSize + j];\n                        }\n                        geom.setAttribute("attrWeights", arr4, 4);\n                    }\n                    else op.logWarn("unknown draco attrib", attr);\n                }\n\n                geometry.attributes = null;\n                geom.verticesIndices = geometry.index.array;\n\n                this.setGeom(geom);\n\n                this.mesh = null;\n                gltf.loadingMeshes--;\n                gltf.timing.push(["draco decode", Math.round((performance.now() - gltf.startTime))]);\n\n                if (finished)finished(this);\n            }, (error) => { op.logError(error); });\n        }\n        else\n        {\n            gltf.loadingMeshes--;\n            this.fillGeomAttribs(gltf, this.geom, prim.attributes);\n\n            if (prim.targets)\n            {\n                for (let j = 0; j < prim.targets.length; j++)\n                {\n                    const tgeom = new CGL.Geometry("gltf_target_" + j);\n\n                    // if (prim.hasOwnProperty("indices")) tgeom.verticesIndices = gltf.accBuffers[prim.indices];\n\n                    this.fillGeomAttribs(gltf, tgeom, prim.targets[j], false);\n\n                    // { // calculate normals for final position of morphtarget for later...\n                    //     for (let i = 0; i < tgeom.vertices.length; i++) tgeom.vertices[i] += this.geom.vertices[i];\n                    //     tgeom.calculateNormals();\n                    //     for (let i = 0; i < tgeom.vertices.length; i++) tgeom.vertices[i] -= this.geom.vertices[i];\n                    // }\n\n                    this.geom.morphTargets.push(tgeom);\n                }\n            }\n            if (finished)finished(this);\n        }\n    }\n\n    _linearToSrgb(x)\n    {\n        if (x <= 0)\n            return 0;\n        else if (x >= 1)\n            return 1;\n        else if (x < 0.0031308)\n            return x * 12.92;\n        else\n            return x ** (1 / 2.2) * 1.055 - 0.055;\n    }\n\n    calcVertexColors(arr, type)\n    {\n        let vertexColors = null;\n        if (arr instanceof Float32Array)\n        {\n            let div = false;\n            for (let i = 0; i < arr.length; i++)\n            {\n                if (arr[i] > 1)\n                {\n                    div = true;\n                    continue;\n                }\n            }\n\n            if (div)\n                for (let i = 0; i < arr.length; i++) arr[i] /= 65535;\n\n            vertexColors = arr;\n        }\n\n        else if (arr instanceof Uint16Array)\n        {\n            const fb = new Float32Array(arr.length);\n            for (let i = 0; i < arr.length; i++) fb[i] = arr[i] / 65535;\n\n            vertexColors = fb;\n        }\n        else vertexColors = arr;\n\n        for (let i = 0; i < vertexColors.length; i++)\n        {\n            vertexColors[i] = this._linearToSrgb(vertexColors[i]);\n        }\n\n        if (arr.cblStride == 3)\n        {\n            const nc = new Float32Array(vertexColors.length / 3 * 4);\n            for (let i = 0; i < vertexColors.length / 3; i++)\n            {\n                nc[i * 4 + 0] = vertexColors[i * 3 + 0];\n                nc[i * 4 + 1] = vertexColors[i * 3 + 1];\n                nc[i * 4 + 2] = vertexColors[i * 3 + 2];\n                nc[i * 4 + 3] = 1;\n            }\n            vertexColors = nc;\n        }\n\n        return vertexColors;\n    }\n\n    fillGeomAttribs(gltf, tgeom, attribs, setGeom)\n    {\n        if (attribs.hasOwnProperty("POSITION")) tgeom.vertices = gltf.accBuffers[attribs.POSITION];\n        if (attribs.hasOwnProperty("NORMAL")) tgeom.vertexNormals = gltf.accBuffers[attribs.NORMAL];\n        if (attribs.hasOwnProperty("TANGENT")) tgeom.tangents = gltf.accBuffers[attribs.TANGENT];\n\n        // // console.log(gltf.accBuffers[attribs.COLOR_0])\n        // console.log(gltf);\n\n        if (attribs.hasOwnProperty("COLOR_0")) tgeom.vertexColors = this.calcVertexColors(gltf.accBuffers[attribs.COLOR_0], gltf.accBuffers[attribs.COLOR_0].type || 4);\n        if (attribs.hasOwnProperty("COLOR_1")) tgeom.setAttribute("attrVertColor1", this.calcVertexColors(gltf.accBuffers[attribs.COLOR_1]), gltf.accBuffers[attribs.COLOR_1].type || 4);\n        if (attribs.hasOwnProperty("COLOR_2")) tgeom.setAttribute("attrVertColor2", this.calcVertexColors(gltf.accBuffers[attribs.COLOR_2]), gltf.accBuffers[attribs.COLOR_2].type || 4);\n        if (attribs.hasOwnProperty("COLOR_3")) tgeom.setAttribute("attrVertColor3", this.calcVertexColors(gltf.accBuffers[attribs.COLOR_3]), gltf.accBuffers[attribs.COLOR_3].type || 4);\n        if (attribs.hasOwnProperty("COLOR_4")) tgeom.setAttribute("attrVertColor4", this.calcVertexColors(gltf.accBuffers[attribs.COLOR_4]), gltf.accBuffers[attribs.COLOR_4].type || 4);\n\n        if (attribs.hasOwnProperty("TEXCOORD_0")) tgeom.texCoords = gltf.accBuffers[attribs.TEXCOORD_0];\n        if (attribs.hasOwnProperty("TEXCOORD_1")) tgeom.setAttribute("attrTexCoord1", gltf.accBuffers[attribs.TEXCOORD_1], 2);\n        if (attribs.hasOwnProperty("TEXCOORD_2")) tgeom.setAttribute("attrTexCoord2", gltf.accBuffers[attribs.TEXCOORD_2], 2);\n        if (attribs.hasOwnProperty("TEXCOORD_3")) tgeom.setAttribute("attrTexCoord3", gltf.accBuffers[attribs.TEXCOORD_3], 2);\n        if (attribs.hasOwnProperty("TEXCOORD_4")) tgeom.setAttribute("attrTexCoord4", gltf.accBuffers[attribs.TEXCOORD_4], 2);\n\n        if (attribs.hasOwnProperty("WEIGHTS_0"))\n        {\n            tgeom.setAttribute("attrWeights", gltf.accBuffers[attribs.WEIGHTS_0], 4);\n        }\n        if (attribs.hasOwnProperty("JOINTS_0"))\n        {\n            if (!gltf.accBuffers[attribs.JOINTS_0])console.log("no !gltf.accBuffers[attribs.JOINTS_0]");\n            tgeom.setAttribute("attrJoints", gltf.accBuffers[attribs.JOINTS_0], 4);\n        }\n\n        if (attribs.hasOwnProperty("POSITION")) gltf.accBuffersDelete.push(attribs.POSITION);\n        if (attribs.hasOwnProperty("NORMAL")) gltf.accBuffersDelete.push(attribs.NORMAL);\n        if (attribs.hasOwnProperty("TEXCOORD_0")) gltf.accBuffersDelete.push(attribs.TEXCOORD_0);\n        if (attribs.hasOwnProperty("TANGENT")) gltf.accBuffersDelete.push(attribs.TANGENT);\n        if (attribs.hasOwnProperty("COLOR_0"))gltf.accBuffersDelete.push(attribs.COLOR_0);\n        if (attribs.hasOwnProperty("COLOR_0"))gltf.accBuffersDelete.push(attribs.COLOR_0);\n        if (attribs.hasOwnProperty("COLOR_1"))gltf.accBuffersDelete.push(attribs.COLOR_1);\n        if (attribs.hasOwnProperty("COLOR_2"))gltf.accBuffersDelete.push(attribs.COLOR_2);\n        if (attribs.hasOwnProperty("COLOR_3"))gltf.accBuffersDelete.push(attribs.COLOR_3);\n\n        if (attribs.hasOwnProperty("TEXCOORD_1")) gltf.accBuffersDelete.push(attribs.TEXCOORD_1);\n        if (attribs.hasOwnProperty("TEXCOORD_2")) gltf.accBuffersDelete.push(attribs.TEXCOORD_2);\n        if (attribs.hasOwnProperty("TEXCOORD_3")) gltf.accBuffersDelete.push(attribs.TEXCOORD_3);\n        if (attribs.hasOwnProperty("TEXCOORD_4")) gltf.accBuffersDelete.push(attribs.TEXCOORD_4);\n\n        if (setGeom !== false) if (tgeom && tgeom.verticesIndices) this.setGeom(tgeom);\n    }\n\n    setGeom(geom)\n    {\n        if (inNormFormat.get() == "X-ZY")\n        {\n            for (let i = 0; i < geom.vertexNormals.length; i += 3)\n            {\n                let t = geom.vertexNormals[i + 2];\n                geom.vertexNormals[i + 2] = geom.vertexNormals[i + 1];\n                geom.vertexNormals[i + 1] = -t;\n            }\n        }\n\n        if (inVertFormat.get() == "XZ-Y")\n        {\n            for (let i = 0; i < geom.vertices.length; i += 3)\n            {\n                let t = geom.vertices[i + 2];\n                geom.vertices[i + 2] = -geom.vertices[i + 1];\n                geom.vertices[i + 1] = t;\n            }\n        }\n\n        if (this.primitive == this.TRIANGLES)\n        {\n            if (inCalcNormals.get() == "Force Smooth" || inCalcNormals.get() == false) geom.calculateNormals();\n            else if (!geom.vertexNormals.length && inCalcNormals.get() == "Auto") geom.calculateNormals({ "smooth": false });\n\n            if ((!geom.biTangents || geom.biTangents.length == 0) && geom.tangents)\n            {\n                const bitan = vec3.create();\n                const tan = vec3.create();\n\n                const tangents = geom.tangents;\n                geom.tangents = new Float32Array(tangents.length / 4 * 3);\n                geom.biTangents = new Float32Array(tangents.length / 4 * 3);\n\n                for (let i = 0; i < tangents.length; i += 4)\n                {\n                    const idx = i / 4 * 3;\n\n                    vec3.cross(\n                        bitan,\n                        [geom.vertexNormals[idx], geom.vertexNormals[idx + 1], geom.vertexNormals[idx + 2]],\n                        [tangents[i], tangents[i + 1], tangents[i + 2]]\n                    );\n\n                    vec3.div(bitan, bitan, [tangents[i + 3], tangents[i + 3], tangents[i + 3]]);\n                    vec3.normalize(bitan, bitan);\n\n                    geom.biTangents[idx + 0] = bitan[0];\n                    geom.biTangents[idx + 1] = bitan[1];\n                    geom.biTangents[idx + 2] = bitan[2];\n\n                    geom.tangents[idx + 0] = tangents[i + 0];\n                    geom.tangents[idx + 1] = tangents[i + 1];\n                    geom.tangents[idx + 2] = tangents[i + 2];\n                }\n            }\n\n            if (geom.tangents.length === 0 || inCalcNormals.get() != "Never")\n            {\n                // console.log("[gltf ]no tangents... calculating tangents...");\n                geom.calcTangentsBitangents();\n            }\n        }\n\n        this.geom = geom;\n\n        this.bounds = geom.getBounds();\n    }\n\n    render(cgl, ignoreMaterial, skinRenderer)\n    {\n        if (!this.mesh && this.geom && this.geom.verticesIndices)\n        {\n            let g = this.geom;\n            if (this.geom.vertices.length / 3 > 64000 && this.geom.verticesIndices.length > 0)\n            {\n                g = this.geom.copy();\n                g.unIndex(false, true);\n            }\n\n            let glprim;\n\n            if (cgl.gl)\n            {\n                if (this.primitive == this.TRIANGLES)glprim = cgl.gl.TRIANGLES;\n                else if (this.primitive == this.LINES)glprim = cgl.gl.LINES;\n                else if (this.primitive == this.LINE_STRIP)glprim = cgl.gl.LINE_STRIP;\n                else if (this.primitive == this.POINTS)glprim = cgl.gl.POINTS;\n                else\n                {\n                    op.logWarn("unknown primitive type", this);\n                }\n            }\n\n            this.mesh = op.patch.cg.createMesh(g, { "glPrimitive": glprim });\n        }\n\n        if (this.mesh)\n        {\n            // update morphTargets\n            if (this.geom && this.geom.morphTargets.length && !this.morphTargetsRenderMod)\n            {\n                this.mesh.addVertexNumbers = true;\n                this.morphTargetsRenderMod = new GltfTargetsRenderer(this);\n            }\n\n            let useMat = !ignoreMaterial && this.material != -1 && gltf.shaders[this.material];\n            if (skinRenderer)useMat = false;\n\n            if (useMat) cgl.pushShader(gltf.shaders[this.material]);\n\n            const currentShader = cgl.getShader() || {};\n            const uniDiff = currentShader.uniformColorDiffuse;\n\n            const uniPbrMetalness = currentShader.uniformPbrMetalness;\n            const uniPbrRoughness = currentShader.uniformPbrRoughness;\n\n            // if (gltf.shaders[this.material] && !inUseMatProps.get())\n            // {\n            //     gltf.shaders[this.material]=null;\n            // }\n\n            if (!gltf.shaders[this.material] && inUseMatProps.get())\n            {\n                if (uniDiff && this._matDiffuseColor)\n                {\n                    this._matDiffuseColorOrig = [uniDiff.getValue()[0], uniDiff.getValue()[1], uniDiff.getValue()[2], uniDiff.getValue()[3]];\n                    uniDiff.setValue(this._matDiffuseColor);\n                }\n\n                if (uniPbrMetalness)\n                    if (this._matPbrMetalness != null)\n                    {\n                        this._matPbrMetalnessOrig = uniPbrMetalness.getValue();\n                        uniPbrMetalness.setValue(this._matPbrMetalness);\n                    }\n                    else\n                        uniPbrMetalness.setValue(0);\n\n                if (uniPbrRoughness)\n                    if (this._matPbrRoughness != null)\n                    {\n                        this._matPbrRoughnessOrig = uniPbrRoughness.getValue();\n                        uniPbrRoughness.setValue(this._matPbrRoughness);\n                    }\n                    else\n                    {\n                        uniPbrRoughness.setValue(0);\n                    }\n            }\n\n            if (this.morphTargetsRenderMod) this.morphTargetsRenderMod.renderStart(cgl, 0);\n            if (this.mesh)\n            {\n                this.mesh.render(cgl.getShader(), ignoreMaterial);\n            }\n            if (this.morphTargetsRenderMod) this.morphTargetsRenderMod.renderFinish(cgl);\n\n            if (inUseMatProps.get())\n            {\n                if (uniDiff && this._matDiffuseColor) uniDiff.setValue(this._matDiffuseColorOrig);\n                if (uniPbrMetalness && this._matPbrMetalnessOrig != undefined) uniPbrMetalness.setValue(this._matPbrMetalnessOrig);\n                if (uniPbrRoughness && this._matPbrRoughnessOrig != undefined) uniPbrRoughness.setValue(this._matPbrRoughnessOrig);\n            }\n\n            if (useMat) cgl.popShader();\n        }\n        else\n        {\n            console.log("no mesh......");\n        }\n    }\n};\n',inc_meshGroup_js:'const gltfMeshGroup = class\n{\n    constructor(gltf, m)\n    {\n        this.bounds = new CABLES.CG.BoundingBox();\n        this.meshes = [];\n\n        m.name = m.name || ("unknown mesh " + CABLES.simpleId());\n\n        this.name = m.name;\n        const prims = m.primitives;\n\n        for (let i = 0; i < prims.length; i++)\n        {\n            const mesh = new gltfMesh(this.name, prims[i], gltf,\n                (mesh) =>\n                {\n                    mesh.extras = m.extras;\n                    this.bounds.apply(mesh.bounds);\n                });\n\n            mesh.submeshIndex = i;\n            this.meshes.push(mesh);\n        }\n    }\n\n    render(cgl, ignoreMat, skinRenderer, _time, weights)\n    {\n        for (let i = 0; i < this.meshes.length; i++)\n        {\n            const useMat = gltf.shaders[this.meshes[i].material];\n\n            if (!ignoreMat && useMat) cgl.pushShader(gltf.shaders[this.meshes[i].material]);\n            if (skinRenderer)skinRenderer.renderStart(cgl, _time);\n            if (weights) this.meshes[i].weights = weights;\n            this.meshes[i].render(cgl, ignoreMat, skinRenderer, _time);\n            if (skinRenderer)skinRenderer.renderFinish(cgl);\n            if (!ignoreMat && useMat) cgl.popShader();\n        }\n    }\n};\n',inc_node_js:'const gltfNode = class\n{\n    constructor(node, gltf)\n    {\n        this.isChild = node.isChild || false;\n        node.name = node.name || "unknown node " + CABLES.simpleId();\n        this.name = node.name;\n        if (node.hasOwnProperty("camera")) this.camera = node.camera;\n        this.hidden = false;\n        this.mat = mat4.create();\n        this._animActions = {};\n        this.animWeights = [];\n        this._animMat = mat4.create();\n        this._tempMat = mat4.create();\n        this._tempQuat = quat.create();\n        this._tempRotmat = mat4.create();\n        this.mesh = null;\n        this.children = [];\n        this._node = node;\n        this._gltf = gltf;\n        this.absMat = mat4.create();\n        this.addTranslate = null;\n        this._tempAnimScale = null;\n        this.addMulMat = null;\n        this.updateMatrix();\n        this.skinRenderer = null;\n        this.copies = [];\n    }\n\n    get skin()\n    {\n        if (this._node.hasOwnProperty("skin")) return this._node.skin;\n        else return -1;\n    }\n\n    copy()\n    {\n        this.isCopy = true;\n        const n = new gltfNode(this._node, this._gltf);\n        n.copyOf = this;\n\n        n._animActions = this._animActions;\n        n.children = this.children;\n        if (this.skin) n.skinRenderer = new GltfSkin(this);\n\n        this.updateMatrix();\n        return n;\n    }\n\n    hasSkin()\n    {\n        if (this._node.hasOwnProperty("skin")) return this._gltf.json.skins[this._node.skin].name || "unknown";\n        return false;\n    }\n\n    initSkin()\n    {\n        if (this.skin > -1)\n        {\n            this.skinRenderer = new GltfSkin(this);\n        }\n    }\n\n    updateMatrix()\n    {\n        mat4.identity(this.mat);\n        if (this._node.translation) mat4.translate(this.mat, this.mat, this._node.translation);\n\n        if (this._node.rotation)\n        {\n            const rotmat = mat4.create();\n            this._rot = this._node.rotation;\n\n            mat4.fromQuat(rotmat, this._node.rotation);\n            mat4.mul(this.mat, this.mat, rotmat);\n        }\n\n        if (this._node.scale)\n        {\n            this._scale = this._node.scale;\n            mat4.scale(this.mat, this.mat, this._scale);\n        }\n\n        if (this._node.hasOwnProperty("mesh"))\n        {\n            this.mesh = this._gltf.meshes[this._node.mesh];\n            if (this.isCopy)\n            {\n            }\n        }\n\n        if (this._node.children)\n        {\n            for (let i = 0; i < this._node.children.length; i++)\n            {\n                this._gltf.json.nodes[i].isChild = true;\n                if (this._gltf.nodes[this._node.children[i]]) this._gltf.nodes[this._node.children[i]].isChild = true;\n                this.children.push(this._node.children[i]);\n            }\n        }\n    }\n\n    unHide()\n    {\n        this.hidden = false;\n        for (let i = 0; i < this.children.length; i++)\n            if (this.children[i].unHide) this.children[i].unHide();\n    }\n\n    calcBounds(gltf, mat, bounds)\n    {\n        const localMat = mat4.create();\n\n        if (mat) mat4.copy(localMat, mat);\n        if (this.mat) mat4.mul(localMat, localMat, this.mat);\n\n        if (this.mesh)\n        {\n            const bb = this.mesh.bounds.copy();\n            bb.mulMat4(localMat);\n            bounds.apply(bb);\n\n            if (bounds.changed)\n            {\n                boundingPoints.push(\n                    bb._min[0] || 0, bb._min[1] || 0, bb._min[2] || 0,\n                    bb._max[0] || 0, bb._max[1] || 0, bb._max[2] || 0);\n            }\n        }\n\n        for (let i = 0; i < this.children.length; i++)\n        {\n            if (gltf.nodes[this.children[i]] && gltf.nodes[this.children[i]].calcBounds)\n            {\n                const b = gltf.nodes[this.children[i]].calcBounds(gltf, localMat, bounds);\n\n                bounds.apply(b);\n            }\n        }\n\n        if (bounds.changed) return bounds;\n        else return null;\n    }\n\n    setAnimAction(name)\n    {\n        if (!name) return;\n\n        this._currentAnimaction = name;\n\n        if (name && !this._animActions[name]) return null;\n\n        for (let path in this._animActions[name])\n        {\n            if (path == "translation") this._animTrans = this._animActions[name][path];\n            else if (path == "rotation") this._animRot = this._animActions[name][path];\n            else if (path == "scale") this._animScale = this._animActions[name][path];\n            else if (path == "weights") this.animWeights = this._animActions[name][path];\n        }\n    }\n\n    setAnim(path, name, anims)\n    {\n        if (!path || !name || !anims) return;\n\n        this._animActions[name] = this._animActions[name] || {};\n\n        // debugger;\n\n        // for (let i = 0; i < this.copies.length; i++) this.copies[i]._animActions = this._animActions;\n\n        if (this._animActions[name][path]) op.log("[gltfNode] animation action path already exists", name, path, this._animActions[name][path]);\n\n        this._animActions[name][path] = anims;\n\n        if (path == "translation") this._animTrans = anims;\n        else if (path == "rotation") this._animRot = anims;\n        else if (path == "scale") this._animScale = anims;\n        else if (path == "weights") this.animWeights = this._animActions[name][path];\n    }\n\n    modelMatLocal()\n    {\n        return this._animMat || this.mat;\n    }\n\n    modelMatAbs()\n    {\n        return this.absMat;\n    }\n\n    transform(cgl, _time)\n    {\n        if (!_time && _time != 0)_time = time;\n\n        this._lastTimeTrans = _time;\n\n        gltfTransforms++;\n\n        if (!this._animTrans && !this._animRot && !this._animScale)\n        {\n            mat4.mul(cgl.mMatrix, cgl.mMatrix, this.mat);\n            this._animMat = null;\n        }\n        else\n        {\n            this._animMat = this._animMat || mat4.create();\n            mat4.identity(this._animMat);\n\n            const playAnims = true;\n\n            if (playAnims && this._animTrans)\n            {\n                mat4.translate(this._animMat, this._animMat, [\n                    this._animTrans[0].getValue(_time),\n                    this._animTrans[1].getValue(_time),\n                    this._animTrans[2].getValue(_time)]);\n            }\n            else\n            if (this._node.translation) mat4.translate(this._animMat, this._animMat, this._node.translation);\n\n            if (playAnims && this._animRot)\n            {\n                if (this._animRot[0].defaultEasing == CABLES.EASING_LINEAR) CABLES.Anim.slerpQuaternion(_time, this._tempQuat, this._animRot[0], this._animRot[1], this._animRot[2], this._animRot[3]);\n                else if (this._animRot[0].defaultEasing == CABLES.EASING_ABSOLUTE)\n                {\n                    this._tempQuat[0] = this._animRot[0].getValue(_time);\n                    this._tempQuat[1] = this._animRot[1].getValue(_time);\n                    this._tempQuat[2] = this._animRot[2].getValue(_time);\n                    this._tempQuat[3] = this._animRot[3].getValue(_time);\n                }\n                else if (this._animRot[0].defaultEasing == CABLES.EASING_CUBICSPLINE)\n                {\n                    CABLES.Anim.slerpQuaternion(_time, this._tempQuat, this._animRot[0], this._animRot[1], this._animRot[2], this._animRot[3]);\n                }\n\n                mat4.fromQuat(this._tempMat, this._tempQuat);\n                mat4.mul(this._animMat, this._animMat, this._tempMat);\n            }\n            else if (this._rot)\n            {\n                mat4.fromQuat(this._tempRotmat, this._rot);\n                mat4.mul(this._animMat, this._animMat, this._tempRotmat);\n            }\n\n            if (playAnims && this._animScale)\n            {\n                if (!this._tempAnimScale) this._tempAnimScale = [1, 1, 1];\n                this._tempAnimScale[0] = this._animScale[0].getValue(_time);\n                this._tempAnimScale[1] = this._animScale[1].getValue(_time);\n                this._tempAnimScale[2] = this._animScale[2].getValue(_time);\n                mat4.scale(this._animMat, this._animMat, this._tempAnimScale);\n            }\n            else if (this._scale) mat4.scale(this._animMat, this._animMat, this._scale);\n\n            mat4.mul(cgl.mMatrix, cgl.mMatrix, this._animMat);\n        }\n\n        if (this.animWeights)\n        {\n            this.weights = this.weights || [];\n\n            let str = "";\n            for (let i = 0; i < this.animWeights.length; i++)\n            {\n                this.weights[i] = this.animWeights[i].getValue(_time);\n                str += this.weights[i] + "/";\n            }\n\n            // this.mesh.weights=this.animWeights.get(_time);\n        }\n\n        if (this.addTranslate) mat4.translate(cgl.mMatrix, cgl.mMatrix, this.addTranslate);\n\n        if (this.addMulMat) mat4.mul(cgl.mMatrix, cgl.mMatrix, this.addMulMat);\n\n        mat4.copy(this.absMat, cgl.mMatrix);\n    }\n\n    render(cgl, dontTransform, dontDrawMesh, ignoreMaterial, ignoreChilds, drawHidden, _time)\n    {\n        if (!dontTransform) cgl.pushModelMatrix();\n\n        if (_time === undefined) _time = gltf.time;\n\n        if (!dontTransform || this.skinRenderer) this.transform(cgl, _time);\n\n        if (this.hidden && !drawHidden)\n        {\n        }\n        else\n        {\n            if (this.skinRenderer)\n            {\n                this.skinRenderer.time = _time;\n                if (!dontDrawMesh)\n                    this.mesh.render(cgl, ignoreMaterial, this.skinRenderer, _time, this.weights);\n            }\n            else\n            {\n                if (this.mesh && !dontDrawMesh)\n                    this.mesh.render(cgl, ignoreMaterial, null, _time, this.weights);\n            }\n        }\n\n        if (!ignoreChilds && !this.hidden)\n            for (let i = 0; i < this.children.length; i++)\n                if (gltf.nodes[this.children[i]])\n                    gltf.nodes[this.children[i]].render(cgl, dontTransform, dontDrawMesh, ignoreMaterial, ignoreChilds, drawHidden, _time);\n\n        if (!dontTransform)cgl.popModelMatrix();\n    }\n};\n',inc_print_js:'let tab = null;\n\nfunction closeTab()\n{\n    if (tab)gui.mainTabs.closeTab(tab.id);\n    tab = null;\n}\n\nfunction formatVec(arr)\n{\n    const nums = [];\n    for (let i = 0; i < arr.length; i++)\n    {\n        nums.push(Math.round(arr[i] * 1000) / 1000);\n    }\n\n    return nums.join(",");\n}\n\nfunction printNode(html, node, level)\n{\n    if (!gltf) return;\n\n    html += "<tr class=\\"row\\">";\n\n    let ident = "";\n    let identSpace = "";\n\n    for (let i = 1; i < level; i++)\n    {\n        identSpace += "&nbsp;&nbsp;&nbsp;";\n        let identClass = "identBg";\n        if (i == 1)identClass = "identBgLevel0";\n        ident += "<td class=\\"ident " + identClass + "\\" ><div style=\\"\\"></div></td>";\n    }\n    let id = CABLES.uuid();\n    html += ident;\n    html += "<td colspan=\\"" + (21 - level) + "\\">";\n\n    if (node.mesh && node.mesh.meshes.length)html += "<span class=\\"icon icon-cube\\"></span>&nbsp;";\n    else html += "<span class=\\"icon icon-box-select\\"></span> &nbsp;";\n\n    html += node.name + "</td><td></td>";\n\n    if (node.mesh)\n    {\n        html += "<td>";\n        for (let i = 0; i < node.mesh.meshes.length; i++)\n        {\n            if (i > 0)html += ", ";\n            html += node.mesh.meshes[i].name;\n        }\n\n        html += "</td>";\n\n        html += "<td>";\n        html += node.hasSkin() || "-";\n        html += "</td>";\n\n        html += "<td>";\n        let countMats = 0;\n        for (let i = 0; i < node.mesh.meshes.length; i++)\n        {\n            if (countMats > 0)html += ", ";\n            if (gltf.json.materials && node.mesh.meshes[i].hasOwnProperty("material"))\n            {\n                if (gltf.json.materials[node.mesh.meshes[i].material])\n                {\n                    html += gltf.json.materials[node.mesh.meshes[i].material].name;\n                    countMats++;\n                }\n            }\n        }\n        if (countMats == 0)html += "none";\n        html += "</td>";\n    }\n    else\n    {\n        html += "<td>-</td><td>-</td><td>-</td>";\n    }\n\n    html += "<td>";\n\n    if (node._node.translation || node._node.rotation || node._node.scale)\n    {\n        let info = "";\n\n        if (node._node.translation)info += "Translate: `" + formatVec(node._node.translation) + "` || ";\n        if (node._node.rotation)info += "Rotation: `" + formatVec(node._node.rotation) + "` || ";\n        if (node._node.scale)info += "Scale: `" + formatVec(node._node.scale) + "` || ";\n\n        html += "<span class=\\"icon icon-gizmo info\\" data-info=\\"" + info + "\\"></span> &nbsp;";\n    }\n\n    if (node._animRot || node._animScale || node._animTrans)\n    {\n        let info = "Animated: ";\n        if (node._animRot) info += "Rot ";\n        if (node._animScale) info += "Scale ";\n        if (node._animTrans) info += "Trans ";\n\n        html += "<span class=\\"icon icon-clock info\\" data-info=\\"" + info + "\\"></span>&nbsp;";\n    }\n\n    if (!node._node.translation && !node._node.rotation && !node._node.scale && !node._animRot && !node._animScale && !node._animTrans) html += "-";\n\n    html += "</td>";\n\n    html += "<td>";\n    let hideclass = "";\n    if (node.hidden)hideclass = "node-hidden";\n\n    // html+=\'\';\n    html += "<a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeNode(\'" + node.name + "\',\'transform\')\\" class=\\"treebutton\\">Transform</a>";\n    html += " <a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeNode(\'" + node.name + "\',\'hierarchy\')\\" class=\\"treebutton\\">Hierarchy</a>";\n    html += " <a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeNode(\'" + node.name + "\')\\" class=\\"treebutton\\">Node</a>";\n\n    if (node.hasSkin())\n        html += " <a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeNode(\'" + node.name + "\',false,{skin:true});\\" class=\\"treebutton\\">Skin</a>";\n\n    html += "</td><td>";\n    html += "&nbsp;<span class=\\"icon iconhover icon-eye " + hideclass + "\\" onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').toggleNodeVisibility(\'" + node.name + "\');this.classList.toggle(\'node-hidden\');\\"></span>";\n    html += "</td>";\n\n    html += "</tr>";\n\n    if (node.children)\n    {\n        for (let i = 0; i < node.children.length; i++)\n            html = printNode(html, gltf.nodes[node.children[i]], level + 1);\n    }\n\n    return html;\n}\n\nfunction printMaterial(mat, idx)\n{\n    let html = "<tr>";\n    html += " <td>" + idx + "</td>";\n    html += " <td>" + mat.name + "</td>";\n\n    html += " <td>";\n\n    const info = JSON.stringify(mat, null, 4).replaceAll("\\"", "").replaceAll("\\n", "<br/>");\n\n    html += "<span class=\\"icon icon-info\\" onclick=\\"new CABLES.UI.ModalDialog({ \'html\': \'<pre>" + info + "</pre>\', \'title\': \'" + mat.name + "\' });\\"></span>&nbsp;";\n\n    if (mat.pbrMetallicRoughness && mat.pbrMetallicRoughness.baseColorFactor)\n    {\n        let rgb = "";\n        rgb += "" + Math.round(mat.pbrMetallicRoughness.baseColorFactor[0] * 255);\n        rgb += "," + Math.round(mat.pbrMetallicRoughness.baseColorFactor[1] * 255);\n        rgb += "," + Math.round(mat.pbrMetallicRoughness.baseColorFactor[2] * 255);\n\n        html += "<div style=\\"width:15px;height:15px;background-color:rgb(" + rgb + ");display:inline-block\\">&nbsp;</a>";\n    }\n    html += " <td style=\\"\\">" + (gltf.shaders[idx] ? "-" : "<a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').assignMaterial(\'" + mat.name + "\')\\" class=\\"treebutton\\">Assign</a>") + "<td>";\n    html += "<td>";\n\n    html += "</tr>";\n    return html;\n}\n\nfunction printInfo()\n{\n    if (!gltf) return;\n\n    const startTime = performance.now();\n    const sizes = {};\n    let html = "<div style=\\"overflow:scroll;width:100%;height:100%\\">";\n\n    html += "File: <a href=\\"" + CABLES.platform.getCablesUrl() + "/asset/patches/?filename=" + inFile.get() + "\\" target=\\"_blank\\">" + CABLES.basename(inFile.get()) + "</a><br/>";\n\n    html += "Generator:" + gltf.json.asset.generator;\n\n    let numNodes = 0;\n    if (gltf.json.nodes)numNodes = gltf.json.nodes.length;\n    html += "<div id=\\"groupNodes\\">Nodes (" + numNodes + ")</div>";\n\n    html += "<table id=\\"sectionNodes\\" class=\\"table treetable\\">";\n\n    html += "<tr>";\n    html += " <th colspan=\\"21\\">Name</th>";\n    html += " <th>Mesh</th>";\n    html += " <th>Skin</th>";\n    html += " <th>Material</th>";\n    html += " <th>Transform</th>";\n    html += " <th>Expose</th>";\n    html += " <th></th>";\n    html += "</tr>";\n\n    for (let i = 0; i < gltf.nodes.length; i++)\n    {\n        if (!gltf.nodes[i].isChild)\n            html = printNode(html, gltf.nodes[i], 1);\n    }\n    html += "</table>";\n\n    // / //////////////////\n\n    let numMaterials = 0;\n    if (gltf.json.materials)numMaterials = gltf.json.materials.length;\n    html += "<div id=\\"groupMaterials\\">Materials (" + numMaterials + ")</div>";\n\n    if (!gltf.json.materials || gltf.json.materials.length == 0)\n    {\n    }\n    else\n    {\n        html += "<table id=\\"materialtable\\"  class=\\"table treetable\\">";\n        html += "<tr>";\n        html += " <th>Index</th>";\n        html += " <th>Name</th>";\n        html += " <th>Color</th>";\n        html += " <th>Function</th>";\n        html += " <th></th>";\n        html += "</tr>";\n        for (let i = 0; i < gltf.json.materials.length; i++)\n        {\n            html += printMaterial(gltf.json.materials[i], i);\n        }\n        html += "</table>";\n    }\n\n    // / ///////////////////////\n\n    html += "<div id=\\"groupMeshes\\">Meshes (" + gltf.json.meshes.length + ")</div>";\n\n    html += "<table id=\\"meshestable\\"  class=\\"table treetable\\">";\n    html += "<tr>";\n    html += " <th>Name</th>";\n    html += " <th>Node</th>";\n    html += " <th>Material</th>";\n    html += " <th>Vertices</th>";\n    html += " <th>Attributes</th>";\n    html += "</tr>";\n\n    let sizeBufferViews = [];\n    sizes.meshes = 0;\n    sizes.meshTargets = 0;\n\n    for (let i = 0; i < gltf.json.meshes.length; i++)\n    {\n        html += "<tr>";\n        html += "<td>" + gltf.json.meshes[i].name + "</td>";\n\n        html += "<td>";\n        let count = 0;\n        let nodename = "";\n        if (gltf.json.nodes)\n            for (let j = 0; j < gltf.json.nodes.length; j++)\n            {\n                if (gltf.json.nodes[j].mesh == i)\n                {\n                    count++;\n                    if (count == 1)\n                    {\n                        nodename = gltf.json.nodes[j].name;\n                    }\n                }\n            }\n        if (count > 1) html += (count) + " nodes (" + nodename + " ...)";\n        else html += nodename;\n        html += "</td>";\n\n        // -------\n\n        html += "<td>";\n        for (let j = 0; j < gltf.json.meshes[i].primitives.length; j++)\n        {\n            if (gltf.json.meshes[i].primitives[j].hasOwnProperty("material"))\n            {\n                if (gltf.json.materials[gltf.json.meshes[i]])\n                {\n                    html += gltf.json.materials[gltf.json.meshes[i].primitives[j].material].name + " ";\n                }\n            }\n            else html += "None";\n        }\n        html += "</td>";\n\n        html += "<td>";\n        let numVerts = 0;\n        for (let j = 0; j < gltf.json.meshes[i].primitives.length; j++)\n        {\n            if (gltf.json.meshes[i].primitives[j].attributes.POSITION != undefined)\n            {\n                let v = parseInt(gltf.json.accessors[gltf.json.meshes[i].primitives[j].attributes.POSITION].count);\n                numVerts += v;\n                html += "" + v + "<br/>";\n            }\n            else html += "-<br/>";\n        }\n\n        if (gltf.json.meshes[i].primitives.length > 1)\n            html += "=" + numVerts;\n        html += "</td>";\n\n        html += "<td>";\n        for (let j = 0; j < gltf.json.meshes[i].primitives.length; j++)\n        {\n            html += Object.keys(gltf.json.meshes[i].primitives[j].attributes);\n            html += " <a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeGeom(\'" + gltf.json.meshes[i].name + "\'," + j + ")\\" class=\\"treebutton\\">Geometry</a>";\n            html += "<br/>";\n\n            if (gltf.json.meshes[i].primitives[j].targets)\n            {\n                html += gltf.json.meshes[i].primitives[j].targets.length + " targets<br/>";\n\n                if (gltf.json.meshes[i].extras && gltf.json.meshes[i].extras.targetNames)\n                    html += "Targetnames:<br/>" + gltf.json.meshes[i].extras.targetNames.join("<br/>");\n\n                html += "<br/>";\n            }\n        }\n\n        html += "</td>";\n        html += "</tr>";\n\n        for (let j = 0; j < gltf.json.meshes[i].primitives.length; j++)\n        {\n            const accessor = gltf.json.accessors[gltf.json.meshes[i].primitives[j].indices];\n            if (accessor)\n            {\n                let bufView = accessor.bufferView;\n\n                if (sizeBufferViews.indexOf(bufView) == -1)\n                {\n                    sizeBufferViews.push(bufView);\n                    if (gltf.json.bufferViews[bufView])sizes.meshes += gltf.json.bufferViews[bufView].byteLength;\n                }\n            }\n\n            for (let k in gltf.json.meshes[i].primitives[j].attributes)\n            {\n                const attr = gltf.json.meshes[i].primitives[j].attributes[k];\n                const bufView2 = gltf.json.accessors[attr].bufferView;\n\n                if (sizeBufferViews.indexOf(bufView2) == -1)\n                {\n                    sizeBufferViews.push(bufView2);\n                    if (gltf.json.bufferViews[bufView2])sizes.meshes += gltf.json.bufferViews[bufView2].byteLength;\n                }\n            }\n\n            if (gltf.json.meshes[i].primitives[j].targets)\n                for (let k = 0; k < gltf.json.meshes[i].primitives[j].targets.length; k++)\n                {\n                    for (let l in gltf.json.meshes[i].primitives[j].targets[k])\n                    {\n                        const accessorIdx = gltf.json.meshes[i].primitives[j].targets[k][l];\n                        const accessor = gltf.json.accessors[accessorIdx];\n                        const bufView2 = accessor.bufferView;\n                        console.log("accessor", accessor);\n                        if (sizeBufferViews.indexOf(bufView2) == -1)\n                            if (gltf.json.bufferViews[bufView2])\n                            {\n                                sizeBufferViews.push(bufView2);\n                                sizes.meshTargets += gltf.json.bufferViews[bufView2].byteLength;\n                            }\n                    }\n                }\n        }\n    }\n    html += "</table>";\n\n    // / //////////////////////////////////\n\n    let numSamplers = 0;\n    let numAnims = 0;\n    let numKeyframes = 0;\n\n    if (gltf.json.animations)\n    {\n        numAnims = gltf.json.animations.length;\n        for (let i = 0; i < gltf.json.animations.length; i++)\n        {\n            numSamplers += gltf.json.animations[i].samplers.length;\n        }\n    }\n\n    html += "<div id=\\"groupAnims\\">Animations (" + numAnims + "/" + numSamplers + ")</div>";\n\n    if (gltf.json.animations)\n    {\n        html += "<table id=\\"sectionAnim\\" class=\\"table treetable\\">";\n        html += "<tr>";\n        html += "  <th>Name</th>";\n        html += "  <th>Target node</th>";\n        html += "  <th>Path</th>";\n        html += "  <th>Interpolation</th>";\n        html += "  <th>Keys</th>";\n        html += "</tr>";\n\n\n        sizes.animations = 0;\n\n        for (let i = 0; i < gltf.json.animations.length; i++)\n        {\n            for (let j = 0; j < gltf.json.animations[i].samplers.length; j++)\n            {\n                let bufView = gltf.json.accessors[gltf.json.animations[i].samplers[j].input].bufferView;\n                if (sizeBufferViews.indexOf(bufView) == -1)\n                {\n                    sizeBufferViews.push(bufView);\n                    sizes.animations += gltf.json.bufferViews[bufView].byteLength;\n                }\n\n                bufView = gltf.json.accessors[gltf.json.animations[i].samplers[j].output].bufferView;\n                if (sizeBufferViews.indexOf(bufView) == -1)\n                {\n                    sizeBufferViews.push(bufView);\n                    sizes.animations += gltf.json.bufferViews[bufView].byteLength;\n                }\n            }\n\n            for (let j = 0; j < gltf.json.animations[i].channels.length; j++)\n            {\n                html += "<tr>";\n                html += "  <td> Anim " + i + ": " + gltf.json.animations[i].name + "</td>";\n\n                html += "  <td>" + gltf.nodes[gltf.json.animations[i].channels[j].target.node].name + "</td>";\n                html += "  <td>";\n                html += gltf.json.animations[i].channels[j].target.path + " ";\n                html += "  </td>";\n\n                const smplidx = gltf.json.animations[i].channels[j].sampler;\n                const smplr = gltf.json.animations[i].samplers[smplidx];\n\n                html += "  <td>" + smplr.interpolation + "</td>";\n\n                html += "  <td>" + gltf.json.accessors[smplr.output].count;\n                numKeyframes += gltf.json.accessors[smplr.output].count;\n\n                // html += "&nbsp;&nbsp;<a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').showAnim(\'" + i + "\',\'" + j + "\')\\" class=\\"icon icon-search\\"></a>";\n\n                html += "</td>";\n\n                html += "</tr>";\n            }\n        }\n\n        html += "<tr>";\n        html += "  <td></td>";\n        html += "  <td></td>";\n        html += "  <td></td>";\n        html += "  <td></td>";\n        html += "  <td>" + numKeyframes + " total</td>";\n        html += "</tr>";\n        html += "</table>";\n    }\n    else\n    {\n\n    }\n\n    // / ///////////////////\n\n    let numImages = 0;\n    if (gltf.json.images)numImages = gltf.json.images.length;\n    html += "<div id=\\"groupImages\\">Images (" + numImages + ")</div>";\n\n    if (gltf.json.images)\n    {\n        html += "<table id=\\"sectionImages\\" class=\\"table treetable\\">";\n\n        html += "<tr>";\n        html += "  <th>name</th>";\n        html += "  <th>type</th>";\n        html += "  <th>func</th>";\n        html += "</tr>";\n\n        sizes.images = 0;\n\n        for (let i = 0; i < gltf.json.images.length; i++)\n        {\n            if (gltf.json.images[i].hasOwnProperty("bufferView"))\n            {\n                // if (sizeBufferViews.indexOf(gltf.json.images[i].hasOwnProperty("bufferView")) == -1)console.log("image bufferview already there?!");\n                // else\n                sizes.images += gltf.json.bufferViews[gltf.json.images[i].bufferView].byteLength;\n            }\n            else console.log("image has no bufferview?!");\n\n            html += "<tr>";\n            html += "<td>" + gltf.json.images[i].name + "</td>";\n            html += "<td>" + gltf.json.images[i].mimeType + "</td>";\n            html += "<td>";\n\n            let name = gltf.json.images[i].name;\n            if (name === undefined)name = gltf.json.images[i].bufferView;\n\n            html += "<a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeTexture(\'" + name + "\')\\" class=\\"treebutton\\">Expose</a>";\n            html += "</td>";\n\n            html += "<tr>";\n        }\n        html += "</table>";\n    }\n\n    // / ///////////////////////\n\n    let numCameras = 0;\n    if (gltf.json.cameras)numCameras = gltf.json.cameras.length;\n    html += "<div id=\\"groupCameras\\">Cameras (" + numCameras + ")</div>";\n\n    if (gltf.json.cameras)\n    {\n        html += "<table id=\\"sectionCameras\\" class=\\"table treetable\\">";\n\n        html += "<tr>";\n        html += "  <th>name</th>";\n        html += "  <th>type</th>";\n        html += "  <th>info</th>";\n        html += "</tr>";\n\n        for (let i = 0; i < gltf.json.cameras.length; i++)\n        {\n            html += "<tr>";\n            html += "<td>" + gltf.json.cameras[i].name + "</td>";\n            html += "<td>" + gltf.json.cameras[i].type + "</td>";\n            html += "<td>";\n\n            if (gltf.json.cameras[i].perspective)\n            {\n                html += "yfov: " + Math.round(gltf.json.cameras[i].perspective.yfov * 100) / 100;\n                html += ", ";\n                html += "zfar: " + Math.round(gltf.json.cameras[i].perspective.zfar * 100) / 100;\n                html += ", ";\n                html += "znear: " + Math.round(gltf.json.cameras[i].perspective.znear * 100) / 100;\n            }\n            html += "</td>";\n\n            html += "<tr>";\n        }\n        html += "</table>";\n    }\n\n    // / ////////////////////////////////////\n\n    let numSkins = 0;\n    if (gltf.json.skins)numSkins = gltf.json.skins.length;\n    html += "<div id=\\"groupSkins\\">Skins (" + numSkins + ")</div>";\n\n    if (gltf.json.skins)\n    {\n        // html += "<h3>Skins (" + gltf.json.skins.length + ")</h3>";\n        html += "<table id=\\"sectionSkins\\" class=\\"table treetable\\">";\n\n        html += "<tr>";\n        html += "  <th>name</th>";\n        html += "  <th></th>";\n        html += "  <th>total joints</th>";\n        html += "</tr>";\n\n        for (let i = 0; i < gltf.json.skins.length; i++)\n        {\n            html += "<tr>";\n            html += "<td>" + gltf.json.skins[i].name + "</td>";\n            html += "<td>" + "</td>";\n            html += "<td>" + gltf.json.skins[i].joints.length + "</td>";\n            html += "<td>";\n            html += "</td>";\n            html += "<tr>";\n        }\n        html += "</table>";\n    }\n\n    // / ////////////////////////////////////\n\n    if (gltf.timing)\n    {\n        html += "<div id=\\"groupTiming\\">Debug Loading Timing </div>";\n\n        html += "<table id=\\"sectionTiming\\" class=\\"table treetable\\">";\n\n        html += "<tr>";\n        html += "  <th>task</th>";\n        html += "  <th>time used</th>";\n        html += "</tr>";\n\n        let lt = 0;\n        for (let i = 0; i < gltf.timing.length - 1; i++)\n        {\n            html += "<tr>";\n            html += "  <td>" + gltf.timing[i][0] + "</td>";\n            html += "  <td>" + (gltf.timing[i + 1][1] - gltf.timing[i][1]) + " ms</td>";\n            html += "</tr>";\n            // lt = gltf.timing[i][1];\n        }\n        html += "</table>";\n    }\n\n    // / //////////////////////////\n\n    let sizeBin = 0;\n    if (gltf.json.buffers)\n        sizeBin = gltf.json.buffers[0].byteLength;\n\n    html += "<div id=\\"groupBinary\\">File Size Allocation (" + Math.round(sizeBin / 1024) + "k )</div>";\n\n    html += "<table id=\\"sectionBinary\\" class=\\"table treetable\\">";\n    html += "<tr>";\n    html += "  <th>name</th>";\n    html += "  <th>size</th>";\n    html += "  <th>%</th>";\n    html += "</tr>";\n    let sizeUnknown = sizeBin;\n    for (let i in sizes)\n    {\n        // html+=i+\':\'+Math.round(sizes[i]/1024);\n        html += "<tr>";\n        html += "<td>" + i + "</td>";\n        html += "<td>" + readableSize(sizes[i]) + " </td>";\n        html += "<td>" + Math.round(sizes[i] / sizeBin * 100) + "% </td>";\n        html += "<tr>";\n        sizeUnknown -= sizes[i];\n    }\n\n    if (sizeUnknown != 0)\n    {\n        html += "<tr>";\n        html += "<td>unknown</td>";\n        html += "<td>" + readableSize(sizeUnknown) + " </td>";\n        html += "<td>" + Math.round(sizeUnknown / sizeBin * 100) + "% </td>";\n        html += "<tr>";\n    }\n\n    html += "</table>";\n    html += "</div>";\n\n    tab = new CABLES.UI.Tab("GLTF " + CABLES.basename(inFile.get()), { "icon": "cube", "infotext": "tab_gltf", "padding": true, "singleton": true });\n    gui.mainTabs.addTab(tab, true);\n\n    tab.addEventListener("close", closeTab);\n    tab.html(html);\n\n    CABLES.UI.Collapsable.setup(ele.byId("groupNodes"), ele.byId("sectionNodes"), false);\n    CABLES.UI.Collapsable.setup(ele.byId("groupMaterials"), ele.byId("materialtable"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupAnims"), ele.byId("sectionAnim"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupMeshes"), ele.byId("meshestable"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupCameras"), ele.byId("sectionCameras"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupImages"), ele.byId("sectionImages"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupSkins"), ele.byId("sectionSkins"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupBinary"), ele.byId("sectionBinary"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupTiming"), ele.byId("sectionTiming"), true);\n\n    gui.maintabPanel.show(true);\n}\n\nfunction readableSize(n)\n{\n    if (n > 1024) return Math.round(n / 1024) + " kb";\n    if (n > 1024 * 500) return Math.round(n / 1024) + " mb";\n    else return n + " bytes";\n}\n',inc_skin_js:'const GltfSkin = class\n{\n    constructor(node)\n    {\n        this._mod = null;\n        this._node = node;\n        this._lastTime = 0;\n        this._matArr = [];\n        this._m = mat4.create();\n        this._invBindMatrix = mat4.create();\n        this.identity = true;\n    }\n\n    renderFinish(cgl)\n    {\n        cgl.popModelMatrix();\n        this._mod.unbind();\n    }\n\n    renderStart(cgl, time)\n    {\n        if (!this._mod)\n        {\n            this._mod = new CGL.ShaderModifier(cgl, op.name + this._node.name);\n\n            this._mod.addModule({\n                "priority": -2,\n                "name": "MODULE_VERTEX_POSITION",\n                "srcHeadVert": attachments.skin_head_vert || "",\n                "srcBodyVert": attachments.skin_vert || ""\n            });\n\n            this._mod.addUniformVert("m4[]", "MOD_boneMats", []);// bohnenmatze\n            const tr = vec3.create();\n        }\n\n        const skinIdx = this._node.skin;\n        const arrLength = gltf.json.skins[skinIdx].joints.length * 16;\n\n        // if (this._lastTime != time || !time)\n        {\n            // this._lastTime=inTime.get();\n            if (this._matArr.length != arrLength) this._matArr.length = arrLength;\n\n            for (let i = 0; i < gltf.json.skins[skinIdx].joints.length; i++)\n            {\n                const i16 = i * 16;\n                const jointIdx = gltf.json.skins[skinIdx].joints[i];\n                const nodeJoint = gltf.nodes[jointIdx];\n\n                for (let j = 0; j < 16; j++)\n                    this._invBindMatrix[j] = gltf.accBuffers[gltf.json.skins[skinIdx].inverseBindMatrices][i16 + j];\n\n                mat4.mul(this._m, nodeJoint.modelMatAbs(), this._invBindMatrix);\n\n                for (let j = 0; j < this._m.length; j++) this._matArr[i16 + j] = this._m[j];\n            }\n\n            this._mod.setUniformValue("MOD_boneMats", this._matArr);\n            this._lastTime = time;\n        }\n\n        this._mod.define("SKIN_NUM_BONES", gltf.json.skins[skinIdx].joints.length);\n        this._mod.bind();\n\n        // draw mesh...\n        cgl.pushModelMatrix();\n        if (this.identity)mat4.identity(cgl.mMatrix);\n    }\n};\n',inc_targets_js:'const GltfTargetsRenderer = class\n{\n    constructor(mesh)\n    {\n        this.mesh = mesh;\n        this.tex = null;\n        this.numRowsPerTarget = 0;\n\n        this.makeTex(mesh.geom);\n    }\n\n    renderFinish(cgl)\n    {\n        if (!cgl.gl) return;\n        cgl.popModelMatrix();\n        this._mod.unbind();\n    }\n\n    renderStart(cgl, time)\n    {\n        if (!cgl.gl) return;\n        if (!this._mod)\n        {\n            this._mod = new CGL.ShaderModifier(cgl, "gltftarget");\n\n            this._mod.addModule({\n                "priority": -2,\n                "name": "MODULE_VERTEX_POSITION",\n                "srcHeadVert": attachments.targets_head_vert || "",\n                "srcBodyVert": attachments.targets_vert || ""\n            });\n\n            this._mod.addUniformVert("4f", "MOD_targetTexInfo", [0, 0, 0, 0]);\n            this._mod.addUniformVert("t", "MOD_targetTex", 1);\n            this._mod.addUniformVert("f[]", "MOD_weights", []);\n\n            const tr = vec3.create();\n        }\n\n        this._mod.pushTexture("MOD_targetTex", this.tex);\n        if (this.tex && this.mesh.weights)\n        {\n            this._mod.setUniformValue("MOD_weights", this.mesh.weights);\n            this._mod.setUniformValue("MOD_targetTexInfo", [this.tex.width, this.tex.height, this.numRowsPerTarget, this.mesh.weights.length]);\n\n            this._mod.define("MOD_NUM_WEIGHTS", Math.max(1, this.mesh.weights.length));\n        }\n        else\n        {\n            this._mod.define("MOD_NUM_WEIGHTS", 1);\n        }\n        this._mod.bind();\n\n        // draw mesh...\n        cgl.pushModelMatrix();\n        if (this.identity)mat4.identity(cgl.mMatrix);\n    }\n\n    makeTex(geom)\n    {\n        if (!cgl.gl) return;\n\n        if (!geom.morphTargets || !geom.morphTargets.length) return;\n\n        let w = geom.morphTargets[0].vertices.length / 3;\n        let h = 0;\n        this.numRowsPerTarget = 0;\n\n        if (geom.morphTargets[0].vertices && geom.morphTargets[0].vertices.length) this.numRowsPerTarget++;\n        if (geom.morphTargets[0].vertexNormals && geom.morphTargets[0].vertexNormals.length) this.numRowsPerTarget++;\n        if (geom.morphTargets[0].tangents && geom.morphTargets[0].tangents.length) this.numRowsPerTarget++;\n        if (geom.morphTargets[0].bitangents && geom.morphTargets[0].bitangents.length) this.numRowsPerTarget++;\n\n        h = geom.morphTargets.length * this.numRowsPerTarget;\n\n        // console.log("this.numRowsPerTarget", this.numRowsPerTarget);\n\n        const pixels = new Float32Array(w * h * 4);\n        let row = 0;\n\n        for (let i = 0; i < geom.morphTargets.length; i++)\n        {\n            if (geom.morphTargets[i].vertices && geom.morphTargets[i].vertices.length)\n            {\n                for (let j = 0; j < geom.morphTargets[i].vertices.length; j += 3)\n                {\n                    pixels[((row * w) + (j / 3)) * 4 + 0] = geom.morphTargets[i].vertices[j + 0];\n                    pixels[((row * w) + (j / 3)) * 4 + 1] = geom.morphTargets[i].vertices[j + 1];\n                    pixels[((row * w) + (j / 3)) * 4 + 2] = geom.morphTargets[i].vertices[j + 2];\n                    pixels[((row * w) + (j / 3)) * 4 + 3] = 1;\n                }\n                row++;\n            }\n\n            if (geom.morphTargets[i].vertexNormals && geom.morphTargets[i].vertexNormals.length)\n            {\n                for (let j = 0; j < geom.morphTargets[i].vertexNormals.length; j += 3)\n                {\n                    pixels[(row * w + j / 3) * 4 + 0] = geom.morphTargets[i].vertexNormals[j + 0];\n                    pixels[(row * w + j / 3) * 4 + 1] = geom.morphTargets[i].vertexNormals[j + 1];\n                    pixels[(row * w + j / 3) * 4 + 2] = geom.morphTargets[i].vertexNormals[j + 2];\n                    pixels[(row * w + j / 3) * 4 + 3] = 1;\n                }\n\n                row++;\n            }\n\n            if (geom.morphTargets[i].tangents && geom.morphTargets[i].tangents.length)\n            {\n                for (let j = 0; j < geom.morphTargets[i].tangents.length; j += 3)\n                {\n                    pixels[(row * w + j / 3) * 4 + 0] = geom.morphTargets[i].tangents[j + 0];\n                    pixels[(row * w + j / 3) * 4 + 1] = geom.morphTargets[i].tangents[j + 1];\n                    pixels[(row * w + j / 3) * 4 + 2] = geom.morphTargets[i].tangents[j + 2];\n                    pixels[(row * w + j / 3) * 4 + 3] = 1;\n                }\n                row++;\n            }\n\n            if (geom.morphTargets[i].bitangents && geom.morphTargets[i].bitangents.length)\n            {\n                for (let j = 0; j < geom.morphTargets[i].bitangents.length; j += 3)\n                {\n                    pixels[(row * w + j / 3) * 4 + 0] = geom.morphTargets[i].bitangents[j + 0];\n                    pixels[(row * w + j / 3) * 4 + 1] = geom.morphTargets[i].bitangents[j + 1];\n                    pixels[(row * w + j / 3) * 4 + 2] = geom.morphTargets[i].bitangents[j + 2];\n                    pixels[(row * w + j / 3) * 4 + 3] = 1;\n                }\n                row++;\n            }\n        }\n\n        this.tex = new CGL.Texture(cgl, { "isFloatingPointTexture": true, "name": "targetsTexture" });\n\n        this.tex.initFromData(pixels, w, h, CGL.Texture.FILTER_LINEAR, CGL.Texture.WRAP_REPEAT);\n\n        // console.log("morphTargets generated texture", w, h);\n    }\n};\n',skin_vert:"int index=int(attrJoints.x);\nvec4 newPos = (MOD_boneMats[index] * pos) * attrWeights.x;\nvec3 newNorm = (vec4((MOD_boneMats[index] * vec4(norm.xyz, 0.0)) * attrWeights.x).xyz);\n\nindex=int(attrJoints.y);\nnewPos += (MOD_boneMats[index] * pos) * attrWeights.y;\nnewNorm = (vec4((MOD_boneMats[index] * vec4(norm.xyz, 0.0)) * attrWeights.y).xyz)+newNorm;\n\nindex=int(attrJoints.z);\nnewPos += (MOD_boneMats[index] * pos) * attrWeights.z;\nnewNorm = (vec4((MOD_boneMats[index] * vec4(norm.xyz, 0.0)) * attrWeights.z).xyz)+newNorm;\n\nindex=int(attrJoints.w);\nnewPos += (MOD_boneMats[index] * pos) * attrWeights.w ;\nnewNorm = (vec4((MOD_boneMats[index] * vec4(norm.xyz, 0.0)) * attrWeights.w).xyz)+newNorm;\n\npos=newPos;\n\nnorm=normalize(newNorm.xyz);\n\n\n",skin_head_vert:"\nIN vec4 attrWeights;\nIN vec4 attrJoints;\nUNI mat4 MOD_boneMats[SKIN_NUM_BONES];\n",targets_vert:"\n\nfloat MOD_width=MOD_targetTexInfo.x;\nfloat MOD_height=MOD_targetTexInfo.y;\nfloat MOD_numTargets=MOD_targetTexInfo.w;\nfloat MOD_numLinesPerTarget=MOD_height/MOD_numTargets;\n\nfloat halfpix=(1.0/MOD_width)*0.5;\nfloat halfpixy=(1.0/MOD_height)*0.5;\n\nfloat x=(attrVertIndex)/MOD_width+halfpix;\n\nvec3 off=vec3(0.0);\n\nfor(float i=0.0;i<MOD_numTargets;i+=1.0)\n{\n    float y=1.0-((MOD_numLinesPerTarget*i)/MOD_height+halfpixy);\n    vec2 coord=vec2(x,y);\n    vec3 targetXYZ = texture(MOD_targetTex,coord).xyz;\n\n    off+=(targetXYZ*MOD_weights[int(i)]);\n\n\n\n    coord.y+=1.0/MOD_height; // normals are in next row\n    vec3 targetNormal = texture(MOD_targetTex,coord).xyz;\n    norm+=targetNormal*MOD_weights[int(i)];\n\n\n}\n\n// norm=normalize(norm);\npos.xyz+=off;\n",targets_head_vert:"\nUNI float MOD_weights[MOD_NUM_WEIGHTS];\n"};const k=class{constructor(e,t){this.node=t;this.name=t.name;this.config=e.json.cameras[t.camera];this.pos=vec3.create();this.quat=quat.create();this.vCenter=vec3.create();this.vUp=vec3.create();this.vMat=mat4.create()}updateAnim(e){if(this.node&&this.node._animTrans){vec3.set(this.pos,this.node._animTrans[0].getValue(e),this.node._animTrans[1].getValue(e),this.node._animTrans[2].getValue(e));quat.set(this.quat,this.node._animRot[0].getValue(e),this.node._animRot[1].getValue(e),this.node._animRot[2].getValue(e),this.node._animRot[3].getValue(e))}}start(e){if(m.tempData.shadowPass)return;this.updateAnim(e);const t=m.getViewPort()[2]/m.getViewPort()[3];m.pushPMatrix();m.pushViewMatrix();let i=mat4.create();mat4.invert(i,this.node.modelMatAbs());this.vMat=i;mat4.identity(m.vMatrix);mat4.mul(m.vMatrix,m.vMatrix,i)}end(){if(m.tempData.shadowPass)return;m.popPMatrix();m.popViewMatrix()}};const E=true;const U=class{constructor(){this.json={};this.accBuffers=[];this.meshes=[];this.nodes=[];this.shaders=[];this.timing=[];this.cams=[];this.startTime=performance.now();this.bounds=new CABLES.CG.BoundingBox;this.loaded=Date.now();this.accBuffersDelete=[]}getNode(t){for(let e=0;e<this.nodes.length;e++){if(this.nodes[e].name==t)return this.nodes[e]}}unHideAll(){for(let e=0;e<this.nodes.length;e++){this.nodes[e].unHide()}}};function x(e){if(window.TextDecoder)return new TextDecoder("utf-8").decode(e);let t,i,n,r;let s,a;t="";n=e.length;i=0;while(i<n){r=e[i++];switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(r);break;case 12:case 13:s=e[i++];t+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=e[i++];a=e[i++];t+=String.fromCharCode((r&15)<<12|(s&63)<<6|(a&63)<<0);break}}return t}function O(e,t,i,n){const r={};if(n>=e.byteLength){return}r.size=e.getUint32(n+0,E);r.type=x(t.subarray(n+4,n+4+4));if(r.type=="BIN\0"){r.dataView=new DataView(i,n+8,r.size)}else if(r.type=="JSON"){const s=x(t.subarray(n+8,n+8+r.size));try{const a=JSON.parse(s);r.data=a;se.set(a.asset.generator)}catch(e){}}else{T.warn("unknown type",r.type)}return r}function V(t){const n={};C={};for(let e=0;e<t.json.animations.length;e++){const r=t.json.animations[e];r.name=r.name||"unknown";for(let e=0;e<r.channels.length;e++){const s=r.channels[e];const a=t.nodes[s.target.node];const o=r.samplers[s.sampler];const i=t.json.accessors[o.input];const l=t.accBuffers[o.input];const u=t.json.accessors[o.output];const h=t.accBuffers[o.output];t.accBuffersDelete.push(o.output,o.input);if(l&&h){let i=1;if(u.type==="VEC2")i=2;else if(u.type==="VEC3")i=3;else if(u.type==="VEC4")i=4;else if(u.type==="SCALAR"){i=h.length/l.length}else T.log("[] UNKNOWN accOut.type",u.type);const c=[];n[r.name]=true;for(let e=0;e<i;e++){const f=new CABLES.Anim;f.batchMode=true;c.push(f)}if(o.interpolation==="LINEAR"){}else if(o.interpolation==="STEP")for(let e=0;e<i;e++)c[e].defaultEasing=CABLES.EASING_ABSOLUTE;else if(o.interpolation==="CUBICSPLINE")for(let e=0;e<i;e++)c[e].defaultEasing=CABLES.EASING_CUBICSPLINE;else T.warn("unknown interpolation",o.interpolation);if(l[0]!==0)for(let e=0;e<i;e++)c[e].setValue(0,h[0*i+e]);for(let t=0;t<l.length;t++){C[r.name]=l[t];for(let e=0;e<i;e++){if(c[e].defaultEasing===CABLES.EASING_CUBICSPLINE){const d=t*i*3+e;const g=c[e].setValue(l[t],h[d+i]);g.bezTangIn=h[d];g.bezTangOut=h[d+i*2]}else{c[e].setValue(l[t],h[t*i+e])}}}for(let e=0;e<i;e++)c[e].batchMode=false;a.setAnim(s.target.path,r.name,c)}else{T.warn("loadAmins bufferIn undefined ",l===undefined);T.warn("loadAmins bufferOut undefined ",h===undefined);T.warn("loadAmins ",r.name,o,u);T.warn("loadAmins num accBuffers",t.accBuffers.length);T.warn("loadAmins num accessors",t.json.accessors.length)}}}t.uniqueAnimNames=n;ce.setRef(Object.keys(n))}function F(i){if(!i||!i.json.cameras)return;i.cameras=i.cameras||[];for(let t=0;t<i.nodes.length;t++){if(i.nodes[t].hasOwnProperty("camera")){const e=new k(i,i.nodes[t]);i.cameras.push(e)}}}function j(){if(!window.DracoDecoder){setTimeout(()=>{j()},100)}L()}function B(e){const t=8;let r=0,i=0;const s=new U;s.timing.push(["Start parsing",Math.round(performance.now()-s.startTime)]);if(!e)return;const n=new Uint8Array(e);let a=0;const o=x(n.subarray(a,4));a+=4;if(o!="glTF")return;s.timing.push(["dataview",Math.round(performance.now()-s.startTime)]);const l=new DataView(e);const u=l.getUint32(a,E);a+=4;const h=l.getUint32(a,E);a+=4;ae.set(u);const c=[];s.chunks=c;c.push(O(l,n,e,a));a+=c[0].size+t;s.json=c[0].data;s.cables={fileUrl:S.get(),shortFileName:CABLES.basename(S.get())};he.setRef(s.json);oe.setRef(s.json.extensionsUsed||[]);let f=O(l,n,e,a);while(f){c.push(f);a+=f.size+t;f=O(l,n,e,a)}s.chunks=c;const d=c[0].data.bufferViews;const g=c[0].data.accessors;s.timing.push(["Parse buffers",Math.round(performance.now()-s.startTime)]);if(s.json.extensionsUsed&&s.json.extensionsUsed.indexOf("KHR_draco_mesh_compression")>-1){if(!window.DracoDecoder){T.setUiError("gltfdraco","GLTF draco compression lib not found / add draco op to your patch!");j();return s}else{s.useDraco=true}}T.setUiError("gltfdraco",null);if(d){for(i=0;i<g.length;i++){const m=g[i];const p=d[m.bufferView];let n=0;if(m.type=="SCALAR")n=1;else if(m.type=="VEC2")n=2;else if(m.type=="VEC3")n=3;else if(m.type=="VEC4")n=4;else if(m.type=="MAT4")n=16;else console.error("unknown accessor type",m.type);if(c[1].dataView){if(p){const _=m.count*n;let e=(p.byteOffset||0)+(m.byteOffset||0);let t=p.byteStride||0;let i=null;if(m.componentType==5126||m.componentType==5125){t=t||4;const b=m.componentType==5125;if(b)i=new Uint32Array(_);else i=new Float32Array(_);i.cblStride=n;for(r=0;r<_;r++){if(b)i[r]=c[1].dataView.getUint32(e,E);else i[r]=c[1].dataView.getFloat32(e,E);if(t!=4&&(r+1)%n===0)e+=t-n*4;e+=4}}else if(m.componentType==5123){t=t||2;i=new Uint16Array(_);i.cblStride=t;for(r=0;r<_;r++){i[r]=c[1].dataView.getUint16(e,E);if(t!=2&&(r+1)%n===0)e+=t-n*2;e+=2}}else if(m.componentType==5121){t=t||1;i=new Uint8Array(_);i.cblStride=t;for(r=0;r<_;r++){i[r]=c[1].dataView.getUint8(e,E);if(t!=1&&(r+1)%n===0)e+=t-n*1;e+=1}}else{console.error("unknown component type",m.componentType)}s.accBuffers.push(i)}else{}}}}s.timing.push(["Parse mesh groups",Math.round(performance.now()-s.startTime)]);s.json.meshes=s.json.meshes||[];if(s.json.meshes){for(i=0;i<s.json.meshes.length;i++){const v=new z(s,s.json.meshes[i]);s.meshes.push(v)}}s.timing.push(["Parse nodes",Math.round(performance.now()-s.startTime)]);for(i=0;i<s.json.nodes.length;i++){if(s.json.nodes[i].children)for(r=0;r<s.json.nodes[i].children.length;r++){s.json.nodes[s.json.nodes[i].children[r]].isChild=true}}for(i=0;i<s.json.nodes.length;i++){const A=new H(s.json.nodes[i],s);s.nodes.push(A)}for(i=0;i<s.nodes.length;i++){const A=s.nodes[i];if(!A.children)continue;for(let e=0;e<A.children.length;e++){s.nodes[A.children[e]].parent=A}}for(i=0;i<s.nodes.length;i++){s.nodes[i].initSkin()}N=true;s.timing.push(["load anims",Math.round(performance.now()-s.startTime)]);if(s.json.animations)V(s);s.timing.push(["load cameras",Math.round(performance.now()-s.startTime)]);if(s.json.cameras)F(s);s.timing.push(["finished",Math.round(performance.now()-s.startTime)]);return s}let G=class{constructor(e,i,s,a){this.POINTS=0;this.LINES=1;this.LINE_LOOP=2;this.LINE_STRIP=3;this.TRIANGLES=4;this.TRIANGLE_STRIP=5;this.TRIANGLE_FAN=6;this.test=0;this.name=e;this.submeshIndex=0;this.material=i.material;this.mesh=null;this.geom=new CGL.Geometry("gltf_"+this.name);this.geom.verticesIndices=[];this.bounds=null;this.primitive=4;this.morphTargetsRenderMod=null;this.weights=i.weights;if(i.hasOwnProperty("mode"))this.primitive=i.mode;if(i.hasOwnProperty("indices"))this.geom.verticesIndices=s.accBuffers[i.indices];s.loadingMeshes=s.loadingMeshes||0;s.loadingMeshes++;this.materialJson=this._matPbrMetalness=this._matPbrRoughness=this._matDiffuseColor=null;if(s.json.materials){if(this.material!=-1)this.materialJson=s.json.materials[this.material];if(this.materialJson&&this.materialJson.pbrMetallicRoughness){if(!this.materialJson.pbrMetallicRoughness.hasOwnProperty("baseColorFactor")){this._matDiffuseColor=[1,1,1,1]}else{this._matDiffuseColor=this.materialJson.pbrMetallicRoughness.baseColorFactor}this._matDiffuseColor=this.materialJson.pbrMetallicRoughness.baseColorFactor;if(!this.materialJson.pbrMetallicRoughness.hasOwnProperty("metallicFactor")){this._matPbrMetalness=1}else{this._matPbrMetalness=this.materialJson.pbrMetallicRoughness.metallicFactor||null}if(!this.materialJson.pbrMetallicRoughness.hasOwnProperty("roughnessFactor")){this._matPbrRoughness=1}else{this._matPbrRoughness=this.materialJson.pbrMetallicRoughness.roughnessFactor||null}}}if(s.useDraco&&i.extensions.KHR_draco_mesh_compression){const n=s.chunks[0].data.bufferViews[i.extensions.KHR_draco_mesh_compression.bufferView];const r=n.byteLength;const o=new Int8Array(r);let t=n.byteOffset||0;for(let e=0;e<r;e++){o[e]=s.chunks[1].dataView.getInt8(t,E);t++}const l=window.DracoDecoder;l.decodeGeometry(o.buffer,t=>{const i=new CGL.Geometry("draco mesh "+e);for(let e=0;e<t.attributes.length;e++){const n=t.attributes[e];if(n.name==="position")i.vertices=n.array;else if(n.name==="normal")i.vertexNormals=n.array;else if(n.name==="uv")i.texCoords=n.array;else if(n.name==="color")i.vertexColors=this.calcVertexColors(n.array);else if(n.name==="joints")i.setAttribute("attrJoints",Array.from(n.array),4);else if(n.name==="weights"){const r=new Float32Array(n.array.length/n.itemSize*4);for(let t=0;t<n.array.length/n.itemSize;t++){r[t*4]=r[t*4+1]=r[t*4+2]=r[t*4+3]=0;for(let e=0;e<n.itemSize;e++)r[t*4+e]=n.array[t*n.itemSize+e]}i.setAttribute("attrWeights",r,4)}else T.logWarn("unknown draco attrib",n)}t.attributes=null;i.verticesIndices=t.index.array;this.setGeom(i);this.mesh=null;s.loadingMeshes--;s.timing.push(["draco decode",Math.round(performance.now()-s.startTime)]);if(a)a(this)},e=>{T.logError(e)})}else{s.loadingMeshes--;this.fillGeomAttribs(s,this.geom,i.attributes);if(i.targets){for(let e=0;e<i.targets.length;e++){const t=new CGL.Geometry("gltf_target_"+e);this.fillGeomAttribs(s,t,i.targets[e],false);this.geom.morphTargets.push(t)}}if(a)a(this)}}_linearToSrgb(e){if(e<=0)return 0;else if(e>=1)return 1;else if(e<.0031308)return e*12.92;else return e**(1/2.2)*1.055-.055}calcVertexColors(i,e){let n=null;if(i instanceof Float32Array){let t=false;for(let e=0;e<i.length;e++){if(i[e]>1){t=true;continue}}if(t)for(let e=0;e<i.length;e++)i[e]/=65535;n=i}else if(i instanceof Uint16Array){const t=new Float32Array(i.length);for(let e=0;e<i.length;e++)t[e]=i[e]/65535;n=t}else n=i;for(let e=0;e<n.length;e++){n[e]=this._linearToSrgb(n[e])}if(i.cblStride==3){const r=new Float32Array(n.length/3*4);for(let e=0;e<n.length/3;e++){r[e*4+0]=n[e*3+0];r[e*4+1]=n[e*3+1];r[e*4+2]=n[e*3+2];r[e*4+3]=1}n=r}return n}fillGeomAttribs(e,t,i,n){if(i.hasOwnProperty("POSITION"))t.vertices=e.accBuffers[i.POSITION];if(i.hasOwnProperty("NORMAL"))t.vertexNormals=e.accBuffers[i.NORMAL];if(i.hasOwnProperty("TANGENT"))t.tangents=e.accBuffers[i.TANGENT];if(i.hasOwnProperty("COLOR_0"))t.vertexColors=this.calcVertexColors(e.accBuffers[i.COLOR_0],e.accBuffers[i.COLOR_0].type||4);if(i.hasOwnProperty("COLOR_1"))t.setAttribute("attrVertColor1",this.calcVertexColors(e.accBuffers[i.COLOR_1]),e.accBuffers[i.COLOR_1].type||4);if(i.hasOwnProperty("COLOR_2"))t.setAttribute("attrVertColor2",this.calcVertexColors(e.accBuffers[i.COLOR_2]),e.accBuffers[i.COLOR_2].type||4);if(i.hasOwnProperty("COLOR_3"))t.setAttribute("attrVertColor3",this.calcVertexColors(e.accBuffers[i.COLOR_3]),e.accBuffers[i.COLOR_3].type||4);if(i.hasOwnProperty("COLOR_4"))t.setAttribute("attrVertColor4",this.calcVertexColors(e.accBuffers[i.COLOR_4]),e.accBuffers[i.COLOR_4].type||4);if(i.hasOwnProperty("TEXCOORD_0"))t.texCoords=e.accBuffers[i.TEXCOORD_0];if(i.hasOwnProperty("TEXCOORD_1"))t.setAttribute("attrTexCoord1",e.accBuffers[i.TEXCOORD_1],2);if(i.hasOwnProperty("TEXCOORD_2"))t.setAttribute("attrTexCoord2",e.accBuffers[i.TEXCOORD_2],2);if(i.hasOwnProperty("TEXCOORD_3"))t.setAttribute("attrTexCoord3",e.accBuffers[i.TEXCOORD_3],2);if(i.hasOwnProperty("TEXCOORD_4"))t.setAttribute("attrTexCoord4",e.accBuffers[i.TEXCOORD_4],2);if(i.hasOwnProperty("WEIGHTS_0")){t.setAttribute("attrWeights",e.accBuffers[i.WEIGHTS_0],4)}if(i.hasOwnProperty("JOINTS_0")){if(!e.accBuffers[i.JOINTS_0])console.log("no !gltf.accBuffers[attribs.JOINTS_0]");t.setAttribute("attrJoints",e.accBuffers[i.JOINTS_0],4)}if(i.hasOwnProperty("POSITION"))e.accBuffersDelete.push(i.POSITION);if(i.hasOwnProperty("NORMAL"))e.accBuffersDelete.push(i.NORMAL);if(i.hasOwnProperty("TEXCOORD_0"))e.accBuffersDelete.push(i.TEXCOORD_0);if(i.hasOwnProperty("TANGENT"))e.accBuffersDelete.push(i.TANGENT);if(i.hasOwnProperty("COLOR_0"))e.accBuffersDelete.push(i.COLOR_0);if(i.hasOwnProperty("COLOR_0"))e.accBuffersDelete.push(i.COLOR_0);if(i.hasOwnProperty("COLOR_1"))e.accBuffersDelete.push(i.COLOR_1);if(i.hasOwnProperty("COLOR_2"))e.accBuffersDelete.push(i.COLOR_2);if(i.hasOwnProperty("COLOR_3"))e.accBuffersDelete.push(i.COLOR_3);if(i.hasOwnProperty("TEXCOORD_1"))e.accBuffersDelete.push(i.TEXCOORD_1);if(i.hasOwnProperty("TEXCOORD_2"))e.accBuffersDelete.push(i.TEXCOORD_2);if(i.hasOwnProperty("TEXCOORD_3"))e.accBuffersDelete.push(i.TEXCOORD_3);if(i.hasOwnProperty("TEXCOORD_4"))e.accBuffersDelete.push(i.TEXCOORD_4);if(n!==false)if(t&&t.verticesIndices)this.setGeom(t)}setGeom(i){if(ee.get()=="X-ZY"){for(let t=0;t<i.vertexNormals.length;t+=3){let e=i.vertexNormals[t+2];i.vertexNormals[t+2]=i.vertexNormals[t+1];i.vertexNormals[t+1]=-e}}if(te.get()=="XZ-Y"){for(let t=0;t<i.vertices.length;t+=3){let e=i.vertices[t+2];i.vertices[t+2]=-i.vertices[t+1];i.vertices[t+1]=e}}if(this.primitive==this.TRIANGLES){if(c.get()=="Force Smooth"||c.get()==false)i.calculateNormals();else if(!i.vertexNormals.length&&c.get()=="Auto")i.calculateNormals({smooth:false});if((!i.biTangents||i.biTangents.length==0)&&i.tangents){const t=vec3.create();const e=vec3.create();const n=i.tangents;i.tangents=new Float32Array(n.length/4*3);i.biTangents=new Float32Array(n.length/4*3);for(let e=0;e<n.length;e+=4){const r=e/4*3;vec3.cross(t,[i.vertexNormals[r],i.vertexNormals[r+1],i.vertexNormals[r+2]],[n[e],n[e+1],n[e+2]]);vec3.div(t,t,[n[e+3],n[e+3],n[e+3]]);vec3.normalize(t,t);i.biTangents[r+0]=t[0];i.biTangents[r+1]=t[1];i.biTangents[r+2]=t[2];i.tangents[r+0]=n[e+0];i.tangents[r+1]=n[e+1];i.tangents[r+2]=n[e+2]}}if(i.tangents.length===0||c.get()!="Never"){i.calcTangentsBitangents()}}this.geom=i;this.bounds=i.getBounds()}render(i,t,n){if(!this.mesh&&this.geom&&this.geom.verticesIndices){let e=this.geom;if(this.geom.vertices.length/3>64e3&&this.geom.verticesIndices.length>0){e=this.geom.copy();e.unIndex(false,true)}let t;if(i.gl){if(this.primitive==this.TRIANGLES)t=i.gl.TRIANGLES;else if(this.primitive==this.LINES)t=i.gl.LINES;else if(this.primitive==this.LINE_STRIP)t=i.gl.LINE_STRIP;else if(this.primitive==this.POINTS)t=i.gl.POINTS;else{T.logWarn("unknown primitive type",this)}}this.mesh=T.patch.cg.createMesh(e,{glPrimitive:t})}if(this.mesh){if(this.geom&&this.geom.morphTargets.length&&!this.morphTargetsRenderMod){this.mesh.addVertexNumbers=true;this.morphTargetsRenderMod=new K(this)}let e=!t&&this.material!=-1&&y.shaders[this.material];if(n)e=false;if(e)i.pushShader(y.shaders[this.material]);const r=i.getShader()||{};const s=r.uniformColorDiffuse;const a=r.uniformPbrMetalness;const o=r.uniformPbrRoughness;if(!y.shaders[this.material]&&ne.get()){if(s&&this._matDiffuseColor){this._matDiffuseColorOrig=[s.getValue()[0],s.getValue()[1],s.getValue()[2],s.getValue()[3]];s.setValue(this._matDiffuseColor)}if(a)if(this._matPbrMetalness!=null){this._matPbrMetalnessOrig=a.getValue();a.setValue(this._matPbrMetalness)}else a.setValue(0);if(o)if(this._matPbrRoughness!=null){this._matPbrRoughnessOrig=o.getValue();o.setValue(this._matPbrRoughness)}else{o.setValue(0)}}if(this.morphTargetsRenderMod)this.morphTargetsRenderMod.renderStart(i,0);if(this.mesh){this.mesh.render(i.getShader(),t)}if(this.morphTargetsRenderMod)this.morphTargetsRenderMod.renderFinish(i);if(ne.get()){if(s&&this._matDiffuseColor)s.setValue(this._matDiffuseColorOrig);if(a&&this._matPbrMetalnessOrig!=undefined)a.setValue(this._matPbrMetalnessOrig);if(o&&this._matPbrRoughnessOrig!=undefined)o.setValue(this._matPbrRoughnessOrig)}if(e)i.popShader()}else{console.log("no mesh......")}}};const z=class{constructor(t,i){this.bounds=new CABLES.CG.BoundingBox;this.meshes=[];i.name=i.name||"unknown mesh "+CABLES.simpleId();this.name=i.name;const n=i.primitives;for(let e=0;e<n.length;e++){const r=new G(this.name,n[e],t,e=>{e.extras=i.extras;this.bounds.apply(e.bounds)});r.submeshIndex=e;this.meshes.push(r)}}render(t,i,n,r,s){for(let e=0;e<this.meshes.length;e++){const a=y.shaders[this.meshes[e].material];if(!i&&a)t.pushShader(y.shaders[this.meshes[e].material]);if(n)n.renderStart(t,r);if(s)this.meshes[e].weights=s;this.meshes[e].render(t,i,n,r);if(n)n.renderFinish(t);if(!i&&a)t.popShader()}}};const H=class{constructor(e,t){this.isChild=e.isChild||false;e.name=e.name||"unknown node "+CABLES.simpleId();this.name=e.name;if(e.hasOwnProperty("camera"))this.camera=e.camera;this.hidden=false;this.mat=mat4.create();this._animActions={};this.animWeights=[];this._animMat=mat4.create();this._tempMat=mat4.create();this._tempQuat=quat.create();this._tempRotmat=mat4.create();this.mesh=null;this.children=[];this._node=e;this._gltf=t;this.absMat=mat4.create();this.addTranslate=null;this._tempAnimScale=null;this.addMulMat=null;this.updateMatrix();this.skinRenderer=null;this.copies=[]}get skin(){if(this._node.hasOwnProperty("skin"))return this._node.skin;else return-1}copy(){this.isCopy=true;const e=new H(this._node,this._gltf);e.copyOf=this;e._animActions=this._animActions;e.children=this.children;if(this.skin)e.skinRenderer=new W(this);this.updateMatrix();return e}hasSkin(){if(this._node.hasOwnProperty("skin"))return this._gltf.json.skins[this._node.skin].name||"unknown";return false}initSkin(){if(this.skin>-1){this.skinRenderer=new W(this)}}updateMatrix(){mat4.identity(this.mat);if(this._node.translation)mat4.translate(this.mat,this.mat,this._node.translation);if(this._node.rotation){const e=mat4.create();this._rot=this._node.rotation;mat4.fromQuat(e,this._node.rotation);mat4.mul(this.mat,this.mat,e)}if(this._node.scale){this._scale=this._node.scale;mat4.scale(this.mat,this.mat,this._scale)}if(this._node.hasOwnProperty("mesh")){this.mesh=this._gltf.meshes[this._node.mesh];if(this.isCopy){}}if(this._node.children){for(let e=0;e<this._node.children.length;e++){this._gltf.json.nodes[e].isChild=true;if(this._gltf.nodes[this._node.children[e]])this._gltf.nodes[this._node.children[e]].isChild=true;this.children.push(this._node.children[e])}}}unHide(){this.hidden=false;for(let e=0;e<this.children.length;e++)if(this.children[e].unHide)this.children[e].unHide()}calcBounds(t,e,i){const n=mat4.create();if(e)mat4.copy(n,e);if(this.mat)mat4.mul(n,n,this.mat);if(this.mesh){const r=this.mesh.bounds.copy();r.mulMat4(n);i.apply(r);if(i.changed){be.push(r._min[0]||0,r._min[1]||0,r._min[2]||0,r._max[0]||0,r._max[1]||0,r._max[2]||0)}}for(let e=0;e<this.children.length;e++){if(t.nodes[this.children[e]]&&t.nodes[this.children[e]].calcBounds){const s=t.nodes[this.children[e]].calcBounds(t,n,i);i.apply(s)}}if(i.changed)return i;else return null}setAnimAction(t){if(!t)return;this._currentAnimaction=t;if(t&&!this._animActions[t])return null;for(let e in this._animActions[t]){if(e=="translation")this._animTrans=this._animActions[t][e];else if(e=="rotation")this._animRot=this._animActions[t][e];else if(e=="scale")this._animScale=this._animActions[t][e];else if(e=="weights")this.animWeights=this._animActions[t][e]}}setAnim(e,t,i){if(!e||!t||!i)return;this._animActions[t]=this._animActions[t]||{};if(this._animActions[t][e])T.log("[gltfNode] animation action path already exists",t,e,this._animActions[t][e]);this._animActions[t][e]=i;if(e=="translation")this._animTrans=i;else if(e=="rotation")this._animRot=i;else if(e=="scale")this._animScale=i;else if(e=="weights")this.animWeights=this._animActions[t][e]}modelMatLocal(){return this._animMat||this.mat}modelMatAbs(){return this.absMat}transform(e,i){if(!i&&i!=0)i=R;this._lastTimeTrans=i;_e++;if(!this._animTrans&&!this._animRot&&!this._animScale){mat4.mul(e.mMatrix,e.mMatrix,this.mat);this._animMat=null}else{this._animMat=this._animMat||mat4.create();mat4.identity(this._animMat);const t=true;if(t&&this._animTrans){mat4.translate(this._animMat,this._animMat,[this._animTrans[0].getValue(i),this._animTrans[1].getValue(i),this._animTrans[2].getValue(i)])}else if(this._node.translation)mat4.translate(this._animMat,this._animMat,this._node.translation);if(t&&this._animRot){if(this._animRot[0].defaultEasing==CABLES.EASING_LINEAR)CABLES.Anim.slerpQuaternion(i,this._tempQuat,this._animRot[0],this._animRot[1],this._animRot[2],this._animRot[3]);else if(this._animRot[0].defaultEasing==CABLES.EASING_ABSOLUTE){this._tempQuat[0]=this._animRot[0].getValue(i);this._tempQuat[1]=this._animRot[1].getValue(i);this._tempQuat[2]=this._animRot[2].getValue(i);this._tempQuat[3]=this._animRot[3].getValue(i)}else if(this._animRot[0].defaultEasing==CABLES.EASING_CUBICSPLINE){CABLES.Anim.slerpQuaternion(i,this._tempQuat,this._animRot[0],this._animRot[1],this._animRot[2],this._animRot[3])}mat4.fromQuat(this._tempMat,this._tempQuat);mat4.mul(this._animMat,this._animMat,this._tempMat)}else if(this._rot){mat4.fromQuat(this._tempRotmat,this._rot);mat4.mul(this._animMat,this._animMat,this._tempRotmat)}if(t&&this._animScale){if(!this._tempAnimScale)this._tempAnimScale=[1,1,1];this._tempAnimScale[0]=this._animScale[0].getValue(i);this._tempAnimScale[1]=this._animScale[1].getValue(i);this._tempAnimScale[2]=this._animScale[2].getValue(i);mat4.scale(this._animMat,this._animMat,this._tempAnimScale)}else if(this._scale)mat4.scale(this._animMat,this._animMat,this._scale);mat4.mul(e.mMatrix,e.mMatrix,this._animMat)}if(this.animWeights){this.weights=this.weights||[];let t="";for(let e=0;e<this.animWeights.length;e++){this.weights[e]=this.animWeights[e].getValue(i);t+=this.weights[e]+"/"}}if(this.addTranslate)mat4.translate(e.mMatrix,e.mMatrix,this.addTranslate);if(this.addMulMat)mat4.mul(e.mMatrix,e.mMatrix,this.addMulMat);mat4.copy(this.absMat,e.mMatrix)}render(t,i,n,r,s,a,o){if(!i)t.pushModelMatrix();if(o===undefined)o=y.time;if(!i||this.skinRenderer)this.transform(t,o);if(this.hidden&&!a){}else{if(this.skinRenderer){this.skinRenderer.time=o;if(!n)this.mesh.render(t,r,this.skinRenderer,o,this.weights)}else{if(this.mesh&&!n)this.mesh.render(t,r,null,o,this.weights)}}if(!s&&!this.hidden)for(let e=0;e<this.children.length;e++)if(y.nodes[this.children[e]])y.nodes[this.children[e]].render(t,i,n,r,s,a,o);if(!i)t.popModelMatrix()}};let A=null;function I(){if(A)gui.mainTabs.closeTab(A.id);A=null}function o(t){const i=[];for(let e=0;e<t.length;e++){i.push(Math.round(t[e]*1e3)/1e3)}return i.join(",")}function X(i,n,r){if(!y)return;i+='<tr class="row">';let s="";let a="";for(let t=1;t<r;t++){a+="&nbsp;&nbsp;&nbsp;";let e="identBg";if(t==1)e="identBgLevel0";s+='<td class="ident '+e+'" ><div style=""></div></td>'}let e=CABLES.uuid();i+=s;i+='<td colspan="'+(21-r)+'">';if(n.mesh&&n.mesh.meshes.length)i+='<span class="icon icon-cube"></span>&nbsp;';else i+='<span class="icon icon-box-select"></span> &nbsp;';i+=n.name+"</td><td></td>";if(n.mesh){i+="<td>";for(let e=0;e<n.mesh.meshes.length;e++){if(e>0)i+=", ";i+=n.mesh.meshes[e].name}i+="</td>";i+="<td>";i+=n.hasSkin()||"-";i+="</td>";i+="<td>";let t=0;for(let e=0;e<n.mesh.meshes.length;e++){if(t>0)i+=", ";if(y.json.materials&&n.mesh.meshes[e].hasOwnProperty("material")){if(y.json.materials[n.mesh.meshes[e].material]){i+=y.json.materials[n.mesh.meshes[e].material].name;t++}}}if(t==0)i+="none";i+="</td>"}else{i+="<td>-</td><td>-</td><td>-</td>"}i+="<td>";if(n._node.translation||n._node.rotation||n._node.scale){let e="";if(n._node.translation)e+="Translate: `"+o(n._node.translation)+"` || ";if(n._node.rotation)e+="Rotation: `"+o(n._node.rotation)+"` || ";if(n._node.scale)e+="Scale: `"+o(n._node.scale)+"` || ";i+='<span class="icon icon-gizmo info" data-info="'+e+'"></span> &nbsp;'}if(n._animRot||n._animScale||n._animTrans){let e="Animated: ";if(n._animRot)e+="Rot ";if(n._animScale)e+="Scale ";if(n._animTrans)e+="Trans ";i+='<span class="icon icon-clock info" data-info="'+e+'"></span>&nbsp;'}if(!n._node.translation&&!n._node.rotation&&!n._node.scale&&!n._animRot&&!n._animScale&&!n._animTrans)i+="-";i+="</td>";i+="<td>";let t="";if(n.hidden)t="node-hidden";i+="<a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeNode('"+n.name+"','transform')\" class=\"treebutton\">Transform</a>";i+=" <a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeNode('"+n.name+"','hierarchy')\" class=\"treebutton\">Hierarchy</a>";i+=" <a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeNode('"+n.name+'\')" class="treebutton">Node</a>';if(n.hasSkin())i+=" <a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeNode('"+n.name+'\',false,{skin:true});" class="treebutton">Skin</a>';i+="</td><td>";i+='&nbsp;<span class="icon iconhover icon-eye '+t+'" onclick="gui.corePatch().getOpById(\''+T.id+"').toggleNodeVisibility('"+n.name+"');this.classList.toggle('node-hidden');\"></span>";i+="</td>";i+="</tr>";if(n.children){for(let e=0;e<n.children.length;e++)i=X(i,y.nodes[n.children[e]],r+1)}return i}function q(t,e){let i="<tr>";i+=" <td>"+e+"</td>";i+=" <td>"+t.name+"</td>";i+=" <td>";const n=JSON.stringify(t,null,4).replaceAll('"',"").replaceAll("\n","<br/>");i+="<span class=\"icon icon-info\" onclick=\"new CABLES.UI.ModalDialog({ 'html': '<pre>"+n+"</pre>', 'title': '"+t.name+"' });\"></span>&nbsp;";if(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorFactor){let e="";e+=""+Math.round(t.pbrMetallicRoughness.baseColorFactor[0]*255);e+=","+Math.round(t.pbrMetallicRoughness.baseColorFactor[1]*255);e+=","+Math.round(t.pbrMetallicRoughness.baseColorFactor[2]*255);i+='<div style="width:15px;height:15px;background-color:rgb('+e+');display:inline-block">&nbsp;</a>'}i+=' <td style="">'+(y.shaders[e]?"-":"<a onclick=\"gui.corePatch().getOpById('"+T.id+"').assignMaterial('"+t.name+'\')" class="treebutton">Assign</a>')+"<td>";i+="<td>";i+="</tr>";return i}function e(){if(!y)return;const e=performance.now();const s={};let a='<div style="overflow:scroll;width:100%;height:100%">';a+='File: <a href="'+CABLES.platform.getCablesUrl()+"/asset/patches/?filename="+S.get()+'" target="_blank">'+CABLES.basename(S.get())+"</a><br/>";a+="Generator:"+y.json.asset.generator;let t=0;if(y.json.nodes)t=y.json.nodes.length;a+='<div id="groupNodes">Nodes ('+t+")</div>";a+='<table id="sectionNodes" class="table treetable">';a+="<tr>";a+=' <th colspan="21">Name</th>';a+=" <th>Mesh</th>";a+=" <th>Skin</th>";a+=" <th>Material</th>";a+=" <th>Transform</th>";a+=" <th>Expose</th>";a+=" <th></th>";a+="</tr>";for(let e=0;e<y.nodes.length;e++){if(!y.nodes[e].isChild)a=X(a,y.nodes[e],1)}a+="</table>";let i=0;if(y.json.materials)i=y.json.materials.length;a+='<div id="groupMaterials">Materials ('+i+")</div>";if(!y.json.materials||y.json.materials.length==0){}else{a+='<table id="materialtable"  class="table treetable">';a+="<tr>";a+=" <th>Index</th>";a+=" <th>Name</th>";a+=" <th>Color</th>";a+=" <th>Function</th>";a+=" <th></th>";a+="</tr>";for(let e=0;e<y.json.materials.length;e++){a+=q(y.json.materials[e],e)}a+="</table>"}a+='<div id="groupMeshes">Meshes ('+y.json.meshes.length+")</div>";a+='<table id="meshestable"  class="table treetable">';a+="<tr>";a+=" <th>Name</th>";a+=" <th>Node</th>";a+=" <th>Material</th>";a+=" <th>Vertices</th>";a+=" <th>Attributes</th>";a+="</tr>";let o=[];s.meshes=0;s.meshTargets=0;for(let r=0;r<y.json.meshes.length;r++){a+="<tr>";a+="<td>"+y.json.meshes[r].name+"</td>";a+="<td>";let t=0;let i="";if(y.json.nodes)for(let e=0;e<y.json.nodes.length;e++){if(y.json.nodes[e].mesh==r){t++;if(t==1){i=y.json.nodes[e].name}}}if(t>1)a+=t+" nodes ("+i+" ...)";else a+=i;a+="</td>";a+="<td>";for(let e=0;e<y.json.meshes[r].primitives.length;e++){if(y.json.meshes[r].primitives[e].hasOwnProperty("material")){if(y.json.materials[y.json.meshes[r]]){a+=y.json.materials[y.json.meshes[r].primitives[e].material].name+" "}}else a+="None"}a+="</td>";a+="<td>";let n=0;for(let t=0;t<y.json.meshes[r].primitives.length;t++){if(y.json.meshes[r].primitives[t].attributes.POSITION!=undefined){let e=parseInt(y.json.accessors[y.json.meshes[r].primitives[t].attributes.POSITION].count);n+=e;a+=""+e+"<br/>"}else a+="-<br/>"}if(y.json.meshes[r].primitives.length>1)a+="="+n;a+="</td>";a+="<td>";for(let e=0;e<y.json.meshes[r].primitives.length;e++){a+=Object.keys(y.json.meshes[r].primitives[e].attributes);a+=" <a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeGeom('"+y.json.meshes[r].name+"',"+e+')" class="treebutton">Geometry</a>';a+="<br/>";if(y.json.meshes[r].primitives[e].targets){a+=y.json.meshes[r].primitives[e].targets.length+" targets<br/>";if(y.json.meshes[r].extras&&y.json.meshes[r].extras.targetNames)a+="Targetnames:<br/>"+y.json.meshes[r].extras.targetNames.join("<br/>");a+="<br/>"}}a+="</td>";a+="</tr>";for(let i=0;i<y.json.meshes[r].primitives.length;i++){const g=y.json.accessors[y.json.meshes[r].primitives[i].indices];if(g){let e=g.bufferView;if(o.indexOf(e)==-1){o.push(e);if(y.json.bufferViews[e])s.meshes+=y.json.bufferViews[e].byteLength}}for(let e in y.json.meshes[r].primitives[i].attributes){const m=y.json.meshes[r].primitives[i].attributes[e];const p=y.json.accessors[m].bufferView;if(o.indexOf(p)==-1){o.push(p);if(y.json.bufferViews[p])s.meshes+=y.json.bufferViews[p].byteLength}}if(y.json.meshes[r].primitives[i].targets)for(let t=0;t<y.json.meshes[r].primitives[i].targets.length;t++){for(let e in y.json.meshes[r].primitives[i].targets[t]){const _=y.json.meshes[r].primitives[i].targets[t][e];const g=y.json.accessors[_];const p=g.bufferView;console.log("accessor",g);if(o.indexOf(p)==-1)if(y.json.bufferViews[p]){o.push(p);s.meshTargets+=y.json.bufferViews[p].byteLength}}}}}a+="</table>";let n=0;let r=0;let l=0;if(y.json.animations){r=y.json.animations.length;for(let e=0;e<y.json.animations.length;e++){n+=y.json.animations[e].samplers.length}}a+='<div id="groupAnims">Animations ('+r+"/"+n+")</div>";if(y.json.animations){a+='<table id="sectionAnim" class="table treetable">';a+="<tr>";a+="  <th>Name</th>";a+="  <th>Target node</th>";a+="  <th>Path</th>";a+="  <th>Interpolation</th>";a+="  <th>Keys</th>";a+="</tr>";s.animations=0;for(let i=0;i<y.json.animations.length;i++){for(let t=0;t<y.json.animations[i].samplers.length;t++){let e=y.json.accessors[y.json.animations[i].samplers[t].input].bufferView;if(o.indexOf(e)==-1){o.push(e);s.animations+=y.json.bufferViews[e].byteLength}e=y.json.accessors[y.json.animations[i].samplers[t].output].bufferView;if(o.indexOf(e)==-1){o.push(e);s.animations+=y.json.bufferViews[e].byteLength}}for(let e=0;e<y.json.animations[i].channels.length;e++){a+="<tr>";a+="  <td> Anim "+i+": "+y.json.animations[i].name+"</td>";a+="  <td>"+y.nodes[y.json.animations[i].channels[e].target.node].name+"</td>";a+="  <td>";a+=y.json.animations[i].channels[e].target.path+" ";a+="  </td>";const b=y.json.animations[i].channels[e].sampler;const v=y.json.animations[i].samplers[b];a+="  <td>"+v.interpolation+"</td>";a+="  <td>"+y.json.accessors[v.output].count;l+=y.json.accessors[v.output].count;a+="</td>";a+="</tr>"}}a+="<tr>";a+="  <td></td>";a+="  <td></td>";a+="  <td></td>";a+="  <td></td>";a+="  <td>"+l+" total</td>";a+="</tr>";a+="</table>"}else{}let u=0;if(y.json.images)u=y.json.images.length;a+='<div id="groupImages">Images ('+u+")</div>";if(y.json.images){a+='<table id="sectionImages" class="table treetable">';a+="<tr>";a+="  <th>name</th>";a+="  <th>type</th>";a+="  <th>func</th>";a+="</tr>";s.images=0;for(let t=0;t<y.json.images.length;t++){if(y.json.images[t].hasOwnProperty("bufferView")){s.images+=y.json.bufferViews[y.json.images[t].bufferView].byteLength}else console.log("image has no bufferview?!");a+="<tr>";a+="<td>"+y.json.images[t].name+"</td>";a+="<td>"+y.json.images[t].mimeType+"</td>";a+="<td>";let e=y.json.images[t].name;if(e===undefined)e=y.json.images[t].bufferView;a+="<a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeTexture('"+e+'\')" class="treebutton">Expose</a>';a+="</td>";a+="<tr>"}a+="</table>"}let h=0;if(y.json.cameras)h=y.json.cameras.length;a+='<div id="groupCameras">Cameras ('+h+")</div>";if(y.json.cameras){a+='<table id="sectionCameras" class="table treetable">';a+="<tr>";a+="  <th>name</th>";a+="  <th>type</th>";a+="  <th>info</th>";a+="</tr>";for(let e=0;e<y.json.cameras.length;e++){a+="<tr>";a+="<td>"+y.json.cameras[e].name+"</td>";a+="<td>"+y.json.cameras[e].type+"</td>";a+="<td>";if(y.json.cameras[e].perspective){a+="yfov: "+Math.round(y.json.cameras[e].perspective.yfov*100)/100;a+=", ";a+="zfar: "+Math.round(y.json.cameras[e].perspective.zfar*100)/100;a+=", ";a+="znear: "+Math.round(y.json.cameras[e].perspective.znear*100)/100}a+="</td>";a+="<tr>"}a+="</table>"}let c=0;if(y.json.skins)c=y.json.skins.length;a+='<div id="groupSkins">Skins ('+c+")</div>";if(y.json.skins){a+='<table id="sectionSkins" class="table treetable">';a+="<tr>";a+="  <th>name</th>";a+="  <th></th>";a+="  <th>total joints</th>";a+="</tr>";for(let e=0;e<y.json.skins.length;e++){a+="<tr>";a+="<td>"+y.json.skins[e].name+"</td>";a+="<td>"+"</td>";a+="<td>"+y.json.skins[e].joints.length+"</td>";a+="<td>";a+="</td>";a+="<tr>"}a+="</table>"}if(y.timing){a+='<div id="groupTiming">Debug Loading Timing </div>';a+='<table id="sectionTiming" class="table treetable">';a+="<tr>";a+="  <th>task</th>";a+="  <th>time used</th>";a+="</tr>";let e=0;for(let e=0;e<y.timing.length-1;e++){a+="<tr>";a+="  <td>"+y.timing[e][0]+"</td>";a+="  <td>"+(y.timing[e+1][1]-y.timing[e][1])+" ms</td>";a+="</tr>"}a+="</table>"}let f=0;if(y.json.buffers)f=y.json.buffers[0].byteLength;a+='<div id="groupBinary">File Size Allocation ('+Math.round(f/1024)+"k )</div>";a+='<table id="sectionBinary" class="table treetable">';a+="<tr>";a+="  <th>name</th>";a+="  <th>size</th>";a+="  <th>%</th>";a+="</tr>";let d=f;for(let e in s){a+="<tr>";a+="<td>"+e+"</td>";a+="<td>"+Y(s[e])+" </td>";a+="<td>"+Math.round(s[e]/f*100)+"% </td>";a+="<tr>";d-=s[e]}if(d!=0){a+="<tr>";a+="<td>unknown</td>";a+="<td>"+Y(d)+" </td>";a+="<td>"+Math.round(d/f*100)+"% </td>";a+="<tr>"}a+="</table>";a+="</div>";A=new CABLES.UI.Tab("GLTF "+CABLES.basename(S.get()),{icon:"cube",infotext:"tab_gltf",padding:true,singleton:true});gui.mainTabs.addTab(A,true);A.addEventListener("close",I);A.html(a);CABLES.UI.Collapsable.setup(ele.byId("groupNodes"),ele.byId("sectionNodes"),false);CABLES.UI.Collapsable.setup(ele.byId("groupMaterials"),ele.byId("materialtable"),true);CABLES.UI.Collapsable.setup(ele.byId("groupAnims"),ele.byId("sectionAnim"),true);CABLES.UI.Collapsable.setup(ele.byId("groupMeshes"),ele.byId("meshestable"),true);CABLES.UI.Collapsable.setup(ele.byId("groupCameras"),ele.byId("sectionCameras"),true);CABLES.UI.Collapsable.setup(ele.byId("groupImages"),ele.byId("sectionImages"),true);CABLES.UI.Collapsable.setup(ele.byId("groupSkins"),ele.byId("sectionSkins"),true);CABLES.UI.Collapsable.setup(ele.byId("groupBinary"),ele.byId("sectionBinary"),true);CABLES.UI.Collapsable.setup(ele.byId("groupTiming"),ele.byId("sectionTiming"),true);gui.maintabPanel.show(true)}function Y(e){if(e>1024)return Math.round(e/1024)+" kb";if(e>1024*500)return Math.round(e/1024)+" mb";else return e+" bytes"}const W=class{constructor(e){this._mod=null;this._node=e;this._lastTime=0;this._matArr=[];this._m=mat4.create();this._invBindMatrix=mat4.create();this.identity=true}renderFinish(e){e.popModelMatrix();this._mod.unbind()}renderStart(e,t){if(!this._mod){this._mod=new CGL.ShaderModifier(e,T.name+this._node.name);this._mod.addModule({priority:-2,name:"MODULE_VERTEX_POSITION",srcHeadVert:l.skin_head_vert||"",srcBodyVert:l.skin_vert||""});this._mod.addUniformVert("m4[]","MOD_boneMats",[]);const r=vec3.create()}const i=this._node.skin;const n=y.json.skins[i].joints.length*16;{if(this._matArr.length!=n)this._matArr.length=n;for(let e=0;e<y.json.skins[i].joints.length;e++){const s=e*16;const a=y.json.skins[i].joints[e];const o=y.nodes[a];for(let e=0;e<16;e++)this._invBindMatrix[e]=y.accBuffers[y.json.skins[i].inverseBindMatrices][s+e];mat4.mul(this._m,o.modelMatAbs(),this._invBindMatrix);for(let e=0;e<this._m.length;e++)this._matArr[s+e]=this._m[e]}this._mod.setUniformValue("MOD_boneMats",this._matArr);this._lastTime=t}this._mod.define("SKIN_NUM_BONES",y.json.skins[i].joints.length);this._mod.bind();e.pushModelMatrix();if(this.identity)mat4.identity(e.mMatrix)}};const K=class{constructor(e){this.mesh=e;this.tex=null;this.numRowsPerTarget=0;this.makeTex(e.geom)}renderFinish(e){if(!e.gl)return;e.popModelMatrix();this._mod.unbind()}renderStart(e,t){if(!e.gl)return;if(!this._mod){this._mod=new CGL.ShaderModifier(e,"gltftarget");this._mod.addModule({priority:-2,name:"MODULE_VERTEX_POSITION",srcHeadVert:l.targets_head_vert||"",srcBodyVert:l.targets_vert||""});this._mod.addUniformVert("4f","MOD_targetTexInfo",[0,0,0,0]);this._mod.addUniformVert("t","MOD_targetTex",1);this._mod.addUniformVert("f[]","MOD_weights",[]);const i=vec3.create()}this._mod.pushTexture("MOD_targetTex",this.tex);if(this.tex&&this.mesh.weights){this._mod.setUniformValue("MOD_weights",this.mesh.weights);this._mod.setUniformValue("MOD_targetTexInfo",[this.tex.width,this.tex.height,this.numRowsPerTarget,this.mesh.weights.length]);this._mod.define("MOD_NUM_WEIGHTS",Math.max(1,this.mesh.weights.length))}else{this._mod.define("MOD_NUM_WEIGHTS",1)}this._mod.bind();e.pushModelMatrix();if(this.identity)mat4.identity(e.mMatrix)}makeTex(i){if(!m.gl)return;if(!i.morphTargets||!i.morphTargets.length)return;let n=i.morphTargets[0].vertices.length/3;let e=0;this.numRowsPerTarget=0;if(i.morphTargets[0].vertices&&i.morphTargets[0].vertices.length)this.numRowsPerTarget++;if(i.morphTargets[0].vertexNormals&&i.morphTargets[0].vertexNormals.length)this.numRowsPerTarget++;if(i.morphTargets[0].tangents&&i.morphTargets[0].tangents.length)this.numRowsPerTarget++;if(i.morphTargets[0].bitangents&&i.morphTargets[0].bitangents.length)this.numRowsPerTarget++;e=i.morphTargets.length*this.numRowsPerTarget;const r=new Float32Array(n*e*4);let s=0;for(let t=0;t<i.morphTargets.length;t++){if(i.morphTargets[t].vertices&&i.morphTargets[t].vertices.length){for(let e=0;e<i.morphTargets[t].vertices.length;e+=3){r[(s*n+e/3)*4+0]=i.morphTargets[t].vertices[e+0];r[(s*n+e/3)*4+1]=i.morphTargets[t].vertices[e+1];r[(s*n+e/3)*4+2]=i.morphTargets[t].vertices[e+2];r[(s*n+e/3)*4+3]=1}s++}if(i.morphTargets[t].vertexNormals&&i.morphTargets[t].vertexNormals.length){for(let e=0;e<i.morphTargets[t].vertexNormals.length;e+=3){r[(s*n+e/3)*4+0]=i.morphTargets[t].vertexNormals[e+0];r[(s*n+e/3)*4+1]=i.morphTargets[t].vertexNormals[e+1];r[(s*n+e/3)*4+2]=i.morphTargets[t].vertexNormals[e+2];r[(s*n+e/3)*4+3]=1}s++}if(i.morphTargets[t].tangents&&i.morphTargets[t].tangents.length){for(let e=0;e<i.morphTargets[t].tangents.length;e+=3){r[(s*n+e/3)*4+0]=i.morphTargets[t].tangents[e+0];r[(s*n+e/3)*4+1]=i.morphTargets[t].tangents[e+1];r[(s*n+e/3)*4+2]=i.morphTargets[t].tangents[e+2];r[(s*n+e/3)*4+3]=1}s++}if(i.morphTargets[t].bitangents&&i.morphTargets[t].bitangents.length){for(let e=0;e<i.morphTargets[t].bitangents.length;e+=3){r[(s*n+e/3)*4+0]=i.morphTargets[t].bitangents[e+0];r[(s*n+e/3)*4+1]=i.morphTargets[t].bitangents[e+1];r[(s*n+e/3)*4+2]=i.morphTargets[t].bitangents[e+2];r[(s*n+e/3)*4+3]=1}s++}}this.tex=new CGL.Texture(m,{isFloatingPointTexture:true,name:"targetsTexture"});this.tex.initFromData(r,n,e,CGL.Texture.FILTER_LINEAR,CGL.Texture.WRAP_REPEAT)}};const Q=T.inTrigger("Render"),t=T.inString("data"),S=T.inUrl("glb File",[".glb"]),Z=T.inBool("Draw",true),i=T.inDropDown("Camera",["None"],"None"),n=T.inString("Animation",""),J=T.inTriggerButton("Show Structure"),r=T.inSwitch("Center",["None","XYZ","XZ"],"XYZ"),s=T.inBool("Rescale",true),a=T.inFloat("Rescale Size",2.5),u=T.inFloat("Time"),h=T.inBool("Sync to timeline",false),$=T.inBool("Loop",true),ee=T.inSwitch("Normals Format",["XYZ","X-ZY"],"XYZ"),te=T.inSwitch("Vertices Format",["XYZ","XZ-Y"],"XYZ"),c=T.inSwitch("Calc Normals",["Auto","Force Smooth","Never"],"Auto"),f=T.inObject("Materials"),ie=T.inArray("Hide Nodes"),ne=T.inBool("Use Material Properties",false),d=T.inBool("Active",true),re=T.outTrigger("Render Before"),g=T.outTrigger("Next"),se=T.outString("Generator"),ae=T.outNumber("GLTF Version"),oe=T.outArray("GLTF Extensions Used"),le=T.outNumber("Anim Length",0),ue=T.outNumber("Anim Time",0),he=T.outObject("Json"),ce=T.outArray("Anims"),fe=T.outArray("BoundingPoints"),de=T.outObject("Bounds"),ge=T.outTrigger("Finished"),me=T.outBool("Loading");T.setPortGroup("Timing",[u,h,$]);let m=T.patch.cg||T.patch.cgl;let p=null;let pe=false;let _e=0;let _=false;let b=null;let be=[];let y=null;let v=0;let C={};let R=0;let N=true;let ve=null;let M=null;let P=null;const Ae=vec3.create();let Te=0;let Ee=false;const w=vec3.create();S.onChange=te.onChange=c.onChange=ee.onChange=L;J.onTriggered=e;t.onChange=Me;ie.onChange=Ne;n.onChange=we;r.onChange=Oe;T.toWorkPortsNeedToBeLinked(Q);t.setUiAttribs({hideParam:true,hidePort:true});T.setPortGroup("Transform",[s,a,r]);function xe(){const t=["None"];if(y){for(let e=0;e<y.nodes.length;e++){if(y.nodes[e].camera>=0){t.push(y.nodes[e].name)}}}i.uiAttribs.values=t}function Oe(){Ee=r.get()!="None";if(y&&y.bounds){w.set(y.bounds.center);w[0]=-w[0];w[1]=-w[1];w[2]=-w[2];if(r.get()=="XZ")w[1]=-y.bounds.minY}}s.onChange=function(){a.setUiAttribs({greyout:!s.get()})};f.onChange=function(){N=true};T.onDelete=function(){I()};h.onChange=function(){u.setUiAttribs({greyout:h.get()})};i.onChange=Ie;function Ie(){b=null;if(!y)return;for(let e=0;e<y.nodes.length;e++){if(y.nodes[e].name==i.get())b=new k(y,y.nodes[e])}}Q.onTriggered=function(){m=T.patch.cg||T.patch.cgl;if(!_)return;if(!d.get())return;if(pe){if(!p)p=CGL.MESHES.getSimpleCube(m,"ErrorCube");p.render(m.getShader())}_e=0;if(h.get())R=T.patch.timer.getTime();else R=Math.max(0,u.get());if($.get()){R%=v;if(R<Te)ge.trigger()}else{if(v>0&&R>=v)ge.trigger()}Te=R;m.pushModelMatrix();ue.set(R||0);if(_&&y&&y.bounds){if(s.get()){let e=a.get()/y.bounds.maxAxis;y.scale=e;vec3.set(Ae,e,e,e);mat4.scale(m.mMatrix,m.mMatrix,Ae)}if(Ee){mat4.translate(m.mMatrix,m.mMatrix,w)}}let e=m.tempData.currentScene||null;m.tempData.currentScene=y;re.trigger();if(_){if(N)Ce();if(b)b.start(R);if(y){y.time=R;if(y.bounds&&m.shouldDrawHelpers(T)){if(T.isCurrentUiOp())m.pushShader(CABLES.GL_MARKER.getSelectedShader(m));else m.pushShader(CABLES.GL_MARKER.getDefaultShader(m));y.bounds.render(m,null,T);m.popShader()}if(Z.get()){for(let e=0;e<y.nodes.length;e++)if(!y.nodes[e].isChild)y.nodes[e].render(m)}else{for(let e=0;e<y.nodes.length;e++)if(!y.nodes[e].isChild)y.nodes[e].render(m,false,true)}}}g.trigger();m.tempData.currentScene=e;m.popModelMatrix();if(b)b.end()};function Se(){if(!y){_=true;pe=true;m.patch.loading.finished(M);T.setUiError("nogltf","GLTF File not found");return}T.setUiError("nogltf",null);if(y.loadingMeshes>0){setTimeout(Se,100);return}y.timing.push(["finishLoading()",Math.round(performance.now()-y.startTime)]);N=true;y.bounds=new CABLES.CG.BoundingBox;y.timing.push(["start calc bounds",Math.round(performance.now()-y.startTime)]);for(let e=0;e<y.nodes.length;e++){const t=y.nodes[e];t.updateMatrix();if(!t.isChild)t.calcBounds(y,null,y.bounds)}if(y.bounds)de.setRef(y.bounds);y.timing.push(["calced bounds",Math.round(performance.now()-y.startTime)]);Ne();y.timing.push(["hideNodesFromData",Math.round(performance.now()-y.startTime)]);if(A)e();y.timing.push(["printinfo",Math.round(performance.now()-y.startTime)]);xe();Ie();fe.set(be);if(y){if(S.get()&&!S.get().startsWith("data:")){T.setUiAttrib({extendTitle:CABLES.basename(S.get())})}y.loaded=Date.now()}if(y){for(let e=0;e<y.nodes.length;e++){if(!y.nodes[e].isChild){y.nodes[e].render(m,false,true,true,false,true,0)}}for(let e=0;e<y.nodes.length;e++){const t=y.nodes[e];t.children=CABLES.uniqueArray(t.children)}}Oe();we();me.set(false);m.patch.loading.finished(M);M=null;if(y.accBuffersDelete){for(let e=0;e<y.accBuffersDelete.length;e++){y.accBuffers[y.accBuffersDelete[e]]=null}}if(!(y.json.images&&y.json.images.length))y.chunks=null;_=true}function ye(e){if(!d.get())return;if(!M)M=m.patch.loading.start("gltfScene",S.get(),T);let t=S.get();if(!t||t=="null")return;let i=T.patch.getFilePath(String(S.get()));if(!i)return;if(S.get()&&!S.get().startsWith("data:")){if(e===true)i+="?rnd="+CABLES.generateUUID()}N=true;me.set(true);fetch(i).then(e=>{return e.arrayBuffer()}).then(e=>{if(S.get()!=t){m.patch.loading.finished(M);M=null;return}be=[];v=0;y=B(e);e=null;Se()}).catch(e=>{if(M)m.patch.loading.finished(M);M=null;Se();T.logError("gltf fetch error",e)});I();const n=new XMLHttpRequest;n.open("GET",i,true);n.responseType="arraybuffer";m.patch.loading.addAssetLoadingTask(()=>{})}T.onFileChanged=function(e){if(S.get()&&S.get().indexOf(e)>-1){L(true)}};d.onChange=()=>{if(d.get())L();if(!d.get()){y=null}};function L(e){clearTimeout(ve);ve=setTimeout(function(){ye(e)},30)}function Ce(){if(!y)return;y.shaders={};if(f.links.length==1&&f.get()){N=true;const i=f.links[0].portOut.op;const n=i.getPort("Shader");const r=i.getPort("Material Name");if(!n&&!r){const s=f.get();for(let t in s){if(s[t]&&y.json.materials)for(let e=0;e<y.json.materials.length;e++){if(y.json.materials[e].name==t){if(y.shaders[e]){i.warn("double material assignment:",name)}y.shaders[e]=s[t]}}}}}if(f.get()){for(let e=0;e<f.links.length;e++){const t=f.links[e].portOut.op;const n=t.getPort("Shader");const r=t.getPort("Material Name");if(n&&r&&n.get()){const name=r.get();if(y.json.materials)for(let e=0;e<y.json.materials.length;e++)if(y.json.materials[e].name==name){if(y.shaders[e]){t.warn("double material assignment:",name)}y.shaders[e]=n.get()}}}}N=false;if(A)e()}function Re(){const t=ie.get();if(!y||!P||!P.hiddenNodes)return;if(!t){return}for(let e=0;e<t.length;e++){const i=y.getNode(t[e]);if(i)i.hidden=true}}function Ne(){if(!P)Me();if(!y)return;y.unHideAll();if(P&&P.hiddenNodes){for(const e in P.hiddenNodes){const t=y.getNode(e);if(t)t.hidden=true;else T.verbose("node to be hidden not found",e,t)}}Re()}function Me(){P=t.get();if(!P||P==="")P={};else P=JSON.parse(P);if(y)Ne();return P}function Pe(){t.set(JSON.stringify(P))}function we(){if(y&&y.nodes){for(let e=0;e<y.nodes.length;e++){y.nodes[e].setAnimAction(n.get())}const e=n.get()||Object.keys(C)[0];v=C[e]||-1;le.set(v)}}function Le(t,i){for(let e=0;e<y.nodes.length;e++){if(y.nodes[e].children.indexOf(i)>=0){t.push(y.nodes[e]);if(y.nodes[e].isChild)Le(t,e)}}}T.exposeTexture=function(e){const t=gui.corePatch().addOp("Ops.Gl.GLTF.GltfTexture");t.getPort("Name").set(e);D(t,1);T.patch.link(T,g.name,t,"Render");gui.patchView.testCollision(t);gui.patchView.centerSelectOp(t.id,true)};T.exposeGeom=function(e,t){const i=gui.corePatch().addOp("Ops.Gl.GLTF.GltfGeometry");i.getPort("Name").set(e);i.getPort("Submesh").set(t);D(i,1);T.patch.link(T,g.name,i,"Update");gui.patchView.testCollision(i);gui.patchView.centerSelectOp(i.id,true)};function D(e,t){t=t||1;e.setUiAttrib({subPatch:T.uiAttribs.subPatch,translate:{x:T.uiAttribs.translate.x,y:T.uiAttribs.translate.y+t*CABLES.GLUI.glUiConfig.newOpDistanceY}})}T.exposeNode=function(i,e,n){let t=e=="hierarchy";if(t){let r=[];for(let e=0;e<y.nodes.length;e++){if(y.nodes[e].name==i){let t=[];const s=y.nodes[e];Le(t,e);t=t.reverse();t.push(s,s);let i=g.name;let n=T;for(let e=0;e<t.length;e++){const a=gui.corePatch().addOp("Ops.Gl.GLTF.GltfNode_v2");a.getPort("Node Name").set(t[e].name);T.patch.link(n,i,a,"Render");D(a,e);if(e==t.length-1){a.getPort("Transformation").set(false)}else{a.getPort("Draw Mesh").set(false);a.getPort("Draw Childs").set(false)}i="Next";n=a;r.push(a);gui.patchView.testCollision(a)}}}for(let e=0;e<r.length;e++){r[e].selectChilds()}}else{let t="Ops.Gl.GLTF.GltfNode_v2";if(n&&n.skin)t="Ops.Gl.GLTF.GltfSkin";if(e=="transform")t="Ops.Gl.GLTF.GltfNodeTransform_v2";gui.serverOps.loadOpLibs(t,()=>{let e=gui.corePatch().addOp(t);e.getPort("Node Name").set(i);D(e);T.patch.link(T,g.name,e,"Render");gui.patchView.testCollision(e);gui.patchView.centerSelectOp(e.id,true)})}gui.closeModal()};T.assignMaterial=function(e){const t=gui.corePatch().addOp("Ops.Gl.GLTF.GltfSetMaterial");t.getPort("Material Name").set(e);T.patch.link(T,f.name,t,"Material");D(t);gui.patchView.testCollision(t);gui.patchView.centerSelectOp(t.id,true);gui.closeModal()};T.toggleNodeVisibility=function(e){const t=y.getNode(e);t.hidden=!t.hidden;P.hiddenNodes=P.hiddenNodes||{};if(t)if(t.hidden)P.hiddenNodes[e]=true;else delete P.hiddenNodes[e];Pe()}}};CABLES.OPS["c9cbb226-46f7-4ca6-8dab-a9d0bdca4331"]={f:Ops.Gl.GLTF.GltfScene_v4,objName:"Ops.Gl.GLTF.GltfScene_v4"};Ops.Ui.Area=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("Title",""),n=e.inTriggerButton("Delete");i.setUiAttribs({hidePort:true});e.setUiAttrib({hasArea:true});e.init=i.onChange=e.onLoaded=r;r();function r(){if(CABLES.UI){gui.savedState.setUnSaved("areaOp",e.getSubPatch());e.uiAttr({comment_title:i.get()||" "});e.name=i.get()}}n.onTriggered=()=>{e.patch.deleteOp(e.id)}}};CABLES.OPS["38f79614-b0de-4960-8da5-2827e7f43415"]={f:Ops.Ui.Area,objName:"Ops.Ui.Area"};Ops.Json.SwitchObject=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inValueInt("Object Index",0);const n=i.outObject("object out");const r=8;const s=[];i.onLoaded=function(){a()};t.onChange=a;for(let t=0;t<r;t++){let e=i.inObject("object port "+t);e.inputNum=t;e.onChange=o.bind(e);s[t]=e}function a(){let e=Math.max(0,Math.floor(t.get()));if(e<0)e=0;else if(e>r-1)e=r-1;n.setRef(s[e].get())}function o(){if(this.inputNum!=t.get())return;n.setRef(this.get())}}};CABLES.OPS["345d535e-267d-49fb-98c0-c8a8f9424160"]={f:Ops.Json.SwitchObject,objName:"Ops.Json.SwitchObject"};Ops.Array.ArrayPack=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={};const s=r.outArray("Result");const a=8;const o=[];let l=false;for(let t=0;t<a;t++){let e=r.inArray("Array "+t);e.onChange=i;o.push(e)}function i(){const t=[];const i=[];let n=0;for(n=0;n<a;n++){let e=o[n].get();if(e){i.push(e);if(e.length!=i[0].length){if(!l)r.setUiError("arraylen","Arrays do not have the same length !");s.set(null);l=true;return}}}if(i.length===0){if(!l)r.setUiError("invalid","No Valid Arrays");s.set(null);l=true;return}if(l){r.setUiError("arraylen",null);r.setUiError("invalid",null)}l=false;for(let e=0;e<i[0].length;e++)for(n=0;n<i.length;n++)t.push(i[n][e]);s.setRef(t)}}};CABLES.OPS["51df396d-87be-4890-8fbd-c8bb3d364d3b"]={f:Ops.Array.ArrayPack,objName:"Ops.Array.ArrayPack"};Ops.Boolean.Boolean=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inBool("value",false),n=e.outBoolNum("result");n.set(false);i.onChange=r;function r(){if(n.get()!=i.get())n.set(i.get())}}};CABLES.OPS["83e2d74c-9741-41aa-a4d7-1bda4ef55fb3"]={f:Ops.Boolean.Boolean,objName:"Ops.Boolean.Boolean"};Ops.Gl.Textures.TextTexture_v6=class extends CABLES.Op{constructor(){super(...arguments);const p=this;const s=p.attachments={text_frag:"{{MODULES_HEAD}}\n\nUNI sampler2D tex;\nUNI float a;\nUNI vec4 color;\nIN vec2 texCoord;\n\nvoid main()\n{\n\n    vec4 col=texture(tex,vec2(texCoord.x,(1.0-texCoord.y)));\n\n    {{MODULE_COLOR}}\n\n    outColor=col;\n}\n",text_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\nUNI float aspect;\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n    vec4 pos=vec4(vPosition,  1.0);\n\n    pos.x*=aspect;\n\n    texCoord=vec2(attrTexCoord.x,1.0-attrTexCoord.y);;\n\n    mat4 mMatrix=modelMatrix;\n\n    {{MODULE_VERTEX_POSITION}}\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n"};const e=p.inTriggerButton("Render"),Y=p.inString("text","cables"),t=p.inValueBool("Draw Mesh",true),i=p.inValueFloat("Scale Mesh",.5),_=p.inSwitch("Size",["Auto","Manual"],"Auto"),b=p.inInt("Width",512),v=p.inInt("Height",512),A=p.inBool("Auto Height",true),T=p.inBool("Auto Line Breaks",true),E=p.inString("font","Arial"),x=p.inString("weight","normal"),O=p.inValueFloat("fontSize",300),I=p.inSwitch("align",["left","center","right"],"center"),S=p.inSwitch("Vertical align",["Top","Middle","Bottom"],"Top"),y=p.inFloat("Letter Spacing",0),C=p.inFloat("Line Height Add",0),W=p.inInt("Padding Y Top",3),K=p.inInt("Padding Y Bottom",3),Q=p.inInt("Padding X",0),R=p.inSwitch("filter",["nearest","linear","mipmap"],"linear"),N=p.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"clamp to edge"),M=p.inSwitch("Anisotropic",[0,1,2,4,8,16],0),P=p.inValueBool("Reuse Texture",true),Z=p.inBool("Show Debug",false),a=p.inBool("Redraw On Font Load",true),w=p.inValueSlider("r",1),L=p.inValueSlider("g",1),D=p.inValueSlider("b",1),k=p.inFloatSlider("Opacity",1),U=p.inValueSlider("background R",0),J=p.inValueSlider("background G",0),$=p.inValueSlider("background B",0),ee=p.inValueSlider("background A",1),o=p.inTriggerButton("Force Redraw"),l=p.outTrigger("Next"),te=p.outNumber("Ratio"),V=p.outTexture("texture"),u=p.outObject("Canvas",null,"element"),h=p.outNumber("Aspect",1),ie=p.outNumber("Num Lines");const F=" ";w.setUiAttribs({colorPick:true});U.setUiAttribs({colorPick:true});p.toWorkPortsNeedToBeLinked(e);p.setPortGroup("Text Color",[w,L,D,k]);p.setPortGroup("Background",[U,J,$,ee]);p.setPortGroup("Font",[E,x,O,I,S,y,C]);p.setPortGroup("Texture",[N,R,M,P,Z]);p.setPortGroup("Rendering",[t,i]);e.onLinkChanged=()=>{if(!e.isLinked())V.setRef(CGL.Texture.getEmptyTexture(j));else V.setRef(B)};o.onTriggered=w.onChange=L.onChange=D.onChange=k.onChange=S.onChange=T.onChange=A.onChange=C.onChange=_.onChange=b.onChange=v.onChange=I.onChange=y.onChange=W.onChange=K.onChange=Q.onChange=Y.onChange=O.onChange=x.onChange=M.onChange=E.onChange=Z.onChange=P.onChange=function(){q=true;ue()};V.ignoreValueSerialize=true;const j=p.patch.cgl;let B=new CGL.Texture(j);let G=2;let z=2;const H=document.createElement("canvas");H.id="texturetext_"+CABLES.generateUUID();H.style.display="none";document.body.appendChild(H);H.style.letterSpacing="0px";u.setRef(H);let X=H.getContext("2d");let q=true;const c=CGL.MESHES.getSimpleRect(j,"texttexture rect");const n=vec3.create();const r=new CGL.Shader(j,"texttexture");r.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);r.setSource(s.text_vert,s.text_frag);const f=new CGL.Uniform(r,"t","tex");const d=new CGL.Uniform(r,"f","aspect",0);const g=new CGL.Uniform(r,"f","a",k);const m=new CGL.Uniform(r,"4f","color",w,L,D,k);if(p.patch.isEditorMode())CABLES.UI.SIMPLEWIREFRAMERECT=CABLES.UI.SIMPLEWIREFRAMERECT||new CGL.WireframeRect(j);e.onTriggered=se;t.onChange=ue;ue();p.on("delete",()=>{X=null;H.remove()});M.onChange=R.onChange=N.onChange=()=>{if(B)B.delete();B=null;q=true};U.onChange=J.onChange=$.onChange=ee.onChange=w.onChange=L.onChange=D.onChange=k.onChange=()=>{if(!t.get()||V.isLinked())q=true};V.onLinkChanged=()=>{if(V.isLinked())q=true};p.patch.on("fontLoaded",e=>{if(e==E.get())q=true});document.fonts.ready.then(()=>{if(a.get())q=true});document.fonts.onloadingdone=function(e){if(a.get())q=true};function ne(){return z}function re(){return G}function se(){let e=0;while(q&&e<10){ae();le();e++}if(t.get()){n[0]=n[1]=n[2]=i.get();j.pushBlendMode(CGL.BLEND_NORMAL,false);j.pushModelMatrix();mat4.scale(j.mMatrix,j.mMatrix,n);r.popTextures();r.pushTexture(f,B.tex);d.set(h.get());if(j.shouldDrawHelpers(p))CABLES.UI.SIMPLEWIREFRAMERECT.render(h.get(),1,1);j.pushShader(r);c.render(p.patch.cg.getShader());j.popShader();j.popBlendMode();j.popModelMatrix()}l.trigger()}function ae(){if(B)B.setSize(ne(),re());X.canvas.width=H.width=ne();X.canvas.height=H.height=re();h.set(H.width/H.height);q=true}function oe(i){let n="";for(let e=0;e<i.length;e++){if(!i[e]){n+="\n";continue}let t=0;const r=i[e].split(F);for(let e=0;e<r.length;e++){if(!r[e])continue;t+=X.measureText(r[e]+F).width;if(t>b.get()){n+="\n"+r[e]+F;t=X.measureText(r[e]+F).width}else{n+=r[e]+F}}n+="\n"}let e=n;i=e.split("\n");if(i[i.length-1]=="")i.pop();return i}function le(){j.checkFrameStarted("texttrexture refresh");const e="rgba("+Math.floor(U.get()*255)+","+Math.floor(J.get()*255)+","+Math.floor($.get()*255)+","+ee.get()+")";X.fillStyle=e;X.fillRect(0,0,X.canvas.width,X.canvas.height);const t="rgba("+Math.floor(w.get()*255)+","+Math.floor(L.get()*255)+","+Math.floor(D.get()*255)+","+k.get()+")";X.fillStyle=t;let i=parseFloat(O.get());let n=E.get();if(n.indexOf(F)>-1)n='"'+n+'"';X.font=x.get()+F+i+"px "+n+"";X.textBaseline="top";X.textAlign=I.get();X.letterSpacing=y.get()+"px";let r=(Y.get()+"").replace(/<br\/>/g,"\n");r=r.trim();let s=r.split("\n");q=false;let a=Math.max(0,W.get());let o=Math.max(0,K.get());let l=Math.max(0,Q.get());z=0;G=0;if(T.get()&&_.get()=="Manual"){if(b.get()>128){s=oe(s)}}const u=[];for(let e=0;e<s.length;e++){const m=X.measureText(s[e]);u[e]=Math.ceil(m.fontBoundingBoxAscent)+Math.ceil(m.fontBoundingBoxDescent)+C.get()}for(let e=0;e<s.length;e++){const m=X.measureText(s[e]);z=Math.max(z,Math.ceil(m.width));G+=u[e]}z+=l*2;if(C.get()<0)G+=C.get()/2*-1;let h=G;if(_.get()=="Manual"){z=b.get()+l*2;if(!A.get()){G=v.get()}}G=Math.ceil(G);z=Math.ceil(z);if(z>j.maxTexSize||G>j.maxTexSize)p.setUiError("textoobig","Texture too big!");else p.setUiError("textoobig",null);G=Math.min(j.maxTexSize,G);z=Math.min(j.maxTexSize,z);let c=0;if(S.get()=="Middle")c=(G-h)/2;else if(S.get()=="Bottom")c=G-h;c+=a;G+=a+o;if(X.canvas.width!=z||X.canvas.height!=G)ae();const f=Z.get();for(let t=0;t<s.length;t++){let e=0+l;if(I.get()=="center")e=X.canvas.width/2;if(I.get()=="right")e=X.canvas.width-l;if(_.get()=="Manual")e+=y.get();X.fillText(s[t],e,c);if(f){X.lineWidth=3;X.strokeStyle="#FF0000";X.beginPath();X.moveTo(0,c);X.lineTo(X.canvas.width,c);X.stroke()}c+=u[t]}let d=CGL.Texture.WRAP_REPEAT;if(N.get()=="mirrored repeat")d=CGL.Texture.WRAP_MIRRORED_REPEAT;else if(N.get()=="clamp to edge")d=CGL.Texture.WRAP_CLAMP_TO_EDGE;let g=CGL.Texture.FILTER_LINEAR;if(R.get()=="nearest")g=CGL.Texture.FILTER_NEAREST;else if(R.get()=="mipmap")g=CGL.Texture.FILTER_MIPMAP;if(!P.get()||!B||!V.get()||B.width!=H.width||B.height!=H.height||B.anisotropic!=parseFloat(M.get())){if(B)B.delete();B=new CGL.Texture.createFromImage(j,H,{filter:g,anisotropic:parseFloat(M.get()),wrap:d})}B.unpackAlpha=false;B.flip=false;B.initTexture(H,g);te.set(X.canvas.height/X.canvas.width);ie.set(s.length);V.setRef(B)}function ue(){b.setUiAttribs({greyout:_.get()!="Manual"});v.setUiAttribs({greyout:_.get()!="Manual"||A.get()});T.setUiAttribs({greyout:_.get()!="Manual"});S.setUiAttribs({greyout:_.get()!="Manual"});A.setUiAttribs({greyout:_.get()!="Manual"});i.setUiAttribs({greyout:!t.get()})}}};CABLES.OPS["2c042efa-3604-4717-b8f4-5ad08d6740e5"]={f:Ops.Gl.Textures.TextTexture_v6,objName:"Ops.Gl.Textures.TextTexture_v6"};Ops.Gl.Textures.EmptyTexture=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("width",8);const n=e.inValue("height",8);const r=e.outTexture("texture");const s=e.patch.cgl;const a=new CGL.Texture(s);i.onChange=o;n.onChange=o;o();function o(){a.setSize(i.get(),n.get());r.set(a)}}};CABLES.OPS["fc124913-0916-4f5c-83e0-702ddf66420c"]={f:Ops.Gl.Textures.EmptyTexture,objName:"Ops.Gl.Textures.EmptyTexture"};Ops.Gl.Shader.ShaderToTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Render"),n=e.inObject("Shader",null,"shader"),a=e.inSwitch("Size",["Canvas","Manual"],"Manual"),o=e.inValueInt("Width",512),l=e.inValueInt("Height",512),u=e.inValueSelect("filter",["nearest","linear","mipmap"]),h=e.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),c=e.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),f=e.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),d=e.inSwitch("Num Textures",["1","4"],"1"),r=e.outTrigger("Next"),s=e.outTexture("Texture"),g=e.outTexture("Texture 2"),m=e.outTexture("Texture 3"),p=e.outTexture("Texture 4");e.setPortGroup("Texture Size",[a,o,l]);e.setPortGroup("Texture settings",[u,c,f,h]);let _=1;const b=e.patch.cgl;const v=[0,0,0,0];const A=null;const T=[];let E=null;let x=null;o.onChange=l.onChange=f.onChange=u.onChange=d.onChange=h.onChange=c.onChange=M;a.onChange=N;const O=false;let I=null;const S=null;let y=true;const C=CGL.MESHES.getSimpleRect(b,"shader2texture rect");e.toWorkPortsNeedToBeLinked(n);u.set("nearest");N();function R(){if(u.get()=="mipmap"&&S&&S.isFloatingPoint()){e.setUiError("warning","HDR and mipmap filtering at the same time is not possible")}else{e.setUiError("warning",null)}}function N(){h.setUiAttribs({greyout:u.get()!="mipmap"});o.setUiAttribs({greyout:a.get()=="Canvas"});l.setUiAttribs({greyout:a.get()=="Canvas"})}function M(){y=true;R();N()}function P(){if(x)x.dispose();E=null;x=null}function w(){y=false;if(I)I.delete();const e=T.length;_=parseInt(d.get());T.length=0;for(let e=0;e<_;e++)T[e]=true;if(e!=T.length){P()}I=null;let t=o.get();let i=l.get();if(a.get()=="Canvas"){t=b.canvasWidth;i=b.canvasHeight}let n=CGL.Texture.FILTER_NEAREST;if(u.get()=="linear")n=CGL.Texture.FILTER_LINEAR;else if(u.get()=="mipmap")n=CGL.Texture.FILTER_MIPMAP;let r=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(c.get()=="repeat")r=CGL.Texture.WRAP_REPEAT;if(c.get()=="mirrored repeat")r=CGL.Texture.WRAP_MIRRORED_REPEAT;const s=Math.min(b.maxAnisotropic,parseFloat(h.get()));if(b.glVersion>=2){I=new CGL.Framebuffer2(b,t,i,{anisotropic:s,pixelFormat:f.get(),multisampling:false,numRenderBuffers:_,wrap:r,filter:n,depth:true,multisamplingSamples:0,clear:true})}else{I=new CGL.Framebuffer(b,o.get(),l.get(),{isFloatingPointTexture:inFloatingPoint.get(),filter:n,wrap:r})}}i.onTriggered=function(){if(!I||y)w();if(a.get()=="Manual"&&(I.getTextureColor().width!=o.get()||I.getTextureColor().height!=l.get())){w()}else if(a.get()=="Canvas"&&I&&(I.getTextureColor().width!=b.canvasWidth||I.getTextureColor().height!=b.canvasHeight))w();if(!n.get()||!n.get().setDrawBuffers)return;if(n.get()!=E){E=n.get();x=n.get().copy();x.setDrawBuffers(T)}if(!x){s.set(null);return}b.pushViewPort(0,0,o.get(),l.get());I.renderStart(b);b.pushPMatrix();mat4.identity(b.pMatrix);b.pushViewMatrix();mat4.identity(b.vMatrix);b.pushModelMatrix();mat4.identity(b.mMatrix);b.pushShader(n.get());if(x.bindTextures)x.bindTextures();b.pushBlend(false);C.render(n.get());b.popBlend();b.popPMatrix();b.popModelMatrix();b.popViewMatrix();I.renderEnd(b);if(_>=2){s.setRef(I.getTextureColorNum(0));g.setRef(I.getTextureColorNum(1));m.setRef(I.getTextureColorNum(2));p.setRef(I.getTextureColorNum(3))}else s.setRef(I.getTextureColor());b.popShader();b.popViewPort();r.trigger()}}};CABLES.OPS["eb40e0e0-761b-4ce7-987a-014fff720873"]={f:Ops.Gl.Shader.ShaderToTexture_v2,objName:"Ops.Gl.Shader.ShaderToTexture_v2"};Ops.Gl.Matrix.Camera_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const D=e.attachments={};const t=e.inTrigger("render");const i=e.outTrigger("trigger");const n=e.inBool("Identity",true);const r=e.inValueSelect("projection mode",["prespective","ortogonal"],"prespective");const s=e.inValue("frustum near",.01);const a=e.inValue("frustum far",5e3);const o=e.inValue("fov",45);const l=e.inValueBool("Auto Aspect Ratio",true);const u=e.inValue("Aspect Ratio",1);const h=e.inValue("eye X",0);const c=e.inValue("eye Y",0);const f=e.inValue("eye Z",5);const d=e.inValue("center X",0);const g=e.inValue("center Y",0);const m=e.inValue("center Z",0);const p=e.inValue("truck",0);const _=e.inValue("boom",0);const b=e.inValue("dolly",0);const v=e.inValue("tilt",0);const A=e.inValue("pan",0);const T=e.inValue("roll",0);const E=e.outNumber("Aspect");const k=e.outArray("Look At Array");const x=e.patch.cgl;let O=0;const I=vec3.create();const S=vec3.create();const y=vec3.create();const C=mat4.create();mat4.identity(C);const R=[];const N=vec3.create();const M=mat4.create();mat4.identity(M);let P=true;t.onTriggered=function(){if(x.tempData.shadowPass)return i.trigger();if(!l.get())O=u.get();else O=x.getViewPort()[2]/x.getViewPort()[3];E.set(O);x.pushViewMatrix();if(n.get())mat4.identity(x.vMatrix);if(P){mat4.identity(M);vec3.set(N,p.get(),_.get(),b.get());if(p.get()!==0||_.get()!==0||b.get()!==0)mat4.translate(M,M,N);if(v.get()!==0)mat4.rotateX(M,M,v.get()*CGL.DEG2RAD);if(A.get()!==0)mat4.rotateY(M,M,A.get()*CGL.DEG2RAD);if(T.get()!==0)mat4.rotateZ(M,M,T.get()*CGL.DEG2RAD);P=false}mat4.multiply(x.vMatrix,x.vMatrix,M);x.pushPMatrix();x.pushViewMatrix();if(r.get()=="prespective"){mat4.perspective(x.pMatrix,o.get()*.0174533,O,s.get(),a.get())}else if(r.get()=="ortogonal"){mat4.ortho(x.pMatrix,-1*(o.get()/14),1*(o.get()/14),-1*(o.get()/14)/O,1*(o.get()/14)/O,s.get(),a.get())}R[0]=h.get();R[1]=c.get();R[2]=f.get();R[3]=d.get();R[4]=g.get();R[5]=m.get();R[6]=0;R[7]=1;R[8]=0;k.setRef(R);vec3.set(I,0,1,0);vec3.set(S,h.get(),c.get(),f.get());vec3.set(y,d.get(),g.get(),m.get());mat4.lookAt(C,S,y,I);mat4.multiply(x.vMatrix,x.vMatrix,C);i.trigger();x.popViewMatrix();x.popPMatrix();x.popViewMatrix();if(e.isCurrentUiOp())gui.setTransformGizmo({posX:p,posY:_,posZ:b})};const w=function(){if(!l.get()){u.setUiAttribs({greyout:false})}else{u.setUiAttribs({greyout:true})}};const L=function(){P=true};p.onChange=L;_.onChange=L;b.onChange=L;v.onChange=L;A.onChange=L;T.onChange=L;l.onChange=w;w()}};CABLES.OPS["f7673a93-7772-4ade-9d3d-df7174f5258b"]={f:Ops.Gl.Matrix.Camera_v2,objName:"Ops.Gl.Matrix.Camera_v2"};Ops.Gl.MainLoop_v2=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inFloat("Max Pixel Density (DPR)",2),n=i.inValue("FPS Limit",0),r=i.inValueBool("Reduce FPS unfocussed",false),s=i.inValueBool("Transparent",false),a=i.inValueBool("Active",1),o=i.inValueBool("Focus canvas",1),l=i.outTrigger("trigger"),u=i.outNumber("width"),h=i.outNumber("height"),c=i.outNumber("Pixel Density");i.onAnimFrame=S;t.onChange=x;const f=i.patch.cg=i.patch.cgl;let d=0;let g=0;let m=null;let p=false;if(!i.patch.cgl)i.uiAttr({error:"No webgl cgl context"});const _=vec3.create();vec3.set(_,0,0,0);const b=vec3.create();vec3.set(b,0,0,-2);let v=true;let A=null;let T=true;let E=true;window.addEventListener("blur",()=>{T=false});window.addEventListener("focus",()=>{T=true});document.addEventListener("visibilitychange",()=>{E=!document.hidden});y();i.patch.tempData.mainloopOp=this;function x(){I();if(CABLES.UI){if(t.get()<1)i.patch.cgl.canvas.style.imageRendering="pixelated"}i.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout()}a.onChange=function(){i.patch.removeOnAnimFrame(i);if(a.get()){i.setUiAttrib({extendTitle:""});i.onAnimFrame=S;i.patch.addOnAnimFrame(i);i.log("adding again!")}else{i.setUiAttrib({extendTitle:"Inactive"})}};function O(){if(r.get()){if(!E)return 10;if(!T)return 30}return n.get()}i.onDelete=function(){f.gl.clearColor(0,0,0,0);f.gl.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT)};function I(){if(t.get()!=0)i.patch.cgl.pixelDensity=Math.min(t.get(),window.devicePixelRatio);else i.patch.cgl.pixelDensity=window.devicePixelRatio}function S(e){if(!a.get())return;if(f.aborted||f.canvas.clientWidth===0||f.canvas.clientHeight===0)return;i.patch.cg=f;I();const t=performance.now();i.patch.config.fpsLimit=O();if(f.canvasWidth==-1){f.setCanvas(i.patch.config.glCanvasId);return}if(f.canvasWidth!=u.get()||f.canvasHeight!=h.get()){u.set(f.canvasWidth/1);h.set(f.canvasHeight/1)}if(CABLES.now()-g>1e3){CGL.fpsReport=CGL.fpsReport||[];if(i.patch.loading.getProgress()>=1&&g!==0)CGL.fpsReport.push(d);d=0;g=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;f.renderStart(f,_,b);if(!s.get())f.gl.clearColor(0,0,0,1);else f.gl.clearColor(0,0,0,0);f.gl.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT);l.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(f);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}f.renderEnd(f);i.patch.cg=null;if(!s.get()){f.gl.clearColor(1,1,1,1);f.gl.colorMask(false,false,false,true);f.gl.clear(f.gl.COLOR_BUFFER_BIT);f.gl.colorMask(true,true,true,true)}if(!f.tempData.phong)f.tempData.phong={};d++;if(v){if(o.get())f.canvas.focus();v=false}c.set(i.patch.cgl.pixelDensity);i.patch.cgl.profileData.profileMainloopMs=performance.now()-t}function y(){clearTimeout(m);m=setTimeout(()=>{if(i.patch.getOpsByObjName(i.name).length>1){i.setUiError("multimainloop","there should only be one mainloop op!");if(!p)p=i.patch.addEventListener("onOpDelete",y)}else i.setUiError("multimainloop",null,1)},500)}}};CABLES.OPS["f1029550-d877-42da-9b1e-63a5163a0350"]={f:Ops.Gl.MainLoop_v2,objName:"Ops.Gl.MainLoop_v2"};Ops.User.srcphag.videoTextureHLS2=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const D=i.attachments={};const k=i.inTrigger("Update"),n=i.inUrl("file","video"),t=i.inValueBool("play"),e=i.inValueBool("loop",true),r=i.inValueSlider("Volume",1),s=i.inValueBool("mute",true),a=i.inValueFloat("Update FPS",30),o=i.inSwitch("Filter",["nearest","linear"],"linear"),l=i.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"clamp to edge"),u=i.inValueBool("flip",true),h=i.inValueFloat("speed",1),c=i.inValueFloat("set time"),f=i.inTriggerButton("Rewind"),U=i.inValueBool("Preload",true),V=i.inBool("Show Interaction needed Button",true),F=i.outTrigger("Next"),d=i.outTexture("texture",null,"texture"),j=i.outNumber("duration"),B=i.outNumber("progress"),G=i.outBoolNum("Interaction Needed"),z=i.outNumber("CurrentTime"),g=i.outBoolNum("Loading"),H=i.outBoolNum("Playing"),m=i.outBoolNum("Can Play Through",false),X=i.outNumber("Width"),q=i.outNumber("Height"),Y=i.outNumber("Aspect Ratio"),p=i.outBoolNum("Has Error"),W=i.outBoolNum("Auto FPS",false),_=i.outString("Error Message");i.setPortGroup("Texture",[o,l,u,a]);i.setPortGroup("Audio",[s,r]);i.setPortGroup("Timing",[c,f,h]);let b=false;let v=false;let A=false;let T=false;let E=0;let x=0;let O=null;let K=null;let I=true;let S=true;let y=0;let C=null;const R=i.patch.cgl;const N=document.createElement("video");N.setAttribute("playsinline","");N.setAttribute("webkit-playsinline","");N.setAttribute("autoplay","autoplay");N.setAttribute("loop","loop");N.loop=e.get();W.set(!!N.requestVideoFrameCallback);const M=CGL.Texture.getEmptyTexture(R);i.toWorkPortsNeedToBeLinked(d);d.setRef(CGL.Texture.getEmptyTexture(R));t.onChange=w;n.onChange=ne;r.onChange=i.onMasterVolumeChanged=ee;o.onChange=l.onChange=()=>{if(O)O.delete();O=null};const Q=i.onDelete;i.onDelete=()=>{if(C){C.destroy();C=null}Q()};k.onTriggered=()=>{if(performance.now()-y>1e3/a.get())S=true;if(S){J()}H.set(!N.paused);if(A&&!N.paused&&t.get()){A=false;CABLES.interActionNeededButton.remove("videoplayer")}G.set(A);F.trigger()};function Z(){if(O)O.delete();E=CGL.Texture.FILTER_NEAREST;if(o.get()=="linear")E=CGL.Texture.FILTER_LINEAR;if(l.get()=="repeat")x=CGL.Texture.WRAP_REPEAT;if(l.get()=="mirrored repeat")x=CGL.Texture.WRAP_MIRRORED_REPEAT;if(l.get()=="clamp to edge")x=CGL.Texture.WRAP_CLAMP_TO_EDGE;O=new CGL.Texture(R,{wrap:x,filter:E})}f.onTriggered=function(){N.currentTime=0;d.setRef(M);S=true};c.onChange=function(){N.currentTime=c.get()||0;S=true};a.onChange=function(){S=true};function P(){N.playbackRate=h.get()}function w(){i.setUiError("playvideo",null);L(true);if(t.get()){N.currentTime=c.get()||0;const e=N.play();if(e)e.then(function(){P()}).catch(function(e){i.setUiError("playvideo",e.message);i.logWarn("exc",e);i.log(e);i.log(N);if(N.paused&&V.get()){i.setUiError("playvideo",null);A=true;CABLES.interActionNeededButton.add(i.patch,"videoplayer",()=>{A=false;N.play().then(()=>{P();CABLES.interActionNeededButton.remove("videoplayer")}).catch(e=>{i.setUiError("playvideo",e.message);i.logWarn("playvideo",e)})})}})}else N.pause()}h.onChange=function(){try{i.setUiError("playbackRate",null);N.playbackRate=h.get()}catch(e){i.setUiError("playbackRate","value for 'speed' not supported by browser",1)}};e.onChange=()=>{N.loop=e.get()};s.onChange=function(){N.muted=s.get()};function J(){const e=S;y=performance.now();if(!n.get()){O=null;d.set(M);return}if(!b)return;if(!O)Z();if(O.width!=N.videoWidth||O.height!=N.videoHeight){i.log("video size",N.videoWidth,N.videoHeight);O.setSize(N.videoWidth,N.videoHeight)}X.set(O.width);q.set(O.height);Y.set(O.width/O.height);if(!m.get())return;if(!b)return;if(!N)return;if(N.videoHeight<=0){i.setUiError("videosize","video width is 0!");return}if(N.videoWidth<=0){i.setUiError("videosize","video height is 0!");return}const t=N.currentTime/N.duration;if(!isNaN(t))B.set(t);z.set(N.currentTime);R.gl.bindTexture(R.gl.TEXTURE_2D,O.tex);R.gl.pixelStorei(R.gl.UNPACK_FLIP_Y_WEBGL,u.get());R.gl.texImage2D(R.gl.TEXTURE_2D,0,R.gl.RGBA,R.gl.RGBA,R.gl.UNSIGNED_BYTE,N);O._setFilter();if(u.get())R.gl.pixelStorei(R.gl.UNPACK_FLIP_Y_WEBGL,false);I=false;d.setRef(O);S=false;i.patch.cgl.profileData.profileVideosPlaying++;if(N.readyState==4)g.set(false);else g.set(false);if(N.requestVideoFrameCallback)N.requestVideoFrameCallback(()=>{S=true})}function $(){N.controls=false;N.muted=s.get();N.loop=e.get();S=true;m.set(true)}function ee(){N.volume=Math.min(1,Math.max(0,(r.get()||0)*i.patch.config.masterVolume))}function te(){j.set(N.duration);w()}function L(e){if(v)return;p.set(false);_.set("");m.set(false);if(n.get()&&String(n.get()).length>1)I=true;if(!n.get()){_.set(true)}if(U.get()||e){clearTimeout(K);g.set(true);N.preload="true";let e=i.patch.getFilePath(n.get());if(String(n.get()).indexOf("data:")==0)e=n.get();if(!e)return;i.setUiError("onerror",null);N.style.display="none";N.setAttribute("src",e);N.setAttribute("crossOrigin","anonymous");if(re(e)&&Hls.isSupported()){se(e)}else{N.setAttribute("src",e)}try{i.setUiError("playbackRate",null);N.playbackRate=h.get()}catch(e){i.setUiError("playbackRate","value for 'speed' not supported by browser",1)}if(!T){T=true;N.addEventListener("canplaythrough",$,true);N.addEventListener("loadedmetadata",te);N.addEventListener("playing",function(){b=true},true);N.onerror=function(){p.set(true);if(N){_.set("Error "+N.error.code+"/"+N.error.message);i.setUiError("onerror","Could not load video / "+N.error.message,2)}}}v=true}}function ie(){setTimeout(L,100)}function ne(){if(!n.get())return;v=false;ie()}function re(e){return e.indexOf(".m3u8")>-1}function se(e){if(C){C.destroy()}C=new Hls({enableWorker:true,lowLatencyMode:true});C.attachMedia(N);C.on(Hls.Events.MEDIA_ATTACHED,()=>{C.loadSource(e)});C.on(Hls.Events.ERROR,(e,t)=>{if(t.fatal){switch(t.type){case Hls.ErrorTypes.NETWORK_ERROR:i.setUiError("hls","Network error, trying to recover...");C.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:i.setUiError("hls","Media error, trying to recover...");C.recoverMediaError();break;default:i.setUiError("hls","Fatal HLS error, destroying...");C.destroy();break}}})}}};CABLES.OPS["cfa166f9-20c3-43a7-bc83-6a603a9d2891"]={f:Ops.User.srcphag.videoTextureHLS2,objName:"Ops.User.srcphag.videoTextureHLS2"};Ops.Gl.ImageCompose.ImageCompose_v4=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={imgcomp_frag:"IN vec2 texCoord;\nUNI vec4 bgColor;\nUNI sampler2D tex;\n#ifdef USE_UVTEX\nUNI sampler2D UVTex;\n#endif\n\nvoid main()\n{\n\n    #ifndef USE_TEX\n        outColor=bgColor;\n    #endif\n    #ifdef USE_TEX\n        #ifndef USE_UVTEX\n        outColor=texture(tex,texCoord);\n        #else\n        outColor=texture(tex,texture(UVTex,texCoord).xy);\n        #endif\n    #endif\n\n\n\n}\n"};const t=i.patch.cgl,n=i.inTrigger("Render"),r=i.inTexture("Base Texture"),s=i.inTexture("UV Texture"),a=i.inSwitch("Size",["Auto","Canvas","Manual"],"Auto"),o=i.inValueInt("Width",640),l=i.inValueInt("Height",480),u=i.inSwitch("Filter",["nearest","linear","mipmap"],"linear"),h=i.inValueSelect("Wrap",["clamp to edge","repeat","mirrored repeat"],"repeat"),c=i.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),f=i.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),d=i.inBool("Clear",true),g=i.inValueSlider("R",0),m=i.inValueSlider("G",0),p=i.inValueSlider("B",0),_=i.inValueSlider("A",0),b=i.outTrigger("Next"),v=i.outTexture("texture_out",CGL.Texture.getEmptyTexture(t)),A=i.outNumber("Aspect Ratio"),D=i.outNumber("Texture Width"),k=i.outNumber("Texture Height");i.setPortGroup("Texture Size",[a,o,l]);i.setPortGroup("Texture Parameters",[h,c,u,f]);g.setUiAttribs({colorPick:true});i.setPortGroup("Color",[g,m,p,_,d]);i.toWorkPortsNeedToBeLinked(n);const U=[0,0,0,0];let T=null;let E=null;let x=true;let V=false;let O=null;let F=null;let j=null;let B=null;h.onChange=u.onChange=c.onChange=f.onChange=G;r.onLinkChanged=d.onChange=a.onChange=s.onChange=P;n.onTriggered=i.preRender=L;P();function I(){if(T)T.delete();if(E)E.delete();E=null;T=new CGL.TextureEffect(t,{isFloatingPointTexture:CGL.Texture.isPixelFormatFloat(f.get()),name:i.name});const e=Math.min(t.maxAnisotropic,parseFloat(c.get()));E=new CGL.Texture(t,{anisotropic:e,name:"image_compose_v2_"+i.id,pixelFormat:f.get(),filter:S(),wrap:y(),width:C(),height:R()});T.setSourceTexture(E);D.set(C());k.set(R());A.set(C()/R());v.setRef(CGL.Texture.getEmptyTexture(t));x=false;P()}function S(){if(u.get()=="nearest")return CGL.Texture.FILTER_NEAREST;else if(u.get()=="linear")return CGL.Texture.FILTER_LINEAR;else if(u.get()=="mipmap")return CGL.Texture.FILTER_MIPMAP}function y(){if(h.get()=="repeat")return CGL.Texture.WRAP_REPEAT;else if(h.get()=="mirrored repeat")return CGL.Texture.WRAP_MIRRORED_REPEAT;else if(h.get()=="clamp to edge")return CGL.Texture.WRAP_CLAMP_TO_EDGE}function C(){let e=0;if(r.get()&&a.get()=="Auto")e=r.get().width;else if(a.get()=="Auto"||a.get()=="Canvas")e=t.canvasWidth;else if(a.get()=="ViewPort")e=t.getViewPort()[2];else e=Math.ceil(o.get());return i.patch.cgl.checkTextureSize(e)}function R(){let e=0;if(r.get()&&a.get()=="Auto")e=r.get().height;else if(a.get()=="Auto"||a.get()=="Canvas")e=t.canvasHeight;else if(a.get()=="ViewPort")e=t.getViewPort()[3];else e=Math.ceil(l.get());return i.patch.cgl.checkTextureSize(e)}function G(){x=true}function z(){if((C()!=E.width||R()!=E.height||E.pixelFormat!=f.get()||E.filter!=S()||E.wrap!=y())&&(C()!==0&&R()!==0)){I();T.setSourceTexture(E);v.setRef(E);N();w()}}function N(){let e=null;if(a.get()=="Manual"){e=null}else if(a.get()=="Auto"){if(r.get())e="Input Texture";else e="Canvas Size";e+=": "+C()+" x "+R()}let t=false;t=a.uiAttribs.info!=e;a.setUiAttribs({info:e});if(t)i.refreshParams()}function M(){if(O)O.toggleDefine("USE_TEX",r.isLinked()||!d.get());if(O)O.toggleDefine("USE_UVTEX",s.isLinked())}function P(){c.setUiAttribs({greyout:S()!=CGL.Texture.FILTER_MIPMAP});g.setUiAttribs({greyout:r.isLinked()});p.setUiAttribs({greyout:r.isLinked()});m.setUiAttribs({greyout:r.isLinked()});_.setUiAttribs({greyout:r.isLinked()});d.setUiAttribs({greyout:r.isLinked()});o.setUiAttribs({greyout:a.get()!="Manual"});l.setUiAttribs({greyout:a.get()!="Manual"});if(E)if(CGL.Texture.isPixelFormatFloat(f.get())&&S()==CGL.Texture.FILTER_MIPMAP)i.setUiError("fpmipmap","Don't use mipmap and 32bit at the same time, many systems do not support this.");else i.setUiError("fpmipmap",null);N();M();w()}function w(){if(E)if(r.isLinked()&&r.get()&&E.isFloatingPoint()<r.get().isFloatingPoint())i.setUiError("textypediff","Warning: Mixing floating point and non floating point texture can result in data/precision loss",1);else i.setUiError("textypediff",null)}i.preRender=()=>{L()};function H(){if(!O){O=new CGL.Shader(t,"copytextureshader");O.setSource(O.getDefaultVertexShader(),e.imgcomp_frag);F=new CGL.Uniform(O,"t","tex",0);j=new CGL.Uniform(O,"t","UVTex",1);B=new CGL.Uniform(O,"4f","bgColor",g,m,p,_);M()}t.pushShader(O);t.currentTextureEffect.bind();if(r.get())t.setTexture(0,r.get().tex);else if(!d.get()&&v.get())t.setTexture(0,v.get().tex);if(s.get())t.setTexture(1,s.get().tex);t.currentTextureEffect.finish();t.popShader()}function L(){if(!T||x)I();t.pushBlend(false);z();const e=t.currentTextureEffect;t.currentTextureEffect=T;t.currentTextureEffect.imgCompVer=3;t.currentTextureEffect.width=o.get();t.currentTextureEffect.height=l.get();T.setSourceTexture(E);T.startEffect(r.get()||CGL.Texture.getEmptyTexture(t,V),true);H();b.trigger();t.pushViewPort(0,0,o.get(),l.get());T.endEffect();v.setRef(T.getCurrentSourceTexture());t.popViewPort();t.popBlend();t.currentTextureEffect=e}}};CABLES.OPS["17212e2b-d692-464c-8f8d-2d511dd3410a"]={f:Ops.Gl.ImageCompose.ImageCompose_v4,objName:"Ops.Gl.ImageCompose.ImageCompose_v4"};Ops.Gl.Meshes.FullscreenRectangle_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={shader_frag:"UNI sampler2D tex;\nIN vec2 texCoord;\n\nvoid main()\n{\n    outColor= texture(tex,texCoord);\n}\n\n",shader_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n   vec4 pos=vec4(vPosition,  1.0);\n\n   texCoord=vec2(attrTexCoord.x,(1.0-attrTexCoord.y));\n\n   gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const i=e.inTrigger("render"),n=e.inSwitch("Scale",["Stretch","Fit"],"Fit"),r=e.inValueBool("Flip Y"),s=e.inValueBool("Flip X"),a=e.inTexture("Texture"),o=e.outTrigger("trigger");const l=e.patch.cgl;let u=null;let h=new CGL.Geometry("fullscreen rectangle");let c=0,f=0,d=0,g=0;e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);e.toWorkPortsNeedToBeLinked(i);s.onChange=x;r.onChange=x;i.onTriggered=E;a.onLinkChanged=v;n.onChange=T;const m=new CGL.Shader(l,"fullscreenrectangle",this);m.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);m.setSource(t.shader_vert,t.shader_frag);m.fullscreenRectUniform=new CGL.Uniform(m,"t","tex",0);m.aspectUni=new CGL.Uniform(m,"f","aspectTex",0);let p=false;let _=true;let b=false;v();T();a.onChange=function(){_=true};function v(){if(!CABLES.UI)return;r.setUiAttribs({greyout:!a.isLinked()});s.setUiAttribs({greyout:!a.isLinked()});n.setUiAttribs({greyout:!a.isLinked()})}function A(){let e=a.get();if(e)p=true;else p=false}e.preRender=function(){A();m.bind();if(u)u.render(m);E()};function T(){b=n.get()=="Fit"}function E(){if(l.viewPort[2]!=d||l.viewPort[3]!=g||!u)O();if(_)A();l.pushPMatrix();mat4.identity(l.pMatrix);mat4.ortho(l.pMatrix,0,d,g,0,-10,1e3);l.pushModelMatrix();mat4.identity(l.mMatrix);l.pushViewMatrix();mat4.identity(l.vMatrix);if(b&&a.get()){const i=a.get().width/a.get().height;let e=g;let t=g*i;if(t>d){e=d*1/i;t=d}l.pushViewPort((d-t)/2,(g-e)/2,t,e)}if(p){if(a.get())l.setTexture(0,a.get().tex);u.render(m)}else{u.render(l.getShader())}l.gl.clear(l.gl.DEPTH_BUFFER_BIT);l.popPMatrix();l.popModelMatrix();l.popViewMatrix();if(b&&a.get())l.popViewPort();o.trigger()}function x(){u=null}function O(){if(l.viewPort[2]==d&&l.viewPort[3]==g&&u)return;let e=0,t=0;d=l.viewPort[2];g=l.viewPort[3];h.vertices=new Float32Array([e+d,t+g,0,e,t+g,0,e+d,t,0,e,t,0]);let i=null;if(r.get())i=new Float32Array([1,0,0,0,1,1,0,1]);else i=new Float32Array([1,1,0,1,1,0,0,0]);if(s.get()){i[0]=0;i[2]=1;i[4]=0;i[6]=1}h.setTexCoords(i);h.verticesIndices=new Uint16Array([2,1,0,3,1,2]);h.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);h.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0]);h.biTangents==new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0]);if(!u)u=new CGL.Mesh(l,h);else u.setGeom(h)}}};CABLES.OPS["fb70721a-eac2-4ff5-a5a2-5c59e2393972"]={f:Ops.Gl.Meshes.FullscreenRectangle_v2,objName:"Ops.Gl.Meshes.FullscreenRectangle_v2"};Ops.Trigger.Sequence=class extends CABLES.Op{constructor(){super(...arguments);const s=this;const e=s.attachments={};const t=s.inTrigger("exe"),i=s.inTriggerButton("Clean up connections");s.setUiAttrib({resizable:true,resizableY:false,stretchPorts:true});const n=[],a=[],r=16;let o=null,l=[];t.onTriggered=c;i.onTriggered=f;i.setUiAttribs({hideParam:true,hidePort:true});for(let t=0;t<r;t++){const d=s.outTrigger("trigger "+t);a.push(d);d.onLinkChanged=h;if(t<r-1){let e=s.inTrigger("exe "+t);e.onTriggered=c;n.push(e)}}u();function u(){l.length=0;for(let e=0;e<a.length;e++)if(a[e].links.length>0)l.push(a[e])}function h(){u();clearTimeout(o);o=setTimeout(()=>{let t=false;for(let e=0;e<a.length;e++)if(a[e].links.length>1)t=true;i.setUiAttribs({hideParam:!t});if(s.isCurrentUiOp())s.refreshParams()},60)}function c(){for(let e=0;e<l.length;e++)l[e].trigger()}function f(){let n=0;for(let i=0;i<a.length;i++){let t=[];if(a[i].links.length>1)for(let e=1;e<a[i].links.length;e++){while(a[n].links.length>0)n++;t.push(a[i].links[e]);const r=a[i].links[e].getOtherPort(a[i]);s.patch.link(s,"trigger "+n,r.op,r.name);n++}for(let e=0;e<t.length;e++)t[e].remove()}h();u()}}};CABLES.OPS["a466bc1f-06e9-4595-8849-bffb9fe22f99"]={f:Ops.Trigger.Sequence,objName:"Ops.Trigger.Sequence"};Ops.Ui.VizTexture=class extends CABLES.Op{constructor(){super(...arguments);const U=this;const i=U.attachments={viztex_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI samplerCube cubeMap;\nUNI float width;\nUNI float height;\nUNI float type;\nUNI float time;\n\nfloat LinearizeDepth(float d,float zNear,float zFar)\n{\n    float z_n = 2.0 * d - 1.0;\n    return 2.0 * zNear / (zFar + zNear - z_n * (zFar - zNear));\n}\n\nvoid main()\n{\n    vec4 col=vec4(vec3(0.),0.0);\n\n    vec4 colTex=texture(tex,texCoord);\n\n\n\n    if(type==1.0)\n    {\n        vec4 depth=vec4(0.);\n        vec2 localST=texCoord;\n        localST.y = 1. - localST.y;\n\n        localST.t = mod(localST.t*3.,1.);\n        localST.s = mod(localST.s*4.,1.);\n\n        #ifdef WEBGL2\n            #define texCube texture\n        #endif\n        #ifdef WEBGL1\n            #define texCube textureCube\n        #endif\n\n//         //Due to the way my depth-cubeMap is rendered, objects to the -x,y,z side is projected to the positive x,y,z side\n//         //Inside where top/bottom is to be drawn?\n        if (texCoord.s*4.> 1. && texCoord.s*4.<2.)\n        {\n            //Bottom (-y) quad\n            if (texCoord.t*3. < 1.)\n            {\n                vec3 dir=vec3(localST.s*2.-1.,-1.,-localST.t*2.+1.);//Due to the (arbitrary) way I choose as up in my depth-viewmatrix, i her emultiply the latter coordinate with -1\n                depth = texCube(cubeMap, dir);\n            }\n            //top (+y) quad\n            else if (texCoord.t*3. > 2.)\n            {\n                vec3 dir=vec3(localST.s*2.-1.,1.,localST.t*2.-1.);//Get lower y texture, which is projected to the +y part of my cubeMap\n                depth = texCube(cubeMap, dir);\n            }\n            else//Front (-z) quad\n            {\n                vec3 dir=vec3(localST.s*2.-1.,-localST.t*2.+1.,1.);\n                depth = texCube(cubeMap, dir);\n            }\n        }\n//         //If not, only these ranges should be drawn\n        else if (texCoord.t*3. > 1. && texCoord.t*3. < 2.)\n        {\n            if (texCoord.x*4. < 1.)//left (-x) quad\n            {\n                vec3 dir=vec3(-1.,-localST.t*2.+1.,localST.s*2.-1.);\n                depth = texCube(cubeMap, dir);\n            }\n            else if (texCoord.x*4. < 3.)//right (+x) quad (front was done above)\n            {\n                vec3 dir=vec3(1,-localST.t*2.+1.,-localST.s*2.+1.);\n                depth = texCube(cubeMap, dir);\n            }\n            else //back (+z) quad\n            {\n                vec3 dir=vec3(-localST.s*2.+1.,-localST.t*2.+1.,-1.);\n                depth = texCube(cubeMap, dir);\n            }\n        }\n        // colTex = vec4(vec3(depth),1.);\n        colTex = vec4(depth);\n    }\n\n    if(type==2.0)\n    {\n       float near = 0.1;\n       float far = 50.;\n       float depth = LinearizeDepth(colTex.r, near, far);\n       colTex.rgb = vec3(depth);\n    }\n\n\n\n\n    #ifdef ANIM_RANGE\n\n        if(colTex.r>1.0 || colTex.r<0.0)\n            colTex.r=mod(colTex.r,1.0)*0.5+(sin(colTex.r+mod(colTex.r*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n        if(colTex.g>1.0 || colTex.g<0.0)\n            colTex.g=mod(colTex.g,1.0)*0.5+(sin(colTex.g+mod(colTex.g*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n        if(colTex.b>1.0 || colTex.b<0.0)\n            colTex.b=mod(colTex.b,1.0)*0.5+(sin(colTex.b+mod(colTex.b*3.0,1.0)+time*5.0)*0.5+0.5)*0.5;\n\n    #endif\n\n\n    // #ifdef ANIM_RANGE\n    //     if(colTex.r>1.0 || colTex.r<0.0)\n    //     {\n    //         float r=mod( time+colTex.r,1.0)*0.5+0.5;\n    //         colTex.r=r;\n    //     }\n    //     if(colTex.g>1.0 || colTex.g<0.0)\n    //     {\n    //         float r=mod( time+colTex.g,1.0)*0.5+0.5;\n    //         colTex.g=r;\n    //     }\n    //     if(colTex.b>1.0 || colTex.b<0.0)\n    //     {\n    //         float r=mod( time+colTex.b,1.0)*0.5+0.5;\n    //         colTex.b=r;\n    //     }\n    // #endif\n\n    #ifdef MOD_RANGE\n        colTex.r=mod(colTex.r,1.0001);\n        colTex.g=mod(colTex.g,1.0001);\n        colTex.b=mod(colTex.b,1.0001);\n\n    #endif\n\n    #ifdef ALPHA_ONE\n        colTex.a=1.0;\n    #endif\n    #ifdef ALPHA_INV\n        colTex.a=1.0-colTex.a;\n    #endif\n\n    outColor = mix(col,colTex,colTex.a);\n}\n\n",viztex_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nOUT vec2 texCoord;\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\nvoid main()\n{\n    texCoord=vec2(attrTexCoord.x,1.0-attrTexCoord.y);\n    vec4 pos = vec4( vPosition, 1. );\n    mat4 mvMatrix=viewMatrix * modelMatrix;\n    gl_Position = projMatrix * mvMatrix * pos;\n}"};const V=U.inTexture("Texture In"),F=U.inBool("Show Info",false),e=U.inSwitch("Visualize outside 0-1",["Off","Anim","Modulo"],"Anim"),t=U.inSwitch("Alpha",["A","1","1-A"],"A"),j=U.inBool("Show Color",false),B=U.inFloatSlider("X",.5),G=U.inFloatSlider("Y",.5),n=U.outTexture("Texture Out"),z=U.outString("Info");U.setUiAttrib({height:150,resizable:true});const H=new CABLES.Timer;let r=null;let X=null;let q=null;let Y="";let s=true;t.onChange=e.onChange=o;j.onChange=a;a();if(CABLES.UI){H.play()}function a(){B.setUiAttribs({greyout:!j.get()});G.setUiAttribs({greyout:!j.get()})}V.onChange=()=>{const e=V.get();n.setRef(e);let t="";if(V.get()&&V.isLinked())t=V.links[0].getOtherPort(V).name;U.setUiAttrib({extendTitle:t})};function o(){if(!r)return;r.toggleDefine("MOD_RANGE",e.get()=="Modulo");r.toggleDefine("ANIM_RANGE",e.get()=="Anim");r.toggleDefine("ALPHA_INV",t.get()=="1-A");r.toggleDefine("ALPHA_ONE",t.get()=="1")}U.renderVizLayerGl=(c,f)=>{if(!V.isLinked())return;if(!f.useGl)return;const d=V;const g=5;const m=g+1;const e=gui.uiProfiler.start("previewlayer texture");const p=d.op.patch.cgl;if(!this._emptyCubemap)this._emptyCubemap=CGL.Texture.getEmptyCubemapTexture(p);d.op.patch.cgl.profileData.profileTexPreviews++;const _=d.get()||CGL.Texture.getEmptyTexture(p);if(!this._mesh){const t=new CGL.Geometry("vizTexture rect");t.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];t.texCoords=[1,1,0,1,1,0,0,0];t.verticesIndices=[0,1,2,3,1,2];this._mesh=new CGL.Mesh(p,t)}if(!this._shader){this._shader=new CGL.Shader(p,"glpreviewtex");this._shader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);this._shader.setSource(i.viztex_vert,i.viztex_frag);this._shaderTexUniform=new CGL.Uniform(this._shader,"t","tex",g);this._shaderTexCubemapUniform=new CGL.Uniform(this._shader,"tc","cubeMap",m);r=this._shader;o();this._shaderTexUniformW=new CGL.Uniform(this._shader,"f","width",_.width);this._shaderTexUniformH=new CGL.Uniform(this._shader,"f","height",_.height);this._shaderTypeUniform=new CGL.Uniform(this._shader,"f","type",0);this._shaderTimeUniform=new CGL.Uniform(this._shader,"f","time",0)}p.pushPMatrix();const b=[_.width,_.height];const v=d.op.patch.cgl.canvasWidth>b[0]&&d.op.patch.cgl.canvasHeight>b[1];if(v){mat4.ortho(p.pMatrix,0,d.op.patch.cgl.canvasWidth,d.op.patch.cgl.canvasHeight,0,.001,11)}else mat4.ortho(p.pMatrix,-1,1,1,-1,.001,11);const A=p.getTexture(g);const T=p.getTexture(m);let E=0;if(_){if(_.cubemap)E=1;if(_.textureType==CGL.Texture.TYPE_DEPTH)E=2;if(E==0||E==2){p.setTexture(g,_.tex);p.setTexture(m,this._emptyCubemap.cubemap,p.gl.TEXTURE_CUBE_MAP)}else if(E==1){p.setTexture(m,_.cubemap,p.gl.TEXTURE_CUBE_MAP)}H.update();this._shaderTimeUniform.setValue(H.get());this._shaderTypeUniform.setValue(E);let t=[d.op.patch.cgl.canvasWidth,d.op.patch.cgl.canvasHeight];p.gl.clearColor(0,0,0,0);p.gl.clear(p.gl.COLOR_BUFFER_BIT|p.gl.DEPTH_BUFFER_BIT);p.pushModelMatrix();if(v){t=b;mat4.translate(p.mMatrix,p.mMatrix,[b[0]/2,b[1]/2,0]);mat4.scale(p.mMatrix,p.mMatrix,[b[0]/2,b[1]/2,0])}this._mesh.render(this._shader);p.popModelMatrix();if(E==0)p.setTexture(g,A);if(E==1)p.setTexture(m,T);p.popPMatrix();p.resetViewPort();const x=[f.width,f.height];const O=false;if(_.width>_.height)x[1]=f.width*b[1]/b[0];else{x[1]=f.width*(b[1]/b[0]);if(x[1]>f.height){const C=f.height/x[1];x[0]*=C;x[1]*=C}}const I=x[0]>b[0]&&x[1]>b[1];c.imageSmoothingEnabled=true;c.fillStyle="#ffffff";c.fillRect(f.x,f.y-10,10,10);c.fillStyle="#000000";c.fillRect(f.x,f.y-10,5,5);c.fillRect(f.x+5,f.y-10+5,5,5);let e=f.height;let i=10*f.width/e*f.scale*2;let n=i*f.height/f.width;let r=e/n;let s=f.width/i;for(let t=0;t<i+1;t++)for(let e=0;e<n+1;e++){if((t+e)%2==0)c.fillStyle="#333333";else c.fillStyle="#393939";c.fillRect(f.x-f.x%s*2+s*t,f.y-f.y%s*2+r*e,s,r)}c.fillStyle="#222";const S=(f.width-x[0])/2;const y=(e-x[1])/2;let a=f.x+(f.width-x[0])/2;let o=f.y+(e-x[1])/2;let l=x[0];let u=x[1];if(e-x[1]<0){a=f.x+(f.width-x[0]*e/x[1])/2;o=f.y;l=x[0]*e/x[1];u=e}c.fillRect(f.x,f.y,a-f.x,e);c.fillRect(f.x+l+a-f.x,f.y,l,e);c.fillRect(f.x,f.y,f.width,y);c.fillRect(f.x,f.y+x[1]+y,f.width,y);if(p.canvas&&p.canvasWidth>0&&p.canvasHeight>0&&p.canvas.width>0&&p.canvas.height>0){try{const R=l/t[0]>3||u/t[1]>3;const N=l/t[0]>10||u/t[1]>10;if(b[1]==1){c.imageSmoothingEnabled=false;c.drawImage(p.canvas,0,0,t[0],t[1],f.x,f.y,f.width,e);c.imageSmoothingEnabled=true}else if(b[0]==1){c.imageSmoothingEnabled=false;c.drawImage(p.canvas,0,0,t[0],t[1],f.x,f.y,f.width,e);c.imageSmoothingEnabled=true}else if(x[0]!=0&&x[1]!=0&&f.width!=0&&e!=0&&l!=0&&u!=0){c.imageSmoothingEnabled=!R;c.drawImage(p.canvas,0,0,t[0],t[1],a,o,l,u)}if(N){const M=l/t[0];const P=u/t[1];c.imageSmoothingEnabled=true;c.lineWidth=1;c.globalAlpha=.5;c.beginPath();for(let e=0;e<=t[0];e++){c.moveTo(a+e*M,o);c.lineTo(a+e*M,o+u)}for(let e=0;e<=t[1];e++){c.moveTo(a,o+e*P);c.lineTo(a+l,o+e*P)}c.strokeStyle="#555";c.stroke();c.globalAlpha=1}}catch(e){console.error("canvas drawimage exception...",e)}}let h="";if(F.get()&&d.get()&&d.get().getInfoOneLine)h+=d.get().getInfoOneLine()+"\n";z.set(h);if(j.get()){h+=Y+"\n";const w=a+l*B.get();const L=o+u*G.get();for(let e=0;e<2;e++){if(e==0)c.fillStyle="#000";else c.fillStyle="#fff";c.fillRect(w-1+e,L-10+e,1,20);c.fillRect(w-10+e,L-1+e,20,1)}}if(F.get()||j.get()){U.setUiAttrib({comment:h})}if(j.get()){const D=p.gl;const k=V.get();if(!k){Y="";return}if(!X)X=D.createFramebuffer();if(!q)q=new CGL.PixelReader;D.bindFramebuffer(D.FRAMEBUFFER,X);D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,k.tex,0);D.bindFramebuffer(D.FRAMEBUFFER,null);q.read(p,X,k.pixelFormat,B.get()*k.width,k.height-G.get()*k.height,1,1,e=>{if(!CGL.Texture.isPixelFormatFloat(k.pixelFormat)){Y="Pixel Float: "+Math.floor(e[0]/255*100)/100;if(!isNaN(e[1]))Y+=", "+Math.floor(e[1]/255*100)/100;if(!isNaN(e[2]))Y+=", "+Math.floor(e[2]/255*100)/100;if(!isNaN(e[3]))Y+=", "+Math.floor(e[3]/255*100)/100;Y+="\n";if(k.pixelFormat.indexOf("ubyte")>0){Y+="Pixel UByte: ";Y+=Math.round(e[0]);if(!isNaN(e[1]))Y+=", "+Math.round(e[1]);if(!isNaN(e[2]))Y+=", "+Math.round(e[2]);if(!isNaN(e[3]))Y+=", "+Math.round(e[3]);Y+="\n"}}else{Y="Pixel Float: "+Math.round(e[0]*100)/100+", "+Math.round(e[1]*100)/100+", "+Math.round(e[2]*100)/100+", "+Math.round(e[3]*100)/100;Y+="\n"}})}}p.gl.clearColor(0,0,0,0);p.gl.clear(p.gl.COLOR_BUFFER_BIT|p.gl.DEPTH_BUFFER_BIT);e.finish()}}};CABLES.OPS["4ea2d7b0-ca74-45db-962b-4d1965ac20c0"]={f:Ops.Ui.VizTexture,objName:"Ops.Ui.VizTexture"};Ops.Gl.RenderToTexture_v3=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={};const t=r.inTrigger("render"),i=r.inSwitch("Size",["Canvas","Manual"],"Canvas"),n=r.inValueInt("texture width",512),s=r.inValueInt("texture height",512),a=r.inBool("Auto Aspect",true),o=r.inSwitch("filter",["nearest","linear","mipmap"],"linear"),l=r.inSwitch("Wrap",["Clamp","Repeat","Mirror"],"Repeat"),u=r.inSwitch("MSAA",["none","2x","4x","8x"],"none"),h=r.outTrigger("trigger"),c=r.outTexture("texture"),f=r.outTexture("textureDepth"),d=r.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),g=r.inValueBool("Depth",true),m=r.inValueBool("Clear",true);const p=r.patch.cgl;let _=null;let b=true;r.setPortGroup("Size",[i,n,s,a]);d.onChange=g.onChange=m.onChange=o.onChange=l.onChange=u.onChange=A;i.onChange=v;t.onTriggered=r.preRender=T;v();function v(){n.setUiAttribs({greyout:i.get()!="Manual"});s.setUiAttribs({greyout:i.get()!="Manual"});a.setUiAttribs({greyout:i.get()!="Manual"})}function A(){b=true}function T(){CGL.TextureEffect.checkOpNotInTextureEffect(r);if(!_||b){if(_)_.delete();let i=CGL.Texture.WRAP_REPEAT;if(l.get()=="Clamp")i=CGL.Texture.WRAP_CLAMP_TO_EDGE;else if(l.get()=="Mirror")i=CGL.Texture.WRAP_MIRRORED_REPEAT;let n=CGL.Texture.FILTER_NEAREST;if(o.get()=="nearest")n=CGL.Texture.FILTER_NEAREST;else if(o.get()=="linear")n=CGL.Texture.FILTER_LINEAR;else if(o.get()=="mipmap")n=CGL.Texture.FILTER_MIPMAP;if(d.get().indexOf("loat")>-1&&o.get()=="mipmap")r.setUiError("fpmipmap","Can't use mipmap and float texture at the same time");else r.setUiError("fpmipmap",null);if(p.glVersion>=2){let e=true;let t=4;if(u.get()=="none"){t=0;e=false}if(u.get()=="2x")t=2;if(u.get()=="4x")t=4;if(u.get()=="8x")t=8;_=new CGL.Framebuffer2(p,8,8,{name:"render2texture "+r.id,pixelFormat:d.get(),multisampling:e,multisamplingSamples:t,wrap:i,filter:n,depth:g.get(),clear:m.get()})}else{_=new CGL.Framebuffer(p,8,8,{isFloatingPointTexture:false,clear:m.get()})}if(_&&_.valid){f.setRef(_.getTextureDepth());b=false}else{_=null;b=true}}let e=a.get();if(i.get()=="Canvas"){e=true;n.set(r.patch.cgl.checkTextureSize(p.canvasWidth));s.set(r.patch.cgl.checkTextureSize(p.canvasHeight))}if(_.getWidth()!=r.patch.cgl.checkTextureSize(n.get())||_.getHeight()!=r.patch.cgl.checkTextureSize(s.get())){_.setSize(r.patch.cgl.checkTextureSize(n.get()),r.patch.cgl.checkTextureSize(s.get()))}_.renderStart(p);p.pushViewPort(0,0,n.get(),s.get());if(e)mat4.perspective(p.pMatrix,45,n.get()/s.get(),.1,1e3);h.trigger();_.renderEnd(p);p.popViewPort();f.setRef(_.getTextureDepth());c.setRef(_.getTextureColor())}}};CABLES.OPS["41eec5c7-c480-477a-be81-04c3efac8357"]={f:Ops.Gl.RenderToTexture_v3,objName:"Ops.Gl.RenderToTexture_v3"};Ops.Gl.ImageCompose.Shapes2d_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={shapes_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float aspect;\n\nUNI bool mirrorX;\nUNI bool mirrorY;\n\nUNI float xPos;\nUNI float yPos;\n\nUNI bool invertColor;\nUNI bool fillShape;\n\nUNI float width;\nUNI float height;\nUNI float lineThickness;\n\nUNI float rotate;\n\nUNI float r;\nUNI float g;\nUNI float b;\nUNI float a;\n\n{{CGL.BLENDMODES3}}\n\n#define PI 3.14159265\n#define TAU (2.0*PI)\n\nvoid pR(inout vec2 p, float a)\n{\n\tp = cos(a)*p + sin(a)*vec2(p.y, -p.x);\n}\n\nfloat sdCircle( vec2 p, float r )\n{\n  return length(p) - r;\n}\n\nfloat sdBox( in vec2 p, in vec2 b )\n{\n    vec2 d = abs(p)-b;\n    return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdEquilateralTriangle( in vec2 p , in float size )\n{\n    const float k = sqrt(3.0);\n    p/= vec2(size);\n    p.x = abs(p.x) - 1.0;\n    p.y = -p.y + 1.0/k;\n    if( p.x + k*p.y > 0.0 ) p = vec2( p.x - k*p.y, -k*p.x - p.y )/2.0;\n    p.x -= clamp( p.x, -2.0, 0.0 );\n    return (-length(p)*sign(p.y))*size;\n}\n\nfloat sdTriangleIsosceles( in vec2 p, in vec2 q )\n{\n\n    p.y +=0.5;\n    p.x = abs(p.x);\n\n    vec2 a = p - q*clamp( dot(p,q)/dot(q,q), 0.0, 1.0 );\n    vec2 b = p - q*vec2( clamp( p.x/q.x, 0.0, 1.0 ), 1.0 );\n    float s = -sign( q.y );\n    vec2 d = min( vec2( dot(a,a), s*(p.x*q.y-p.y*q.x) ),\n                  vec2( dot(b,b), s*(p.y-q.y)  ));\n\n    return -sqrt(d.x)*sign(d.y);\n}\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdRhombus( in vec2 p, in vec2 b )\n{\n    vec2 q = abs(p);\n    float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n    float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n    return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdPentagon( in vec2 p, in float r )\n{\n    const vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n    p.x = abs(p.x);\n    p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n    p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n    p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n    return length(p)*sign(p.y);\n}\n\nfloat sdHexagon( in vec2 p, in float r )\n{\n    const vec3 k = vec3(-0.866025404,0.5,0.577350269);\n    p = abs(p);\n    p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n    p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n    return length(p)*sign(p.y);\n}\n\nfloat sdOctogon( in vec2 p, in float r )\n{\n    const vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n    p = abs(p);\n    p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n    p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n    p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n    return length(p)*sign(p.y);\n}\n\nfloat sdHexagram( in vec2 p, in float r )\n{\n    const vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n    p = abs(p);\n    p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n    p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n    p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n    return length(p)*sign(p.y);\n}\n\nvoid main()\n{\n    vec2 p = texCoord-0.5;\n    p.y/=aspect;\n\n    p *= 2.0;\n\n    float d =0.0;\n\n    if(mirrorX)p.x = abs(p.x);\n    if(mirrorY)p.y = abs(p.y);\n\n    p -= vec2(xPos,yPos/aspect);\n\n    pR(p,rotate * (TAU) + PI);\n\n    #ifdef IS_CIRCLE\n\n        d = sdCircle(p,width);\n    #endif\n\n    #ifdef IS_EQUI_TRIANGLE\n        d = sdEquilateralTriangle(p,width);\n    #endif\n\n    #ifdef IS_ISO_TRIANGLE\n        d = sdTriangleIsosceles(p,vec2(width,height));\n    #endif\n\n    #ifdef IS_BOX\n        d = sdBox(p,vec2(width,height));\n    #endif\n\n    #ifdef IS_RHOMBUS\n        d = sdRhombus(p,vec2(width,height));\n    #endif\n\n    #ifdef IS_PENTAGON\n        d = sdPentagon(p,width);\n    #endif\n\n    #ifdef IS_HEXAGON\n        d = sdHexagon(p,width);\n    #endif\n\n    #ifdef IS_OCTOGON\n        d = sdOctogon(p,width);\n    #endif\n\n    #ifdef IS_HEXAGRAM\n        d = sdHexagram(p*2.0,width);\n    #endif\n\n    if (fillShape == false)\n    {\n        d = abs(d)-abs(lineThickness*0.01);\n    }\n    if(invertColor)\n    {\n        d = sign(d);\n    }\n    else\n    {\n        d = 1.0 - sign(d);\n    }\n\n    d = clamp(d,0.0,1.0);\n\n    vec4 col = vec4(vec4(r,g,b,a)) ;\n    vec4 base = texture(tex,texCoord);\n    outColor = cgl_blendPixel(base,col,d*amount);\n}\n\n\n"};const i=e.inTrigger("render");const n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal");const r=CGL.TextureEffect.AddBlendAlphaMask(e);const s=e.inValueSlider("Amount",1);const a=e.inValueSelect("Shape",["circle","eqi triangle","iso triangle","box","rhombus","pentagon","hexagon","octogon","hexagram"],"circle");const o=e.inValueBool("Mirror X",false);const l=e.inValueBool("Mirror Y",false);const u=e.inValueFloat("Offset X",0);const h=e.inValueFloat("Offset Y",0);const c=e.inValueBool("fillShape",true);const f=e.inValue("Line thickness",1);const d=e.inValueBool("Invert color",false);const g=e.inValue("width",.5);const m=e.inValue("height",.5);const p=e.inValueSlider("Rotate",0);const _=e.inValueSlider("r",Math.random()),b=e.inValueSlider("g",Math.random()),v=e.inValueSlider("b",Math.random()),A=e.inValueSlider("a",1);_.setUiAttribs({colorPick:true});const T=e.outTrigger("trigger");let E=0;function x(){let e=a.get();if(e==="circle"||e==="eqi triangle"||e==="pentagon"||e==="hexagon"||e==="octogon"||e==="hexagram")E=0;else if(e==="box"||e==="iso triangle"||e==="rhombus")E=1;if(E===0){m.setUiAttribs({greyout:true});g.setUiAttribs({title:"Size"})}else if(E===1){m.setUiAttribs({greyout:false});g.setUiAttribs({title:"Width"})}}c.onChange=function(){f.setUiAttribs({greyout:c.get()})};e.init=a.onChange=function(){x();I.toggleDefine("IS_CIRCLE",a.get());I.toggleDefine("IS_EQUI_TRIANGLE",a.get()==="eqi triangle");I.toggleDefine("IS_ISO_TRIANGLE",a.get()==="iso triangle");I.toggleDefine("IS_BOX",a.get()==="box");I.toggleDefine("IS_RHOMBUS",a.get()==="rhombus");I.toggleDefine("IS_PENTAGON",a.get()==="pentagon");I.toggleDefine("IS_HEXAGON",a.get()==="hexagon");I.toggleDefine("IS_OCTOGON",a.get()==="octogon");I.toggleDefine("IS_HEXAGRAM",a.get()==="hexagram")};const O=e.patch.cgl;const I=new CGL.Shader(O,e.name,e);I.setSource(I.getDefaultVertexShader(),t.shapes_frag);const S=new CGL.Uniform(I,"t","tex",0);const y=new CGL.Uniform(I,"f","amount",s);const C=new CGL.Uniform(I,"b","mirrorX",o);const R=new CGL.Uniform(I,"b","mirrorY",l);const N=new CGL.Uniform(I,"f","xPos",u);const M=new CGL.Uniform(I,"f","yPos",h);const D=new CGL.Uniform(I,"b","invertColor",d);const P=new CGL.Uniform(I,"b","fillShape",c);const k=new CGL.Uniform(I,"f","width",g);const U=new CGL.Uniform(I,"f","height",m);const V=new CGL.Uniform(I,"f","lineThickness",f);const F=new CGL.Uniform(I,"f","rotate",p);let j=new CGL.Uniform(I,"f","r",_);let B=new CGL.Uniform(I,"f","g",b);let G=new CGL.Uniform(I,"f","b",v);let z=new CGL.Uniform(I,"f","a",A);let w=new CGL.Uniform(I,"f","aspect",1);CGL.TextureEffect.setupBlending(e,I,n,s,r);i.onTriggered=L;function L(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;O.pushShader(I);O.currentTextureEffect.bind();P.setValue(c.get());w.setValue(O.currentTextureEffect.aspectRatio);O.setTexture(0,O.currentTextureEffect.getCurrentSourceTexture().tex);O.currentTextureEffect.finish();O.popShader();T.trigger()}}};CABLES.OPS["1b81100b-7c09-4171-ae82-8865b905720e"]={f:Ops.Gl.ImageCompose.Shapes2d_v2,objName:"Ops.Gl.ImageCompose.Shapes2d_v2"};Ops.Gl.ImageCompose.AlphaMask_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={alphamask_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D image;\nUNI float amount;\n\nvoid main()\n{\n    vec4 col=vec4(0.0,0.0,0.0,1.0);\n    col=texture(tex,texCoord);\n\n#ifdef USE_TEXTURE\n    float newAlpha=0.0;\n\n    #ifdef FROM_RED\n       newAlpha=texture(image,texCoord).r;\n    #endif\n\n    #ifdef FROM_GREEN\n       newAlpha=texture(image,texCoord).g;\n    #endif\n\n    #ifdef FROM_BLUE\n       newAlpha=texture(image,texCoord).b;\n    #endif\n\n    #ifdef FROM_ALPHA\n       newAlpha=texture(image,texCoord).a;\n    #endif\n\n    #ifdef FROM_LUMINANCE\n       float gray = dot(vec3(0.2126,0.7152,0.0722), texture(image,texCoord).rgb );\n       newAlpha=gray;\n    #endif\n\n\n    newAlpha*=amount;\n\n    #ifdef INVERT\n        newAlpha=1.0-newAlpha;\n    #endif\n\n    #ifdef METH_OVERRIDE\n        col.a=newAlpha;\n    #endif\n    #ifdef METH_ADD\n        col.a+=newAlpha;\n    #endif\n    #ifdef METH_MUL\n        col.a*=newAlpha;\n    #endif\n\n#endif\n#ifndef USE_TEXTURE\n    col.a*=amount;\n    // col.g=1.0;\n#endif\n\n    outColor= col;\n}"};const i=e.inTrigger("render"),n=e.inFloatSlider("Amount",1),r=e.inSwitch("Method",["Override","Mul","Add"],"Override"),s=e.inBool("Invert",false),a=e.inTexture("image"),o=e.outTrigger("trigger");const l=this.patch.cgl;const u=new CGL.Shader(l,e.name,e);u.setSource(u.getDefaultVertexShader(),t.alphamask_frag);const h=new CGL.Uniform(u,"t","tex",0);const c=new CGL.Uniform(u,"t","image",1);const f=new CGL.Uniform(u,"f","amount",n);const d=e.inDropDown("method",["luminance","image alpha","red","green","blue"],"luminance");a.onChange=r.onChange=s.onChange=d.onChange=function(){u.toggleDefine("FROM_LUMINANCE",d.get()=="luminance");u.toggleDefine("FROM_ALPHA",d.get()=="image alpha");u.toggleDefine("FROM_RED",d.get()=="red");u.toggleDefine("FROM_GREEN",d.get()=="green");u.toggleDefine("FROM_BLUR",d.get()=="blue");u.toggleDefine("USE_TEXTURE",a.get());u.toggleDefine("INVERT",s.get());u.toggleDefine("METH_MUL",r.get()=="Mul");u.toggleDefine("METH_ADD",r.get()=="Add");u.toggleDefine("METH_OVERRIDE",r.get()=="Override")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;l.pushShader(u);l.currentTextureEffect.bind();l.setTexture(0,l.currentTextureEffect.getCurrentSourceTexture().tex);if(a.get()&&a.get().tex)l.setTexture(1,a.get().tex);l.currentTextureEffect.finish();l.popShader();o.trigger()}}};CABLES.OPS["a971aaa4-565f-47cf-8a4f-61a3a4378183"]={f:Ops.Gl.ImageCompose.AlphaMask_v2,objName:"Ops.Gl.ImageCompose.AlphaMask_v2"};Ops.Gl.ImageCompose.Pixelate_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={pixelate_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D multiplierTex;\nUNI float amount;\nUNI float amountX;\nUNI float amountY;\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n    float x=1.0/amountX;\n    float y=1.0/amountY;\n\n    #ifdef PIXELATE_TEXTURE\n        x += texture(multiplierTex,texCoord).r*0.1;//*0.1\n        y += texture(multiplierTex,texCoord).r*0.1;//*0.1\n    #endif\n\n    vec2 coord = vec2(x*floor(texCoord.x/x), y*floor(texCoord.y/y));\n\n    col=texture(tex,coord);\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blendPixel(base,col,amount);\n}"};const i=e.inTrigger("render"),n=e.inTexture("Multiplier"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),s=e.inValueSlider("Amount",1),a=e.inValue("width",100),o=e.inValue("height",100),l=e.outTrigger("trigger");const u=e.patch.cgl;const h=new CGL.Shader(u,e.name,e);h.setSource(h.getDefaultVertexShader(),t.pixelate_frag);const c=new CGL.Uniform(h,"t","tex",0);const f=new CGL.Uniform(h,"t","multiplierTex",1);const d=new CGL.Uniform(h,"f","amount",s);const g=new CGL.Uniform(h,"f","amountX",a);const m=new CGL.Uniform(h,"f","amountY",o);n.onChange=function(){h.toggleDefine("PIXELATE_TEXTURE",n.isLinked())};CGL.TextureEffect.setupBlending(e,h,r,s);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;u.pushShader(h);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);if(n.get())u.setTexture(1,n.get().tex);u.currentTextureEffect.finish();u.popShader();l.trigger()}}};CABLES.OPS["c06ae168-ff4f-4ae6-b4d0-06c3b24203bc"]={f:Ops.Gl.ImageCompose.Pixelate_v2,objName:"Ops.Gl.ImageCompose.Pixelate_v2"};Ops.Gl.ImageCompose.Noise.GlitchNoise_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={glitchnoise_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\n\n{{CGL.BLENDMODES3}}\n\nUNI float amount;\nUNI float time;\nUNI float frequency;\nUNI float strength;\nUNI float blockSizeA;\nUNI float blockSizeB;\nUNI float blockSizeC;\nUNI float blockSizeD;\nUNI float scrollX;\nUNI float scrollY;\n\nfloat rng2(vec2 seed)\n{\n    return fract(sin(dot(seed * floor(time * (frequency * 10.0)), vec2(127.1,311.7))) * 43758.5453123);//43758.5453123\n}\n\nfloat rng(float seed)\n{\n    return rng2(vec2(seed, 1.0));\n}\n\nvoid main( )\n{\n    //add scroll for x and y\n    vec2 scrollXY = vec2(scrollX,scrollY);\n    vec2 blockS = floor((texCoord + scrollXY ) * vec2(blockSizeA,blockSizeB));\n    vec2 blockL = floor((texCoord )  * vec2(blockSizeC,blockSizeD));\n\n    float r = rng2(texCoord);\n    vec3 noise = (vec3(r, 1. - r, r / 2. + 0.5) * 1.0 - 2.0) * 0.08;\n\n    float lineNoise = pow(rng2(blockS), 8.0) * pow(rng2(blockL), 3.0) - pow(rng(7.2341), 17.0) * 2.;\n\n    vec4 col1 = texture(tex, texCoord);\n    vec4 col2 = texture(tex, texCoord + vec2(lineNoise * (0.05 * strength)  * rng(5.0), 1));\n    vec4 col3 = texture(tex, texCoord - vec2(lineNoise * (0.05 * strength) * rng(31.0), 1));\n\n    float glitch = (lineNoise * strength * rng(5.0)) + (lineNoise * strength * rng(31.));\n    float glitch2 = lineNoise * strength * rng(31.);\n\n    //blend section\n    vec4 col=vec4(vec3(glitch),1.0);\n    //original texture\n    vec4 base=texture(tex,texCoord);\n\n    outColor=cgl_blendPixel(base,col,amount);\n\n}"};const i=e.inTrigger("render"),n=e.inValueSlider("Amount",1),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),s=CGL.TextureEffect.AddBlendAlphaMask(e),a=e.inValue("Seed",0),o=e.inValue("frequency",1),l=e.inValue("strength",8),u=e.inValue("Block size small x",24),h=e.inValue("Block size small y",9),c=e.inValue("Block size large x",8),f=e.inValue("Block size large y",4),d=e.inValue("Scroll X",0),g=e.inValue("Scroll Y",0),m=e.outTrigger("trigger");const p=0;const _=e.patch.cgl;const b=new CGL.Shader(_,e.name,e);b.setSource(b.getDefaultVertexShader(),t.glitchnoise_frag);const v=new CGL.Uniform(b,"t","tex",p),A=new CGL.Uniform(b,"f","amount",n),T=new CGL.Uniform(b,"f","time",a),E=new CGL.Uniform(b,"f","frequency",o),x=new CGL.Uniform(b,"f","strength",l),O=new CGL.Uniform(b,"f","blockSizeA",u),I=new CGL.Uniform(b,"f","blockSizeB",h),S=new CGL.Uniform(b,"f","blockSizeC",c),y=new CGL.Uniform(b,"f","blockSizeD",f),C=new CGL.Uniform(b,"f","scrollX",d),R=new CGL.Uniform(b,"f","scrollY",g);CGL.TextureEffect.setupBlending(e,b,r,n,s);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;_.pushShader(b);_.currentTextureEffect.bind();_.setTexture(p,_.currentTextureEffect.getCurrentSourceTexture().tex);_.currentTextureEffect.finish();_.popShader();m.trigger()}}};CABLES.OPS["87de572e-644a-4613-b0f3-68b9ec74f489"]={f:Ops.Gl.ImageCompose.Noise.GlitchNoise_v2,objName:"Ops.Gl.ImageCompose.Noise.GlitchNoise_v2"};Ops.Gl.ImageCompose.PixelDisplacement_v4=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={pixeldisplace3_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D displaceTex;\nUNI float amountX;\nUNI float amountY;\nUNI float amount;\n\n#ifdef MAPPING_REPEAT\n    UNI vec2 repeat;\n#endif\n\n{{CGL.BLENDMODES3}}\n\nvec3 getOffset(vec3 offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nfloat getOffset(float offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nvoid main()\n{\n    #ifndef MAPPING_REPEAT\n        vec4 rgba=texture(displaceTex,texCoord);\n    #endif\n    #ifdef MAPPING_REPEAT\n        vec4 rgba=texture(displaceTex,texCoord*repeat);\n    #endif\n\n    vec3 offset=rgba.rgb*rgba.a;\n    float x,y;\n\n    #ifdef INPUT_REDGREEN\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_RED\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.r*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_GREEN\n        offset=getOffset(offset);\n        x=offset.g*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_BLUE\n        offset=getOffset(offset);\n        x=offset.b*amountX+texCoord.x;\n        y=offset.b*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_LUMINANCE\n        float o=dot(vec3(0.2126,0.7152,0.0722), offset);\n        o=getOffset(o);\n        x=o*amountX+texCoord.x;\n        y=o*amountY+texCoord.y;\n    #endif\n    #ifdef WRAP_CLAMP\n        x=clamp(x,0.0,1.0);\n        y=clamp(y,0.0,1.0);\n    #endif\n    #ifdef WRAP_REPEAT\n        x=mod(x,1.0);\n        y=mod(y,1.0);\n    #endif\n    #ifdef WRAP_MIRROR\n        float mx=mod(x,2.0);\n        float my=mod(y,2.0);\n        x=abs((floor(mx)-fract(mx)));\n        y=abs((floor(my)-fract(my)));\n    #endif\n\n\n\n    vec4 col=texture(tex,vec2(x,y));\n    vec4 base=texture(tex,texCoord);\n\n    base.a=0.0;\n\n    outColor=cgl_blendPixel(base,col,amount);\n}\n\n\n//////"};const i=e.inTrigger("render"),n=e.inTexture("displaceTex"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),s=e.inValueSlider("Amount",1),a=e.inValueSlider("amount X",.2),o=e.inValueSlider("amount Y",.2),l=e.inSwitch("Wrap",["Mirror","Clamp","Repeat"],"Mirror"),u=e.inValueSelect("Input",["Luminance","RedGreen","Red","Green","Blue"],"Luminance"),h=e.inSwitch("Zero Displace",["Grey","Black"],"Grey"),c=e.inSwitch("Pixel Mapping",["Stretch","Repeat"],"Stretch"),f=e.outTrigger("trigger");e.setPortGroup("Axis Displacement Strength",[a,o]);e.setPortGroup("Modes",[l,u]);e.toWorkPortsNeedToBeLinked(n);const d=e.patch.cgl,g=new CGL.Shader(d,e.name,e);g.setSource(g.getDefaultVertexShader(),t.pixeldisplace3_frag);const m=new CGL.Uniform(g,"t","tex",0),p=new CGL.Uniform(g,"t","displaceTex",1),_=new CGL.Uniform(g,"f","amountX",a),b=new CGL.Uniform(g,"f","amountY",o),v=new CGL.Uniform(g,"2f","repeat",1,1),A=new CGL.Uniform(g,"f","amount",s);c.onChange=h.onChange=l.onChange=u.onChange=T;T();CGL.TextureEffect.setupBlending(e,g,r,s);function T(){g.toggleDefine("MAPPING_REPEAT",c.get()=="Repeat");g.removeDefine("ZERO_BLACK");g.removeDefine("ZERO_GREY");g.define("ZERO_"+(h.get()+"").toUpperCase());g.removeDefine("WRAP_CLAMP");g.removeDefine("WRAP_REPEAT");g.removeDefine("WRAP_MIRROR");g.define("WRAP_"+(l.get()+"").toUpperCase());g.removeDefine("INPUT_LUMINANCE");g.removeDefine("INPUT_REDGREEN");g.removeDefine("INPUT_RED");g.define("INPUT_"+(u.get()+"").toUpperCase())}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;if(n.get()){d.pushShader(g);d.currentTextureEffect.bind();v.setValue([d.currentTextureEffect.getCurrentSourceTexture().width/n.get().width,d.currentTextureEffect.getCurrentSourceTexture().height/n.get().height]);d.setTexture(0,d.currentTextureEffect.getCurrentSourceTexture().tex);if(n.get())d.setTexture(1,n.get().tex);d.currentTextureEffect.finish();d.popShader()}f.trigger()}}};CABLES.OPS["c00f79f2-0505-4b4f-b0bf-10ef7875dd87"]={f:Ops.Gl.ImageCompose.PixelDisplacement_v4,objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"};Ops.Gl.Textures.CopyTexture_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const k=t.attachments={copytexture_frag:"UNI float a;\nUNI sampler2D tex;\n\n#ifdef TEX_MASK\nUNI sampler2D texMask;\n#endif\n\nIN vec2 texCoord;\n\nvoid main()\n{\n    vec2 tc=texCoord;\n\n    #ifdef FLIPX\n        tc.x=1.0-tc.x;\n    #endif\n    #ifdef FLIPY\n        tc.y=1.0-tc.y;\n    #endif\n\n    vec4 col=texture(tex,tc);\n\n    #ifdef TEX_MASK\n        col.a=texture(texMask,tc).r;\n    #endif\n\n    #ifdef GREY_R\n        col.rgb=vec3(col.r);\n    #endif\n\n    #ifdef GREY_G\n        col.rgb=vec3(col.g);\n    #endif\n\n    #ifdef GREY_B\n        col.rgb=vec3(col.b);\n    #endif\n\n    #ifdef GREY_A\n        col.rgb=vec3(col.a);\n    #endif\n\n    #ifdef GREY_LUMI\n        col.rgb=vec3( dot(vec3(0.2126,0.7152,0.0722), col.rgb) );\n    #endif\n\n\n    #ifdef INVERT_A\n        col.a=1.0-col.a;\n    #endif\n\n    #ifdef INVERT_R\n        col.r=1.0-col.r;\n    #endif\n\n    #ifdef INVERT_G\n        col.g=1.0-col.g;\n    #endif\n\n    #ifdef INVERT_B\n        col.b=1.0-col.b;\n    #endif\n\n    #ifdef ALPHA_1\n        col.a=1.0;\n    #endif\n\n\n\n\n    outColor= col;\n}"};const e=t.inTriggerButton("render"),i=t.inTexture("Texture"),n=t.inTexture("Alpha Mask"),r=t.inValueBool("use original size",true),s=t.inValueInt("width",640),a=t.inValueInt("height",360),o=t.inSwitch("filter",["nearest","linear","mipmap"],"linear"),l=t.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),u=t.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),h=t.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),c=t.inSwitch("Alpha Mask Source",["A","1"],"A"),f=t.inSwitch("Convert Greyscale",["Off","R","G","B","A","Luminance"],"Off"),d=t.inBool("Invert R",false),g=t.inBool("Invert G",false),m=t.inBool("Invert B",false),U=t.inBool("Invert A",false),p=t.inBool("Flip X",false),_=t.inBool("Flip Y",false),b=t.outTrigger("trigger"),v=t.outTexture("texture_out",null),V=t.outNumber("Aspect Ratio");c.setUiAttribs({hidePort:true});f.setUiAttribs({hidePort:true});d.setUiAttribs({hidePort:true});g.setUiAttribs({hidePort:true});m.setUiAttribs({hidePort:true});let F=null;const A=t.patch.cgl;let T=null;let E=null;let x=null;let O=true;let I=null;let S=2,y=2;const C=[0,0,0,0];let R=true;t.toWorkPortsNeedToBeLinked(e,i);t.setPortGroup("Size",[r,s,a]);const N=new CGL.Shader(A,"copytexture");N.setSource(N.getDefaultVertexShader(),k.copytexture_frag);const j=new CGL.Uniform(N,"t","tex",0);let B=new CGL.Uniform(N,"t","texMask",1);let M=CGL.Texture.FILTER_LINEAR;let P=CGL.Texture.WRAP_CLAMP_TO_EDGE;p.onChange=_.onChange=c.onChange=u.onChange=f.onChange=d.onChange=g.onChange=m.onChange=h.onChange=o.onChange=l.onChange=e.onLinkChanged=n.onChange=i.onLinkChanged=()=>{L()};i.onChange=()=>{if(I!=i.get()){L()}I=i.get()};e.onTriggered=H;D();function w(){if(E)E.delete();if(x){x.delete();x=null}E=new CGL.TextureEffect(A,{pixelFormat:l.get(),clear:false});if(!x||x.width!=Math.floor(s.get())||x.height!=Math.floor(a.get())||x.wrap!=P||x.pixelFormat!=l.get()){const e=Math.min(A.maxAnisotropic,parseFloat(u.get()));if(x)x.delete();x=new CGL.Texture(A,{name:"copytexture_"+t.id,pixelFormat:l.get(),anisotropic:e,filter:M,wrap:P,width:Math.floor(s.get()),height:Math.floor(a.get())})}E.setSourceTexture(x);D();R=false}function L(){X();R=true;if(!e.isLinked()||!i.isLinked())v.setRef(CGL.Texture.getEmptyTexture(A))}function G(){if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(A))return;if(!E)w();if(r.get()){S=i.get().width;y=i.get().height}else{S=Math.floor(s.get());y=Math.floor(a.get())}if((S!=x.width||y!=x.height)&&(S!==0&&y!==0)){a.set(y);s.set(S);x.filter=M;x.setSize(S,y);V.set(S/y);E.setSourceTexture(x)}O=false}function D(){if(!CABLES.UI)return;u.setUiAttribs({greyout:o.get()!="mipmap"});s.setUiAttribs({greyout:r.get()});a.setUiAttribs({greyout:r.get()})}function z(){O=true;L()}r.onChange=function(){D();if(r.get()){s.onChange=null;a.onChange=null}else{s.onChange=z;a.onChange=z}G()};function H(){if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(A))v.setRef(CGL.Texture.getEmptyTexture(A));if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(A)){T=null;b.trigger();return}else if(!E||R||T!=i.get()){w()}const e=A.getViewPort();C[0]=e[0];C[1]=e[1];C[2]=e[2];C[3]=e[3];G();T=i.get();const t=A.currentTextureEffect;A.currentTextureEffect=E;E.setSourceTexture(x);E.startEffect();A.pushShader(N);A.currentTextureEffect.bind();A.setTexture(0,i.get().tex);if(n.get())A.setTexture(1,n.get().tex);A.pushBlend(false);A.currentTextureEffect.finish();A.popShader();A.popBlend();v.setRef(E.getCurrentSourceTexture());E.endEffect();A.setViewPort(C[0],C[1],C[2],C[3]);A.currentTextureEffect=t;A.setTexture(0,CGL.Texture.getEmptyTexture(A).tex);b.trigger()}function X(){N.toggleDefine("FLIPX",p.get());N.toggleDefine("FLIPY",_.get());N.toggleDefine("TEX_MASK",n.get());N.toggleDefine("GREY_R",f.get()==="R");N.toggleDefine("GREY_G",f.get()==="G");N.toggleDefine("GREY_B",f.get()==="B");N.toggleDefine("GREY_A",f.get()==="A");N.toggleDefine("GREY_LUMI",f.get()==="Luminance");N.toggleDefine("ALPHA_1",c.get()==="1");N.toggleDefine("ALPHA_A",c.get()==="A");N.toggleDefine("INVERT_R",d.get());N.toggleDefine("INVERT_G",g.get());N.toggleDefine("INVERT_B",m.get());N.toggleDefine("INVERT_A",U.get());if(h.get()=="repeat")P=CGL.Texture.WRAP_REPEAT;else if(h.get()=="mirrored repeat")P=CGL.Texture.WRAP_MIRRORED_REPEAT;else if(h.get()=="clamp to edge")P=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(o.get()=="nearest")M=CGL.Texture.FILTER_NEAREST;else if(o.get()=="linear")M=CGL.Texture.FILTER_LINEAR;else if(o.get()=="mipmap")M=CGL.Texture.FILTER_MIPMAP;if(N.needsRecompile()){R=true}if(x&&(x.width!=Math.floor(s.get())||x.height!=Math.floor(a.get())||x.wrap!=P||x.pixelFormat!=l.get())){R=true}}}};CABLES.OPS["25d77a01-ccfe-4b2e-b3c3-a09a8a018d0c"]={f:Ops.Gl.Textures.CopyTexture_v3,objName:"Ops.Gl.Textures.CopyTexture_v3"};Ops.Gl.ImageCompose.DrawImage_v3=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={drawimage_frag:"#ifdef HAS_TEXTURES\n    IN vec2 texCoord;\n    UNI sampler2D tex;\n    UNI sampler2D image;\n#endif\n\n#ifdef TEX_TRANSFORM\n    IN mat3 transform;\n#endif\n// UNI float rotate;\n\n{{CGL.BLENDMODES}}\n\n#ifdef HAS_TEXTUREALPHA\n   UNI sampler2D imageAlpha;\n#endif\n\nUNI float amount;\n\n#ifdef ASPECT_RATIO\n    UNI float aspectTex;\n    UNI float aspectPos;\n#endif\n\nvoid main()\n{\n    vec4 blendRGBA=vec4(0.0,0.0,0.0,1.0);\n\n    #ifdef HAS_TEXTURES\n        vec2 tc=texCoord;\n\n        #ifdef TEX_FLIP_X\n            tc.x=1.0-tc.x;\n        #endif\n        #ifdef TEX_FLIP_Y\n            tc.y=1.0-tc.y;\n        #endif\n\n        #ifdef ASPECT_RATIO\n            #ifdef ASPECT_AXIS_X\n                tc.y=(1.0-aspectPos)-(((1.0-aspectPos)-tc.y)*aspectTex);\n            #endif\n            #ifdef ASPECT_AXIS_Y\n                tc.x=(1.0-aspectPos)-(((1.0-aspectPos)-tc.x)/aspectTex);\n            #endif\n        #endif\n\n        #ifdef TEX_TRANSFORM\n            vec3 coordinates=vec3(tc.x, tc.y,1.0);\n            tc=(transform * coordinates ).xy;\n        #endif\n\n        blendRGBA=texture(image,tc);\n\n        vec3 blend=blendRGBA.rgb;\n        vec4 baseRGBA=texture(tex,texCoord);\n        vec3 base=baseRGBA.rgb;\n\n\n        #ifdef PREMUL\n            blend.rgb = (blend.rgb) + (base.rgb * (1.0 - blendRGBA.a));\n        #endif\n\n        vec3 colNew=_blend(base,blend);\n\n\n\n\n        #ifdef REMOVE_ALPHA_SRC\n            blendRGBA.a=1.0;\n        #endif\n\n        #ifdef HAS_TEXTUREALPHA\n            vec4 colImgAlpha=texture(imageAlpha,tc);\n            float colImgAlphaAlpha=colImgAlpha.a;\n\n            #ifdef ALPHA_FROM_LUMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef ALPHA_FROM_INV_UMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=1.0-(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef INVERT_ALPHA\n                colImgAlphaAlpha=clamp(colImgAlphaAlpha,0.0,1.0);\n                colImgAlphaAlpha=1.0-colImgAlphaAlpha;\n            #endif\n\n            blendRGBA.a=colImgAlphaAlpha*blendRGBA.a;\n        #endif\n    #endif\n\n    float am=amount;\n\n    #ifdef CLIP_REPEAT\n        if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n        {\n            // colNew.rgb=vec3(0.0);\n            am=0.0;\n        }\n    #endif\n\n    #ifdef ASPECT_RATIO\n        #ifdef ASPECT_CROP\n            if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n            {\n                colNew.rgb=base.rgb;\n                am=0.0;\n            }\n\n        #endif\n    #endif\n\n\n\n    #ifndef PREMUL\n        blendRGBA.rgb=mix(colNew,base,1.0-(am*blendRGBA.a));\n        blendRGBA.a=clamp(baseRGBA.a+(blendRGBA.a*am),0.,1.);\n    #endif\n\n    #ifdef PREMUL\n        // premultiply\n        // blendRGBA.rgb = (blendRGBA.rgb) + (baseRGBA.rgb * (1.0 - blendRGBA.a));\n        blendRGBA=vec4(\n            mix(colNew.rgb,base,1.0-(am*blendRGBA.a)),\n            blendRGBA.a*am+baseRGBA.a\n            );\n    #endif\n\n    #ifdef ALPHA_MASK\n    blendRGBA.a=baseRGBA.a;\n    #endif\n\n    outColor=blendRGBA;\n}\n\n\n\n\n\n\n\n",drawimage_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\n\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\n// OUT vec3 norm;\n\n#ifdef TEX_TRANSFORM\n    UNI float posX;\n    UNI float posY;\n    UNI float scaleX;\n    UNI float scaleY;\n    UNI float rotate;\n    OUT mat3 transform;\n#endif\n\nvoid main()\n{\n   texCoord=attrTexCoord;\n//   norm=attrVertNormal;\n\n   #ifdef TEX_TRANSFORM\n        vec3 coordinates=vec3(attrTexCoord.x, attrTexCoord.y,1.0);\n        float angle = radians( rotate );\n        vec2 scale= vec2(scaleX,scaleY);\n        vec2 translate= vec2(posX,posY);\n\n        transform = mat3(   scale.x * cos( angle ), scale.x * sin( angle ), 0.0,\n            - scale.y * sin( angle ), scale.y * cos( angle ), 0.0,\n            - 0.5 * scale.x * cos( angle ) + 0.5 * scale.y * sin( angle ) - 0.5 * translate.x*2.0 + 0.5,  - 0.5 * scale.x * sin( angle ) - 0.5 * scale.y * cos( angle ) - 0.5 * translate.y*2.0 + 0.5, 1.0);\n   #endif\n\n   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);\n}\n"};const t=n.inTrigger("render"),i=CGL.TextureEffect.AddBlendSelect(n,"blendMode"),r=n.inValueSlider("amount",1),s=n.inTexture("Image"),a=n.inValueBool("Premultiplied",false),o=n.inValueBool("Alpha Mask",false),l=n.inValueBool("removeAlphaSrc",false),u=n.inTexture("Mask"),h=n.inValueSelect("Mask Src",["alpha channel","luminance","luminance inv"],"luminance"),c=n.inBool("Invert alpha channel"),f=n.inValueBool("Aspect Ratio",false),d=n.inValueSelect("Stretch Axis",["X","Y"],"X"),g=n.inValueSlider("Position",0),m=n.inValueBool("Crop",false),p=n.outTrigger("trigger");i.set("normal");const _=n.patch.cgl;const b=new CGL.Shader(_,"drawimage");u.onLinkChanged=v;n.setPortGroup("Aspect Ratio",[f,g,m,d]);n.setPortGroup("Mask",[u,h,c]);function v(){if(u.isLinked()){l.setUiAttribs({greyout:true});h.setUiAttribs({greyout:false});c.setUiAttribs({greyout:false})}else{l.setUiAttribs({greyout:false});h.setUiAttribs({greyout:true});c.setUiAttribs({greyout:true})}}n.toWorkPortsNeedToBeLinked(s);b.setSource(e.drawimage_vert,e.drawimage_frag);const A=new CGL.Uniform(b,"t","tex",0),D=new CGL.Uniform(b,"t","image",1),k=new CGL.Uniform(b,"t","imageAlpha",2),T=new CGL.Uniform(b,"f","aspectTex",1),U=new CGL.Uniform(b,"f","aspectPos",g);f.onChange=m.onChange=d.onChange=E;function E(){b.removeDefine("ASPECT_AXIS_X");b.removeDefine("ASPECT_AXIS_Y");b.removeDefine("ASPECT_CROP");g.setUiAttribs({greyout:!f.get()});m.setUiAttribs({greyout:!f.get()});d.setUiAttribs({greyout:!f.get()});if(f.get()){b.define("ASPECT_RATIO");if(m.get())b.define("ASPECT_CROP");if(d.get()=="X")b.define("ASPECT_AXIS_X");if(d.get()=="Y")b.define("ASPECT_AXIS_Y")}else{b.removeDefine("ASPECT_RATIO");if(m.get())b.define("ASPECT_CROP");if(d.get()=="X")b.define("ASPECT_AXIS_X");if(d.get()=="Y")b.define("ASPECT_AXIS_Y")}}const x=n.inValueBool("flip x");const O=n.inValueBool("flip y");let I=n.inValueBool("Transform");let S=n.inValueSlider("Scale X",1);let y=n.inValueSlider("Scale Y",1);let C=n.inValue("Position X",0);let R=n.inValue("Position Y",0);let N=n.inValue("Rotation",0);const M=n.inValueBool("Clip Repeat",false);const V=new CGL.Uniform(b,"f","scaleX",S);const F=new CGL.Uniform(b,"f","scaleY",y);const j=new CGL.Uniform(b,"f","posX",C);const B=new CGL.Uniform(b,"f","posY",R);const G=new CGL.Uniform(b,"f","rotate",N);I.onChange=P;function P(){b.toggleDefine("TEX_TRANSFORM",I.get());S.setUiAttribs({greyout:!I.get()});y.setUiAttribs({greyout:!I.get()});C.setUiAttribs({greyout:!I.get()});R.setUiAttribs({greyout:!I.get()});N.setUiAttribs({greyout:!I.get()})}CGL.TextureEffect.setupBlending(n,b,i,r);const z=new CGL.Uniform(b,"f","amount",r);t.onTriggered=L;M.onChange=u.onChange=a.onChange=o.onChange=c.onChange=O.onChange=x.onChange=l.onChange=h.onChange=w;P();v();E();w();function w(){b.toggleDefine("REMOVE_ALPHA_SRC",l.get());b.toggleDefine("ALPHA_MASK",o.get());b.toggleDefine("CLIP_REPEAT",M.get());b.toggleDefine("HAS_TEXTUREALPHA",u.get()&&u.get().tex);b.toggleDefine("TEX_FLIP_X",x.get());b.toggleDefine("TEX_FLIP_Y",O.get());b.toggleDefine("INVERT_ALPHA",c.get());b.toggleDefine("ALPHA_FROM_LUMINANCE",h.get()=="luminance");b.toggleDefine("ALPHA_FROM_INV_UMINANCE",h.get()=="luminance_inv");b.toggleDefine("PREMUL",a.get())}function L(){if(!CGL.TextureEffect.checkOpInEffect(n))return;const e=s.get();if(e&&e.tex&&r.get()>0){_.pushShader(b);_.currentTextureEffect.bind();const t=_.currentTextureEffect.getCurrentSourceTexture();_.setTexture(0,t.tex);const i=1/(_.currentTextureEffect.getWidth()/_.currentTextureEffect.getHeight())*(e.width/e.height);T.setValue(i);_.setTexture(1,e.tex);if(u.get()&&u.get().tex){_.setTexture(2,u.get().tex)}_.pushBlendMode(CGL.BLEND_NONE,true);_.currentTextureEffect.finish();_.popBlendMode();_.popShader()}p.trigger()}}};CABLES.OPS["8f6b2f15-fcb0-4597-90c0-e5173f2969fe"]={f:Ops.Gl.ImageCompose.DrawImage_v3,objName:"Ops.Gl.ImageCompose.DrawImage_v3"};Ops.Math.Interpolate=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inFloat("Value 1"),n=e.inFloat("Value 2"),r=e.inFloatSlider("Percentage"),s=e.outNumber("Result");i.onChange=n.onChange=r.onChange=a;function a(){s.set((n.get()-i.get())*r.get()+i.get())}}};CABLES.OPS["d126e2c8-221e-428f-8ff4-8b8c5f6b8905"]={f:Ops.Math.Interpolate,objName:"Ops.Math.Interpolate"};Ops.Gl.ImageCompose.BrightnessContrast=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={brightness_contrast_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float amountbright;\n\nvoid main()\n{\n    vec4 col=vec4(1.0,0.0,0.0,1.0);\n    col=texture(tex,texCoord);\n\n    // apply contrast\n    col.rgb = ((col.rgb - 0.5) * max(amount*2.0, 0.0))+0.5;\n\n    // apply brightness\n    col.rgb *= amountbright*2.0;\n\n    outColor = col;\n}"};const i=e.inTrigger("render"),n=e.inValueSlider("contrast",.5),r=e.inValueSlider("brightness",.5),s=e.outTrigger("trigger");const a=e.patch.cgl;const o=new CGL.Shader(a,"brightnesscontrast");o.setSource(o.getDefaultVertexShader(),t.brightness_contrast_frag);const l=new CGL.Uniform(o,"t","tex",0);const u=new CGL.Uniform(o,"f","amount",n);const h=new CGL.Uniform(o,"f","amountbright",r);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;if(!a.currentTextureEffect.getCurrentSourceTexture())return;if(!CGL.TextureEffect.checkOpInEffect(e))return;a.pushShader(o);a.currentTextureEffect.bind();a.setTexture(0,a.currentTextureEffect.getCurrentSourceTexture().tex);a.currentTextureEffect.finish();a.popShader();s.trigger()}}};CABLES.OPS["54b89199-c594-4dff-bc48-82d6c7a55e8a"]={f:Ops.Gl.ImageCompose.BrightnessContrast,objName:"Ops.Gl.ImageCompose.BrightnessContrast"};Ops.Gl.ImageCompose.Desaturate=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={desaturate_frag:"\nIN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\n\n#ifdef MASK\n    UNI sampler2D mask;\n#endif\n\nvec3 desaturate(vec3 color, float amount)\n{\n   vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n   return vec3(mix(color, gray, amount));\n}\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n\n    float am=amount;\n    #ifdef MASK\n        am*=1.0-texture(mask,texCoord).r;\n        #ifdef INVERTMASK\n        am=1.0-am;\n        #endif\n    #endif\n\n    col.rgb=desaturate(col.rgb,am);\n    outColor= col;\n}"};const i=e.inTrigger("render");const n=e.outTrigger("trigger");const r=e.inValueSlider("amount",1);const s=e.inTexture("Mask");const a=e.inValueBool("Invert Mask");const o=e.patch.cgl;const l=new CGL.Shader(o,e.name,e);l.setSource(l.getDefaultVertexShader(),t.desaturate_frag);let u=new CGL.Uniform(l,"t","tex",0);let h=new CGL.Uniform(l,"t","mask",1);let c=new CGL.Uniform(l,"f","amount",r);a.onChange=function(){if(a.get())l.define("INVERTMASK");else l.removeDefine("INVERTMASK")};s.onChange=function(){if(s.get())l.define("MASK");else l.removeDefine("MASK")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;o.pushShader(l);o.currentTextureEffect.bind();o.setTexture(0,o.currentTextureEffect.getCurrentSourceTexture().tex);if(s.get())o.setTexture(1,s.get().tex);o.currentTextureEffect.finish();o.popShader();n.trigger()}}};CABLES.OPS["340efbd5-be53-4bd5-92ad-8f38d8eeecf1"]={f:Ops.Gl.ImageCompose.Desaturate,objName:"Ops.Gl.ImageCompose.Desaturate"};Ops.Gl.ImageCompose.Levels_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={levels_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float inMin;\nUNI float inMax;\nUNI float midPoint;\nUNI float outMax;\nUNI float outMin;\n\nvoid main()\n{\n    vec4 baseRGBA=texture(tex,texCoord);\n    vec3 base=baseRGBA.rgb;\n    vec3 inputRange = min(max(base - vec3(inMin), vec3(0.0)) / (vec3(inMax) - vec3(inMin)), vec3(outMax));\n\n    inputRange = pow(inputRange, vec3(1.0 / (1.5 - midPoint)));\n\n    outColor= vec4(mix(vec3(outMin), vec3(1.0), inputRange) ,baseRGBA.a);\n}"};const i=e.inTrigger("Render"),n=e.inValueSlider("In Min",0),r=e.inValueSlider("Midpoint",.5),s=e.inValueSlider("In Max",1),a=e.inValueSlider("Out Min",0),o=e.inValueSlider("Out Max",1),l=e.outTrigger("Next");const u=e.patch.cgl;const h=new CGL.Shader(u,e.name,e);const c=new CGL.Uniform(h,"f","inMin",n),f=new CGL.Uniform(h,"f","midPoint",r),d=new CGL.Uniform(h,"f","inMax",s),g=new CGL.Uniform(h,"f","outMin",a),m=new CGL.Uniform(h,"f","outMax",o),p=new CGL.Uniform(h,"t","tex",0);h.setSource(h.getDefaultVertexShader(),t.levels_frag);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;u.pushShader(h);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);u.currentTextureEffect.finish();u.popShader();l.trigger()}}};CABLES.OPS["cf49063c-a010-4e2b-add6-f8dea50392b5"]={f:Ops.Gl.ImageCompose.Levels_v2,objName:"Ops.Gl.ImageCompose.Levels_v2"};Ops.Gl.Textures.NoiseTexture=class extends CABLES.Op{constructor(){super(...arguments);const p=this;const e=p.attachments={};const _=p.inValueInt("Width",256),b=p.inValueInt("Height",256),v=p.inSwitch("Filter",["nearest","linear"],"nearest"),A=p.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"repeat"),T=p.inValueBool("Color",false),E=p.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),x=p.inBool("Integer",false),O=p.inFloat("Seed",1),I=p.inBool("Channel R",true),S=p.inFloat("Min R",0),y=p.inFloat("Max R",1),C=p.inBool("Channel G",true),R=p.inFloat("Min G",0),N=p.inFloat("Max G",1),M=p.inBool("Channel B",true),P=p.inFloat("Min B",0),w=p.inFloat("Max B",1),L=p.inBool("Channel A",true),D=p.inFloat("Min A",1),k=p.inFloat("Max A",1),U=p.outTexture("Texture"),V=p.outNumber("Total Pixel");const F=p.patch.cgl;let t=null;let j=null;O.onChange=_.onChange=b.onChange=E.onChange=S.onChange=y.onChange=R.onChange=D.onChange=N.onChange=k.onChange=P.onChange=w.onChange=I.onChange=M.onChange=C.onChange=L.onChange=v.onChange=A.onChange=x.onChange=T.onChange=i;i();function i(){if(j)F.patch.loading.finished(j);j=F.patch.loading.start("noisetexture","noisetexture");F.addNextFrameOnceCallback(n)}function n(){const e=E.get().indexOf("float")>-1;if(!e){if(S.get()<0||S.get()>1||R.get()<0||R.get()>1||P.get()<0||P.get()>1||y.get()<0||y.get()>1||k.get()<0||k.get()>1||N.get()<0||N.get()>1||w.get()<0||w.get()>1)p.setUiError("nonfprange","Non floating point textures have to be between 0 and 1");else p.setUiError("nonfprange",null)}else p.setUiError("nonfprange",null);R.setUiAttribs({greyout:!T.get()});N.setUiAttribs({greyout:!T.get()});P.setUiAttribs({greyout:!T.get()});w.setUiAttribs({greyout:!T.get()});k.setUiAttribs({greyout:!T.get()});let t=Math.ceil(_.get());let i=Math.ceil(b.get());if(t<1)t=1;if(i<1)i=1;let n;const r=t*4*i;const s=S.get();const a=y.get()-s;const o=R.get();const l=N.get()-o;const u=P.get();const h=w.get()-u;const c=D.get();const f=k.get()-c;Math.randomSeed=O.get();if(e){n=new Float32Array(r);if(T.get()){for(let e=0;e<r;e+=4){n[e+0]=s+Math.seededRandom()*a;n[e+1]=o+Math.seededRandom()*l;n[e+2]=u+Math.seededRandom()*h;n[e+3]=c+Math.seededRandom()*f}}else{for(let t=0;t<r;t+=4){let e=s+Math.seededRandom()*a;n[t+0]=n[t+1]=n[t+2]=e;n[t+3]=1}}}else{n=new Uint8Array(r);if(T.get()){for(let e=0;e<r;e+=4){n[e+0]=(s+Math.seededRandom()*a)*255;n[e+1]=(o+Math.seededRandom()*l)*255;n[e+2]=(u+Math.seededRandom()*h)*255;n[e+3]=(c+Math.seededRandom()*f)*255}}else{for(let e=0;e<r;e+=4){n[e+0]=n[e+1]=n[e+2]=(s+Math.seededRandom()*a)*255;n[e+3]=255}}}if(x.get()){for(let e=0;e<n.length;e++)n[e]=Math.round(n[e]-.5)}if(!I.get())for(let e=0;e<r;e+=4)n[e+0]=0;if(!C.get())for(let e=0;e<r;e+=4)n[e+1]=0;if(!M.get())for(let e=0;e<r;e+=4)n[e+2]=0;if(!L.get())for(let e=0;e<r;e+=4)n[e+3]=0;let d=CGL.Texture.FILTER_NEAREST;if(v.get()=="linear")d=CGL.Texture.FILTER_LINEAR;let g=CGL.Texture.WRAP_REPEAT;if(A.get()=="mirrored repeat")g=CGL.Texture.WRAP_MIRRORED_REPEAT;if(A.get()=="clamp to edge")g=CGL.Texture.WRAP_CLAMP_TO_EDGE;let m=new CGL.Texture(F,{isFloatingPointTexture:e,name:"noisetexture"});m.initFromData(n,t,i,d,g);V.set(t*i);U.setRef(m);j=F.patch.loading.finished(j)}}};CABLES.OPS["b781bc6b-b2cf-44fe-80eb-a840e430d27d"]={f:Ops.Gl.Textures.NoiseTexture,objName:"Ops.Gl.Textures.NoiseTexture"};Ops.Gl.ShaderEffects.TransformTextureCoordinates=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={trans_vert:"\n#ifdef MOD_FLIPX\n    texCoord.x=1.0-texCoord.x;\n#endif\n#ifdef MOD_FLIPY\n    texCoord.y=1.0-texCoord.y;\n#endif\n\ntexCoord-=0.5;\nfloat MOD_a=MOD_rot * (2.0*3.14159265);\ntexCoord = (cos(MOD_a)*texCoord + sin(MOD_a)*vec2(texCoord.y, -texCoord.x));\ntexCoord+=0.5;\n\ntexCoord*=MOD_scale;\ntexCoord+=MOD_trans;\n"};const i=e.inTrigger("render"),n=e.outTrigger("Trigger"),r=e.inValue("Translate X",0),s=e.inValue("Translate Y",0),a=e.inValue("Repeat X",1),o=e.inValue("Repeat Y",1),l=e.inBool("Flip X",false),u=e.inBool("Flip Y",false),h=e.inFloat("Rotation",0);const c=e.patch.cgl;const f=new CGL.ShaderModifier(c,e.name,{opId:e.id});f.addModule({priority:-2,name:"MODULE_VERTEX_POSITION",srcBodyVert:t.trans_vert||""});f.addUniformVert("2f","MOD_trans",r,s);f.addUniformVert("2f","MOD_scale",a,o);f.addUniformVert("f","MOD_rot",h);l.onChange=u.onChange=d;d();function d(){f.toggleDefine("MOD_FLIPX",l.get());f.toggleDefine("MOD_FLIPY",u.get())}i.onTriggered=function(){f.bind();n.trigger();f.unbind()}}};CABLES.OPS["54eeb750-1491-4fdf-bfd5-290e1b29bafd"]={f:Ops.Gl.ShaderEffects.TransformTextureCoordinates,objName:"Ops.Gl.ShaderEffects.TransformTextureCoordinates"};Ops.Gl.ImageCompose.RepeatTexture_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={repeat_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D mulTex;\nUNI float amount;\nUNI float amountX;\nUNI float amountY;\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n    float am=amount;\n\n    float mul=1.0;\n\n    #ifdef HAS_MASK\n        mul=texture(mulTex,texCoord).r;\n    #endif\n\n    vec2 coord = vec2(\n        mod(texCoord.x*amountX*mul,1.0),\n        mod(texCoord.y*amountY*mul,1.0));\n\n    vec4 col=texture(tex,coord);\n    vec4 base=texture(tex,texCoord);\n\n\n    #ifdef CLEAR\n        base.a=0.0;\n    #endif\n\n    outColor=cgl_blendPixel(base,col,am);\n}"};const i=e.inTrigger("render"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),r=e.inValueSlider("Amount",1),s=e.inValue("x",3),a=e.inValue("y",3),o=e.outTrigger("trigger"),l=e.inBool("Clear",true),u=e.inTexture("Multiply");const h=e.patch.cgl;const c=new CGL.Shader(h,e.name,e);c.setSource(c.getDefaultVertexShader(),t.repeat_frag);const f=new CGL.Uniform(c,"t","tex",0),d=new CGL.Uniform(c,"t","mulTex",2),g=new CGL.Uniform(c,"f","amount",r),m=new CGL.Uniform(c,"f","amountX",s),p=new CGL.Uniform(c,"f","amountY",a);CGL.TextureEffect.setupBlending(e,c,n,r);l.onChange=u.onChange=_;function _(){c.toggleDefine("CLEAR",l.get());c.toggleDefine("HAS_MASK",u.get())}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;h.pushShader(c);h.currentTextureEffect.bind();h.setTexture(0,h.currentTextureEffect.getCurrentSourceTexture().tex);if(u.get())h.setTexture(2,u.get().tex);h.currentTextureEffect.finish();h.popShader();o.trigger()}}};CABLES.OPS["ff9aa796-d781-444c-a9d4-a62157f82dd5"]={f:Ops.Gl.ImageCompose.RepeatTexture_v2,objName:"Ops.Gl.ImageCompose.RepeatTexture_v2"};Ops.Gl.Phong.PhongMaterial_v6=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const o=e.attachments={phong_frag:'IN vec3 viewDirection;\nIN vec3 normInterpolated;\nIN vec2 texCoord;\n\n#ifdef AO_CHAN_1\n    #ifndef ATTRIB_texCoord1\n        #define ATTRIB_texCoord1\n\n        IN vec2 texCoord1;\n    #endif\n#endif\n\n#ifdef HAS_TEXTURE_AO\nvec2 tcAo;\n#endif\n\n\n\n#ifdef ENABLE_FRESNEL\n    IN vec4 cameraSpace_pos;\n#endif\n\n// IN mat3 normalMatrix; // when instancing...\n\n#ifdef HAS_TEXTURE_NORMAL\n    IN mat3 TBN_Matrix; // tangent bitangent normal space transform matrix\n#endif\n\nIN vec3 fragPos;\nIN vec3 v_viewDirection;\n\nUNI vec4 inDiffuseColor;\nUNI vec4 inMaterialProperties;\n\n#ifdef ADD_EMISSIVE_COLOR\n    UNI vec4 inEmissiveColor; // .w = intensity\n#endif\n\n#ifdef ENABLE_FRESNEL\n    UNI mat4 viewMatrix;\n    UNI vec4 inFresnel;\n    UNI vec2 inFresnelWidthExponent;\n#endif\n\n#ifdef ENVMAP_MATCAP\n    IN vec3 viewSpaceNormal;\n    IN vec3 viewSpacePosition;\n#endif\n\nstruct Light {\n    vec3 color;\n    vec3 position;\n    vec3 specular;\n\n\n    // * SPOT LIGHT * //\n    #ifdef HAS_SPOT\n        vec3 conePointAt;\n        #define COSCONEANGLE x\n        #define COSCONEANGLEINNER y\n        #define SPOTEXPONENT z\n        vec3 spotProperties;\n    #endif\n\n    #define INTENSITY x\n    #define ATTENUATION y\n    #define FALLOFF z\n    #define RADIUS w\n    vec4 lightProperties;\n\n    int castLight;\n};\n\n/* CONSTANTS */\n#define NONE -1\n#define ALBEDO x\n#define ROUGHNESS y\n#define SHININESS z\n#define SPECULAR_AMT w\n#define NORMAL x\n#define AO y\n#define SPECULAR z\n#define EMISSIVE w\nconst float PI = 3.1415926535897932384626433832795;\nconst float TWO_PI = (2. * PI);\nconst float EIGHT_PI = (8. * PI);\n\n#define RECIPROCAL_PI 1./PI\n#define RECIPROCAL_PI2 RECIPROCAL_PI/2.\n\n// TEXTURES\n// #ifdef HAS_TEXTURES\n    UNI vec4 inTextureIntensities;\n\n    #ifdef HAS_TEXTURE_ENV\n        #ifdef TEX_FORMAT_CUBEMAP\n            UNI samplerCube texEnv;\n            #ifndef WEBGL1\n                #define SAMPLETEX textureLod\n            #endif\n            #ifdef WEBGL1\n                #define SAMPLETEX textureCubeLodEXT\n            #endif\n        #endif\n\n        #ifdef TEX_FORMAT_EQUIRECT\n            UNI sampler2D texEnv;\n            #ifdef WEBGL1\n                // #extension GL_EXT_shader_texture_lod : enable\n                #ifdef GL_EXT_shader_texture_lod\n                    #define textureLod texture2DLodEXT\n                #endif\n                // #define textureLod texture2D\n            #endif\n\n            #define SAMPLETEX sampleEquirect\n\n            const vec2 invAtan = vec2(0.1591, 0.3183);\n            vec4 sampleEquirect(sampler2D tex,vec3 direction,float lod)\n            {\n                #ifndef WEBGL1\n                    vec3 newDirection = normalize(direction);\n            \t\tvec2 sampleUV;\n            \t\tsampleUV.x = -1. * (atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.75);\n            \t\tsampleUV.y = asin( clamp(direction.y, -1., 1.) ) * RECIPROCAL_PI + 0.5;\n                #endif\n\n                #ifdef WEBGL1\n                    vec3 newDirection = normalize(direction);\n                \t\tvec2 sampleUV = vec2(atan(newDirection.z, newDirection.x), asin(newDirection.y+1e-6));\n                        sampleUV *= vec2(0.1591, 0.3183);\n                        sampleUV += 0.5;\n                #endif\n                return textureLod(tex, sampleUV, lod);\n            }\n        #endif\n        #ifdef ENVMAP_MATCAP\n            UNI sampler2D texEnv;\n            #ifdef WEBGL1\n                // #extension GL_EXT_shader_texture_lod : enable\n                #ifdef GL_EXT_shader_texture_lod\n                    #define textureLod texture2DLodEXT\n                #endif\n                // #define textureLod texture2D\n            #endif\n\n\n            // * taken & modified from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderLib/meshmatcap_frag.glsl.js\n            vec2 getMatCapUV(vec3 viewSpacePosition, vec3 viewSpaceNormal) {\n                vec3 viewDir = normalize(-viewSpacePosition);\n            \tvec3 x = normalize(vec3(viewDir.z, 0.0, - viewDir.x));\n            \tvec3 y = normalize(cross(viewDir, x));\n            \tvec2 uv = vec2(dot(x, viewSpaceNormal), dot(y, viewSpaceNormal)) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n            \treturn uv;\n            }\n        #endif\n\n        UNI float inEnvMapIntensity;\n        UNI float inEnvMapWidth;\n    #endif\n\n    #ifdef HAS_TEXTURE_LUMINANCE_MASK\n        UNI sampler2D texLuminance;\n        UNI float inLuminanceMaskIntensity;\n    #endif\n\n    #ifdef HAS_TEXTURE_DIFFUSE\n        UNI sampler2D texDiffuse;\n    #endif\n\n    #ifdef HAS_TEXTURE_SPECULAR\n        UNI sampler2D texSpecular;\n    #endif\n\n    #ifdef HAS_TEXTURE_NORMAL\n        UNI sampler2D texNormal;\n    #endif\n\n    #ifdef HAS_TEXTURE_AO\n        UNI sampler2D texAO;\n    #endif\n\n    #ifdef HAS_TEXTURE_EMISSIVE\n        UNI sampler2D texEmissive;\n    #endif\n\n    #ifdef HAS_TEXTURE_EMISSIVE_MASK\n        UNI sampler2D texMaskEmissive;\n        UNI float inEmissiveMaskIntensity;\n    #endif\n    #ifdef HAS_TEXTURE_ALPHA\n        UNI sampler2D texAlpha;\n    #endif\n// #endif\n\n{{MODULES_HEAD}}\n\nfloat when_gt(float x, float y) { return max(sign(x - y), 0.0); } // comparator function\nfloat when_lt(float x, float y) { return max(sign(y - x), 0.0); }\nfloat when_eq(float x, float y) { return 1. - abs(sign(x - y)); } // comparator function\nfloat when_neq(float x, float y) { return abs(sign(x - y)); } // comparator function\nfloat when_ge(float x, float y) { return 1.0 - when_lt(x, y); }\nfloat when_le(float x, float y) { return 1.0 - when_gt(x, y); }\n\n#ifdef FALLOFF_MODE_A\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // * original falloff\n        float denom = distance / radius + 1.0;\n        float attenuation = 1.0 / (denom*denom);\n        float t = (attenuation - falloff) / (1.0 - falloff);\n        return max(t, 0.0);\n    }\n#endif\n\n#ifdef FALLOFF_MODE_B\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        float distanceSquared = dot(lightDirection, lightDirection);\n        float factor = distanceSquared * falloff;\n        float smoothFactor = clamp(1. - factor * factor, 0., 1.);\n        float attenuation = smoothFactor * smoothFactor;\n\n        return attenuation * 1. / max(distanceSquared, 0.00001);\n    }\n#endif\n\n#ifdef FALLOFF_MODE_C\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\n        float falloffNumerator = 1. - pow(distance/radius, 4.);\n        falloffNumerator = clamp(falloffNumerator, 0., 1.);\n        falloffNumerator *= falloffNumerator;\n\n        float denominator = distance*distance + falloff;\n\n        return falloffNumerator/denominator;\n    }\n#endif\n\n#ifdef FALLOFF_MODE_D\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // inverse square falloff, "physically correct"\n        return 1.0 / max(distance * distance, 0.0001);\n    }\n#endif\n\n#ifdef ENABLE_FRESNEL\n    float CalculateFresnel(vec3 direction, vec3 normal)\n    {\n        vec3 nDirection = normalize( direction );\n        vec3 nNormal = normalize( mat3(viewMatrix) * normal );\n        vec3 halfDirection = normalize( nNormal + nDirection );\n\n        float cosine = dot( halfDirection, nDirection );\n        float product = max( cosine, 0.0 );\n        float factor = pow(product, inFresnelWidthExponent.y);\n\n        return 5. * factor;\n    }\n#endif\n\n#ifdef CONSERVE_ENERGY\n    // http://www.rorydriscoll.com/2009/01/25/energy-conservation-in-games/\n    // http://www.farbrausch.de/~fg/articles/phong.pdf\n    float EnergyConservation(float shininess) {\n        #ifdef SPECULAR_PHONG\n            return (shininess + 2.)/TWO_PI;\n        #endif\n        #ifdef SPECULAR_BLINN\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n\n        #ifdef SPECULAR_SCHLICK\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n\n        #ifdef SPECULAR_GAUSS\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n    }\n#endif\n\n#ifdef ENABLE_OREN_NAYAR_DIFFUSE\n    float CalculateOrenNayar(vec3 lightDirection, vec3 viewDirection, vec3 normal) {\n        float LdotV = dot(lightDirection, viewDirection);\n        float NdotL = dot(lightDirection, normal);\n        float NdotV = dot(normal, viewDirection);\n\n        float albedo = inMaterialProperties.ALBEDO;\n        albedo *= 1.8;\n        float s = LdotV - NdotL * NdotV;\n        float t = mix(1., max(NdotL, NdotV), step(0., s));\n\n        float roughness = inMaterialProperties.ROUGHNESS;\n        float sigma2 = roughness * roughness;\n        float A = 1. + sigma2 * (albedo / (sigma2 + 0.13) + 0.5 / (sigma2 + 0.33));\n        float B = 0.45 * sigma2 / (sigma2 + 0.09);\n\n        float factor = albedo * max(0., NdotL) * (A + B * s / t) / PI;\n\n        return factor;\n\n    }\n#endif\n\nvec3 CalculateDiffuseColor(\n    vec3 lightDirection,\n    vec3 viewDirection,\n    vec3 normal,\n    vec3 lightColor,\n    vec3 materialColor,\n    inout float lambert\n) {\n    #ifndef ENABLE_OREN_NAYAR_DIFFUSE\n        lambert = clamp(dot(lightDirection, normal), 0., 1.);\n    #endif\n\n    #ifdef ENABLE_OREN_NAYAR_DIFFUSE\n        lambert = CalculateOrenNayar(lightDirection, viewDirection, normal);\n    #endif\n\n    vec3 diffuseColor = lambert * lightColor * materialColor;\n    return diffuseColor;\n}\n\nvec3 CalculateSpecularColor(\n    vec3 specularColor,\n    float specularCoefficient,\n    float shininess,\n    vec3 lightDirection,\n    vec3 viewDirection,\n    vec3 normal,\n    float lambertian\n) {\n    vec3 resultColor = vec3(0.);\n\n    #ifdef SPECULAR_PHONG\n        vec3 reflectDirection = reflect(-lightDirection, normal);\n        float specularAngle = max(dot(reflectDirection, viewDirection), 0.);\n        float specularFactor = pow(specularAngle, max(0., shininess));\n    resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_BLINN\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = max(dot(halfDirection, normal), 0.);\n        float specularFactor = pow(specularAngle, max(0., shininess));\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_SCHLICK\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = dot(halfDirection, normal);\n        float schlickShininess = max(0., shininess);\n        float specularFactor = specularAngle / (schlickShininess - schlickShininess*specularAngle + specularAngle);\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_GAUSS\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = acos(max(dot(halfDirection, normal), 0.));\n        float exponent = specularAngle * shininess * 0.17;\n        exponent = -(exponent*exponent);\n        float specularFactor = exp(exponent);\n\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef CONSERVE_ENERGY\n        float conserveEnergyFactor = EnergyConservation(shininess);\n        resultColor = conserveEnergyFactor * resultColor;\n    #endif\n\n    return resultColor;\n}\n\n#ifdef HAS_SPOT\n    float CalculateSpotLightEffect(vec3 lightPosition, vec3 conePointAt, float cosConeAngle, float cosConeAngleInner, float spotExponent, vec3 lightDirection) {\n        vec3 spotLightDirection = normalize(lightPosition-conePointAt);\n        float spotAngle = dot(-lightDirection, spotLightDirection);\n        float epsilon = cosConeAngle - cosConeAngleInner;\n\n        float spotIntensity = clamp((spotAngle - cosConeAngle)/epsilon, 0.0, 1.0);\n        spotIntensity = pow(spotIntensity, max(0.01, spotExponent));\n\n        return max(0., spotIntensity);\n    }\n#endif\n\n\n\n{{PHONG_FRAGMENT_HEAD}}\n\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n\n    vec4 col=vec4(0., 0., 0., inDiffuseColor.a);\n    vec3 calculatedColor = vec3(0.);\n    vec3 normal = normalize(normInterpolated);\n    vec3 baseColor = inDiffuseColor.rgb;\n\n    {{MODULE_BASE_COLOR}}\n\n\n\n    #ifdef AO_CHAN_0\n        vec2 tcAo=texCoord;\n    #endif\n    #ifdef AO_CHAN_1\n        vec2 tcAo=texCoord1;\n    #endif\n\n\n    vec3 viewDirection = normalize(v_viewDirection);\n\n    #ifdef DOUBLE_SIDED\n        if(!gl_FrontFacing) normal = normal * -1.0;\n    #endif\n\n    #ifdef HAS_TEXTURES\n        #ifdef HAS_TEXTURE_DIFFUSE\n            baseColor = texture(texDiffuse, texCoord).rgb;\n\n            #ifdef COLORIZE_TEXTURE\n                baseColor *= inDiffuseColor.rgb;\n            #endif\n        #endif\n\n        #ifdef HAS_TEXTURE_NORMAL\n            normal = texture(texNormal, texCoord).rgb;\n            normal = normalize(normal * 2. - 1.);\n            float normalIntensity = inTextureIntensities.NORMAL;\n            normal = normalize(mix(vec3(0., 0., 1.), normal, 2. * normalIntensity));\n            normal = normalize(TBN_Matrix * normal);\n        #endif\n    #endif\n\n    {{PHONG_FRAGMENT_BODY}}\n\n\n\n\n\n\n    #ifdef ENABLE_FRESNEL\n        calculatedColor += inFresnel.rgb * (CalculateFresnel(vec3(cameraSpace_pos), normal) * inFresnel.w * inFresnelWidthExponent.x);\n    #endif\n\n     #ifdef HAS_TEXTURE_ALPHA\n        #ifdef ALPHA_MASK_ALPHA\n            col.a*=texture(texAlpha,texCoord).a;\n        #endif\n        #ifdef ALPHA_MASK_LUMI\n            col.a*= dot(vec3(0.2126,0.7152,0.0722), texture(texAlpha,texCoord).rgb);\n        #endif\n        #ifdef ALPHA_MASK_R\n            col.a*=texture(texAlpha,texCoord).r;\n        #endif\n        #ifdef ALPHA_MASK_G\n            col.a*=texture(texAlpha,texCoord).g;\n        #endif\n        #ifdef ALPHA_MASK_B\n            col.a*=texture(texAlpha,texCoord).b;\n        #endif\n    #endif\n\n    #ifdef DISCARDTRANS\n        if(col.a<0.2) discard;\n    #endif\n\n\n    #ifdef HAS_TEXTURE_ENV\n        vec3 luminanceColor = vec3(0.);\n\n        #ifndef ENVMAP_MATCAP\n            float environmentMapWidth = inEnvMapWidth;\n            float glossyExponent = inMaterialProperties.SHININESS;\n            float glossyCoefficient = inMaterialProperties.SPECULAR_AMT;\n\n            vec3 envMapNormal =  normal;\n            vec3 reflectDirection = reflect(normalize(-viewDirection), normal);\n\n            float lambertianCoefficient = dot(viewDirection, reflectDirection); //0.44; // TODO: need prefiltered map for this\n            // lambertianCoefficient = 1.;\n            float specularAngle = max(dot(reflectDirection, viewDirection), 0.);\n            float specularFactor = pow(specularAngle, max(0., inMaterialProperties.SHININESS));\n\n            glossyExponent = specularFactor;\n\n            float maxMIPLevel = 10.;\n            float MIPlevel = log2(environmentMapWidth / 1024. * sqrt(3.)) - 0.5 * log2(glossyExponent + 1.);\n\n            luminanceColor = inEnvMapIntensity * (\n                inDiffuseColor.rgb *\n                SAMPLETEX(texEnv, envMapNormal, maxMIPLevel).rgb\n                +\n                glossyCoefficient * SAMPLETEX(texEnv, reflectDirection, MIPlevel).rgb\n            );\n        #endif\n        #ifdef ENVMAP_MATCAP\n            luminanceColor = inEnvMapIntensity * (\n                texture(texEnv, getMatCapUV(viewSpacePosition, viewSpaceNormal)).rgb\n                //inDiffuseColor.rgb\n                //* textureLod(texEnv, getMatCapUV(envMapNormal), maxMIPLevel).rgb\n                //+\n                //glossyCoefficient * textureLod(texEnv, getMatCapUV(reflectDirection), MIPlevel).rgb\n            );\n        #endif\n\n\n\n        #ifdef HAS_TEXTURE_LUMINANCE_MASK\n            luminanceColor *= texture(texLuminance, texCoord).r * inLuminanceMaskIntensity;\n        #endif\n\n        #ifdef HAS_TEXTURE_AO\n            luminanceColor *= texture(texAO, tcAo).r*inTextureIntensities.AO;\n        #endif\n\n        #ifdef ENV_BLEND_ADD\n            calculatedColor.rgb += luminanceColor;\n        #endif\n        #ifdef ENV_BLEND_MUL\n            calculatedColor.rgb *= luminanceColor;\n        #endif\n\n        #ifdef ENV_BLEND_MIX\n            calculatedColor.rgb=mix(luminanceColor,calculatedColor.rgb,luminanceColor);\n        #endif\n\n\n    #endif\n\n    #ifdef ADD_EMISSIVE_COLOR\n        vec3 emissiveRadiance = mix(calculatedColor, inEmissiveColor.rgb, inEmissiveColor.w); // .w = intensity of color;\n\n        #ifdef HAS_TEXTURE_EMISSIVE\n            float emissiveIntensity = inTextureIntensities.EMISSIVE;\n            emissiveRadiance = mix(calculatedColor, texture(texEmissive, texCoord).rgb, emissiveIntensity);\n        #endif\n\n        #ifdef HAS_TEXTURE_EMISSIVE_MASK\n           float emissiveMixValue = mix(1., texture(texMaskEmissive, texCoord).r, inEmissiveMaskIntensity);\n           calculatedColor = mix(calculatedColor, emissiveRadiance, emissiveMixValue);\n        #endif\n\n        #ifndef HAS_TEXTURE_EMISSIVE_MASK\n            calculatedColor = emissiveRadiance;\n        #endif\n    #endif\n\n    col.rgb = clamp(calculatedColor, 0., 1.);\n\n\n    {{MODULE_COLOR}}\n\n    outColor = col;\n\n}\n',phong_vert:"\n{{MODULES_HEAD}}\n\n#define NONE -1\n#define AMBIENT 0\n#define POINT 1\n#define DIRECTIONAL 2\n#define SPOT 3\n\n#define TEX_REPEAT_X x;\n#define TEX_REPEAT_Y y;\n#define TEX_OFFSET_X z;\n#define TEX_OFFSET_Y w;\n\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN float attrVertIndex;\nIN vec3 attrTangent;\nIN vec3 attrBiTangent;\n\nOUT vec2 texCoord;\nOUT vec3 normInterpolated;\nOUT vec3 fragPos;\n\n#ifdef AO_CHAN_1\n    #ifndef ATTRIB_attrTexCoord1\n        IN vec2 attrTexCoord1;\n        OUT vec2 texCoord1;\n        #define ATTRIB_attrTexCoord1\n        #define ATTRIB_texCoord1\n    #endif\n#endif\n\n#ifdef HAS_TEXTURE_NORMAL\n    OUT mat3 TBN_Matrix; // tangent bitangent normal space transform matrix\n#endif\n\n#ifdef ENABLE_FRESNEL\n    OUT vec4 cameraSpace_pos;\n#endif\n\nOUT vec3 v_viewDirection;\nOUT mat3 normalMatrix;\nOUT mat4 mvMatrix;\n\n#ifdef HAS_TEXTURES\n    UNI vec4 inTextureRepeatOffset;\n#endif\n\nUNI vec3 camPos;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\n#ifdef ENVMAP_MATCAP\n    OUT vec3 viewSpaceNormal;\n    OUT vec3 viewSpacePosition;\n#endif\n\n\nmat3 transposeMat3(mat3 m)\n{\n    return mat3(m[0][0], m[1][0], m[2][0],\n        m[0][1], m[1][1], m[2][1],\n        m[0][2], m[1][2], m[2][2]);\n}\n\nmat3 inverseMat3(mat3 m)\n{\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n    float b01 = a22 * a11 - a12 * a21;\n    float b11 = -a22 * a10 + a12 * a20;\n    float b21 = a21 * a10 - a11 * a20;\n\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n        b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n        b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nvoid main()\n{\n    mat4 mMatrix=modelMatrix;\n    vec4 pos=vec4(vPosition,  1.0);\n\n    texCoord=attrTexCoord;\n    texCoord.y = 1. - texCoord.y;\n\n    #ifdef ATTRIB_texCoord1\n        texCoord1=attrTexCoord1;\n    #endif\n\n    vec3 norm=attrVertNormal;\n    vec3 tangent = attrTangent;\n    vec3 bitangent = attrBiTangent;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    normalMatrix = transposeMat3(inverseMat3(mat3(mMatrix)));\n    mvMatrix = (viewMatrix * mMatrix);\n\n\n\n    #ifdef ENABLE_FRESNEL\n        cameraSpace_pos = mvMatrix * pos;\n    #endif\n\n    #ifdef HAS_TEXTURES\n        float repeatX = inTextureRepeatOffset.TEX_REPEAT_X;\n        float offsetX = inTextureRepeatOffset.TEX_OFFSET_X;\n        float repeatY = inTextureRepeatOffset.TEX_REPEAT_Y;\n        float offsetY = inTextureRepeatOffset.TEX_OFFSET_Y;\n\n        texCoord.x *= repeatX;\n        texCoord.x += offsetX;\n        texCoord.y *= repeatY;\n        texCoord.y += offsetY;\n    #endif\n\n   normInterpolated = vec3(normalMatrix*norm);\n\n    #ifdef HAS_TEXTURE_NORMAL\n        vec3 normCameraSpace = normalize((vec4(normInterpolated, 0.0)).xyz);\n        vec3 tangCameraSpace = normalize((mMatrix * vec4(tangent, 0.0)).xyz);\n        vec3 bitangCameraSpace = normalize((mMatrix * vec4(bitangent, 0.0)).xyz);\n\n        // re orthogonalization for smoother normals\n        tangCameraSpace = normalize(tangCameraSpace - dot(tangCameraSpace, normCameraSpace) * normCameraSpace);\n        bitangCameraSpace = cross(normCameraSpace, tangCameraSpace);\n\n        TBN_Matrix = mat3(tangCameraSpace, bitangCameraSpace, normCameraSpace);\n    #endif\n\n    fragPos = vec3((mMatrix) * pos);\n    v_viewDirection = normalize(camPos - fragPos);\n    // modelPos=mMatrix*pos;\n\n    #ifdef ENVMAP_MATCAP\n        mat3 viewSpaceNormalMatrix = normalMatrix = transposeMat3(inverseMat3(mat3(mvMatrix)));\n        viewSpaceNormal = normalize(viewSpaceNormalMatrix * norm);\n        viewSpacePosition = vec3(mvMatrix * pos);\n    #endif\n\n    mat4 modelViewMatrix=mvMatrix;\n    {{MODULE_VERTEX_MODELVIEW}}\n\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n",snippet_body_ambient_frag:"    // * AMBIENT LIGHT {{LIGHT_INDEX}} *\n    vec3 diffuseColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY*phongLight{{LIGHT_INDEX}}.color;\n    calculatedColor += diffuseColor{{LIGHT_INDEX}};\n",snippet_body_directional_frag:"    // * DIRECTIONAL LIGHT {{LIGHT_INDEX}} *\n\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = normalize(phongLight{{LIGHT_INDEX}}.position);\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                // lightColor{{LIGHT_INDEX}} *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n                lightColor{{LIGHT_INDEX}} *= texture(texAO, tcAo).g, inTextureIntensities.AO;\n\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        vec3 lightModelDiff{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }",snippet_body_point_frag:"// * POINT LIGHT {{LIGHT_INDEX}} *\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n        // * get length before normalization for falloff calculation\n        phongLightDirection{{LIGHT_INDEX}} = normalize(phongLightDirection{{LIGHT_INDEX}});\n        float phongLightDistance{{LIGHT_INDEX}} = length(phongLightDirection{{LIGHT_INDEX}});\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                lightColor{{LIGHT_INDEX}} -= (1.0-texture(texAO, tcAo).g)* (inTextureIntensities.AO);\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n\n        float attenuation{{LIGHT_INDEX}} = CalculateFalloff(\n            phongLightDistance{{LIGHT_INDEX}},\n            phongLightDirection{{LIGHT_INDEX}},\n            phongLight{{LIGHT_INDEX}}.lightProperties.FALLOFF,\n            phongLight{{LIGHT_INDEX}}.lightProperties.RADIUS\n        );\n\n        attenuation{{LIGHT_INDEX}} *= when_gt(phongLambert{{LIGHT_INDEX}}, 0.);\n        combinedColor{{LIGHT_INDEX}} *= attenuation{{LIGHT_INDEX}};\n\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }\n",snippet_body_spot_frag:"    // * SPOT LIGHT {{LIGHT_INDEX}} *\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n        phongLightDirection{{LIGHT_INDEX}} = normalize( phongLightDirection{{LIGHT_INDEX}});\n        float phongLightDistance{{LIGHT_INDEX}} = length(phongLightDirection{{LIGHT_INDEX}});\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                // lightColor{{LIGHT_INDEX}} *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n                lightColor{{LIGHT_INDEX}} *= texture(texAO, texCoord).g, inTextureIntensities.AO;\n\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        float spotIntensity{{LIGHT_INDEX}} = CalculateSpotLightEffect(\n            phongLight{{LIGHT_INDEX}}.position, phongLight{{LIGHT_INDEX}}.conePointAt, phongLight{{LIGHT_INDEX}}.spotProperties.COSCONEANGLE,\n            phongLight{{LIGHT_INDEX}}.spotProperties.COSCONEANGLEINNER, phongLight{{LIGHT_INDEX}}.spotProperties.SPOTEXPONENT,\n            phongLightDirection{{LIGHT_INDEX}}\n        );\n\n        combinedColor{{LIGHT_INDEX}} *= spotIntensity{{LIGHT_INDEX}};\n\n        vec3 lightModelDiff{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n\n        float attenuation{{LIGHT_INDEX}} = CalculateFalloff(\n            phongLightDistance{{LIGHT_INDEX}},\n            phongLightDirection{{LIGHT_INDEX}},\n            phongLight{{LIGHT_INDEX}}.lightProperties.FALLOFF,\n            phongLight{{LIGHT_INDEX}}.lightProperties.RADIUS\n        );\n\n        attenuation{{LIGHT_INDEX}} *= when_gt(phongLambert{{LIGHT_INDEX}}, 0.);\n\n        combinedColor{{LIGHT_INDEX}} *= attenuation{{LIGHT_INDEX}};\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }",snippet_head_frag:"UNI Light phongLight{{LIGHT_INDEX}};\n"};const t=e.patch.cgl;const k=o.snippet_head_frag;const U={point:o.snippet_body_point_frag,spot:o.snippet_body_spot_frag,ambient:o.snippet_body_ambient_frag,directional:o.snippet_body_directional_frag,area:o.snippet_body_area_frag};const V=new RegExp("{{LIGHT_INDEX}}","g");const F=e=>{return k.replace("{{LIGHT_INDEX}}",e)};const j=(e,t)=>{return U[t].replace(V,e)};function B(){const e=o.phong_vert;let t=o.phong_frag;let i=F(0);let n=j(0,rt[0].type);t=t.replace(Ee,i);t=t.replace(xe,n);R.setSource(e,t);R.define("HAS_POINT");R.removeDefine("HAS_SPOT");R.removeDefine("HAS_DIRECTIONAL");R.removeDefine("HAS_AMBIENT")}const G=e.inTrigger("Trigger In");const z=e.inFloat("R",Math.random());const H=e.inFloat("G",Math.random());const X=e.inFloat("B",Math.random());const q=e.inFloatSlider("A",1);const Y=[z,H,X,q];e.setPortGroup("Diffuse Color",Y);const i=e.inBool("Enable",false);const n=e.inFloatSlider("Albedo",.707);const r=e.inFloatSlider("Roughness",.835);i.setUiAttribs({hidePort:true});n.setUiAttribs({greyout:true});r.setUiAttribs({greyout:true});z.setUiAttribs({colorPick:true});e.setPortGroup("Oren-Nayar Diffuse",[i,n,r]);e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);i.onChange=function(){R.toggleDefine("ENABLE_OREN_NAYAR_DIFFUSE",i);n.setUiAttribs({greyout:!i.get()});r.setUiAttribs({greyout:!i.get()})};const s=e.inValueBool("Active",false);s.setUiAttribs({hidePort:true});const W=e.inValueSlider("Fresnel Intensity",.7);const K=e.inFloat("Fresnel Width",1);const Q=e.inFloat("Fresnel Exponent",6);const Z=e.inFloat("Fresnel R",1);const J=e.inFloat("Fresnel G",1);const $=e.inFloat("Fresnel B",1);Z.setUiAttribs({colorPick:true});const ee=[W,K,Q,Z,J,$];ee.forEach(function(e){e.setUiAttribs({greyout:true})});e.setPortGroup("Fresnel",ee.concat([s]));let a=null;let te=null;s.onChange=function(){R.toggleDefine("ENABLE_FRESNEL",s);if(s.get()){if(!a)a=new CGL.Uniform(R,"4f","inFresnel",Z,J,$,W);if(!te)te=new CGL.Uniform(R,"2f","inFresnelWidthExponent",K,Q)}else{if(a){R.removeUniform("inFresnel");a=null}if(te){R.removeUniform("inFresnelWidthExponent");te=null}}ee.forEach(function(e){e.setUiAttribs({greyout:!s.get()})})};const l=e.inBool("Emissive Active",false);const u=e.inFloatSlider("Color Intensity",.3);const h=e.inFloatSlider("Emissive R",Math.random());const c=e.inFloatSlider("Emissive G",Math.random());const f=e.inFloatSlider("Emissive B",Math.random());h.setUiAttribs({colorPick:true});e.setPortGroup("Emissive Color",[l,u,h,c,f]);u.setUiAttribs({greyout:!l.get()});h.setUiAttribs({greyout:!l.get()});c.setUiAttribs({greyout:!l.get()});f.setUiAttribs({greyout:!l.get()});let ie=null;l.onChange=()=>{R.toggleDefine("ADD_EMISSIVE_COLOR",l);if(l.get()){ie=new CGL.Uniform(R,"4f","inEmissiveColor",h,c,f,u);v.setUiAttribs({greyout:false});A.setUiAttribs({greyout:false});if(v.get())O.setUiAttribs({greyout:false});if(A.get())I.setUiAttribs({greyout:false})}else{e.log("ayayay");v.setUiAttribs({greyout:true});A.setUiAttribs({greyout:true});O.setUiAttribs({greyout:true});I.setUiAttribs({greyout:true});R.removeUniform("inEmissiveColor");ie=null}if(v.get()){u.setUiAttribs({greyout:true});h.setUiAttribs({greyout:true});c.setUiAttribs({greyout:true});f.setUiAttribs({greyout:true})}else{if(l.get()){u.setUiAttribs({greyout:false});h.setUiAttribs({greyout:false});c.setUiAttribs({greyout:false});f.setUiAttribs({greyout:false})}else{u.setUiAttribs({greyout:true});h.setUiAttribs({greyout:true});c.setUiAttribs({greyout:true});f.setUiAttribs({greyout:true})}}};const ne=e.inFloat("Shininess",4);const re=e.inFloatSlider("Specular Amount",.5);const d=e.inSwitch("Specular Model",["Blinn","Schlick","Phong","Gauss"],"Blinn");d.setUiAttribs({hidePort:true});const se=[ne,re,d];e.setPortGroup("Specular",se);const ae=e.inValueBool("Energy Conservation",false);const oe=e.inBool("Double Sided Material",false);const g=e.inSwitch("Falloff Mode",["A","B","C","D"],"A");ae.setUiAttribs({hidePort:true});oe.setUiAttribs({hidePort:true});g.setUiAttribs({hidePort:true});g.onChange=()=>{const e=["A","B","C","D"];R.define("FALLOFF_MODE_"+g.get());e.filter(e=>{return e!==g.get()}).forEach(e=>{return R.removeDefine("FALLOFF_MODE_"+e)})};const le=[ae,oe,g];e.setPortGroup("Light Options",le);const m=e.inTexture("Diffuse Texture");const p=e.inTexture("Specular Texture");const _=e.inTexture("Normal Map");const b=e.inTexture("AO Texture");const v=e.inTexture("Emissive Texture");const A=e.inTexture("Emissive Mask");const T=e.inTexture("Opacity Texture");const E=e.inTexture("Environment Map");const x=e.inTexture("Env Map Mask");e.setPortGroup("Textures",[m,p,_,b,v,A,T,E,x]);const ue=e.inBool("Colorize Texture",false);const he=e.inFloat("Diffuse Repeat X",1);const ce=e.inFloat("Diffuse Repeat Y",1);const fe=e.inFloat("Texture Offset X",0);const de=e.inFloat("Texture Offset Y",0);const ge=e.inFloatSlider("Specular Intensity",1);const me=e.inFloatSlider("Normal Map Intensity",.5);const pe=e.inFloatSlider("AO Intensity",1);const _e=e.inSwitch("AO UV Channel",["1","2"],1);const O=e.inFloatSlider("Emissive Intensity",1);const I=e.inFloatSlider("Emissive Mask Intensity",1);const be=e.inFloatSlider("Env Map Intensity",1);const S=e.inSwitch("Env Map Blend",["Add","Multiply","Mix"],"Add");const ve=e.inFloatSlider("Env Mask Intensity",1);ue.setUiAttribs({hidePort:true});e.setPortGroup("Texture Transforms",[ue,ce,he,de,fe]);e.setPortGroup("Texture Intensities",[me,pe,ge,O,S,I,be,ve]);const y=e.inSwitch("Alpha Mask Source",["Luminance","R","G","B","A"],"Luminance");y.setUiAttribs({greyout:true});const C=e.inValueBool("Discard Transparent Pixels");C.setUiAttribs({hidePort:true});e.setPortGroup("Opacity Texture",[y,C]);_e.onChange=S.onChange=y.onChange=He;const Ae=e.outTrigger("Trigger Out");const Te=e.outObject("Shader",null,"shader");Te.ignoreValueSerialize=true;const R=new CGL.Shader(t,"phongmaterial_"+e.id,this);R.op=this;R.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_BASE_COLOR","MODULE_VERTEX_MODELVIEW"]);R.setSource(o.simosphong_vert,o.simosphong_frag);R.define("FALLOFF_MODE_A");if(t.glVersion<2){R.enableExtension("GL_OES_standard_derivatives");if(t.enableExtension("OES_texture_float"))R.enableExtension("GL_OES_texture_float");else e.log("error loading extension OES_texture_float");if(t.enableExtension("OES_texture_float_linear"))R.enableExtension("GL_OES_texture_float_linear");else e.log("error loading extention OES_texture_float_linear");if(t.enableExtension("GL_OES_texture_half_float"))R.enableExtension("GL_OES_texture_half_float");else e.log("error loading extention GL_OES_texture_half_float");if(t.enableExtension("GL_OES_texture_half_float_linear"))R.enableExtension("GL_OES_texture_half_float_linear");else e.log("error loading extention GL_OES_texture_half_float_linear")}const Ee=new RegExp("{{PHONG_FRAGMENT_HEAD}}","g");const xe=new RegExp("{{PHONG_FRAGMENT_BODY}}","g");const N={directional:false,spot:false,ambient:false,point:false};function Oe(t){let e=o.phong_frag;let i="";let n="";N.directional=false;N.spot=false;N.ambient=false;N.point=false;for(let e=0;e<t.length;e+=1){const r=t[e];const s=r.type;if(!N[s]){N[s]=true}i=i.concat(F(e));n=n.concat(j(e,r.type))}e=e.replace(Ee,i);e=e.replace(xe,n);R.setSource(o.phong_vert,e);for(let e=0,t=Object.keys(N);e<t.length;e+=1){const a=t[e];if(N[a]){if(!R.hasDefine("HAS_"+a.toUpperCase())){R.define("HAS_"+a.toUpperCase())}}else{if(R.hasDefine("HAS_"+a.toUpperCase())){R.removeDefine("HAS_"+a.toUpperCase())}}}}Te.setRef(R);let Ie=null;let Se=null;let ye=null;let Ce=null;let Re=null;let Ne=null;let Me=null;let M=null;let P=null;let w=null;let Pe=null;let we=null;let Le=null;ue.onChange=function(){R.toggleDefine("COLORIZE_TEXTURE",ue.get())};function De(){if(m.get()){if(!R.hasDefine("HAS_TEXTURE_DIFFUSE")){R.define("HAS_TEXTURE_DIFFUSE");if(!Ie)Ie=new CGL.Uniform(R,"t","texDiffuse",0)}}else{R.removeUniform("texDiffuse");R.removeDefine("HAS_TEXTURE_DIFFUSE");Ie=null}}function ke(){if(p.get()){ge.setUiAttribs({greyout:false});if(!R.hasDefine("HAS_TEXTURE_SPECULAR")){R.define("HAS_TEXTURE_SPECULAR");if(!Se)Se=new CGL.Uniform(R,"t","texSpecular",0)}}else{ge.setUiAttribs({greyout:true});R.removeUniform("texSpecular");R.removeDefine("HAS_TEXTURE_SPECULAR");Se=null}}function Ue(){if(_.get()){me.setUiAttribs({greyout:false});if(!R.hasDefine("HAS_TEXTURE_NORMAL")){R.define("HAS_TEXTURE_NORMAL");if(!ye)ye=new CGL.Uniform(R,"t","texNormal",0)}}else{me.setUiAttribs({greyout:true});R.removeUniform("texNormal");R.removeDefine("HAS_TEXTURE_NORMAL");ye=null}}Ce=new CGL.Uniform(R,"t","texAO");function Ve(){R.toggleDefine("HAS_TEXTURE_AO",b.get());pe.setUiAttribs({greyout:!b.get()})}function Fe(){if(v.get()){h.setUiAttribs({greyout:true});c.setUiAttribs({greyout:true});f.setUiAttribs({greyout:true});u.setUiAttribs({greyout:true});if(l.get()){O.setUiAttribs({greyout:false})}if(!R.hasDefine("HAS_TEXTURE_EMISSIVE")){R.define("HAS_TEXTURE_EMISSIVE");if(!Re)Re=new CGL.Uniform(R,"t","texEmissive",0)}}else{O.setUiAttribs({greyout:true});if(l.get()){h.setUiAttribs({greyout:false});c.setUiAttribs({greyout:false});f.setUiAttribs({greyout:false});u.setUiAttribs({greyout:false})}else{v.setUiAttribs({greyout:true})}R.removeUniform("texEmissive");R.removeDefine("HAS_TEXTURE_EMISSIVE");Re=null}}function je(){if(A.get()){if(l.get()){I.setUiAttribs({greyout:false})}if(!R.hasDefine("HAS_TEXTURE_EMISSIVE_MASK")){R.define("HAS_TEXTURE_EMISSIVE_MASK");if(!Ne)Ne=new CGL.Uniform(R,"t","texMaskEmissive",0);if(!Me)Me=new CGL.Uniform(R,"f","inEmissiveMaskIntensity",I)}}else{if(!l.get()){A.setUiAttribs({greyout:true})}I.setUiAttribs({greyout:true});R.removeUniform("texMaskEmissive");R.removeUniform("inEmissiveMaskIntensity");R.removeDefine("HAS_TEXTURE_EMISSIVE_MASK");Ne=null;Me=null}}let Be=false;function Ge(){R.toggleDefine("HAS_TEXTURE_ENV",E.get());be.setUiAttribs({greyout:!E.get()});if(E.get()){if(!P)P=new CGL.Uniform(R,"t","texEnv",0);R.toggleDefine("TEX_FORMAT_CUBEMAP",E.get().cubemap);if(E.get().cubemap){R.removeDefine("TEX_FORMAT_EQUIRECT");R.removeDefine("ENVMAP_MATCAP");if(!w)w=new CGL.Uniform(R,"f","inEnvMapIntensity",be);if(!Pe)Pe=new CGL.Uniform(R,"f","inEnvMapWidth",E.get().cubemap.width)}else{const e=E.get().width===E.get().height;R.toggleDefine("TEX_FORMAT_EQUIRECT",!e);R.toggleDefine("ENVMAP_MATCAP",e);if(!w)w=new CGL.Uniform(R,"f","inEnvMapIntensity",be);if(!Pe)Pe=new CGL.Uniform(R,"f","inEnvMapWidth",E.get().width)}}else{R.removeUniform("inEnvMapIntensity");R.removeUniform("inEnvMapWidth");R.removeUniform("texEnv");R.removeDefine("HAS_TEXTURE_ENV");R.removeDefine("ENVMAP_MATCAP");P=null;w=null}Be=false}function ze(){if(x.get()){ve.setUiAttribs({greyout:false});if(!we){R.define("HAS_TEXTURE_LUMINANCE_MASK");we=new CGL.Uniform(R,"t","texLuminance",0);Le=new CGL.Uniform(R,"f","inLuminanceMaskIntensity",ve)}}else{ve.setUiAttribs({greyout:true});R.removeDefine("HAS_TEXTURE_LUMINANCE_MASK");R.removeUniform("inLuminanceMaskIntensity");R.removeUniform("texLuminance");we=null;Le=null}}function He(){R.toggleDefine("ENV_BLEND_ADD",S.get()=="Add");R.toggleDefine("ENV_BLEND_MUL",S.get()=="Multiply");R.toggleDefine("ENV_BLEND_MIX",S.get()=="Mix");R.toggleDefine("ALPHA_MASK_ALPHA",y.get()=="A"||y.get()=="Alpha");R.toggleDefine("ALPHA_MASK_LUMI",y.get()=="Luminance");R.toggleDefine("ALPHA_MASK_R",y.get()=="R");R.toggleDefine("ALPHA_MASK_G",y.get()=="G");R.toggleDefine("ALPHA_MASK_B",y.get()=="B");R.toggleDefine("AO_CHAN_0",_e.get()=="1");R.toggleDefine("AO_CHAN_1",_e.get()=="2")}function Xe(){if(T.get()){if(M!==null)return;R.removeUniform("texAlpha");R.define("HAS_TEXTURE_ALPHA");if(!M)M=new CGL.Uniform(R,"t","texAlpha",0);y.setUiAttribs({greyout:false});C.setUiAttribs({greyout:false})}else{R.removeUniform("texAlpha");R.removeDefine("HAS_TEXTURE_ALPHA");M=null;y.setUiAttribs({greyout:true});C.setUiAttribs({greyout:true})}He()}C.onChange=function(){R.toggleDefine("DISCARDTRANS",C.get())};m.onChange=De;p.onChange=ke;_.onChange=Ue;b.onChange=Ve;v.onChange=Fe;A.onChange=je;T.onChange=Xe;E.onChange=()=>{Be=true};x.onChange=ze;const qe=t.maxUniformsFrag;const Ye=qe===64?6:16;R.define("MAX_LIGHTS",Ye.toString());R.define("SPECULAR_PHONG");d.onChange=function(){if(d.get()==="Phong"){R.define("SPECULAR_PHONG");R.removeDefine("SPECULAR_BLINN");R.removeDefine("SPECULAR_GAUSS");R.removeDefine("SPECULAR_SCHLICK")}else if(d.get()==="Blinn"){R.define("SPECULAR_BLINN");R.removeDefine("SPECULAR_PHONG");R.removeDefine("SPECULAR_GAUSS");R.removeDefine("SPECULAR_SCHLICK")}else if(d.get()==="Gauss"){R.define("SPECULAR_GAUSS");R.removeDefine("SPECULAR_BLINN");R.removeDefine("SPECULAR_PHONG");R.removeDefine("SPECULAR_SCHLICK")}else if(d.get()==="Schlick"){R.define("SPECULAR_SCHLICK");R.removeDefine("SPECULAR_BLINN");R.removeDefine("SPECULAR_PHONG");R.removeDefine("SPECULAR_GAUSS")}};ae.onChange=function(){R.toggleDefine("CONSERVE_ENERGY",ae.get())};oe.onChange=function(){R.toggleDefine("DOUBLE_SIDED",oe.get())};const We=new CGL.Uniform(R,"4f","inMaterialProperties",n,r,ne,re);const Ke=new CGL.Uniform(R,"4f","inDiffuseColor",z,H,X,q);const Qe=new CGL.Uniform(R,"4f","inTextureIntensities",me,pe,ge,O);const Ze=new CGL.Uniform(R,"4f","inTextureRepeatOffset",he,ce,fe,de);R.uniformColorDiffuse=Ke;const L=[];let Je=0;function $e(t){for(let e=0;e<L.length;e+=1){L[e]=null}for(let e=0;e<t;e+=1){L[e]=null;if(!L[e]){L[e]={color:new CGL.Uniform(R,"3f","phongLight"+e+".color",[1,1,1]),position:new CGL.Uniform(R,"3f","phongLight"+e+".position",[0,11,0]),specular:new CGL.Uniform(R,"3f","phongLight"+e+".specular",[1,1,1]),lightProperties:new CGL.Uniform(R,"4f","phongLight"+e+".lightProperties",[1,1,1,1]),conePointAt:new CGL.Uniform(R,"3f","phongLight"+e+".conePointAt",vec3.create()),spotProperties:new CGL.Uniform(R,"3f","phongLight"+e+".spotProperties",[0,0,0,0]),castLight:new CGL.Uniform(R,"i","phongLight"+e+".castLight",1)}}}}function et(e){D.position.setValue(e.position);D.color.setValue(e.color);D.specular.setValue(e.specular);D.lightProperties.setValue([e.intensity,e.attenuation,e.falloff,e.radius]);D.conePointAt.setValue(e.conePointAt);D.spotProperties.setValue([e.cosConeAngle,e.cosConeAngleInner,e.spotExponent])}function tt(t){for(let e=0;e<t.length;e+=1){const i=t[e];i.isUsed=true;L[e].position.setValue(i.position);L[e].color.setValue(i.color);L[e].specular.setValue(i.specular);L[e].lightProperties.setValue([i.intensity,i.attenuation,i.falloff,i.radius]);L[e].conePointAt.setValue(i.conePointAt);L[e].spotProperties.setValue([i.cosConeAngle,i.cosConeAngleInner,i.spotExponent]);L[e].castLight.setValue(i.castLight)}}function it(e){if(e.length!==Je){Oe(e);$e(e.length);Je=e.length;tt(e)}else{tt(e)}}let D=null;function nt(){D={color:new CGL.Uniform(R,"3f","phongLight"+0+".color",[1,1,1]),specular:new CGL.Uniform(R,"3f","phongLight"+0+".specular",[1,1,1]),position:new CGL.Uniform(R,"3f","phongLight"+0+".position",[0,11,0]),lightProperties:new CGL.Uniform(R,"4f","phongLight"+0+".lightProperties",[1,1,1,1]),conePointAt:new CGL.Uniform(R,"3f","phongLight"+0+".conePointAt",vec3.create()),spotProperties:new CGL.Uniform(R,"3f","phongLight"+0+".spotProperties",[0,0,0,0]),castLight:new CGL.Uniform(R,"i","phongLight"+0+".castLight",1)}}const rt=[{type:"point",position:[5,5,5],color:[1,1,1],specular:[1,1,1],intensity:1,attenuation:0,falloff:.5,radius:80,castLight:1}];const st=mat4.create();function at(){if(t.tempData.lightStack){if(t.tempData.lightStack.length===0){e.setUiError("deflight","Default light is enabled. Please add lights to your patch to make this warning disappear.",1)}else e.setUiError("deflight",null)}if(!t.tempData.lightStack||!t.tempData.lightStack.length){if(!D){B();nt()}mat4.invert(st,t.vMatrix);rt[0].position=[st[12],st[13],st[14]];et(rt[0]);Je=-1}else{if(R){if(t.tempData.lightStack){if(t.tempData.lightStack.length){D=null;it(t.tempData.lightStack)}}}}}const ot=function(){if(!R){e.log("NO SHADER");return}t.pushShader(R);R.popTextures();Ae.trigger();t.popShader()};e.preRender=function(){R.bind();ot()};const lt=mat4.create();const ut=vec3.create();const ht=vec3.create();G.onTriggered=function(){if(!R){e.log("phong has no shader...");return}if(Be)Ge();t.pushShader(R);R.popTextures();if(m.get())R.pushTexture(Ie,m.get());if(p.get())R.pushTexture(Se,p.get());if(_.get())R.pushTexture(ye,_.get());if(b.get())R.pushTexture(Ce,b.get());if(v.get())R.pushTexture(Re,v.get());if(A.get())R.pushTexture(Ne,A.get());if(T.get())R.pushTexture(M,T.get());if(E.get()){if(E.get().cubemap)R.pushTexture(P,E.get().cubemap,t.gl.TEXTURE_CUBE_MAP);else R.pushTexture(P,E.get())}if(x.get()){R.pushTexture(we,x.get())}at();Ae.trigger();t.popShader()};if(t.glVersion==1){if(!t.enableExtension("EXT_shader_texture_lod")){e.log("no EXT_shader_texture_lod texture extension")}else{R.enableExtension("GL_EXT_shader_texture_lod");t.enableExtension("OES_texture_float");t.enableExtension("OES_texture_float_linear");t.enableExtension("OES_texture_half_float");t.enableExtension("OES_texture_half_float_linear");R.enableExtension("GL_OES_standard_derivatives");R.enableExtension("GL_OES_texture_float");R.enableExtension("GL_OES_texture_float_linear");R.enableExtension("GL_OES_texture_half_float");R.enableExtension("GL_OES_texture_half_float_linear")}}De();ke();Ue();Ve();Xe();Fe();je();Ge();ze()}};CABLES.OPS["0d83ed06-cdbe-4fe0-87bb-0ccece7fb6e1"]={f:Ops.Gl.Phong.PhongMaterial_v6,objName:"Ops.Gl.Phong.PhongMaterial_v6"};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Hls=e()}}(function(){return function s(a,o,l){function u(i,e){if(!o[i]){if(!a[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(h)return h(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=o[i]={exports:{}};a[i][0].call(r.exports,function(e){var t=a[i][1][e];return u(t?t:e)},r,r.exports,s,a,o,l)}return o[i].exports}for(var h="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function r(e){return"number"==typeof e}function l(e){return"object"==typeof e&&null!==e}function u(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,r,s,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],u(i))return!1;if(o(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),i.apply(this,r)}else if(l(i))for(r=Array.prototype.slice.call(arguments,1),a=i.slice(),n=a.length,s=0;n>s;s++)a[s].apply(this,r);return!0},n.prototype.addListener=function(e,t){var i;if(!o(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?l(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,l(this._events[e])&&!this._events[e].warned&&(i=u(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,"function"==typeof console.trace)),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var i,n,r,s;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],r=i.length,n=-1,i===t||o(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(l(i)){for(s=r;s-- >0;)if(i[s]===t||i[s].listener&&i[s].listener===t){n=s;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],o(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(o(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,i){var f=arguments[3],d=arguments[4],g=arguments[5],m=JSON.stringify;t.exports=function(e){for(var t,i=Object.keys(g),n=0,r=i.length;r>n;n++){var s=i[n],a=g[s].exports;if(a===e||a.default===e){t=s;break}}if(!t){t=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var o={},n=0,r=i.length;r>n;n++){var s=i[n];o[s]=s}d[t]=[Function(["require","module","exports"],"("+e+")(self)"),o]}var l=Math.floor(Math.pow(16,8)*Math.random()).toString(16),u={};u[t]=t,d[l]=[Function(["require"],"var f = require("+m(t)+");(f.default ? f.default : f)(self);"),u];var h="("+f+")({"+Object.keys(d).map(function(e){return m(e)+":["+d[e][0]+","+m(d[e][1])+"]"}).join(",")+"},{},["+m(l)+"])",c=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(c.createObjectURL(new Blob([h],{type:"text/javascript"})))}},{}],3:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var l=e("../events"),u=n(l),h=e("../event-handler"),c=n(h),f=function(e){function i(e){r(this,i);var t=s(this,Object.getPrototypeOf(i).call(this,e,u.default.FRAG_LOAD_PROGRESS));return t.lastfetchlevel=0,t._autoLevelCapping=-1,t._nextAutoLevel=-1,t}return a(i,e),o(i,[{key:"destroy",value:function(){c.default.prototype.destroy.call(this)}},{key:"onFragLoadProgress",value:function(e){var t=e.stats;void 0===t.aborted&&1===e.frag.loadCounter&&(this.lastfetchduration=(performance.now()-t.trequest)/1e3,this.lastfetchlevel=e.frag.level,this.lastbw=8*t.loaded/this.lastfetchduration)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e,t,i,n=this.lastbw,r=this.hls;if(i=-1===this._autoLevelCapping?r.levels.length-1:this._autoLevelCapping,-1!==this._nextAutoLevel){var s=Math.min(this._nextAutoLevel,i);if(s!==this.lastfetchlevel)return s;this._nextAutoLevel=-1}for(t=0;i>=t;t++)if(e=t<=this.lastfetchlevel?.8*n:.7*n,e<r.levels[t].bitrate)return Math.max(0,t-1);return t-1},set:function(e){this._nextAutoLevel=e}}]),i}(c.default);i.default=f},{"../event-handler":20,"../events":21}],4:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var l=e("../events"),u=n(l),h=e("../event-handler"),c=n(h),f=e("../utils/logger"),d=e("../errors"),g=function(e){function i(e){r(this,i);var t=s(this,Object.getPrototypeOf(i).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING));return t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t}return a(i,e),o(i,[{key:"destroy",value:function(){c.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media,i=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),i.addEventListener("sourceopen",this.onmso),i.addEventListener("sourceended",this.onmse),i.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(i)}},{key:"onMediaDetaching",value:function(){var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){f.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media.src="",this.media.removeAttribute("src"),this.mediaSource=null,this.media=null,this.pendingTracks=null,this.sourceBuffer=null}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){f.logger.log("media source opened"),this.hls.trigger(u.default.MEDIA_ATTACHED,{media:this.media}),this.mediaSource.removeEventListener("sourceopen",this.onmso);var e=this.pendingTracks;e&&(this.onBufferCodecs(e),this.pendingTracks=null,this.doAppending())}},{key:"onMediaSourceClose",value:function(){f.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){f.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){this._needsFlush&&this.doFlush(),this._needsEos&&this.onBufferEos(),this.hls.trigger(u.default.BUFFER_APPENDED),this.doAppending()}},{key:"onSBUpdateError",value:function(e){f.logger.error("sourceBuffer error:"+e),this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;if(e){for(var t in e){var i=e[t];try{this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this.onsbue),i.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer=null}this.flushRange=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){var t,i,n,r,s;if(!this.media)return void(this.pendingTracks=e);if(!this.sourceBuffer){var a={},o=this.mediaSource;for(i in e)n=e[i],r=n.levelCodec||n.codec,s=n.container+";codecs="+r,f.logger.log("creating sourceBuffer with mimeType:"+s),t=a[i]=o.addSourceBuffer(s),t.addEventListener("updateend",this.onsbue),t.addEventListener("error",this.onsbe);this.sourceBuffer=a}}},{key:"onBufferAppending",value:function(e){this.segments?this.segments.push(e):this.segments=[e],this.doAppending()}},{key:"onBufferAppendFail",value:function(e){f.logger.error("sourceBuffer error:"+e.event),this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;t&&"open"===t.readyState&&(e.audio&&e.audio.updating||e.video&&e.video.updating?this._needsEos=!0:(f.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment"),t.endOfStream(),this._needsEos=!1))}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset}),this.flushBufferCounter=0,this.doFlush()}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,i=this.sourceBuffer;if(i)for(var n in i)t+=i[n].buffered.length;this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,i=this.segments;if(t){if(this.media.error)return i=[],void f.logger.error("trying to append although a media error occured, flush segment and abort");for(var n in t)if(t[n].updating)return;if(i.length){var r=i.shift();try{t[r.type].appendBuffer(r.data),this.appendError=0,this.appended++}catch(t){f.logger.error("error while trying to append buffer:"+t.message),i.unshift(r);var s={type:d.ErrorTypes.MEDIA_ERROR};if(22!==t.code){if(this.appendError?this.appendError++:this.appendError=1,s.details=d.ErrorDetails.BUFFER_APPEND_ERROR,s.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return f.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),i=[],s.fatal=!0,void e.trigger(u.default.ERROR,s);s.fatal=!1,e.trigger(u.default.ERROR,s)}else i=[],s.details=d.ErrorDetails.BUFFER_FULL_ERROR,e.trigger(u.default.ERROR,s)}}}}},{key:"flushBuffer",value:function(e,t){var i,n,r,s,a,o;if(this.flushBufferCounter<this.appended&&this.sourceBuffer)for(var l in this.sourceBuffer){if(i=this.sourceBuffer[l],i.updating)return f.logger.warn("cannot flush, sb updating in progress"),!1;for(n=0;n<i.buffered.length;n++)if(r=i.buffered.start(n),s=i.buffered.end(n),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,o=t):(a=Math.max(r,e),o=Math.min(s,t)),Math.min(o,s)-a>.5)return this.flushBufferCounter++,f.logger.log("flush "+l+" ["+a+","+o+"], of ["+r+","+s+"], pos:"+this.media.currentTime),i.remove(a,o),!1}else f.logger.warn("abort flushing too many retries");return f.logger.log("buffer flushed"),!0}}]),i}(c.default);i.default=g},{"../errors":19,"../event-handler":20,"../events":21,"../utils/logger":34}],5:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var l=e("../events"),u=n(l),h=e("../event-handler"),c=n(h),f=e("../utils/logger"),d=e("../errors"),g=function(e){function i(e){r(this,i);var t=s(this,Object.getPrototypeOf(i).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.ERROR));return t.ontick=t.tick.bind(t),t._manualLevel=t._autoLevelCapping=-1,t}return a(i,e),o(i,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0,this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,i,n=[],r=[],s={},a=!1,o=!1,l=this.hls;if(e.levels.forEach(function(e){e.videoCodec&&(a=!0),e.audioCodec&&(o=!0);var t=s[e.bitrate];void 0===t?(s[e.bitrate]=n.length,e.url=[e.url],e.urlId=0,n.push(e)):n[t].url.push(e.url)}),a&&o?n.forEach(function(e){e.videoCodec&&r.push(e)}):r=n,r=r.filter(function(e){var t=function(e){return MediaSource.isTypeSupported("audio/mp4;codecs="+e)},i=function(e){return MediaSource.isTypeSupported("video/mp4;codecs="+e)},n=e.audioCodec,r=e.videoCodec;return(!n||t(n))&&(!r||i(r))}),r.length){for(t=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r,i=0;i<r.length;i++)if(r[i].bitrate===t){this._firstLevel=i,f.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}l.trigger(u.default.MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:e.stats})}else l.trigger(u.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:l.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){if(e>=0&&e<this._levels.length){this.timer&&(clearInterval(this.timer),this.timer=null),this._level=e,f.logger.log("switching to level "+e),this.hls.trigger(u.default.LEVEL_SWITCH,{level:e});var t=this._levels[e];if(void 0===t.details||t.details.live===!0){f.logger.log("(re)loading playlist for level "+e);var i=t.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:t.url[i],level:e,id:i})}}else this.hls.trigger(u.default.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t,i,n=e.details,r=this.hls;switch(n){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:case d.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case d.ErrorDetails.KEY_LOAD_ERROR:case d.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level;break;case d.ErrorDetails.LEVEL_LOAD_ERROR:case d.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.level}if(void 0!==t)if(i=this._levels[t],i.urlId<i.url.length-1)i.urlId++,i.details=void 0,f.logger.warn("level controller,"+n+" for level "+t+": switching to redundant stream id "+i.urlId);else{var s=-1===this._manualLevel&&t;s?(f.logger.warn("level controller,"+n+": emergency switch-down for next fragment"),r.abrController.nextAutoLevel=0):i&&i.details&&i.details.live?f.logger.warn("level controller,"+n+" on live stream, discard"):n!==d.ErrorDetails.FRAG_LOAD_ERROR&&n!==d.ErrorDetails.FRAG_LOAD_TIMEOUT&&(f.logger.error("cannot recover "+n+" error"),this._level=void 0,this.timer&&(clearInterval(this.timer),this.timer=null),e.fatal=!0,r.trigger(event,e))}}}},{key:"onLevelLoaded",value:function(e){e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],i=t.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:t.url[i],level:e,id:i})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){(this._level!==e||void 0===this._levels[e].details)&&this.setLevelInternal(e)}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){return void 0===this._startLevel?this._firstLevel:this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),i}(c.default);i.default=g},{"../errors":19,"../event-handler":20,"../events":21,"../utils/logger":34}],6:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var l=e("../demux/demuxer"),u=n(l),h=e("../events"),P=n(h),c=e("../event-handler"),f=n(c),w=e("../utils/logger"),d=e("../utils/binary-search"),L=n(d),g=e("../helper/level-helper"),m=n(g),D=e("../errors"),k={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},p=function(e){function i(e){r(this,i);var t=s(this,Object.getPrototypeOf(i).call(this,e,P.default.MEDIA_ATTACHED,P.default.MEDIA_DETACHING,P.default.MANIFEST_LOADING,P.default.MANIFEST_PARSED,P.default.LEVEL_LOADED,P.default.KEY_LOADED,P.default.FRAG_LOADED,P.default.FRAG_PARSING_INIT_SEGMENT,P.default.FRAG_PARSING_DATA,P.default.FRAG_PARSED,P.default.ERROR,P.default.BUFFER_APPENDED,P.default.BUFFER_FLUSHED));return t.config=e.config,t.audioCodecSwap=!1,t.ticks=0,t.ontick=t.tick.bind(t),t}return a(i,e),o(i,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),f.default.prototype.destroy.call(this),this.state=k.STOPPED}},{key:"startLoad",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];if(this.levels){var t=this.media,i=this.lastCurrentTime;this.stopLoad(),this.demuxer=new u.default(this.hls),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,t&&i?(w.logger.log("configure startPosition @"+i),this.lastPaused||(w.logger.log("resuming video"),t.play()),this.state=k.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=k.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else w.logger.warn("cannot start loading as manifest not parsed yet"),this.state=k.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,i,n=this,r=this.hls,s=r.config;switch(this.state){case k.ERROR:case k.PAUSED:break;case k.STARTING:this.startLevel=r.startLevel,-1===this.startLevel&&(this.startLevel=0,this.fragBitrateTest=!0),this.level=r.nextLoadLevel=this.startLevel,this.state=k.WAITING_LEVEL,this.loadedmetadata=!1;break;case k.IDLE:if(!this.media&&(this.startFragRequested||!s.startFragPrefetch))break;e=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition,t=this.startFragRequested===!1?this.startLevel:r.nextLoadLevel;var a,o=this.bufferInfo(e,s.maxBufferHole),l=o.len,u=o.end,h=this.fragPrevious;if(this.levels[t].hasOwnProperty("bitrate")?(a=Math.max(8*s.maxBufferSize/this.levels[t].bitrate,s.maxBufferLength),a=Math.min(a,s.maxMaxBufferLength)):a=s.maxBufferLength,a>l){if(r.nextLoadLevel=t,this.level=t,i=this.levels[t].details,"undefined"==typeof i||i.live&&this.levelLastLoaded!==t){this.state=k.WAITING_LEVEL;break}var c=i.fragments,f=c.length,d=c[0].start,g=c[f-1].start+c[f-1].duration,m=void 0;if(i.live){var p=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*i.targetduration;if(u<Math.max(d,g-p)){var _=void 0!==s.liveSyncDuration?s.liveSyncDuration:s.liveSyncDurationCount*i.targetduration;this.seekAfterBuffered=d+Math.max(0,i.totalduration-_),w.logger.log("buffer end: "+u+" is located too far from the end of live sliding playlist, media position will be reseted to: "+this.seekAfterBuffered.toFixed(3)),u=this.seekAfterBuffered}if(this.startFragRequested&&!i.PTSKnown){if(h){var b=h.sn+1;b>=i.startSN&&b<=i.endSN&&(m=c[b-i.startSN],w.logger.log("live playlist, switching playlist, load frag with next SN: "+m.sn))}m||(m=c[Math.min(f-1,Math.round(f/2))],w.logger.log("live playlist, switching playlist, unknown, load middle frag : "+m.sn))}}else d>u&&(m=c[0]);if(m||!function(){var e=void 0,t=s.maxFragLookUpTolerance;g>u?(u>g-t&&(t=0),e=L.default.search(c,function(e){return e.start+e.duration-t<=u?1:e.start-t>u?-1:0})):e=c[f-1],e&&(m=e,d=e.start,h&&m.level===h.level&&m.sn===h.sn&&(m.sn<i.endSN?(m=c[m.sn+1-i.startSN],w.logger.log("SN just loaded, load next one: "+m.sn)):(i.live||(n.hls.trigger(P.default.BUFFER_EOS),n.state=k.ENDED),m=null)))}(),m)if(null!=m.decryptdata.uri&&null==m.decryptdata.key)w.logger.log("Loading key for "+m.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+t),this.state=k.KEY_LOADING,r.trigger(P.default.KEY_LOADING,{frag:m});else{if(w.logger.log("Loading "+m.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+t+", currentTime:"+e+",bufferEnd:"+u.toFixed(3)),m.autoLevel=r.autoLevelEnabled,this.levels.length>1&&(m.expectedLen=Math.round(m.duration*this.levels[t].bitrate/8),m.trequest=performance.now()),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,m.loadCounter){m.loadCounter++;var v=s.fragLoadingLoopThreshold;if(m.loadCounter>v&&Math.abs(this.fragLoadIdx-m.loadIdx)<v)return void r.trigger(P.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:m})}else m.loadCounter=1;m.loadIdx=this.fragLoadIdx,this.fragCurrent=m,this.startFragRequested=!0,r.trigger(P.default.FRAG_LOADING,{frag:m}),this.state=k.FRAG_LOADING}}break;case k.WAITING_LEVEL:t=this.levels[this.level],t&&t.details&&(this.state=k.IDLE);break;case k.FRAG_LOADING:var A=this.media,T=this.fragCurrent;if(A&&(!A.paused||this.loadedmetadata===!1)&&T.autoLevel&&this.level&&this.levels.length>1){var E=performance.now()-T.trequest;if(E>500*T.duration){var x=Math.max(1,1e3*T.loaded/E);T.expectedLen<T.loaded&&(T.expectedLen=T.loaded),e=A.currentTime;var O=(T.expectedLen-T.loaded)/x,I=this.bufferInfo(e,s.maxBufferHole).end-e;if(I<2*T.duration&&O>I){var S=void 0,y=void 0;for(y=this.level-1;y>=0&&(S=T.duration*this.levels[y].bitrate/(6.4*x),w.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+y+"] :"+O.toFixed(1)+"/"+I.toFixed(1)+"/"+S.toFixed(1)),!(I>S));y--);O>S&&(y=Math.max(0,y),r.nextLoadLevel=y,w.logger.warn("loading too slow, abort fragment loading and switch to level "+y),T.loader.abort(),r.trigger(P.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:T}),this.state=k.IDLE)}}}break;case k.FRAG_LOADING_WAITING_RETRY:var C=performance.now(),R=this.retryDate,N=this.media,M=N&&N.seeking;(!R||C>=R||M)&&(w.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=k.IDLE);break;case k.PARSING:break;case k.PARSED:break;case k.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"bufferInfo",value:function(e,t){var i=this.media;if(i){var n,r=i.buffered,s=[];for(n=0;n<r.length;n++)s.push({start:r.start(n),end:r.end(n)});return this.bufferedInfo(s,e,t)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,i){var n,r,s,a,o,l=[];for(e.sort(function(e,t){var i=e.start-t.start;return i?i:t.end-e.end}),o=0;o<e.length;o++){var u=l.length;if(u){var h=l[u-1].end;e[o].start-h<i?e[o].end>h&&(l[u-1].end=e[o].end):l.push(e[o])}else l.push(e[o])}for(o=0,n=0,r=s=t;o<l.length;o++){var c=l[o].start,f=l[o].end;if(t+i>=c&&f>t)r=c,s=f,n=s-t;else if(c>t+i){a=c;break}}return{len:n,start:r,end:s,nextStart:a}}},{key:"getBufferRange",value:function(e){var t,i,n=this.bufferRange;if(n)for(t=n.length-1;t>=0;t--)if(i=n[t],e>=i.start&&e<=i.end)return i;return null}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"isBuffered",value:function(e){for(var t=this.media,i=t.buffered,n=0;n<i.length;n++)if(e>=i.start(n)&&e<=i.end(n))return!0;return!1}},{key:"_checkFragmentChanged",value:function(){var e,t,i=this.media;if(i&&i.seeking===!1&&(t=i.currentTime,t>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),this.isBuffered(t)?e=this.getBufferRange(t):this.isBuffered(t+.1)&&(e=this.getBufferRange(t+.1)),e)){var n=e.frag;n!==this.fragPlaying&&(this.fragPlaying=n,this.hls.trigger(P.default.FRAG_CHANGED,{frag:n}))}}},{key:"immediateLevelSwitch",value:function(){w.logger.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,this.previouslyPaused=this.media.paused,this.media.pause());var e=this.fragCurrent;e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.hls.trigger(P.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY}),this.state=k.PAUSED,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.tick()}},{key:"immediateLevelSwitchEnd",value:function(){this.immediateSwitch=!1,this.media.currentTime-=1e-4,this.previouslyPaused||this.media.play()}},{key:"nextLevelSwitch",value:function(){var e,t,i;if(t=this.getBufferRange(this.media.currentTime),t&&t.start>1&&(this.hls.trigger(P.default.BUFFER_FLUSHING,{startOffset:0,endOffset:t.start-1}),this.state=k.PAUSED),this.media.paused)e=0;else{var n=this.hls.nextLoadLevel,r=this.levels[n],s=this.fragLastKbps;e=s&&this.fragCurrent?this.fragCurrent.duration*r.bitrate/(1e3*s)+1:0}if(i=this.getBufferRange(this.media.currentTime+e),i&&(i=this.followingBufferRange(i))){this.hls.trigger(P.default.BUFFER_FLUSHING,{startOffset:i.start,endOffset:Number.POSITIVE_INFINITY}),this.state=k.PAUSED;var a=this.fragCurrent;a&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}}},{key:"onMediaAttached",value:function(e){var t=this.media=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended),this.levels&&this.config.autoStartLoad&&this.startLoad()}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(w.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){if(this.state===k.FRAG_LOADING){if(0===this.bufferInfo(this.media.currentTime,this.config.maxBufferHole).len){w.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.state=k.IDLE}}else this.state===k.ENDED&&(this.state=k.IDLE);this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaSeeked",value:function(){this.tick()}},{key:"onMediaEnded",value:function(){w.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){w.logger.log("trigger BUFFER_RESET"),this.hls.trigger(P.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1}},{key:"onManifestParsed",value:function(e){var t,i=!1,n=!1;e.levels.forEach(function(e){t=e.audioCodec,t&&(-1!==t.indexOf("mp4a.40.2")&&(i=!0),-1!==t.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=i&&n,this.audioCodecSwitch&&w.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1,this.config.autoStartLoad&&this.startLoad()}},{key:"onLevelLoaded",value:function(e){var t=e.details,i=e.level,n=this.levels[i],r=t.totalduration,s=0;if(w.logger.log("level "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+r),this.levelLastLoaded=i,t.live){var a=n.details;a?(m.default.mergeDetails(a,t),s=t.fragments[0].start,t.PTSKnown?w.logger.log("live playlist sliding:"+s.toFixed(3)):w.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,w.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(n.details=t,this.hls.trigger(P.default.LEVEL_UPDATED,{details:t,level:i}),this.startFragRequested===!1){if(t.live){var o=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;this.startPosition=Math.max(0,s+r-o)}this.nextLoadPosition=this.startPosition}this.state===k.WAITING_LEVEL&&(this.state=k.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===k.KEY_LOADING&&(this.state=k.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===k.FRAG_LOADING&&t&&e.frag.level===t.level&&e.frag.sn===t.sn)if(this.fragBitrateTest===!0)this.state=k.IDLE,this.fragBitrateTest=!1,e.stats.tparsed=e.stats.tbuffered=performance.now(),this.hls.trigger(P.default.FRAG_BUFFERED,{stats:e.stats,frag:t});else{this.state=k.PARSING,this.stats=e.stats;var i=this.levels[this.level],n=i.details,r=n.totalduration,s=t.start,a=t.level,o=t.sn,l=i.audioCodec||this.config.defaultAudioCodec;this.audioCodecSwap&&(w.logger.log("swapping playlist audio codec"),void 0===l&&(l=this.lastAudioCodec),l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingAppending=0,w.logger.log("Demuxing "+o+" of ["+n.startSN+" ,"+n.endSN+"],level "+a),this.demuxer.push(e.payload,l,i.videoCodec,s,t.cc,a,o,r,t.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){if(this.state===k.PARSING){var t,i,n=e.tracks;if(i=n.audio){var r=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();r&&this.audioCodecSwap&&(w.logger.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===s.indexOf("firefox")&&(r="mp4a.40.5"),-1!==s.indexOf("android")&&(r="mp4a.40.2",w.logger.log("Android: force audio codec to"+r)),i.levelCodec=r}if(i=n.video,i&&(i.levelCodec=this.levels[this.level].videoCodec),e.unique){var a={codec:"",levelCodec:""};for(t in e.tracks)i=n[t],a.container=i.container,a.codec&&(a.codec+=",",a.levelCodec+=","),i.codec&&(a.codec+=i.codec),i.levelCodec&&(a.levelCodec+=i.levelCodec);n={audiovideo:a}}this.hls.trigger(P.default.BUFFER_CODECS,n);for(t in n){i=n[t],w.logger.log("track:"+t+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var o=i.initSegment;o&&(this.pendingAppending++,this.hls.trigger(P.default.BUFFER_APPENDING,{type:t,data:o}))}this.tick()}}},{key:"onFragParsingData",value:function(t){var i=this;if(this.state===k.PARSING){this.tparse2=Date.now();var e=this.levels[this.level],n=this.fragCurrent;w.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb);var r=m.default.updateFragPTS(e.details,n.sn,t.startPTS,t.endPTS),s=this.hls;s.trigger(P.default.LEVEL_PTS_UPDATED,{details:e.details,level:this.level,drift:r}),[t.data1,t.data2].forEach(function(e){e&&(i.pendingAppending++,s.trigger(P.default.BUFFER_APPENDING,{type:t.type,data:e}))}),this.nextLoadPosition=t.endPTS,this.bufferRange.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:n}),this.tick()}else w.logger.warn("not in PARSING state but "+this.state+", ignoring FRAG_PARSING_DATA event")}},{key:"onFragParsed",value:function(){this.state===k.PARSING&&(this.stats.tparsed=performance.now(),this.state=k.PARSED,this._checkAppendedParsed())}},{key:"onBufferAppended",value:function(){switch(this.state){case k.PARSING:case k.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===k.PARSED&&0===this.pendingAppending){var e=this.fragCurrent,t=this.stats;e&&(this.fragPrevious=e,t.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*t.length/(t.tbuffered-t.tfirst)),this.hls.trigger(P.default.FRAG_BUFFERED,{stats:t,frag:e}),w.logger.log("media buffered : "+this.timeRangesToString(this.media.buffered)),this.state=k.IDLE),this.tick()}}},{key:"onError",value:function(e){switch(e.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var t=this.fragLoadError;if(t?t++:t=1,t<=this.config.fragLoadingMaxRetry){this.fragLoadError=t,e.frag.loadCounter=0;var i=Math.min(Math.pow(2,t-1)*this.config.fragLoadingRetryDelay,64e3);w.logger.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.state=k.FRAG_LOADING_WAITING_RETRY}else w.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(P.default.ERROR,e),this.state=k.ERROR}break;case D.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:w.logger.warn("mediaController: "+e.details+" while loading frag,switch to "+(e.fatal?"ERROR":"IDLE")+" state ..."),this.state=e.fatal?k.ERROR:k.IDLE;break;case D.ErrorDetails.BUFFER_FULL_ERROR:this.config.maxMaxBufferLength/=2,w.logger.warn("reduce max buffer length to "+this.config.maxMaxBufferLength+"s and trigger a nextLevelSwitch to flush old buffer and fix QuotaExceededError"),this.nextLevelSwitch()}}},{key:"_checkBuffer",value:function(){var e=this.media;if(e){var t=e.readyState;if(t){var i,n,r=this.seekAfterBuffered;if(r)e.duration>=r&&(i=r,this.seekAfterBuffered=void 0);else{n=e.currentTime;var s=this.loadedmetadata;!s&&e.buffered.length&&(this.loadedmetadata=!0,n||n===this.startPosition||(i=this.startPosition))}i&&(n=i,w.logger.log("target seek position:"+i));var a=this.bufferInfo(n,0),o=!(e.paused||e.ended||e.seeking||2>t),l=.4,u=n>e.playbackRate*this.lastCurrentTime;if(this.stalled&&u&&(this.stalled=!1,w.logger.log("playback not stuck anymore @"+n)),a.len<=l){if(u||!o?l=0:this.stalled||(w.logger.log("playback seems stuck @"+n),this.hls.trigger(P.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1}),this.stalled=!0),a.len<=l){var h=a.nextStart,c=h-n;h&&c<this.config.maxSeekHole&&c>0&&!e.seeking&&(w.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+h),e.currentTime=h,this.hls.trigger(P.default.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1}))}}else i&&e.currentTime!==i&&(w.logger.log("adjust currentTime from "+e.currentTime+" to "+i),e.currentTime=i)}}}},{key:"onBufferFlushed",value:function(){var e,t,i=[];for(t=0;t<this.bufferRange.length;t++)e=this.bufferRange[t],this.isBuffered((e.start+e.end)/2)&&i.push(e);this.bufferRange=i,this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.state=k.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"timeRangesToString",value:function(e){for(var t="",i=e.length,n=0;i>n;n++)t+="["+e.start(n)+","+e.end(n)+"]";return t}},{key:"currentLevel",get:function(){if(this.media){var e=this.getBufferRange(this.media.currentTime);if(e)return e.frag.level}return-1}},{key:"nextBufferRange",get:function(){return this.media?this.followingBufferRange(this.getBufferRange(this.media.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}}]),i}(f.default);i.default=p},{"../demux/demuxer":15,"../errors":19,"../event-handler":20,"../events":21,"../helper/level-helper":22,"../utils/binary-search":32,"../utils/logger":34}],7:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var l=e("../events"),u=n(l),h=e("../event-handler"),c=n(h),f=e("../utils/cea-708-interpreter"),d=n(f),g=function(e){function i(e){r(this,i);var t=s(this,Object.getPrototypeOf(i).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.MANIFEST_LOADING,u.default.FRAG_LOADED));return t.hls=e,t.config=e.config,t.config.enableCEA708Captions&&(t.cea708Interpreter=new d.default),t}return a(i,e),o(i,[{key:"destroy",value:function(){c.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;this.cea708Interpreter.attach(t)}},{key:"onMediaDetaching",value:function(){this.cea708Interpreter.detach()}},{key:"onManifestLoading",value:function(){this.lastPts=Number.POSITIVE_INFINITY}},{key:"onFragLoaded",value:function(e){var t=e.frag.start;t<=this.lastPts&&this.cea708Interpreter.clear(),this.lastPts=t}},{key:"onFragParsingUserdata",value:function(e){for(var t=0;t<e.samples.length;t++)this.cea708Interpreter.push(e.samples[t].pts,e.samples[t].bytes)}}]),i}(c.default);i.default=g},{"../event-handler":20,"../events":21,"../utils/cea-708-interpreter":33}],8:[function(e,t,i){"use strict";function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function h(e){c(this,h),this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute();var t,i,n,r,s,a=this._tables[0][4],o=this._tables[1],l=e.length,u=1;if(4!==l&&6!==l&&8!==l)throw new Error("Invalid aes key size="+l);for(r=e.slice(0),s=[],this._key=[r,s],t=l;4*l+28>t;t++)n=r[t-1],(t%l===0||8===l&&t%l===4)&&(n=a[n>>>24]<<24^a[n>>16&255]<<16^a[n>>8&255]<<8^a[255&n],t%l===0&&(n=n<<8^n>>>24^u<<24,u=u<<1^283*(u>>7))),r[t]=r[t-l]^n;for(i=0;t;i++,t--)n=r[3&i?t:t-4],4>=t||4>i?s[i]=n:s[i]=o[0][a[n>>>24]]^o[1][a[n>>16&255]]^o[2][a[n>>8&255]]^o[3][a[255&n]]}return n(h,[{key:"_precompute",value:function(){var e,t,i,n,r,s,a,o,l,u=this._tables[0],h=this._tables[1],c=u[4],f=h[4],d=[],g=[];for(e=0;256>e;e++)g[(d[e]=e<<1^283*(e>>7))^e]=e;for(t=i=0;!c[t];t^=n||1,i=g[i]||1)for(a=i^i<<1^i<<2^i<<3^i<<4,a=a>>8^255&a^99,c[t]=a,f[a]=t,s=d[r=d[n=d[t]]],l=16843009*s^65537*r^257*n^16843008*t,o=257*d[a]^16843008*a,e=0;4>e;e++)u[e][t]=o=o<<24^o>>>8,h[e][a]=l=l<<24^l>>>8;for(e=0;5>e;e++)u[e]=u[e].slice(0),h[e]=h[e].slice(0)}},{key:"decrypt",value:function(e,t,i,n,r,s){var a,o,l,u,h=this._key[1],c=e^h[0],f=n^h[1],d=i^h[2],g=t^h[3],m=h.length/4-2,p=4,_=this._tables[1],b=_[0],v=_[1],A=_[2],T=_[3],E=_[4];for(u=0;m>u;u++)a=b[c>>>24]^v[f>>16&255]^A[d>>8&255]^T[255&g]^h[p],o=b[f>>>24]^v[d>>16&255]^A[g>>8&255]^T[255&c]^h[p+1],l=b[d>>>24]^v[g>>16&255]^A[c>>8&255]^T[255&f]^h[p+2],g=b[g>>>24]^v[c>>16&255]^A[f>>8&255]^T[255&d]^h[p+3],p+=4,c=a,f=o,d=l;for(u=0;4>u;u++)r[(3&-u)+s]=E[c>>>24]<<24^E[f>>16&255]<<16^E[d>>8&255]<<8^E[255&g]^h[p++],a=c,c=f,f=d,d=g,g=a}}]),h}();i.default=r},{}],9:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("./aes"),p=n(a),o=function(){function i(e,t){r(this,i),this.key=e,this.iv=t}return s(i,[{key:"ntoh",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"doDecrypt",value:function(e,t,i){var n,r,s,a,o,l,u,h,c,f=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),d=new p.default(Array.prototype.slice.call(t)),g=new Uint8Array(e.byteLength),m=new Int32Array(g.buffer);for(n=~~i[0],r=~~i[1],s=~~i[2],a=~~i[3],c=0;c<f.length;c+=4)o=~~this.ntoh(f[c]),l=~~this.ntoh(f[c+1]),u=~~this.ntoh(f[c+2]),h=~~this.ntoh(f[c+3]),d.decrypt(o,l,u,h,m,c),m[c]=this.ntoh(m[c]^n),m[c+1]=this.ntoh(m[c+1]^r),m[c+2]=this.ntoh(m[c+2]^s),m[c+3]=this.ntoh(m[c+3]^a),n=o,r=l,s=u,a=h;return g}},{key:"localDecrypt",value:function(e,t,i,n){var r=this.doDecrypt(e,t,i);n.set(r,e.byteOffset)}},{key:"decrypt",value:function(e){var t=32e3,i=new Int32Array(e),n=new Uint8Array(e.byteLength),r=0,s=this.key,a=this.iv;for(this.localDecrypt(i.subarray(r,r+t),s,a,n),r=t;r<i.length;r+=t)a=new Uint32Array([this.ntoh(i[r-4]),this.ntoh(i[r-3]),this.ntoh(i[r-2]),this.ntoh(i[r-1])]),this.localDecrypt(i.subarray(r,r+t),s,a,n);return n}}]),i}();i.default=o},{"./aes":8}],10:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("./aes128-decrypter"),l=n(a),o=e("../errors"),u=e("../utils/logger"),h=function(){function i(e){r(this,i),this.hls=e;try{var t=window?window.crypto:crypto;this.subtle=t.subtle||t.webkitSubtle,this.disableWebCrypto=!this.subtle}catch(t){this.disableWebCrypto=!0}}return s(i,[{key:"destroy",value:function(){}},{key:"decrypt",value:function(e,t,i,n){this.disableWebCrypto&&this.hls.config.enableSoftwareAES?this.decryptBySoftware(e,t,i,n):this.decryptByWebCrypto(e,t,i,n)}},{key:"decryptByWebCrypto",value:function(t,i,n,r){var s=this;u.logger.log("decrypting by WebCrypto API"),this.subtle.importKey("raw",i,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(e){s.subtle.decrypt({name:"AES-CBC",iv:n.buffer},e,t).then(r).catch(function(e){s.onWebCryptoError(e,t,i,n,r)})}).catch(function(e){s.onWebCryptoError(e,t,i,n,r)})}},{key:"decryptBySoftware",value:function(e,t,i,n){u.logger.log("decrypting by JavaScript Implementation");var r=new DataView(t.buffer),s=new Uint32Array([r.getUint32(0),r.getUint32(4),r.getUint32(8),r.getUint32(12)]);r=new DataView(i.buffer);var a=new Uint32Array([r.getUint32(0),r.getUint32(4),r.getUint32(8),r.getUint32(12)]),o=new l.default(s,a);n(o.decrypt(e).buffer)}},{key:"onWebCryptoError",value:function(e,t,i,n,r){this.hls.config.enableSoftwareAES?(u.logger.log("disabling to use WebCrypto API"),this.disableWebCrypto=!0,this.decryptBySoftware(t,i,n,r)):(u.logger.error("decrypting error : "+e.message),this.hls.trigger(Event.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}}]),i}();i.default=h},{"../errors":19,"../utils/logger":34,"./aes128-decrypter":9}],11:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("./adts"),A=n(a),T=e("../utils/logger"),o=e("../demux/id3"),E=n(o),l=function(){function i(e,t){r(this,i),this.observer=e,this.remuxerClass=t,this.remuxer=new this.remuxerClass(e),this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}return s(i,[{key:"push",value:function(e,t,i,n,r,s,a,o){var l,u,h,c,f,d,g,m,p,_=this._aacTrack,b=new E.default(e),v=90*b.timeStamp;for(f=b.length,m=e.length;m-1>f&&(255!==e[f]||240!==(240&e[f+1]));f++);for(_.audiosamplerate||(l=A.default.getAudioConfig(this.observer,e,f,t),_.config=l.config,_.audiosamplerate=l.samplerate,_.channelCount=l.channelCount,_.codec=l.codec,_.timescale=l.samplerate,_.duration=l.samplerate*o,T.logger.log("parsed codec:"+_.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)),c=0,h=9216e4/_.audiosamplerate;m>f+5&&(d=1&e[f+1]?7:9,u=(3&e[f+3])<<11|e[f+4]<<3|(224&e[f+5])>>>5,u-=d,u>0&&m>=f+d+u);)for(g=v+c*h,p={unit:e.subarray(f+d,f+d+u),pts:g,dts:g},_.samples.push(p),_.len+=u,f+=u+d,c++;m-1>f&&(255!==e[f]||240!==(240&e[f+1]));f++);this.remuxer.remux(this._aacTrack,{samples:[]},{samples:[{pts:v,dts:v,unit:b.payload}]},{samples:[]},n)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,i,n=new E.default(e);if(n.hasTimeStamp)for(t=n.length,i=e.length;i-1>t;t++)if(255===e[t]&&240===(240&e[t+1]))return!0;return!1}}]),i}();i.default=l},{"../demux/id3":17,"../utils/logger":34,"./adts":12}],12:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var c=e("../utils/logger"),f=e("../errors"),s=function(){function e(){n(this,e)}return r(e,null,[{key:"getAudioConfig",value:function(e,t,i,n){var r,s,a,o,l,u=navigator.userAgent.toLowerCase(),h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return r=((192&t[i+2])>>>6)+1,s=(60&t[i+2])>>>2,s>h.length-1?void e.trigger(Event.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s}):(o=(1&t[i+2])<<2,o|=(192&t[i+3])>>>6,c.logger.log("manifest codec:"+n+",ADTS data:type:"+r+",sampleingIndex:"+s+"["+h[s]+"Hz],channelConfig:"+o),-1!==u.indexOf("firefox")?s>=6?(r=5,l=new Array(4),a=s-3):(r=2,l=new Array(2),a=s):-1!==u.indexOf("android")?(r=2,l=new Array(2),a=s):(r=5,l=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&s>=6?a=s-3:((n&&-1!==n.indexOf("mp4a.40.2")&&s>=6&&1===o||!n&&1===o)&&(r=2,l=new Array(2)),a=s)),l[0]=r<<3,l[0]|=(14&s)>>1,l[1]|=(1&s)<<7,l[1]|=o<<3,5===r&&(l[1]|=(14&a)>>1,l[2]=(1&a)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:h[s],channelCount:o,codec:"mp4a.40."+r})}}]),e}();i.default=s},{"../errors":19,"../utils/logger":34}],13:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("../events"),h=n(a),c=e("../errors"),o=e("../demux/aacdemuxer"),f=n(o),l=e("../demux/tsdemuxer"),d=n(l),u=e("../remux/mp4-remuxer"),g=n(u),m=e("../remux/passthrough-remuxer"),p=n(m),_=function(){function i(e,t){r(this,i),this.hls=e,this.typeSupported=t}return s(i,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,i,n,r,s,a,o){var l=this.demuxer;if(!l){var u=this.hls;if(d.default.probe(e))l=this.typeSupported.mp2t===!0?new d.default(u,p.default):new d.default(u,g.default);else{if(!f.default.probe(e))return void u.trigger(h.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});l=new f.default(u,g.default)}this.demuxer=l}l.push(e,t,i,n,r,s,a,o)}}]),i}();i.default=_},{"../demux/aacdemuxer":11,"../demux/tsdemuxer":18,"../errors":19,"../events":21,"../remux/mp4-remuxer":29,"../remux/passthrough-remuxer":30}],14:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var r=e("../demux/demuxer-inline"),s=n(r),a=e("../events"),o=n(a),l=e("events"),u=n(l),h=function(n){var r=new u.default;r.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];r.emit.apply(r,[e,e].concat(i))},r.off=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];r.removeListener.apply(r,[e].concat(i))},n.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":n.demuxer=new s.default(r,t.typeSupported);break;case"demux":n.demuxer.push(new Uint8Array(t.data),t.audioCodec,t.videoCodec,t.timeOffset,t.cc,t.level,t.sn,t.duration)}}),r.on(o.default.FRAG_PARSING_INIT_SEGMENT,function(e,t){n.postMessage({event:e,tracks:t.tracks,unique:t.unique})}),r.on(o.default.FRAG_PARSING_DATA,function(e,t){var i={event:e,type:t.type,startPTS:t.startPTS,endPTS:t.endPTS,startDTS:t.startDTS,endDTS:t.endDTS,data1:t.data1.buffer,data2:t.data2.buffer,nb:t.nb};n.postMessage(i,[i.data1,i.data2])}),r.on(o.default.FRAG_PARSED,function(e){n.postMessage({event:e})}),r.on(o.default.ERROR,function(e,t){n.postMessage({event:e,data:t})}),r.on(o.default.FRAG_PARSING_METADATA,function(e,t){var i={event:e,samples:t.samples};n.postMessage(i)}),r.on(o.default.FRAG_PARSING_USERDATA,function(e,t){var i={event:e,samples:t.samples};n.postMessage(i)})};i.default=h},{"../demux/demuxer-inline":13,"../events":21,events:1}],15:[function(r,e,t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(t,"__esModule",{value:!0});var n=r("../events"),o=i(n),l=r("../demux/demuxer-inline"),u=i(l),h=r("../demux/demuxer-worker"),c=i(h),f=r("../utils/logger"),d=r("../crypt/decrypter"),g=i(d),m=function(){function n(t){s(this,n),this.hls=t;var i={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:t.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t")};if(t.config.enableWorker&&"undefined"!=typeof Worker){f.logger.log("demuxing in webworker");try{var e=r("webworkify");this.w=e(c.default),this.onwmsg=this.onWorkerMessage.bind(this),this.w.addEventListener("message",this.onwmsg),this.w.postMessage({cmd:"init",typeSupported:i})}catch(e){f.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),this.demuxer=new u.default(t,i)}}else this.demuxer=new u.default(t,i);this.demuxInitialized=!0}return a(n,[{key:"destroy",value:function(){this.w?(this.w.removeEventListener("message",this.onwmsg),this.w.terminate(),this.w=null):(this.demuxer.destroy(),this.demuxer=null),this.decrypter&&(this.decrypter.destroy(),this.decrypter=null)}},{key:"pushDecrypted",value:function(e,t,i,n,r,s,a,o){this.w?this.w.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:i,timeOffset:n,cc:r,level:s,sn:a,duration:o},[e]):this.demuxer.push(new Uint8Array(e),t,i,n,r,s,a,o)}},{key:"push",value:function(e,t,i,n,r,s,a,o,l){if(e.byteLength>0&&null!=l&&null!=l.key&&"AES-128"===l.method){null==this.decrypter&&(this.decrypter=new g.default(this.hls));var u=this;this.decrypter.decrypt(e,l.key,l.iv,function(e){u.pushDecrypted(e,t,i,n,r,s,a,o)})}else this.pushDecrypted(e,t,i,n,r,s,a,o)}},{key:"onWorkerMessage",value:function(e){var t=e.data;switch(t.event){case o.default.FRAG_PARSING_INIT_SEGMENT:var i={};i.tracks=t.tracks,i.unique=t.unique,this.hls.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,i);break;case o.default.FRAG_PARSING_DATA:this.hls.trigger(o.default.FRAG_PARSING_DATA,{data1:new Uint8Array(t.data1),data2:new Uint8Array(t.data2),startPTS:t.startPTS,endPTS:t.endPTS,startDTS:t.startDTS,endDTS:t.endDTS,type:t.type,nb:t.nb});break;case o.default.FRAG_PARSING_METADATA:this.hls.trigger(o.default.FRAG_PARSING_METADATA,{samples:t.samples});break;case o.default.FRAG_PARSING_USERDATA:this.hls.trigger(o.default.FRAG_PARSING_USERDATA,{samples:t.samples});break;default:this.hls.trigger(t.event,t.data)}}}]),n}();t.default=m},{"../crypt/decrypter":10,"../demux/demuxer-inline":13,"../demux/demuxer-worker":14,"../events":21,"../utils/logger":34,webworkify:2}],16:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var s=e("../utils/logger"),a=function(){function t(e){n(this,t),this.data=e,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return r(t,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,t=new Uint8Array(4),i=Math.min(4,this.bytesAvailable);if(0===i)throw new Error("no bytes available");t.set(this.data.subarray(e,e+i)),this.word=new DataView(t.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0?i<<t|this.readBits(t):i}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,i,n=8,r=8;for(t=0;e>t;t++)0!==r&&(i=this.readEG(),r=(n+i+256)%256),n=0===r?n:r}},{key:"readSPS",value:function(){var e,t,i,n,r,s,a,o,l,u=0,h=0,c=0,f=0,d=1;if(this.readUByte(),e=this.readUByte(),t=this.readBits(5),this.skipBits(3),i=this.readUByte(),this.skipUEG(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var g=this.readUEG();if(3===g&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(o=3!==g?8:12,l=0;o>l;l++)this.readBoolean()&&(6>l?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var m=this.readUEG();if(0===m)this.readUEG();else if(1===m)for(this.skipBits(1),this.skipEG(),this.skipEG(),n=this.readUEG(),l=0;n>l;l++)this.skipEG();if(this.skipUEG(),this.skipBits(1),r=this.readUEG(),s=this.readUEG(),a=this.readBits(1),0===a&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(u=this.readUEG(),h=this.readUEG(),c=this.readUEG(),f=this.readUEG()),this.readBoolean()&&this.readBoolean()){var p=void 0,_=this.readUByte();switch(_){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()]}p&&(d=p[0]/p[1])}return{width:Math.ceil((16*(r+1)-2*u-2*h)*d),height:(2-a)*(s+1)*16-(a?2:4)*(c+f)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),t}();i.default=a},{"../utils/logger":34}],17:[function(e,t,i){"use strict";function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var f=e("../utils/logger"),r=function(){function h(e){c(this,h),this._hasTimeStamp=!1;for(var t,i,n,r,s,a,o,l,u=0;;)if(o=this.readUTF(e,u,3),u+=3,"ID3"===o)u+=3,t=127&e[u++],i=127&e[u++],n=127&e[u++],r=127&e[u++],s=(t<<21)+(i<<14)+(n<<7)+r,a=u+s,this._parseID3Frames(e,u,a),u=a;else{if("3DI"!==o)return u-=3,l=u,void(l&&(this.hasTimeStamp||f.logger.warn("ID3 tag found, but no timestamp"),this._length=l,this._payload=e.subarray(0,l)));u+=7,f.logger.log("3DI footer found, end: "+u)}}return n(h,[{key:"readUTF",value:function(e,t,i){var n="",r=t,s=t+i;do{n+=String.fromCharCode(e[r++])}while(s>r);return n}},{key:"_parseID3Frames",value:function(e,t,i){for(var n,r,s,a,o;i>=t+8;)switch(n=this.readUTF(e,t,4),t+=4,r=e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],a=e[t++]<<8+e[t++],s=t,n){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var l=1&e[t++];this._hasTimeStamp=!0,o=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,l&&(o+=47721858.84),o=Math.round(o),f.logger.trace("ID3 timestamp found: "+o),this._timeStamp=o}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),h}();i.default=r},{"../utils/logger":34}],18:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("./adts"),E=n(a),o=e("../events"),x=n(o),l=e("./exp-golomb"),S=n(l),y=e("../utils/logger"),O=e("../errors"),u=function(){function i(e,t){r(this,i),this.observer=e,this.remuxerClass=t,this.lastCC=0,this.remuxer=new this.remuxerClass(e)}return s(i,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this.lastAacPTS=null,this.aacOverFlow=null,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0},this._aacTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,i,n,r,s,a,o){var l,u,h,c,f,d,g,m,p=e.length,_=this.remuxer.passthrough;this.audioCodec=t,this.videoCodec=i,this.timeOffset=n,this._duration=o,this.contiguous=!1,r!==this.lastCC?(y.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=r):s!==this.lastLevel?(y.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=s):a===this.lastSN+1&&(this.contiguous=!0),this.lastSN=a,this.contiguous||(this.aacOverFlow=null);var b=this.pmtParsed,v=this._avcTrack.id,A=this._aacTrack.id,T=this._id3Track.id;for(p-=p%188,c=0;p>c;c+=188)if(71===e[c]){if(f=!!(64&e[c+1]),d=((31&e[c+1])<<8)+e[c+2],g=(48&e[c+3])>>4,g>1){if(m=c+5+e[c+4],m===c+188)continue}else m=c+4;if(b)if(d===v){if(f){if(l&&(this._parseAVCPES(this._parsePES(l)),_&&this._avcTrack.codec&&(-1===A||this._aacTrack.codec)))return void this.remux(e);l={data:[],size:0}}l&&(l.data.push(e.subarray(m,c+188)),l.size+=c+188-m)}else if(d===A){if(f){if(u&&(this._parseAACPES(this._parsePES(u)),_&&this._aacTrack.codec&&(-1===v||this._avcTrack.codec)))return void this.remux(e);u={data:[],size:0}}u&&(u.data.push(e.subarray(m,c+188)),u.size+=c+188-m)}else d===T&&(f&&(h&&this._parseID3PES(this._parsePES(h)),h={data:[],size:0}),h&&(h.data.push(e.subarray(m,c+188)),h.size+=c+188-m));else f&&(m+=e[m]+1),0===d?this._parsePAT(e,m):d===this._pmtId&&(this._parsePMT(e,m),b=this.pmtParsed=!0,v=this._avcTrack.id,A=this._aacTrack.id,T=this._id3Track.id)}else this.observer.trigger(x.default.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});l&&this._parseAVCPES(this._parsePES(l)),u&&this._parseAACPES(this._parsePES(u)),h&&this._parseID3PES(this._parsePES(h)),this.remux(null)}},{key:"remux",value:function(e){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this._txtTrack,this.timeOffset,this.contiguous,e)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){this._pmtId=(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t){var i,n,r,s;for(i=(15&e[t+1])<<8|e[t+2],n=t+3+i-4,r=(15&e[t+10])<<8|e[t+11],t+=12+r;n>t;){switch(s=(31&e[t+1])<<8|e[t+2],e[t]){case 15:this._aacTrack.id=s;break;case 21:this._id3Track.id=s;break;case 27:this._avcTrack.id=s;break;default:y.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}}},{key:"_parsePES",value:function(e){var t,i,n,r,s,a,o,l,u,h=0,c=e.data;if(t=c[0],n=(t[0]<<16)+(t[1]<<8)+t[2],1===n){for(r=(t[4]<<8)+t[5],i=t[7],192&i&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&i?(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,l>4294967295&&(l-=8589934592)):l=o),s=t[8],u=s+9,e.size-=u,a=new Uint8Array(e.size);c.length;){t=c.shift();var f=t.byteLength;if(u){if(u>f){u-=f;continue}t=t.subarray(u),f-=u,u=0}a.set(t,h),h+=f}return{data:a,pts:o,dts:l,len:r}}return null}},{key:"_parseAVCPES",value:function(m){var p,e,_,b,v=this,A=this._avcTrack,t=A.samples,i=this._parseAVCNALu(m.data),T=[],E=!1,x=!1,O=0;if(0===i.length&&t.length>0){var n=t[t.length-1],r=n.units.units[n.units.units.length-1],s=new Uint8Array(r.data.byteLength+m.data.byteLength);s.set(r.data,0),s.set(m.data,r.data.byteLength),r.data=s,n.units.length+=m.data.byteLength,A.len+=m.data.byteLength}m.data=null;var I="";i.forEach(function(e){switch(e.type){case 1:_=!0,E&&(I+="NDR ");break;case 5:_=!0,E&&(I+="IDR "),x=!0;break;case 6:_=!0,E&&(I+="SEI "),p=new S.default(e.data),p.readUByte();var t=p.readUByte();if(4===t){var i=0;do{i=p.readUByte()}while(255===i);var n=p.readUByte();if(181===n){var r=p.readUShort();if(49===r){var s=p.readUInt();if(1195456820===s){var a=p.readUByte();if(3===a){var o=p.readUByte(),l=p.readUByte(),u=31&o,h=[o,l];for(b=0;u>b;b++)h.push(p.readUByte()),h.push(p.readUByte()),h.push(p.readUByte());v._txtTrack.samples.push({type:3,pts:m.pts,bytes:h})}}}}}break;case 7:if(_=!0,E&&(I+="SPS "),!A.sps){p=new S.default(e.data);var c=p.readSPS();A.width=c.width,A.height=c.height,A.sps=[e.data],A.timescale=v.remuxer.timescale,A.duration=v.remuxer.timescale*v._duration;var f=e.data.subarray(1,4),d="avc1.";for(b=0;3>b;b++){var g=f[b].toString(16);g.length<2&&(g="0"+g),d+=g}A.codec=d}break;case 8:_=!0,E&&(I+="PPS "),A.pps||(A.pps=[e.data]);break;case 9:_=!1,E&&(I+="AUD ");break;default:_=!1,I+="unknown NAL "+e.type+" "}_&&(T.push(e),O+=e.data.byteLength)}),(E||I.length)&&y.logger.log(I),T.length&&(x===!0||A.sps)&&(e={units:{units:T,length:O},pts:m.pts,dts:m.dts,key:x},t.push(e),A.len+=O,A.nbNalu+=T.length)}},{key:"_parseAVCNALu",value:function(e){for(var t,i,n,r,s,a,o=0,l=e.byteLength,u=0,h=[];l>o;)switch(t=e[o++],u){case 0:0===t&&(u=1);break;case 1:u=0===t?2:0;break;case 2:case 3:if(0===t)u=3;else if(1===t&&l>o){if(r=31&e[o],s)n={data:e.subarray(s,o-u-1),type:a},h.push(n);else if(i=o-u-1){var c=this._avcTrack,f=c.samples;if(f.length){var d=f[f.length-1],g=d.units.units,m=g[g.length-1],p=new Uint8Array(m.data.byteLength+i);p.set(m.data,0),p.set(e.subarray(0,i),m.data.byteLength),m.data=p,d.units.length+=i,c.len+=i}}s=o,a=r,u=0}else u=0}return s&&(n={data:e.subarray(s,l),type:a},h.push(n)),h}},{key:"_parseAACPES",value:function(e){var t,i,n,r,s,a,o,l,u,h=this._aacTrack,c=e.data,f=e.pts,d=0,g=this._duration,m=this.audioCodec,p=this.aacOverFlow,_=this.lastAacPTS;if(p){var b=new Uint8Array(p.byteLength+c.byteLength);b.set(p,0),b.set(c,p.byteLength),c=b}for(s=d,l=c.length;l-1>s&&(255!==c[s]||240!==(240&c[s+1]));s++);if(s){var v,A;if(l-1>s?(v="AAC PES did not start with ADTS header,offset:"+s,A=!1):(v="no ADTS header found in AAC PES",A=!0),this.observer.trigger(x.default.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:A,reason:v}),A)return}if(h.audiosamplerate||(t=E.default.getAudioConfig(this.observer,c,s,m),h.config=t.config,h.audiosamplerate=t.samplerate,h.channelCount=t.channelCount,h.codec=t.codec,h.timescale=t.samplerate,h.duration=t.samplerate*g,y.logger.log("parsed codec:"+h.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)),r=0,n=9216e4/h.audiosamplerate,p&&_){var T=_+n;Math.abs(T-f)>1&&(y.logger.log("AAC: align PTS for overlapping frames by "+Math.round((T-f)/90)),f=T)}for(;l>s+5&&(a=1&c[s+1]?7:9,i=(3&c[s+3])<<11|c[s+4]<<3|(224&c[s+5])>>>5,i-=a,i>0&&l>=s+a+i);)for(o=f+r*n,u={unit:c.subarray(s+a,s+a+i),pts:o,dts:o},h.samples.push(u),h.len+=i,s+=i+a,r++;l-1>s&&(255!==c[s]||240!==(240&c[s+1]));s++);p=l>s?c.subarray(s,l):null,this.aacOverFlow=p,this.lastAacPTS=o}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]?!0:!1}}]),i}();i.default=u},{"../errors":19,"../events":21,"../utils/logger":34,"./adts":12,"./exp-golomb":16}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},i.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole"}},{}],20:[function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function r(e){s(this,r),this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return a(r,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===n(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var i=function(e,t){var i="on"+e.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,t)};i.call(this,e,t).call()}}]),r}();i.default=r},{}],21:[function(e,t,i){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded"}},{}],22:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var g=e("../utils/logger"),s=function(){function d(){n(this,d)}return r(d,null,[{key:"mergeDetails",value:function(e,t){var i,n=Math.max(e.startSN,t.startSN)-t.startSN,r=Math.min(e.endSN,t.endSN)-t.startSN,s=t.startSN-e.startSN,a=e.fragments,o=t.fragments,l=0;if(n>r)return void(t.PTSKnown=!1);for(var u=n;r>=u;u++){var h=a[s+u],c=o[u];l=h.cc-c.cc,isNaN(h.startPTS)||(c.start=c.startPTS=h.startPTS,c.endPTS=h.endPTS,c.duration=h.duration,i=c)}if(l)for(g.logger.log("discontinuity sliding from playlist, take drift into account"),u=0;u<o.length;u++)o[u].cc+=l;if(i)d.updateFragPTS(t,i.sn,i.startPTS,i.endPTS);else{var f=a[s].start;for(u=0;u<o.length;u++)o[u].start+=f}t.PTSKnown=e.PTSKnown}},{key:"updateFragPTS",value:function(e,t,i,n){var r,s,a,o;if(t<e.startSN||t>e.endSN)return 0;r=t-e.startSN,s=e.fragments,a=s[r],isNaN(a.startPTS)||(i=Math.min(i,a.startPTS),n=Math.max(n,a.endPTS));var l=i-a.start;for(a.start=a.startPTS=i,a.endPTS=n,a.duration=n-i,o=r;o>0;o--)d.updatePTS(s,o,o-1);for(o=r;o<s.length-1;o++)d.updatePTS(s,o,o+1);return e.PTSKnown=!0,l}},{key:"updatePTS",value:function(e,t,i){var n=e[t],r=e[i],s=r.startPTS;isNaN(s)?i>t?r.start=n.start+n.duration:r.start=n.start-r.duration:i>t?(n.duration=s-n.start,n.duration<0&&g.logger.error("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(r.duration=n.start-s,r.duration<0&&g.logger.error("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!"))}}]),d}();i.default=s},{"../utils/logger":34}],23:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("./events"),o=n(a),l=e("./errors"),u=e("./loader/playlist-loader"),h=n(u),c=e("./loader/fragment-loader"),f=n(c),d=e("./controller/abr-controller"),g=n(d),m=e("./controller/buffer-controller"),p=n(m),_=e("./controller/stream-controller"),b=n(_),v=e("./controller/level-controller"),A=n(v),T=e("./controller/timeline-controller"),E=n(T),x=e("./utils/logger"),O=e("./utils/xhr-loader"),I=n(O),S=e("events"),y=n(S),C=e("./loader/key-loader"),R=n(C),N=function(){function n(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];s(this,n);var t=n.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var i in t)i in e||(e[i]=t[i]);if(void 0!==e.liveMaxLatencyDurationCount&&e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(e.liveMaxLatencyDuration<=e.liveSyncDuration||void 0===e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,x.enableLogs)(e.debug),this.config=e;var r=this.observer=new y.default;r.trigger=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];r.emit.apply(r,[e,e].concat(i))},r.off=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];r.removeListener.apply(r,[e].concat(i))},this.on=r.on.bind(r),this.off=r.off.bind(r),this.trigger=r.trigger.bind(r),this.playlistLoader=new h.default(this),this.fragmentLoader=new f.default(this),this.levelController=new A.default(this),this.abrController=new e.abrController(this),this.bufferController=new e.bufferController(this),this.streamController=new e.streamController(this),this.timelineController=new e.timelineController(this),this.keyLoader=new R.default(this)}return r(n,null,[{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function(){return o.default}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig||(n.defaultConfig={autoStartLoad:!0,debug:!1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,appendErrorMaxRetry:3,loader:I.default,fLoader:void 0,pLoader:void 0,abrController:g.default,bufferController:p.default,streamController:b.default,timelineController:E.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1}),n.defaultConfig},set:function(e){n.defaultConfig=e}}]),r(n,[{key:"destroy",value:function(){x.logger.log("destroy"),this.trigger(o.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.bufferController.destroy(),this.streamController.destroy(),this.timelineController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){x.logger.log("attachMedia"),this.media=e,this.trigger(o.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){x.logger.log("detachMedia"),this.trigger(o.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){x.logger.log("loadSource:"+e),this.url=e,this.trigger(o.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];x.logger.log("startLoad"),this.levelController.startLoad(),this.streamController.startLoad(e)}},{key:"stopLoad",value:function(){x.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad()}},{key:"swapAudioCodec",value:function(){x.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){x.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){x.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){x.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){x.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return this.levelController.firstLevel},set:function(e){x.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){x.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){x.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}}]),n}();i.default=N},{"./controller/abr-controller":3,"./controller/buffer-controller":4,"./controller/level-controller":5,"./controller/stream-controller":6,"./controller/timeline-controller":7,"./errors":19,"./events":21,"./loader/fragment-loader":25,"./loader/key-loader":26,"./loader/playlist-loader":27,"./utils/logger":34,"./utils/xhr-loader":36,events:1}],24:[function(e,t,i){"use strict";t.exports=e("./hls.js").default},{"./hls.js":23}],25:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var l=e("../events"),u=n(l),h=e("../event-handler"),c=n(h),f=e("../errors"),d=function(e){function t(e){return r(this,t),s(this,Object.getPrototypeOf(t).call(this,e,u.default.FRAG_LOADING))}return a(t,e),o(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),c.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;this.frag=t,this.frag.loaded=0;var i=this.hls.config;t.loader=this.loader="undefined"!=typeof i.fLoader?new i.fLoader(i):new i.loader(i),this.loader.load(t.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),i.fragLoadingTimeOut,1,0,this.loadprogress.bind(this),t)}},{key:"loadsuccess",value:function(e,t){var i=e.currentTarget.response;t.length=i.byteLength,this.frag.loader=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:i,frag:this.frag,stats:t})}},{key:"loaderror",value:function(e){this.loader&&this.loader.abort(),this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:this.frag,response:e})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(e,t){this.frag.loaded=t.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:this.frag,stats:t})}}]),t}(c.default);i.default=d},{"../errors":19,"../event-handler":20,"../events":21}],26:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var l=e("../events"),u=n(l),h=e("../event-handler"),c=n(h),f=e("../errors"),d=function(e){function i(e){r(this,i);var t=s(this,Object.getPrototypeOf(i).call(this,e,u.default.KEY_LOADING));return t.decryptkey=null,t.decrypturl=null,t}return a(i,e),o(i,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),c.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=this.frag=e.frag,i=t.decryptdata,n=i.uri;if(n!==this.decrypturl||null===this.decryptkey){var r=this.hls.config;t.loader=this.loader=new r.loader(r),this.decrypturl=n,this.decryptkey=null,t.loader.load(n,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),r.fragLoadingTimeOut,r.fragLoadingMaxRetry,r.fragLoadingRetryDelay,this.loadprogress.bind(this),t)}else this.decryptkey&&(i.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e){var t=this.frag;this.decryptkey=t.decryptdata.key=new Uint8Array(e.currentTarget.response),t.loader=void 0,this.hls.trigger(u.default.KEY_LOADED,{frag:t})}},{key:"loaderror",value:function(e){this.loader&&this.loader.abort(),this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:this.frag,response:e})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(){}}]),i}(c.default);i.default=d},{"../errors":19,"../event-handler":20,"../events":21}],27:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var l=e("../events"),h=n(l),u=e("../event-handler"),c=n(u),f=e("../errors"),d=e("../utils/url"),g=n(d),m=e("../utils/attr-list"),S=n(m),p=function(e){function t(e){return r(this,t),s(this,Object.getPrototypeOf(t).call(this,e,h.default.MANIFEST_LOADING,h.default.LEVEL_LOADING))}return a(t,e),o(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),this.url=this.id=null,c.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,null)}},{key:"onLevelLoading",value:function(e){this.load(e.url,e.level,e.id)}},{key:"load",value:function(e,t,i){var n,r,s,a=this.hls.config;this.url=e,this.id=t,this.id2=i,null===this.id?(n=a.manifestLoadingMaxRetry,r=a.manifestLoadingTimeOut,s=a.manifestLoadingRetryDelay):(n=a.levelLoadingMaxRetry,r=a.levelLoadingTimeOut,s=a.levelLoadingRetryDelay),this.loader="undefined"!=typeof a.pLoader?new a.pLoader(a):new a.loader(a),this.loader.load(e,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),r,n,s)}},{key:"resolve",value:function(e,t){return g.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){for(var i=[],n=void 0,r=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;null!=(n=r.exec(e));){var s={},a=s.attrs=new S.default(n[1]);s.url=this.resolve(n[2],t);var o=a.decimalResolution("RESOLUTION");o&&(s.width=o.width,s.height=o.height),s.bitrate=a.decimalInteger("BANDWIDTH"),s.name=a.NAME;var l=a.CODECS;if(l){l=l.split(",");for(var u=0;u<l.length;u++){var h=l[u];-1!==h.indexOf("avc1")?s.videoCodec=this.avc1toavcoti(h):s.audioCodec=h}}i.push(s)}return i}},{key:"avc1toavcoti",value:function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"parseLevelPlaylist",value:function(e,t,i){var n,r,s,a,o=0,l=0,u={url:t,fragments:[],live:!0,startSN:0},h={method:null,key:null,iv:null,uri:null},c=0,f=null,d=null;for(r=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.*))|(?:#EXT(INF):([\d\.]+)[^\r\n]*([\r\n]+[^#|\r\n]+)?)|(?:#EXT-X-(BYTERANGE):([\d]+[@[\d]*)]*[\r\n]+([^#|\r\n]+)?|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.*))/g;null!==(n=r.exec(e));)switch(n.shift(),n=n.filter(function(e){return void 0!==e}),n[0]){case"MEDIA-SEQUENCE":o=u.startSN=parseInt(n[1]);break;case"TARGETDURATION":u.targetduration=parseFloat(n[1]);break;case"ENDLIST":u.live=!1;break;case"DIS":c++;break;case"BYTERANGE":var g=n[1].split("@");a=1===g.length?s:parseInt(g[1]),s=parseInt(g[0])+a,d&&!d.url&&(d.byteRangeStartOffset=a,d.byteRangeEndOffset=s,d.url=this.resolve(n[2],t));break;case"INF":var m=parseFloat(n[1]);if(!isNaN(m)){var p,_=o++;if(h.method&&h.uri&&!h.iv){p=this.cloneObj(h);for(var b=new Uint8Array(16),v=12;16>v;v++)b[v]=_>>8*(15-v)&255;p.iv=b}else p=h;var A=n[2]?this.resolve(n[2],t):null;d={url:A,duration:m,start:l,sn:_,level:i,cc:c,byteRangeStartOffset:a,byteRangeEndOffset:s,decryptdata:p,programDateTime:f},u.fragments.push(d),l+=m,a=null,f=null}break;case"KEY":var T=n[1],E=new S.default(T),x=E.enumeratedString("METHOD"),O=E.URI,I=E.hexadecimalInteger("IV");x&&(h={method:null,key:null,iv:null,uri:null},O&&"AES-128"===x&&(h.method=x,h.uri=this.resolve(O,t),h.key=null,h.iv=I));break;case"PROGRAM-DATE-TIME":f=new Date(Date.parse(n[1]))}return d&&!d.url&&(u.fragments.pop(),l-=d.duration),u.totalduration=l,u.endSN=o-1,u}},{key:"loadsuccess",value:function(e,t){var i,n=e.currentTarget,r=n.responseText,s=n.responseURL,a=this.id,o=this.id2,l=this.hls;if(void 0===s&&(s=this.url),t.tload=performance.now(),t.mtime=new Date(n.getResponseHeader("Last-Modified")),0===r.indexOf("#EXTM3U"))if(r.indexOf("#EXTINF:")>0)if(null===this.id)l.trigger(h.default.MANIFEST_LOADED,{levels:[{url:s}],url:s,stats:t});else{var u=this.parseLevelPlaylist(r,s,a);t.tparsed=performance.now(),l.trigger(h.default.LEVEL_LOADED,{details:u,level:a,id:o,stats:t})}else i=this.parseMasterPlaylist(r,s),i.length?l.trigger(h.default.MANIFEST_LOADED,{levels:i,url:s,stats:t}):l.trigger(h.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:s,reason:"no level found in manifest"});else l.trigger(h.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:s,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e){var t,i;null===this.id?(t=f.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0):(t=f.ErrorDetails.LEVEL_LOAD_ERROR,i=!1),this.loader&&this.loader.abort(),this.hls.trigger(h.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:t,fatal:i,url:this.url,loader:this.loader,response:e.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function(){var e,t;null===this.id?(e=f.ErrorDetails.MANIFEST_LOAD_TIMEOUT,t=!0):(e=f.ErrorDetails.LEVEL_LOAD_TIMEOUT,t=!1),this.loader&&this.loader.abort(),this.hls.trigger(h.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:e,fatal:t,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]),t}(c.default);i.default=p},{"../errors":19,"../event-handler":20,"../events":21,"../utils/attr-list":31,"../utils/url":35}],28:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function f(){n(this,f)}return r(f,null,[{key:"init",value:function(){f.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e;for(e in f.types)f.types.hasOwnProperty(e)&&(f.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);f.HDLR_TYPES={video:t,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);f.STTS=f.STSC=f.STCO=r,f.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),f.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),f.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),f.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);f.FTYP=f.box(f.types.ftyp,s,o,s,a),f.DINF=f.box(f.types.dinf,f.box(f.types.dref,n))}},{key:"box",value:function(e){for(var t,i=Array.prototype.slice.call(arguments,1),n=8,r=i.length,s=r;r--;)n+=i[r].byteLength;for(t=new Uint8Array(n),t[0]=n>>24&255,t[1]=n>>16&255,t[2]=n>>8&255,t[3]=255&n,t.set(e,4),r=0,n=8;s>r;r++)t.set(i[r],n),n+=i[r].byteLength;return t}},{key:"hdlr",value:function(e){return f.box(f.types.hdlr,f.HDLR_TYPES[e])}},{key:"mdat",value:function(e){return f.box(f.types.mdat,e)}},{key:"mdhd",value:function(e,t){return f.box(f.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,t>>24,t>>16&255,t>>8&255,255&t,85,196,0,0]))}},{key:"mdia",value:function(e){return f.box(f.types.mdia,f.mdhd(e.timescale,e.duration),f.hdlr(e.type),f.minf(e))}},{key:"mfhd",value:function(e){return f.box(f.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"minf",value:function(e){return"audio"===e.type?f.box(f.types.minf,f.box(f.types.smhd,f.SMHD),f.DINF,f.stbl(e)):f.box(f.types.minf,f.box(f.types.vmhd,f.VMHD),f.DINF,f.stbl(e))}},{key:"moof",value:function(e,t,i){return f.box(f.types.moof,f.mfhd(e),f.traf(i,t))}},{key:"moov",value:function(e){for(var t=e.length,i=[];t--;)i[t]=f.trak(e[t]);return f.box.apply(null,[f.types.moov,f.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(f.mvex(e)))}},{key:"mvex",value:function(e){for(var t=e.length,i=[];t--;)i[t]=f.trex(e[t]);return f.box.apply(null,[f.types.mvex].concat(i))}},{key:"mvhd",value:function(e,t){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return f.box(f.types.mvhd,i)}},{key:"sdtp",value:function(e){var t,i,n=e.samples||[],r=new Uint8Array(4+n.length);for(i=0;i<n.length;i++)t=n[i].flags,r[i+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return f.box(f.types.sdtp,r)}},{key:"stbl",value:function(e){return f.box(f.types.stbl,f.stsd(e),f.box(f.types.stts,f.STTS),f.box(f.types.stsc,f.STSC),f.box(f.types.stsz,f.STSZ),f.box(f.types.stco,f.STCO))}},{key:"avc1",value:function(e){var t,i,n,r=[],s=[];for(t=0;t<e.sps.length;t++)i=e.sps[t],n=i.byteLength,r.push(n>>>8&255),r.push(255&n),r=r.concat(Array.prototype.slice.call(i));for(t=0;t<e.pps.length;t++)i=e.pps[t],n=i.byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(i));var a=f.box(f.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(s))),o=e.width,l=e.height;return f.box(f.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,f.box(f.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(e){var t=e.audiosamplerate;return f.box(f.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),f.box(f.types.esds,f.esds(e)))}},{key:"stsd",value:function(e){return"audio"===e.type?f.box(f.types.stsd,f.STSD,f.mp4a(e)):f.box(f.types.stsd,f.STSD,f.avc1(e))}},{key:"tkhd",value:function(e){var t=e.id,i=e.duration,n=e.width,r=e.height;return f.box(f.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,r>>8&255,255&r,0,0]))}},{key:"traf",value:function(e,t){var i=f.sdtp(e),n=e.id;return f.box(f.types.traf,f.box(f.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),f.box(f.types.tfdt,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t])),f.trun(e,i.length+16+16+8+16+8+8),i)}},{key:"trak",value:function(e){return e.duration=e.duration||4294967295,f.box(f.types.trak,f.tkhd(e),f.mdia(e))}},{key:"trex",value:function(e){var t=e.id;return f.box(f.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(e,t){var i,n,r,s,a,o,l=e.samples||[],u=l.length,h=12+16*u,c=new Uint8Array(h);for(t+=8+h,c.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),i=0;u>i;i++)n=l[i],r=n.duration,s=n.size,a=n.flags,o=n.cts,c.set([r>>>24&255,r>>>16&255,r>>>8&255,255&r,s>>>24&255,s>>>16&255,s>>>8&255,255&s,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*i);return f.box(f.types.trun,c)}},{key:"initSegment",value:function(e){f.types||f.init();var t,i=f.moov(e);return t=new Uint8Array(f.FTYP.byteLength+i.byteLength),t.set(f.FTYP),t.set(i,f.FTYP.byteLength),t}}]),f}();i.default=s},{}],29:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("../events"),S=n(a),y=e("../utils/logger"),o=e("../remux/mp4-generator"),C=n(o),f=e("../errors"),l=function(){function t(e){r(this,t),this.observer=e,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return s(t,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=this.nextAacPts=this.nextAvcDts=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,i,n,r,s){this.ISGenerated||this.generateIS(e,t,r),t.samples.length&&this.remuxVideo(t,r,s),e.samples.length&&this.remuxAudio(e,r,s),i.samples.length&&this.remuxID3(i,r),n.samples.length&&this.remuxText(n,r),this.observer.trigger(S.default.FRAG_PARSED)}},{key:"generateIS",value:function(e,t,i){var n,r,s=this.observer,a=e.samples,o=t.samples,l=this.PES_TIMESCALE,u={},h={tracks:u,unique:!1},c=void 0===this._initPTS;c&&(n=r=1/0),e.config&&a.length&&(u.audio={container:"audio/mp4",codec:e.codec,initSegment:C.default.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(n=r=a[0].pts-l*i)),t.sps&&t.pps&&o.length&&(u.video={container:"video/mp4",codec:t.codec,initSegment:C.default.initSegment([t]),metadata:{width:t.width,height:t.height}},c&&(n=Math.min(n,o[0].pts-l*i),r=Math.min(r,o[0].dts-l*i))),Object.keys(u)?(s.trigger(S.default.FRAG_PARSING_INIT_SEGMENT,h),this.ISGenerated=!0,c&&(this._initPTS=n,this._initDTS=r)):s.trigger(S.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,i){var n,r,s,a,o,l,u,h,c,f,d,g,m,p,_,b=8,v=this.PES_TIMESCALE,A=this.PES2MP4SCALEFACTOR,T=[];for(l=new Uint8Array(e.len+4*e.nbNalu+8),n=new DataView(l.buffer),n.setUint32(0,l.byteLength),l.set(C.default.types.mdat,4);e.samples.length;){for(r=e.samples.shift(),a=0;r.units.units.length;)o=r.units.units.shift(),n.setUint32(b,o.data.byteLength),b+=4,l.set(o.data,b),b+=o.data.byteLength,a+=4+o.data.byteLength;if(d=r.pts-this._initDTS,g=r.dts-this._initDTS,g=Math.min(d,g),void 0!==f){m=this._PTSNormalize(d,f),p=this._PTSNormalize(g,f);var E=(p-f)/A;0>=E&&(y.logger.log("invalid sample duration at PTS/DTS: "+r.pts+"/"+r.dts+":"+E),E=1),s.duration=E}else{var x,O=this.nextAvcDts;m=this._PTSNormalize(d,O),p=this._PTSNormalize(g,O),x=Math.round((p-O)/90),(i||Math.abs(x)<600)&&x&&(x>1?y.logger.log("AVC:"+x+" ms hole between fragments detected,filling it"):-1>x&&y.logger.log("AVC:"+-x+" ms overlapping between fragments detected"),p=O,m=Math.max(m-x,p),y.logger.log("Video/PTS/DTS adjusted: "+m+"/"+p+",delta:"+x)),h=Math.max(0,m),c=Math.max(0,p)}s={size:a,duration:0,cts:(m-p)/A,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}},_=s.flags,r.key===!0?(_.dependsOn=2,_.isNonSync=0):(_.dependsOn=1,_.isNonSync=1),T.push(s),f=p}var I=0;T.length>=2&&(I=T[T.length-2].duration,s.duration=I),this.nextAvcDts=p+I*A,e.len=0,e.nbNalu=0,T.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_=T[0].flags,_.dependsOn=2,_.isNonSync=0),e.samples=T,u=C.default.moof(e.sequenceNumber++,c/A,e),e.samples=[],this.observer.trigger(S.default.FRAG_PARSING_DATA,{data1:u,data2:l,startPTS:h/v,endPTS:(m+A*I)/v,startDTS:c/v,endDTS:this.nextAvcDts/v,type:"video",nb:T.length})}},{key:"remuxAudio",value:function(e,t,i){var n,r,s,a,o,l,u,h,c,f,d,g,m,p=8,_=this.PES_TIMESCALE,b=e.timescale,v=_/b,A=[],T=[];for(e.samples.sort(function(e,t){return e.pts-t.pts}),T=e.samples;T.length;){if(r=T.shift(),a=r.unit,f=r.pts-this._initDTS,d=r.dts-this._initDTS,void 0!==c)g=this._PTSNormalize(f,c),m=this._PTSNormalize(d,c),s.duration=(m-c)/v,Math.abs(s.duration-1024)>10&&y.logger.log("invalid AAC sample duration at PTS "+Math.round(f/90)+",should be 1024,found :"+Math.round(s.duration)),s.duration=1024,m=1024*v+c;else{var E,x=this.nextAacPts;if(g=this._PTSNormalize(f,x),m=this._PTSNormalize(d,x),E=Math.round(1e3*(g-x)/_),(i||Math.abs(E)<600)&&E){if(E>0)y.logger.log(E+" ms hole between AAC samples detected,filling it");else if(-12>E){y.logger.log(-E+" ms overlapping between AAC samples detected, drop frame"),e.len-=a.byteLength;continue}g=m=x}if(u=Math.max(0,g),h=Math.max(0,m),!(e.len>0))return;o=new Uint8Array(e.len+8),n=new DataView(o.buffer),n.setUint32(0,o.byteLength),o.set(C.default.types.mdat,4)}o.set(a,p),p+=a.byteLength,s={size:a.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(s),c=m}var O=0,I=A.length;I>=2&&(O=A[I-2].duration,s.duration=O),I&&(this.nextAacPts=g+v*O,e.len=0,e.samples=A,l=C.default.moof(e.sequenceNumber++,h/v,e),e.samples=[],this.observer.trigger(S.default.FRAG_PARSING_DATA,{data1:l,data2:o,startPTS:u/_,endPTS:this.nextAacPts/_,startDTS:h/_,endDTS:(m+v*O)/_,type:"audio",nb:I}))}},{key:"remuxID3",value:function(e,t){var i,n=e.samples.length;if(n){for(var r=0;n>r;r++)i=e.samples[r],i.pts=(i.pts-this._initPTS)/this.PES_TIMESCALE,i.dts=(i.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(S.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var i,n=e.samples.length;if(n){for(var r=0;n>r;r++)i=e.samples[r],i.pts=(i.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(S.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var i;if(void 0===t)return e;for(i=e>t?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}},{key:"passthrough",get:function(){return!1}},{key:"timescale",get:function(){return this.MP4_TIMESCALE}}]),t}();i.default=l},{"../errors":19,"../events":21,"../remux/mp4-generator":28,"../utils/logger":34}],30:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var a=e("../events"),c=n(a),o=function(){function t(e){r(this,t),this.observer=e,this.ISGenerated=!1}return s(t,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,i,n,r,s){var a=this.observer;if(!this.ISGenerated){var o={},l={tracks:o,unique:!0},u=t,h=u.codec;h&&(l.tracks.video={container:u.container,codec:h,metadata:{width:u.width,height:u.height}}),u=e,h=u.codec,h&&(l.tracks.audio={container:u.container,codec:h,metadata:{channelCount:u.channelCount}}),this.ISGenerated=!0,a.trigger(c.default.FRAG_PARSING_INIT_SEGMENT,l)}a.trigger(c.default.FRAG_PARSING_DATA,{data1:s,startPTS:r,startDTS:r,type:"audiovideo",nb:1})}},{key:"passthrough",get:function(){return!0}},{key:"timescale",get:function(){return 0}}]),t}();i.default=o},{"../events":21}],31:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function i(e){n(this,i),"string"==typeof e&&(e=i.parseAttrList(e));for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return r(i,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=/^(\d+)x(\d+)$/.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){for(var t,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,n={};null!==(t=i.exec(e));){var r=t[2],s='"';0===r.indexOf(s)&&r.lastIndexOf(s)===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n}}]),i}();i.default=s},{}],32:[function(e,t,i){"use strict";var n={search:function(e,t){for(var i=0,n=e.length-1,r=null,s=null;n>=i;){r=(i+n)/2|0,s=e[r];var a=t(s);if(a>0)i=r+1;else{if(!(0>a))return s;n=r-1}}return null}};t.exports=n},{}],33:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(){n(this,e)}return r(e,[{key:"attach",value:function(e){this.media=e,this.display=[],this.memory=[]}},{key:"detach",value:function(){this.clear()}},{key:"destroy",value:function(){}},{key:"_createCue",value:function(){var e=window.VTTCue||window.TextTrackCue,t=this.cue=new e(-1,-1,"");t.text="",t.pauseOnExit=!1,t.startTime=Number.MAX_VALUE,t.endTime=Number.MAX_VALUE,this.memory.push(t)}},{key:"clear",value:function(){var e=this._textTrack;if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"push",value:function(e,t){this.cue||this._createCue();for(var i,n,r,s,a,o=31&t[0],l=2,u=0;o>u;u++)if(i=t[l++],n=127&t[l++],r=127&t[l++],s=0===(4&i)?!1:!0,a=3&i,(0!==n||0!==r)&&s&&0===a){if(32&n||64&n)this.cue.text+=this._fromCharCode(n)+this._fromCharCode(r);else if((17===n||25===n)&&r>=48&&63>=r)switch(r){case 48:this.cue.text+="";break;case 49:this.cue.text+="";break;case 50:this.cue.text+="";break;case 51:this.cue.text+="";break;case 52:this.cue.text+="";break;case 53:this.cue.text+="";break;case 54:this.cue.text+="";break;case 55:this.cue.text+="";break;case 56:this.cue.text+="";break;case 57:this.cue.text+=" ";break;case 58:this.cue.text+="";break;case 59:this.cue.text+="";break;case 60:this.cue.text+="";break;case 61:this.cue.text+="";break;case 62:this.cue.text+="";break;case 63:this.cue.text+=""}if((17===n||25===n)&&r>=32&&47>=r)switch(r){case 32:break;case 33:break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:break;case 42:break;case 43:break;case 44:break;case 45:break;case 46:break;case 47:}if((20===n||28===n)&&r>=32&&47>=r)switch(r){case 32:this._clearActiveCues(e);break;case 33:this.cue.text=this.cue.text.substr(0,this.cue.text.length-1);break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:this._clearActiveCues(e);break;case 42:break;case 43:break;case 44:this._clearActiveCues(e);break;case 45:break;case 46:this._text="";break;case 47:this._flipMemory(e)}if((23===n||31===n)&&r>=33&&35>=r)switch(r){case 33:break;case 34:break;case 35:}}}},{key:"_fromCharCode",value:function(e){switch(e){case 42:return"";case 2:return"";case 2:return"";case 4:return"";case 5:return"";case 6:return"";case 3:return"";case 4:return"";case 5:return"";case 6:return"";case 7:return"";default:return String.fromCharCode(e)}}},{key:"_flipMemory",value:function(e){this._clearActiveCues(e),this._flushCaptions(e)}},{key:"_flushCaptions",value:function(e){this._has708||(this._textTrack=this.media.addTextTrack("captions","English","en"),this._has708=!0);var t=!0,i=!1,n=void 0;try{for(var r,s=this.memory[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var a=r.value;a.startTime=e,this._textTrack.addCue(a),this.display.push(a)}}catch(t){i=!0,n=t}finally{try{!t&&s.return&&s.return()}finally{if(i)throw n}}this.memory=[],this.cue=null}},{key:"_clearActiveCues",value:function(e){var t=!0,i=!1,n=void 0;try{for(var r,s=this.display[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var a=r.value;a.endTime=e}}catch(t){i=!0,n=t}finally{try{!t&&s.return&&s.return()}finally{if(i)throw n}}this.display=[]}},{key:"_clearBufferedCues",value:function(){}}]),e}();i.default=s},{}],34:[function(e,t,i){"use strict";function s(){}function a(e,t){return t="["+e+"] > "+t}function r(n){var r=window.console[n];return r?function(){for(var e=arguments.length,t=Array(e),i=0;e>i;i++)t[i]=arguments[i];t[0]&&(t[0]=a(n,t[0])),r.apply(window.console,t)}:s}function n(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;e>n;n++)i[n-1]=arguments[n];i.forEach(function(e){u[e]=t[e]?t[e].bind(t):r(e)})}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(i,"__esModule",{value:!0});var l={trace:s,debug:s,log:s,warn:s,info:s,error:s},u=l;i.enableLogs=function(e){if(e===!0||"object"===("undefined"==typeof e?"undefined":o(e))){n(e,"debug","log","info","warn","error");try{u.log()}catch(e){u=l}}else u=l},i.logger=u},{}],35:[function(e,t,i){"use strict";var d={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var i=null,n=null,r=/^([^#]*)(.*)$/.exec(t);r&&(n=r[2],t=r[1]);var s=/^([^\?]*)(.*)$/.exec(t);s&&(i=s[2],t=s[1]);var a=/^([^#]*)(.*)$/.exec(e);a&&(e=a[1]);var o=/^([^\?]*)(.*)$/.exec(e);o&&(e=o[1]);var l=/^((([a-z]+):)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?\/)(.*)$/i.exec(e),u=l[3],h=l[1],c=l[5],f=null;return f=/^\/\//.test(t)?u+"://"+d.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?h+d.buildAbsolutePath("",t.substring(1)):d.buildAbsolutePath(h+c,t),i&&(f+=i),n&&(f+=n),f},buildAbsolutePath:function(e,t){for(var i,n,r=t,s="",a=e.replace(/[^\/]*$/,r.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),o=0;n=a.indexOf("/../",o),n>-1;o=n+i)i=/^\/(?:\.\.\/)*/.exec(a.slice(n))[0].length,s=(s+a.substring(o,n)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(i-1)/3+"}$"),"/");return s+a.substr(o)}};t.exports=d},{}],36:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();Object.defineProperty(i,"__esModule",{value:!0});var s=e("../utils/logger"),a=function(){function t(e){n(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return r(t,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader,t=this.timeoutHandle;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),t&&window.clearTimeout(t)}},{key:"load",value:function(e,t,i,n,r,s,a,o){var l=arguments.length<=8||void 0===arguments[8]?null:arguments[8],u=arguments.length<=9||void 0===arguments[9]?null:arguments[9];this.url=e,!u||isNaN(u.byteRangeStartOffset)||isNaN(u.byteRangeEndOffset)||(this.byteRange=u.byteRangeStartOffset+"-"+(u.byteRangeEndOffset-1)),this.responseType=t,this.onSuccess=i,this.onProgress=l,this.onTimeout=r,this.onError=n,this.stats={trequest:performance.now(),retry:0},this.timeout=s,this.maxRetry=a,this.retryDelay=o,this.loadInternal()}},{key:"loadInternal",value:function(){var e;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onloadend=this.loadend.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",this.url,!0),this.byteRange&&e.setRequestHeader("Range","bytes="+this.byteRange),e.responseType=this.responseType,this.stats.tfirst=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(e,this.url),this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),this.timeout),e.send()}},{key:"loadend",value:function(e){var t=e.currentTarget,i=t.status,n=this.stats;n.aborted||(i>=200&&300>i?(window.clearTimeout(this.timeoutHandle),n.tload=performance.now(),this.onSuccess(e,n)):n.retry<this.maxRetry?(s.logger.warn(i+" while loading "+this.url+", retrying in "+this.retryDelay+"..."),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),n.retry++):(window.clearTimeout(this.timeoutHandle),s.logger.error(i+" while loading "+this.url),this.onError(e)))}},{key:"loadtimeout",value:function(e){s.logger.warn("timeout while loading "+this.url),this.onTimeout(e,this.stats)}},{key:"loadprogress",value:function(e){var t=this.stats;null===t.tfirst&&(t.tfirst=performance.now()),t.loaded=e.loaded,this.onProgress&&this.onProgress(e,t)}}]),t}();i.default=a},{"../utils/logger":34}]},{},[24])(24)});(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{VarGetOpWrapper:()=>t,VarSetOpWrapper:()=>e});const a=CABLES;class e{constructor(t,e,i,n,r,s){this._valuePort=i;this._varNamePort=n;this._op=t;this._type=e;this._typeId=-1;this._triggerPort=r;this._nextPort=s;this._var=null;this._btnCreate=t.inTriggerButton("Create new variable");this._btnCreate.setUiAttribs({hidePort:true});this._btnCreate.onTriggered=this._createVar.bind(this);this._helper=t.inUiTriggerButtons("",["Rename"]);this._helper.setUiAttribs({hidePort:true});this._helper.onTriggered=e=>{if(e=="Rename")CABLES.CMD.PATCH.renameVariable(t.varName.get())};this._op.setPortGroup("Variable",[this._helper,this._varNamePort,this._btnCreate]);n.setUiAttribs({_variableSelect:true});this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.patch.addEventListener("variablesChanged",this._updateName.bind(this));this._op.patch.addEventListener("variableRename",this._renameVar.bind(this));this._varNamePort.onChange=this._updateName.bind(this);this._isTexture=this._valuePort.uiAttribs.objType==="texture";this._valuePort.changeAlways=true;if(this._triggerPort){this._triggerPort.onTriggered=()=>{this._setVarValue(true)}}else{this._valuePort.onChange=this._setVarValue.bind(this)}this._op.init=()=>{this._updateName();if(!this._triggerPort)this._setVarValue();this._updateErrorUi()};if(e=="array")this._typeId=a.Port.TYPE_ARRAY;else if(e=="object")this._typeId=a.Port.TYPE_OBJECT;else if(e=="string")this._typeId=a.Port.TYPE_STRING;else if(e=="texture")this._typeId=a.Port.TYPE_TEXTURE;else this._typeId=a.Port.TYPE_VALUE}_updateErrorUi(){if(CABLES.UI){if(!this._varNamePort.get())this._op.setUiError("novarname","no variable selected");else{if(this._op.hasUiErrors)this._op.setUiError("novarname",null)}}}_updateName(){this._var=null;const e=this._varNamePort.get();this._op.setTitle("var set");this._op.setUiAttrib({extendTitle:"#"+e});this._updateErrorUi();const t=this._op.patch.getVar(e);if(t&&!t.type)t.type=this._type;if(!this._op.patch.hasVar(e)&&e!=0&&!this._triggerPort){this._setVarValue()}if(!this._op.patch.hasVar(e)&&e!=0&&this._triggerPort){if(this._type=="string")this._op.patch.setVarValue(e,"");else if(this._type=="number")this._op.patch.setVarValue(e,"");else this._op.patch.setVarValue(e,null)}if(this._op.isCurrentUiOp()){this._updateVarNamesDropdown();this._op.refreshParams()}this._updateDisplay();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varNamePort.get())}_createVar(){CABLES.CMD.PATCH.createVariable(this._op,this._type,()=>{this._updateName()})}_updateDisplay(){this._valuePort.setUiAttribs({greyout:!this._varNamePort.get()})}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded&&CABLES.UI.loaded){const e=gui.uiProfiler.start("[vars] _updateVarNamesDropdown");const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._varNamePort.uiAttribs.values=t;e.finish()}}_renameVar(e,t){if(e!=this._varNamePort.get())return;this._varNamePort.set(t);this._updateName()}_setVarValue(e){let t=this._valuePort.get();if(!this._var){const i=this._varNamePort.get();if(!i)return;if(this._typeId==a.Port.TYPE_VALUE&&typeof t=="string")t=parseFloat(t);this._op.patch.setVarValue(i,t,this._type);this._var=this._op.patch.getVar(i)}if(this._typeId==a.Port.TYPE_VALUE||this._typeId==a.Port.TYPE_STRING){this._var.setValue(t)}else if(this._typeId==a.Port.TYPE_ARRAY){this._arr=[];a.utils.copyArray(t,this._arr);this._var.setValue(this._arr)}else{if(this._typeId==a.Port.TYPE_OBJECT){if(this._isTexture)this._var.setValue(CGL.Texture.getEmptyTexture(this._op.patch.cgl));else this._var.setValue(null);if(t&&t.tex&&t._cgl&&!this._isTexture)this._op.setUiError("texobj","Dont use object variables for textures, use varSetTexture");else this._op.setUiError("texobj",null)}this._var.setValue(t)}if(e&&this._nextPort)this._nextPort.trigger()}}class t{constructor(e,t,i,n){this._op=e;this._type=t;this._varnamePort=i;this._variable=null;this._valueOutPort=n;this._listenerId=null;this._typeId=0;if(t=="array")this._typeId=a.Port.TYPE_ARRAY;else if(t=="object")this._typeId=a.Port.TYPE_OBJECT;else if(t=="texture")this._typeId=a.Port.TYPE_TEXTURE;else if(t=="string")this._typeId=a.Port.TYPE_STRING;else this._typeId=a.Port.TYPE_VALUE;if(n)this._isTexture=n.uiAttribs.objType==="texture";this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.on("uiErrorChange",this._updateTitle.bind(this));this._op.patch.on("variableRename",this._renameVar.bind(this));this._op.patch.on("variableDeleted",e=>{if(this._op.isCurrentUiOp())this._op.refreshParams()});i.setUiAttribs({_variableSelect:true});i.setUiAttribs({_variableSelectGet:true});this._varnamePort.onChange=this._changeVar.bind(this);this._op.patch.addEventListener("variablesChanged",this._init.bind(this));this._op.onDelete=()=>{if(this._variable&&this._listenerId)this._variable.off(this._listenerId)};this._op.init=()=>{this._init()}}get variable(){return this._variable}_changeVar(){if(this._variable&&this._listenerId){this._variable.off(this._listenerId)}this._init()}_renameVar(e,t){if(e!=this._varnamePort.get())return;this._varnamePort.set(t);this._updateVarNamesDropdown();this._updateTitle();this._listenerId=this._variable.on("change",this._setValueOut.bind(this))}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded){const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._op.varName.uiAttribs.values=t}}_setValueOut(e){if(this._valueOutPort)if(this._typeId==a.Port.TYPE_NUMBER||this._typeId==a.Port.TYPE_STRING)this._valueOutPort.set(e);else if(this._typeId==a.Port.TYPE_ARRAY||this._typeId==a.Port.TYPE_OBJECT||this._isTexture)this._valueOutPort.setRef(e);else console.log("unkown type?")}_updateTitle(){if(this._variable){this._op.setUiError("unknownvar",null);this._op.setTitle("var get");this._op.setUiAttrib({extendTitle:"#"+this._varnamePort.get()});if(this._valueOutPort)this._setValueOut(this._variable.getValue())}else{this._op.setUiError("unknownvar","unknown variable! - there is no setVariable with this name ("+this._varnamePort.get()+")");this._op.setUiAttrib({extendTitle:"#invalid"});if(this._valueOutPort)this._setValueOut(0)}}_init(){this._updateVarNamesDropdown();if(this._variable&&this._listenerId)this._variable.off(this._listenerId);this._variable=this._op.patch.getVar(this._op.varName.get());if(this._variable)this._listenerId=this._variable.on("change",this._setValueOut.bind(this));this._updateTitle();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varnamePort.get())}}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var t={};(()=>{"use strict";n.r(t);n.d(t,{ShaderModifier:()=>e});class e{constructor(e,t,i){this._cgl=e;this._name=t;this._origShaders={};this._uniforms=[];this._structUniforms=[];this._definesToggled={};this._defines={};this._mods=[];this._textures=[];this._boundShader=null;this._changedDefines=true;this._changedUniforms=true;this._modulesChanged=false;this.needsTexturePush=false;this._lastShader=null;this._attributes=[];if(i&&i.opId)this.opId=i.opId;if(this._cgl.glVersion==1){this._cgl.enableExtension("OES_texture_float");this._cgl.enableExtension("OES_texture_float_linear");this._cgl.enableExtension("OES_texture_half_float");this._cgl.enableExtension("OES_texture_half_float_linear")}}bind(e,t){const i=e||this._cgl.getShader();if(!i)return;this._boundShader=this._origShaders[i.id];let n=false;if(this._boundShader&&this._lastShader!=this._boundShader.shader){if(!this._boundShader.shader.hasModule(this._mods[0].id))n=true}if(n||!this._boundShader||i.lastCompile!=this._boundShader.lastCompile||this._modulesChanged||i.needsRecompile()){if(this._boundShader)this._boundShader.shader.dispose();if(i.needsRecompile())i.compile();this.needsTexturePush=true;this._boundShader=this._origShaders[i.id]={lastCompile:i.lastCompile,orig:i,shader:i.copy()};this._addModulesToShader(this._boundShader.shader);this._updateDefinesShader(this._boundShader.shader);this._updateUniformsShader(this._boundShader.shader)}this._boundShader.wireframe=i.wireframe;if(this._changedDefines)this._updateDefines();if(this._changedUniforms)this._updateUniforms();if(t!==false)this._cgl.pushShader(this._boundShader.shader);this._boundShader.shader.copyUniformValues(this._boundShader.orig);if(this.needsTexturePush){for(let e=0;e<this._textures.length;e++){const r=this._textures[e][0];const s=this._textures[e][1];const a=this._textures[e][2];if(this._getUniform(r)){const o=this.getPrefixedName(r);const l=this._boundShader.shader.getUniform(o);if(l)this._boundShader.shader.pushTexture(l,s,a)}}this.needsTexturePush=false;this._textures.length=0}this._modulesChanged=false;this._boundShader.shader.fromMod=this;if(this.onBind)this.onBind(this._boundShader.shader);return this._boundShader.shader}unbind(e){if(this._boundShader){if(e!==false)this._cgl.popShader()}this._boundShader=null}_addModulesToShader(t){let i;if(this._mods.length>1)i=this._mods[0];for(let e=0;e<this._mods.length;e++)t.addModule(this._mods[e],i)}_removeModulesFromShader(e){for(const t in this._origShaders)this._origShaders[t].shader.removeModule(e)}addModule(e){this._mods.push(e);this._modulesChanged=true}removeModule(t){const i=[];let n=false;for(let e=0;e<this._mods.length;e++){if(this._mods[e].title==t){n=true;this._removeModulesFromShader(this._mods[e]);i.push(e)}}for(let e=i.length-1;e>=0;e-=1)this._mods.splice(i[e],1);this._modulesChanged=true}_updateUniformsShader(n){for(let e=0;e<this._uniforms.length;e++){const t=this._uniforms[e];const i=this.getPrefixedName(t.name);if(!n.hasUniform(i)&&!t.structName){let e=null;if(t.shaderType==="both"){e=n.addUniformBoth(t.type,i,t.v1,t.v2,t.v3,t.v4);e.comment="mod: "+this._name}else if(t.shaderType==="frag"){e=n.addUniformFrag(t.type,i,t.v1,t.v2,t.v3,t.v4);e.comment="mod: "+this._name}else if(t.shaderType==="vert"){e=n.addUniformVert(t.type,i,t.v1,t.v2,t.v3,t.v4);e.comment="mod: "+this._name}}}for(let i=0;i<this._structUniforms.length;i+=1){const r=this._structUniforms[i];let e=r.uniformName;let t=r.structName;const s=r.members;e=this.getPrefixedName(r.uniformName);t=this.getPrefixedName(r.structName);if(r.shaderType==="frag"){n.addUniformStructFrag(t,e,s)}if(r.shaderType==="vert"){n.addUniformStructVert(t,e,s)}if(r.shaderType==="both"){n.addUniformStructBoth(t,e,s)}}}_updateUniforms(){for(const e in this._origShaders)this._updateUniformsShader(this._origShaders[e].shader);this._changedUniforms=false}_setUniformValue(e,t,i){const n=e.getUniform(t);if(n)n.setValue(i)}setUniformValue(e,t){const i=this._getUniform(e);if(!i)return;const n=this.getPrefixedName(e);for(const r in this._origShaders){this._setUniformValue(this._origShaders[r].shader,n,t)}}hasUniform(e){return this._getUniform(e)}_getUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].name==t)return this._uniforms[e];if(this._uniforms[e].structName){if(this._uniforms[e].propertyName==t)return this._uniforms[e]}}return false}_getStructUniform(t){for(let e=0;e<this._structUniforms.length;e+=1)if(this._structUniforms[e].uniformName===t)return this._structUniforms[e];return null}_isStructUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].name==t)return false;if(this._uniforms[e].structName){if(this._uniforms[e].propertyName==t)return true}}return false}addUniform(t,i,n,r,s,a,o,l,u,h){if(!this._getUniform(i)){let e="both";if(h)e=h;this._uniforms.push({type:t,name:i,v1:n,v2:r,v3:s,v4:a,structUniformName:o,structName:l,propertyName:u,shaderType:e});this._changedUniforms=true}}addUniformFrag(e,t,i,n,r,s){this.addUniform(e,t,i,n,r,s,null,null,null,"frag");this._changedUniforms=true}addUniformVert(e,t,i,n,r,s){this.addUniform(e,t,i,n,r,s,null,null,null,"vert");this._changedUniforms=true}addUniformBoth(e,t,i,n,r,s){this.addUniform(e,t,i,n,r,s,null,null,null,"both");this._changedUniforms=true}addUniformStruct(t,i,n,r){for(let e=0;e<n.length;e+=1){const s=n[e];if((s.type==="2i"||s.type==="i"||s.type==="3i")&&r==="both")console.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",s.name," of type:",s.type,".");if(!this._getUniform(i+"."+s.name)){this.addUniform(s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name,r)}}if(!this._getStructUniform(i)){this._structUniforms.push({structName:t,uniformName:i,members:n,shaderType:r})}}addUniformStructVert(e,t,i){this.addUniformStruct(e,t,i,"vert")}addUniformStructFrag(e,t,i){this.addUniformStruct(e,t,i,"frag")}addUniformStructBoth(e,t,i){this.addUniformStruct(e,t,i,"both")}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t)}pushTexture(e,t,i){if(!t)throw new Error("no texture given to texturestack");this._textures.push([e,t,i]);this.needsTexturePush=true}_removeUniformFromShader(e,t){if(t.hasUniform(e))t.removeUniform(e)}removeUniform(t){if(this._getUniform(t)){for(let e=this._uniforms.length-1;e>=0;e-=1){const i=t;if(this._uniforms[e].name==t&&!this._uniforms[e].structName){for(const n in this._origShaders){this._removeUniformFromShader(this.getPrefixedName(i),this._origShaders[n].shader)}this._uniforms.splice(e,1)}}this._changedUniforms=true}}removeUniformStruct(t){if(this._getStructUniform(t)){for(let e=this._structUniforms.length-1;e>=0;e-=1){const i=this._structUniforms[e];if(i.uniformName===t){for(const n in this._origShaders){for(let e=0;e<i.members.length;e+=1){const r=i.members[e];this._removeUniformFromShader(this.getPrefixedName(r.name),this._origShaders[n].shader)}}this._structUniforms.splice(e,1)}}this._changedUniforms=true}}getPrefixedName(e){const t=this._mods[0].group;if(t===undefined){return}if(e.startsWith("MOD_")){e=e.substr("MOD_".length);e="mod"+t+"_"+e}return e}_updateDefinesShader(t){for(const e in this._defines){const i=this.getPrefixedName(e);if(this._defines[e]!==null&&this._defines[e]!==undefined)t.define(i,this._defines[e]);else t.removeDefine(i)}for(const e in this._definesToggled){const i=this.getPrefixedName(e);t.toggleDefine(i,this._definesToggled[e])}}_updateDefines(){for(const e in this._origShaders)this._updateDefinesShader(this._origShaders[e].shader);this._changedDefines=false}define(e,t){if(t===undefined)t=true;this._defines[e]=t;this._changedDefines=true}removeDefine(e){this._defines[e]=null;this._changedDefines=true}hasDefine(e){if(this._defines[e]!==null&&this._defines[e]!==undefined)return true;return false}toggleDefine(e,t){this._changedDefines=true;this._definesToggled[e]=t}currentShader(){if(!this._boundShader)return null;return this._boundShader.shader}dispose(){}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var i in t)e[i]=t[i];if(t.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{WireframeCube:()=>e,WireframeRect:()=>t});class e{constructor(e){this.cgl=e;this.geom=new CGL.Geometry("marker");this.geom.setPointVertices([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,1,1,-1,1,-1,1,1,-1,-1,1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1]);this.mesh=new CGL.Mesh(this.cgl,this.geom,this.cgl.gl.LINES);this.mesh.setGeom(this.geom);this.colorShader=new CGL.UniColorShader(this.cgl);this.colorShader.setColor([0,1,1,1]);this._vScale=vec3.create()}render(e,t,i){this.cgl.pushModelMatrix();this.cgl.pushShader(this.colorShader.shader);this.cgl.pushDepthTest(false);if(e==undefined)e=1;if(t==undefined)t=e;if(i==undefined)i=e;vec3.set(this._vScale,e,t,i);mat4.scale(this.cgl.mvMatrix,this.cgl.mvMatrix,this._vScale);this.mesh.render(this.cgl.getShader());this.cgl.popDepthTest();this.cgl.popShader();this.cgl.popModelMatrix()}}class t{constructor(e){this.cgl=e;this.geom=new CGL.Geometry("marker");const t=-1;const i=1;this.geom.setPointVertices([t,t,0,i,t,0,i,t,0,i,i,0,i,i,0,t,i,0,t,i,0,t,t,0]);this.mesh=new CGL.Mesh(this.cgl,this.geom,this.cgl.gl.LINES);this.mesh.setGeom(this.geom);this.colorShader=new CGL.UniColorShader(this.cgl);this.colorShader.setColor([0,1,1,1]);this._vScale=vec3.create()}render(e,t,i){this.cgl.pushModelMatrix();this.cgl.pushShader(this.colorShader.shader);this.cgl.pushDepthTest(false);vec3.set(this._vScale,e||1,t||e||1,i||e||1);mat4.scale(this.cgl.mvMatrix,this.cgl.mvMatrix,this._vScale);this.mesh.render(this.cgl.getShader());this.cgl.popDepthTest();this.cgl.popShader();this.cgl.popModelMatrix()}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{SubPatchOp:()=>e});const t=CABLES;class e{constructor(i,e){e=e||{};this._op=i;i.patchId=i.addInPort(new t.Port(i,"patchId",t.CONSTANTS.OP.OP_PORT_TYPE_STRING,{display:"readonly",hidePort:true,hideParam:true}));i.setUiAttribs({subPatchOp:{version:2}});if(i.uiAttribs.parentOfSubpatch){i.patchId.set(i.uiAttribs.parentOfSubpatch)}else{if(e.subId)i.patchId.set(e.subId);else i.patchId.set(t.utils.generateUUID())}i.patchId.onChange=()=>{if(e.subId)i.patchId.value=e.subId};i.init=()=>{i.setStorage({subPatchVer:2})};i.loadDependencies=(e,t)=>{if(CABLES.UI){gui.serverOps.loadProjectDependencies(e,()=>{if(t)t()})}else if(t)t()};i.on("delete",()=>{if(i.patch.clearSubPatchCache)i.patch.clearSubPatchCache(this.patchId);const t=i.patch.ops;for(let e=t.length-1;e>=0;e--)if(t[e]&&t[e].uiAttribs&&t[e].uiAttribs.subPatch==i.patchId.get())i.patch.deleteOp(t[e].id)});this._op.isExposableSubpatchOp=()=>{return true}}get patchId(){return this._op.patchId.get()}}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var Z={};(()=>{Z.d=(e,t)=>{for(var i in t){if(Z.o(t,i)&&!Z.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{Z.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{Z.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var J={};(()=>{"use strict";Z.r(J);Z.d(J,{CopyTexture:()=>Q});const E=CABLES;const h=CABLES.SHARED;const t=8;class i{constructor(e={}){this.id=E.utils.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||i.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=t;if(!e.height)e.height=t}}i.getDefaultTextureData=(e,s,a={})=>{if(e=="empty"){return new Uint8Array(s*s*4).fill(0)}else if(e=="color"){const r=new Uint8Array(s*s*4);let t=a.r||1;let i=a.g||1;let n=a.b||1;for(let e=0;e<s*s;e++){r[e*4+0]=t;r[e*4+1]=i;r[e*4+2]=n;r[e*4+3]=255}return r}else if(e=="randomUInt"){const r=new Uint8Array(s*s*4);for(let e=0;e<s*s;e++){r[e*4+0]=Math.random()*255;r[e*4+1]=Math.random()*255;r[e*4+2]=Math.random()*255;r[e*4+3]=255}return r}else if(e=="random"||e=="randomFloat"){const r=new Float32Array(s*s*4);for(let e=0;e<s*s;e++){r[e*4+0]=(Math.random()-.5)*2;r[e*4+1]=(Math.random()-.5)*2;r[e*4+2]=(Math.random()-.5)*2;r[e*4+3]=1}return r}else if(e=="stripes"){const o=[];let i=a.r;let n=a.g;let r=a.b;if(i===undefined)i=1;if(n===undefined)n=1;if(r===undefined)r=1;for(let t=0;t<s;t++){for(let e=0;e<s;e++){if((e+t)%64<32){o.push((200+t/s*25+e/s*25)*i);o.push((200+t/s*25+e/s*25)*n);o.push((200+t/s*25+e/s*25)*r)}else{o.push((40+t/s*25+e/s*25)*i);o.push((40+t/s*25+e/s*25)*n);o.push((40+t/s*25+e/s*25)*r)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return i.getDefaultTextureData("stripes",s,{r:1,g:0,b:0})}};i.FILTER_NEAREST=0;i.FILTER_LINEAR=1;i.FILTER_MIPMAP=2;i.WRAP_REPEAT=0;i.WRAP_MIRRORED_REPEAT=1;i.WRAP_CLAMP_TO_EDGE=2;i.TYPE_DEFAULT=0;i.TYPE_DEPTH=1;i.TYPE_FLOAT=2;i.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";i.PFORMATSTR_R8UB="R 8bit ubyte";i.PFORMATSTR_RG8UB="RG 8bit ubyte";i.PFORMATSTR_RGB8UB="RGB 8bit ubyte";i.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";i.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";i.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";i.PFORMATSTR_R16F="R 16bit float";i.PFORMATSTR_RG16F="RG 16bit float";i.PFORMATSTR_RGB16F="RGB 16bit float";i.PFORMATSTR_RGBA16F="RGBA 16bit float";i.PFORMATSTR_R32F="R 32bit float";i.PFORMATSTR_RG32F="RG 32bit float";i.PFORMATSTR_RGB32F="RGB 32bit float";i.PFORMATSTR_RGBA32F="RGBA 32bit float";i.PFORMATSTR_DEPTH="DEPTH";i.PIXELFORMATS=[i.PFORMATSTR_RGB565,i.PFORMATSTR_R8UB,i.PFORMATSTR_RG8UB,i.PFORMATSTR_RGB8UB,i.PFORMATSTR_RGBA8UB,i.PFORMATSTR_SRGBA8,i.PFORMATSTR_R11FG11FB10F,i.PFORMATSTR_R16F,i.PFORMATSTR_RG16F,i.PFORMATSTR_RGBA16F,i.PFORMATSTR_R32F,i.PFORMATSTR_RGBA32F];const n=8;const a=new h.Logger("cgl_texture");class u extends i{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new h.Logger("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=u.FILTER_NEAREST;this.wrap=u.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=u.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=u.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=u.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=u.PFORMATSTR_RGBA32F;if(this.textureType==u.TYPE_DEPTH)this.pixelFormat=u.PFORMATSTR_DEPTH;this._cgl.profileData.profileTextureNew++;this.setFormat(u.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return u.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new u(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=n;if(t!=t||t<=0||!t)t=n;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(u.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.profileTextureResize++;const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,n,r){this.filter=n;this.wrap=r;if(n==undefined)this.filter=u.FILTER_LINEAR;if(r==undefined)this.wrap=u.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const s=CGL.Texture.getTempTexture(this._cgl);this.width=s.width;this.height=s.height;this.tex=s.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(u.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==u.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.profileGenMipMap++}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(u.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.profileTextureDelete++;this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return u.isPowerOfTwo(this.width)&&u.isPowerOfTwo(this.height)}printInfo(){a.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===u.FILTER_NEAREST)e+=" nearest";if(this.filter===u.FILTER_LINEAR)e+=" linear";if(this.filter===u.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===u.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===u.WRAP_REPEAT)e+=" repeat";if(this.wrap===u.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return u.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==u.TYPE_FLOAT&&this.filter==u.FILTER_MIPMAP){this.filter=u.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=u.FILTER_NEAREST;this.wrap=u.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==u.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==u.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==u.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==u.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==u.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==u.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}u.load=function(i,n,r,e){if(!n)return r({error:true});let s=null;if(!i.patch.loading.existByName(n))s=i.patch.loading.start("cgl.texture",n);const a=new u(i);a.name=n;a.image=new Image;a.image.crossOrigin="anonymous";a.loading=true;if(e&&e.hasOwnProperty("filter"))a.filter=e.filter;if(e&&e.hasOwnProperty("flip"))a.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))a.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))a.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))a.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))a.pixelFormat=e.pixelFormat;a.image.onabort=a.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",n,e);a.loading=false;if(s)i.patch.loading.finished(s);const t={error:true};if(r)r(t,a)};a.image.onload=function(e){i.addNextFrameOnceCallback(()=>{a.initTexture(a.image);if(s)i.patch.loading.finished(s);a.loading=false;if(r)r(null,a)})};a.image.src=n;return a};u.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=u.getTemporaryTexture(e,256,u.FILTER_LINEAR,u.REPEAT);return e.tempTexture};u.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=u.getTemporaryTexture(e,256,u.FILTER_LINEAR,u.REPEAT,1,.2,.2);return e.errorTexture};u.getEmptyTexture=function(e,t){if(t)return u.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new u(e,{name:"emptyTexture"});const n=u.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(n,i,i,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.tempTextureEmpty};u.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new u(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.tempTextureEmptyFloat};u.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=u.getDefaultTextureData("randomUInt",t);e.randomTexture=new u(e);e.randomTexture.initFromData(i,t,t,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.randomTexture};u.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=u.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new u(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.getRandomFloatTexture};u.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=u.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new u(e);e.blackTexture.initFromData(i,t,t,u.FILTER_NEAREST,u.WRAP_REPEAT);return e.blackTexture};u.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const n=t.gl.TEXTURE_CUBE_MAP;const r=u.FILTER_NEAREST;const s=u.WRAP_CLAMP_TO_EDGE;const a=8;const o=8;t.profileData.profileTextureNew++;t.gl.bindTexture(n,e);t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(n,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(n,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(n,null);return{id:E.utils.uuid(),tex:e,cubemap:e,width:a,height:o,filter:r,wrap:s,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};u.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return u.getTempTexture(e)};u.getTemporaryTexture=function(e,t,i,n,r,s,a){const o=u.getDefaultTextureData("stripes",256,{r:r,g:s,b:a});const l=new u(e);l.initFromData(o,t,t,i,n);return l};u.createFromImage=function(e,t,i){i=i||{};const n=new u(e,i);n.flip=false;n.image=t;n.width=t.videoWidth||t.width||8;n.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))n.wrap=i.wrap;n.initTexture(t,i.filter);return n};u.fromImage=function(e,t,i,n){console.error("deprecated texture from image...");const r=new u(e);r.flip=false;if(i)r.filter=i;if(n)r.wrap=n;r.image=t;r.initTexture(t);return r};u.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};u.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==u.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==u.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==u.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==u.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==u.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==u.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==u.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==u.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==u.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==u.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};u.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=u.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let n=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==u.PFORMATSTR_RGBA32F)t=u.PFORMATSTR_RGBA16F;if(t==u.PFORMATSTR_RG32F)t=u.PFORMATSTR_RG16F;if(t==u.PFORMATSTR_R32F)t=u.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const r=e.enableExtension("EXT_color_buffer_half_float");if(!r){console.warn("no 16bit extension, fallback to 32bit",t);if(t==u.PFORMATSTR_RGBA16F)t=u.PFORMATSTR_RGBA32F;if(t==u.PFORMATSTR_RGB16F)t=u.PFORMATSTR_RGB32F;if(t==u.PFORMATSTR_RG16F)t=u.PFORMATSTR_RG32F;if(t==u.PFORMATSTR_R16F)t=u.PFORMATSTR_R32F}else{n=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==u.PFORMATSTR_RGBA16F||t==u.PFORMATSTR_RG16F||t==u.PFORMATSTR_R16F){const s=e.enableExtension("OES_texture_half_float");if(!s)throw new Error("no half float texture extension");n=s.HALF_FLOAT_OES}}if(t==u.PFORMATSTR_RGBA8UB){}else if(t==u.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==u.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==u.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==u.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==u.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==u.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=n}else if(t==u.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=n;i.glDataFormat=e.gl.RED}else if(t==u.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=n;i.glDataFormat=e.gl.RG}else if(t==u.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=n}else if(t==u.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=n;i.glDataFormat=e.gl.RGB}else if(t==u.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=n}else if(t==u.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{a.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==u.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=u.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)a.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};u.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};u.isPixelFormatFloat=e=>{return(e||"").includes("float")};u.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")};class e{constructor(t,e,i,n){this._log=new h.Logger("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=n||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=u.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=u.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!n.pixelFormat){if(n.isFloatingPointTexture)this._options.pixelFormat=u.PFORMATSTR_RGBA32F;else this._options.pixelFormat=u.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new u(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let r=u.FILTER_NEAREST;if(this._options.shadowMap)r=u.FILTER_LINEAR;const s=512;if(this._options.depth){this._textureDepth=new u(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:r,shadowMap:this._options.shadowMap||false,width:e||s,height:i||s})}if(t.aborted)return;this.setSize(e||s,i||s);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const n=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const a=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,a);const o=u.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=u.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=u.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,a);this._colorRenderbuffers[i]=a}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let r=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)r=this._cgl.gl.DEPTH_COMPONENT16;if(n){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const s=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(s!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(s){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",s,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+s)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.profileFramebuffer++;if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==u.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const r=function(e){this.draw=function(e,t,i){}};const s=function(e){this.render=function(e,t){}};const o=function(e){this.render=function(e,t,i,n){}};class l{constructor(e,t,i,n,r,s,a,o,l,u){this._log=new h.Logger("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=u;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof n=="object"&&n instanceof E.Port){this._port=n;this._value=this._port.get();if(r&&s&&a){if(!(r instanceof E.Port)||!(s instanceof E.Port)||!(a instanceof E.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=r;this._port3=s;this._port4=a;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(r&&s){if(!(r instanceof E.Port)||!(s instanceof E.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=r;this._port3=s;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(r){if(!(r instanceof E.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=r;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=n;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}class c extends l{constructor(e,t,i,n,r,s,a,o,l,u){super(e,t,i,n,r,s,a,o,l,u);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new c(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return c.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.profileUniformCount++}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.profileUniformCount++}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.profileUniformCount++;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}c.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)};const f={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const d={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const g=180/Math.PI;const m=Math.PI/180;const p={MATH:{DEG2RAD:m,RAD2DEG:g},SHADER:f,BLEND_MODES:d};const x="\n";class _{_name="unknown";constructor(){}}const O={};O.lastMesh=null;class b extends _{#cgl=null;#geom=null;#bufVerticesIndizes=null;constructor(e,t,i={}){super();this.#cgl=e;let n=i||{};if(E.utils.isNumeric(n))n={glPrimitive:i};this._log=new h.Logger("cgl_mesh");this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this._indexType=this.#cgl.gl.UNSIGNED_SHORT;this._attributes=[];this._attribLocs={};this._lastShader=null;this._numInstances=0;this._glPrimitive=n.glPrimitive;this.opId=n.opId||"";this._preWireframeGeom=null;this.addVertexNumbers=false;this.feedBackAttributes=[];this.setGeom(t);this._feedBacks=[];this._feedBacksChanged=false;this._transformFeedBackLoc=-1;this._lastAttrUpdate=0;this.memFreed=false;this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name);this._queryExt=null}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(p.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,n,r){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:n,offset:r,instanced:t==p.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,n){if(!e)return;if(!i&&!n)return;if(!e.name)this._log.stack("no attrname?!");const r=this.#cgl.gl;r.bindBuffer(r.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=n-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=n-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(n>t.length&&!this.warned){this.warned=true;this._log.warn(this.#cgl.canvas.id+" "+e.name+" buffersubdata out of bounds ?",t.length,n,i,e);return}r.bufferSubData(r.ARRAY_BUFFER,i*4,t,i,n-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame){console.log("_bufferArray",e.length,t.name)}if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,n){this.setAttribute(e,t,i,n)}setAttribute(e,t,i,n={}){if(!t){this._log.error("mesh addAttribute - no array given! "+e);throw new Error}let r=null;let s=false;let a=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof n=="function"){r=n}if(typeof n=="object"){if(n.cb)r=n.cb;if(n.instanced)s=n.instanced}if(e==p.SHADER.SHADERVAR_INSTANCE_MMATRIX)s=true;for(a=0;a<this._attributes.length;a++){const h=this._attributes[a];if(h.name==e){if(h.numItems===o){}else{this._resizeAttr(t,h)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,h.buffer);this._bufferArray(t,h);return h}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let u=this.#cgl.gl.FLOAT;if(n&&n.type)u=n.type;const h={buffer:l,name:e,cb:r,itemSize:i,numItems:o,startItem:0,instanced:s,type:u};this._bufferArray(t,h);if(e==p.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=h;this._attributes.push(h);this._attribLocs={};return h}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(p.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(p.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(p.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(p.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(p.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new c(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this._log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this._log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this._log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this._indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;O.lastMesh=null;this.#cgl.profileData.profileMeshSetGeom++;this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const n={texCoords:p.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:p.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:p.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const r in i)if(i[r].data&&i[r].data.length)this.setAttribute(n[r]||r,i[r].data,i[r].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const n=this._attributes[e];if(i[e]==-1){if(n._attrLocationLastShaderTime!=t.lastCompile){n._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),n.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,n.buffer);if(n.instanced){if(n.itemSize<=4){if(!n.itemSize||n.itemSize==0)this._log.warn("instanced attrib itemsize error",this.#geom.name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(n.itemSize==16){const r=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,n.type,false,r,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,n.type,false,r,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,n.type,false,r,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,n.type,false,r,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this._log.warn("unknown instance attrib size",n.name)}}else{if(!n.itemSize||n.itemSize==0)this._log.warn("attrib itemsize error",this._name,n);this.#cgl.gl.vertexAttribPointer(i[e],n.itemSize,n.type,false,n.itemSize*4,0);if(n.pointer){for(let e=0;e<n.pointer.length;e++){const s=n.pointer[e];if(s.loc==-1)s.loc=this.#cgl.glGetAttribLocation(t.getProgram(),s.name);this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(s.loc);this.#cgl.gl.vertexAttribPointer(s.loc,n.itemSize,n.type,false,s.stride,s.offset)}}if(this.bindFeedback)this.bindFeedback(n)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;O.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(O.lastMesh!=this){if(O.lastMesh)O.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();O.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==undefined)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let n=1;let r=this.#cgl.profileData.doProfileGlQuery;let s=false;if(r){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const a=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(a){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);s=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)n=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this._indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this._indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame&&this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this._log.error("mesh draw gl error");this._log.error("mesh",this);this._log.error("shader",i);const u=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const h=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this._log.error("attrib ",h)}}this.#cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/n*(this._numInstances||1);this.#cgl.profileData.profileMeshDraw++;if(r&&s){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(p.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}const U=CABLES.GLMatrix;class v{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyGeom(t){if(!t)return;if(t instanceof v){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ)}else{if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2])}this.calcCenterSize()}copy(){return new v(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!E.utils.isNumeric(e)||!E.utils.isNumeric(t)||!E.utils.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}U.vec3.transformMat4(this._max,this._max,e);U.vec3.transformMat4(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();U.mat4.translate(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}class A{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new h.Logger("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let n="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)n="float";else if(i==2)n="vec2";else if(i==3)n="vec3";else if(i==4)n="vec4";const r={name:e,data:t,itemSize:i,type:n};this._attributes[e]=r}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,n){let r=U.vec3.create();if(t==undefined)t=1;if(i==undefined)i=1;if(n==undefined)n=1;for(let e=0;e<this.vertexNormals.length;e+=3){U.vec3.set(r,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);r[0]*=-t;r[1]*=-i;r[2]*=-n;U.vec3.normalize(r,r);this.vertexNormals[e+0]=r[0];this.vertexNormals[e+1]=r[1];this.vertexNormals[e+2]=r[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const n=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+n;this.vertices=E.utils.float32Concat(this._vertices,t.vertices);this.texCoords=E.utils.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=E.utils.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=E.utils.float32Concat(this.tangents,t.tangents);this.biTangents=E.utils.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new A(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=U.vec3.create();const n=U.vec3.create();const r=U.vec3.create();function s(e){U.vec3.subtract(i,e[0],e[1]);U.vec3.subtract(n,e[0],e[2]);U.vec3.cross(r,i,n);U.vec3.normalize(r,r);if(t&&t.forceZUp){if(r[2]<0){r[0]*=-1;r[1]*=-1;r[2]*=-1}}return r}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const a=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=s(o);a.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=a}else{const u=[];u.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];u[e/3]=s(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=u[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const h=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];U.vec3.normalize(h,h);this.vertexNormals[this.verticesIndices[t+e]*3+0]=h[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=h[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=h[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const A=this.vertices.length/3*2;this.texCoords=new Float32Array(A);for(let e=0;e<A;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const n=[];n.length=i*2;const r=U.vec3.create();const s=U.vec3.create();const a=U.vec3.create();const o=U.vec2.create();const l=U.vec2.create();const u=U.vec2.create();const h=U.vec3.create();const c=U.vec3.create();for(let e=0;e<t;e+=1){const T=this.verticesIndices[e*3];const E=this.verticesIndices[e*3+1];const x=this.verticesIndices[e*3+2];U.vec3.set(r,this.vertices[T*3],this.vertices[T*3+1],this.vertices[T*3+2]);U.vec3.set(s,this.vertices[E*3],this.vertices[E*3+1],this.vertices[E*3+2]);U.vec3.set(a,this.vertices[x*3],this.vertices[x*3+1],this.vertices[x*3+2]);U.vec2.set(o,this.texCoords[T*2],this.texCoords[T*2+1]);U.vec2.set(l,this.texCoords[E*2],this.texCoords[E*2+1]);U.vec2.set(u,this.texCoords[x*2],this.texCoords[x*2+1]);const O=s[0]-r[0];const I=a[0]-r[0];const S=s[1]-r[1];const y=a[1]-r[1];const C=s[2]-r[2];const R=a[2]-r[2];const N=l[0]-o[0];const M=u[0]-o[0];const P=l[1]-o[1];const w=u[1]-o[1];const L=1/(N*w-M*P);U.vec3.set(h,(w*O-P*I)*L,(w*S-P*y)*L,(w*C-P*R)*L);U.vec3.set(c,(N*I-M*O)*L,(N*y-M*S)*L,(N*R-M*C)*L);n[T]=h;n[E]=h;n[x]=h;n[T+i]=c;n[E+i]=c;n[x+i]=c}const f=U.vec3.create();const d=U.vec3.create();const g=U.vec3.create();const m=U.vec3.create();const p=U.vec3.create();const _=U.vec3.create();const b=U.vec3.create();const v=U.vec3.create();for(let e=0;e<i;e+=1){if(!n[e])continue;U.vec3.set(f,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);U.vec3.set(d,n[e][0],n[e][1],n[e][2]);const D=U.vec3.dot(f,d);U.vec3.scale(p,f,D);U.vec3.subtract(_,d,p);U.vec3.normalize(v,_);U.vec3.cross(b,f,d);const k=1;U.vec3.scale(g,v,1/k);U.vec3.cross(m,f,g);this.tangents[e*3+0]=g[0];this.tangents[e*3+1]=g[1];this.tangents[e*3+2]=g[2];this.biTangents[e*3+0]=m[0];this.biTangents[e*3+1]=m[1];this.biTangents[e*3+2]=m[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const n=[];let r=0;for(let e in this._attributes){const s=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(s.itemSize==3)i.push(s.data[this.verticesIndices[t+e]*3+0],s.data[this.verticesIndices[t+e]*3+1],s.data[this.verticesIndices[t+e]*3+2]);else if(s.itemSize==4)i.push(s.data[this.verticesIndices[t+e]*4+0],s.data[this.verticesIndices[t+e]*4+1],s.data[this.verticesIndices[t+e]*4+2],s.data[this.verticesIndices[t+e]*4+3]);else if(s.itemSize==2)i.push(s.data[this.verticesIndices[t+e]*2+0],s.data[this.verticesIndices[t+e]*2+1]);else if(s.itemSize==1)i.push(s.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",s)}}this.setAttribute(s.name,i,s.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);n.push(r);r++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);n.push(r);r++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=n;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new v(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let n=0;const r=this.getBounds();const s=[r.minX+(r.maxX-r.minX)/2,r.minY+(r.maxY-r.minY)/2,r.minZ+(r.maxZ-r.minZ)/2];for(n=0;n<this.vertices.length;n+=3){if(this.vertices[n+0]==this.vertices[n+0]){if(e)this.vertices[n+0]-=s[0];if(t)this.vertices[n+1]-=s[1];if(i)this.vertices[n+2]-=s[2]}}return s}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const n=this.vertices[e*3+0];const r=this.vertices[e*3+1];this.texCoords[e*2+0]=n/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-r/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}A.buildFromFaces=function(t,e,i){const n=[];const r=[];for(let e=0;e<t.length;e+=3){const a=t[e+0];const o=t[e+1];const l=t[e+2];const u=[-1,-1,-1];if(i)for(let e=0;e<n.length;e+=3){if(n[e+0]==a[0]&&n[e+1]==a[1]&&n[e+2]==a[2])u[0]=e/3;if(n[e+0]==o[0]&&n[e+1]==o[1]&&n[e+2]==o[2])u[1]=e/3;if(n[e+0]==l[0]&&n[e+1]==l[1]&&n[e+2]==l[2])u[2]=e/3}if(u[0]==-1){n.push(a[0],a[1],a[2]);u[0]=(n.length-1)/3}if(u[1]==-1){n.push(o[0],o[1],o[2]);u[1]=(n.length-1)/3}if(u[2]==-1){n.push(l[0],l[1],l[2]);u[2]=(n.length-1)/3}r.push(u[0]);r.push(u[1]);r.push(u[2])}const s=new A(e);s.name=e;s.vertices=n;s.verticesIndices=r;return s};const T={};T.getSimpleRect=function(e,t,i=1){const n=new A(t);n.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];n.texCoords=[1,1,0,1,1,0,0,0];n.verticesIndices=[0,1,2,2,1,3];n.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(n)};T.getSimpleCube=function(e,t){const i=new A(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new b(e,i)};class I{constructor(e,t){this._cgl=e;this._log=new h.Logger("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new u(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.profileTextureEffect++;if(this._textureTarget.filter==u.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=T.getSimpleRect(this._cgl,"texEffectRect")}}I.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};I.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};I.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};I.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};I.AddBlendSelect=function(e,t,i){const n=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return n};I.AddBlendAlphaMask=function(e,t,i){const n=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return n};I.setupBlending=function(i,n,r,e,s){const t=()=>{let e=false;if(s)e=s.get()=="On";I.onChangeBlendSelect(n,r.get(),e);let t=r.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[r,e,s]);let a=false;r.onChange=t;if(s){s.onChange=t;a=s.get()=="On"}I.onChangeBlendSelect(n,r.get(),a)};const S={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=I.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=I.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new c(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){u.getRandomTexture(e);e.setTexture(7,u.getRandomTexture(e).tex)}}};class D{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,n){this.coloruni.set(e,t,i,n)}}class k extends h.Events{id=E.utils.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=E.utils.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=E.utils.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=E.utils.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}const V=`
{{MODULES_HEAD}}
IN vec3 vPosition; //!@
IN vec2 attrTexCoord;
IN vec3 attrVertNormal;
IN vec3 attrTangent,attrBiTangent;

IN float attrVertIndex;

OUT vec2 texCoord;
OUT vec3 norm;
UNI mat4 projMatrix;
UNI mat4 viewMatrix;
UNI mat4 modelMatrix;

void main()
{
    texCoord=attrTexCoord;
    norm=attrVertNormal;
    vec4 pos=vec4(vPosition,  1.0);
    vec3 tangent=attrTangent;
    vec3 bitangent=attrBiTangent;
    mat4 mMatrix=modelMatrix;
    gl_PointSize=10.0;

    {{MODULE_VERTEX_POSITION}}

    mat4 modelViewMatrix=viewMatrix*mMatrix;
    {{MODULE_VERTEX_MODELVIEW}}

    gl_Position = projMatrix * modelViewMatrix * pos;
}
`;let F=0;function y(){return V}function C(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+x+"IN vec2 texCoord;"+x+"{{MODULES_HEAD}}"+x+"void main()"+x+"{"+x+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+x+"    {{MODULE_COLOR}}"+x+"    outColor = col;"+x+"}"}class R extends k{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new h.Logger("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++F;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=y();this.srcFrag=C();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=U.mat4.create();this._tempCamPosMatrix=U.mat4.create();this._tempInverseViewMatrix=U.mat4.create();this._tempInverseProjMatrix=U.mat4.create();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new R(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in S){if(e.includes(t)){const i=new S[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let n="";let r="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const a="struct "+this._uniforms[i]._structName+" {"+x+s+"};"+x+x;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")n=n.concat(a);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")r=r.concat(a);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(s);const l=r.lastIndexOf(s);n=n.slice(0,o)+t+n.slice(o-1);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=n.lastIndexOf(s);n=n.slice(0,o)+t+n.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=r.lastIndexOf(s);r=r.slice(0,l)+t+r.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+x;if(!this._uniDeclarationsFrag.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";n=n.replace(s,"");n+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+x;if(!this._uniDeclarationsVert.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(s,"");r+=i;this._uniDeclarationsVert.push(i)}}return[r,n]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+x;i.srcHeadVert+="#define ATTRIB_"+e.name+x;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+x;if(!t)i.srcHeadVert+="#endif"+x;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+x;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+x;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+x;if(!t)i.srcHeadVert+="#endif"+x;i.srcVert=""+x+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+x;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+x;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+x;if(!t)i.srcHeadFrag+="#endif"+x}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.profileShaderCompiles++;this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+x;let i="";if(this._defines.length)i="\n// cgl generated"+x;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+x;const n=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const p=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const b=this._uniforms[e];const v=p.indexOf(b._name,e+1);if(v>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+x;let r="";let s="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=y();this.srcFrag=C()}r="#version 300 es"+x+"// "+x+"// vertex shader "+this._name+x+"// "+x+"precision "+this.precision+" float;"+x+"precision "+this.precision+" sampler2D;"+x+""+x+"#define WEBGL2"+x+"#define texture2D texture"+x+"#define UNI uniform"+x+"#define IN in"+x+"#define OUT out"+x;s="#version 300 es"+x+"// "+x+"// fragment shader "+this._name+x+"// "+x+"precision "+this.precision+" float;"+x+"precision "+this.precision+" sampler2D;"+x+""+x+"#define WEBGL2"+x+"#define texture2D texture"+x+"#define IN in"+x+"#define OUT out"+x+"#define UNI uniform"+x+"{{DRAWBUFFER}}"+x;let a="\n// cgl generated"+x;let o="\n// cgl generated"+x;s+="\n// active mods: --------------- ";r+="\n// active mods: --------------- ";let l=false;let u=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;s+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){r+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";u=true}}}}if(!u)s+="\n// no mods used...";if(!l)s+="\n// no mods used...";s+="\n";r+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))a+=e+";"+t+x;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+x}}let h=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")h++}}if(h>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+h+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!s.includes("precision"))s="precision "+this.precision+" float;"+x+s;if(!r.includes("precision"))r="precision "+this.precision+" float;"+x+r;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){s+="#define MOBILE"+x;r+="#define MOBILE"+x}r=t+r+i+n[0]+a+"\n// -- \n"+this.srcVert;s=t+s+i+n[1]+o+"\n// -- \n"+this.srcFrag;let f="";let d="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let g=false;for(let n=0;n<this._moduleNames.length;n++){let t="";let i="";if(!g){g=true;for(let e=0;e<this._attributes.length;e++){const A=this._getAttrSrc(this._attributes[e],true);if(A.srcHeadVert)f+=A.srcHeadVert;if(A.srcVert)t+=A.srcVert;if(A.srcHeadFrag)d+=A.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const T=this._modules[e];if(T.name==this._moduleNames[n]){f+="\n//---- MOD: group:"+T.group+": idx:"+e+" - prfx:"+T.prefix+" - "+T.title+" ------\n";d+="\n//---- MOD: group:"+T.group+": idx:"+e+" - prfx:"+T.prefix+" - "+T.title+" ------\n";t+="\n\n//---- MOD: "+T.title+" / "+T.priority+" ------\n";i+="\n\n//---- MOD: "+T.title+" / "+T.priority+" ------\n";if(T.attributes)for(let e=0;e<T.attributes.length;e++){const A=this._getAttrSrc(T.attributes[e],false);if(A.srcHeadVert)f+=A.srcHeadVert;if(A.srcVert)t+=A.srcVert;if(A.srcHeadFrag)d+=A.srcHeadFrag}f+=T.srcHeadVert||"";d+=T.srcHeadFrag||"";t+=T.srcBodyVert||"";i+=T.srcBodyFrag||"";f+="\n//---- end mod ------\n";d+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,T.prefix);i=i.replace(/{{mod}}/g,T.prefix);f=f.replace(/{{mod}}/g,T.prefix);d=d.replace(/{{mod}}/g,T.prefix);t=t.replace(/MOD_/g,T.prefix);i=i.replace(/MOD_/g,T.prefix);f=f.replace(/MOD_/g,T.prefix);d=d.replace(/MOD_/g,T.prefix)}}r=r.replace("{{"+this._moduleNames[n]+"}}",t);s=s.replace("{{"+this._moduleNames[n]+"}}",i)}r=r.replace("{{MODULES_HEAD}}",f);s=s.replace("{{MODULES_HEAD}}",d);r=this._addLibs(r);s=this._addLibs(s);let m="";for(let e=0;e<16;e++)if(s.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){m="out vec4 outColor;"+x;m+="#define gl_FragColor outColor"+x}else{m+="#define MULTI_COLORTARGETS"+x;m+="vec4 outColor;"+x;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)m+="#define gl_FragColor outColor"+e+""+x;m+="layout(location = "+e+") out vec4 outColor"+e+";"+x;t++}}s=s.replace("{{DRAWBUFFER}}",m);if(!this._program){this._program=this._createProgram(r,s)}else{this._program=this._createProgram(r,s);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=s;this.finalShaderVert=r;O.lastMesh=null;O.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,E.now)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;O.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,p.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,p.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.profileShaderBinds++;this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.profileMVPMatrixCount++;this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){U.mat4.invert(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._inverseProjMatrixUniform){U.mat4.invert(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.profileMVPMatrixCount++}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.profileMVPMatrixCount++;if(this._camPosUniform){U.mat4.invert(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.profileMVPMatrixCount++}}else{const e=U.mat4.create();U.mat4.mul(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.profileMVPMatrixCount++}if(this._normalMatrixUniform){U.mat4.invert(this._tempNormalMatrix,this._cgl.mMatrix);U.mat4.transpose(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.profileMVPMatrixCount++}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,n,r,s){const a=new c(this,e,t,i,n,r,s);a.shaderType="frag";return a}addUniformVert(e,t,i,n,r,s){const a=new c(this,e,t,i,n,r,s);a.shaderType="vert";return a}addUniformBoth(e,t,i,n,r,s){const a=new c(this,e,t,i,n,r,s);a.shaderType="both";return a}addUniformStructFrag(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(!this.hasUniform(i+"."+s.name)){const a=new c(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="frag";r[i+"."+s.name]=a}}return r}addUniformStructVert(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(!this.hasUniform(i+"."+s.name)){const a=new c(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="vert";r[i+"."+s.name]=a}}return r}addUniformStructBoth(t,i,n){const r={};if(!n)return r;for(let e=0;e<n.length;e+=1){const s=n[e];if(s.type==="2i"||s.type==="i"||s.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",s.name," of type:",s.type,".");if(!this.hasUniform(i+"."+s.name)){const a=new c(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="both";r[i+"."+s.name]=a}}return r}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=R.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=R.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const n=this._cgl.gl.getShaderInfoLog(this.fshader);const r=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(n)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||u.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const n=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return n}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,n){return C(e,t,i,n)}getDefaultVertexShader(){return y()}}R.getDefaultVertexShader=y;R.getDefaultFragmentShader=C;R.getErrorFragmentShader=function(){return""+x+"void main()"+x+"{"+x+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+x+"   g= step(0.1,g);"+x+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+x+"}"};R.createShader=function(e,t,i,n){if(e.aborted)return;const r=e.gl.createShader(i);e.gl.shaderSource(r,t);e.gl.compileShader(r);if(!e.gl.getShaderParameter(r,e.gl.COMPILE_STATUS)){n.error={str:t,infoLog:e.gl.getShaderInfoLog(r)};if(CABLES.UI)gui.emitEvent("ShaderError",n);if(!n.error.infoLog){n._log.warn("empty shader info log",this._name);return}n.setSource(R.getDefaultVertexShader(),R.getErrorFragmentShader())}return r};const j=Math.PI/180;const B=180/Math.PI;const G=null;const z=window.navigator.userAgent.includes("Windows");const N=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(z)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const n=e||t.detail;i=-(n%3?n*10:n/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const H=N;const X=N;class M{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute=[];this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){this.counts={};this.profileSingleMeshAttribute={};this.profileMeshAttributes=0;this.profileUniformCount=0;this.profileShaderGetUniform=0;this.profileShaderCompiles=0;this.profileShaderBinds=0;this.profileTextureResize=0;this.profileFrameBuffercreate=0;this.profileEffectBuffercreate=0;this.profileTextureDelete=0;this.profileMeshSetGeom=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileNonTypedAttrib=0;this.profileNonTypedAttribNames="";this.profileTextureNew=0;this.profileGenMipMap=0;this.profileFramebuffer=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.profileMeshNumElements=0;this.profileFencedPixelRead=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t){this.counts[e]=this.counts[e]||[];this.counts[e].push(t)}addHeavyEvent(e,t,i){const n={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(n);this._cgl.emitEvent("heavyEvent",n)}}class P{constructor(){this._arr=[U.mat4.create()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const t=U.mat4.create();this._arr.push(t)}U.mat4.copy(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}class q{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new h.Logger("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(t,i,e=false){let n=0;if(this.forceAspect){let e=t/this.forceAspect;if(e<i)n=(i-e)/2;i=e}if(this._oldWidthRp!=t*this.pixelDensity||this._oldHeightRp!=i*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=t*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=i*this.pixelDensity;if(!e){this.canvasEle.style.width=t+"px";this.canvasEle.style.height=i+"px";this.canvasEle.style.marginTop=n+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}class Y extends h.Events{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,E.now)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,E.now)()-this.#timeStartFrame;this.#msCounter+=e;if((0,E.now)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,E.now)()}}class w extends h.Events{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";gApi=0;_textureslots=[];_pMatrixStack=new P;_mMatrixStack=new P;_vMatrixStack=new P;canvasScale=1;constructor(e){super();this._log=new h.Logger("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new Y;this._identView=U.vec3.create();this._ident=U.vec3.create();U.vec3.set(this._identView,0,0,-2);U.vec3.set(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new M(this);this.pMatrix=U.mat4.create();this.mMatrix=U.mat4.create();this.vMatrix=U.mat4.create();U.mat4.identity(this.mMatrix);U.mat4.identity(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new q({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;U.mat4.perspective(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);U.mat4.identity(this.mMatrix);U.mat4.identity(this.vMatrix);U.mat4.translate(this.mMatrix,this.mMatrix,e);U.mat4.translate(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,n){console.log("no screenshot function implemented")}saveScreenshot(i,n,e,t,r){this.patch.renderOneFrame();let s=this.canvas.clientWidth*this.pixelDensity;let a=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;s=e}if(t){this.canvas.height=t;a=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const u="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+u+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=s;this.canvas.height=a;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(n)n(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}const W={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class K extends w{#cursor="auto";constructor(e){super(e);this.gApi=w.API_WEBGL;this.aborted=false;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new h.Logger("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new R(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(R.getDefaultVertexShader(),R.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.error("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,n){this._viewPortStack.push(e,t,i,n);this.setViewPort(e,t,i,n)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,n){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(n);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,n){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,n)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(w.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(p.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;E.utils.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=u.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let n=this.gl.getError();if(n!=this.gl.NO_ERROR){let e="";if(n==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(n==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(n==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(n==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(n==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(n==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(n==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,n,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}n=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==p.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==p.BLEND_MODES.BLEND_NONE){}else if(e==p.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==p.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==p.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==p.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(E.utils.isNumeric(t))t={glPrimitive:t};return new b(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new R(this,"errormaterial");this.errorShader.setSource(R.getDefaultVertexShader(),R.getErrorFragmentShader());return this.errorShader}}const L={Framebuffer2:e,Geometry:A,BoundingBox:v,Marker:r,WirePoint:s,WireCube:o,MatrixStack:P,Mesh:b,MESH:O,ShaderLibMods:S,Shader:R,Uniform:c,MESHES:T,getWheelSpeed:H,getWheelDelta:X,Context:K,Texture:u,TextureEffect:I,onLoadingAssetsFinished:G,ProfileData:M,UniColorShader:D,...p.BLEND_MODES,...p.SHADER,...p.MATH,...p.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL=window.CABLES.CGL||L;window.CGL=window.CGL||L;E.Anim.slerpQuaternion=function(e,t,i,n,r,s){if(!E.Anim.slerpQuaternion.q1){E.Anim.slerpQuaternion.q1=quat.create();E.Anim.slerpQuaternion.q2=quat.create()}const a=i.getKeyIndex(e);let o=a+1;if(o>=i.keys.length)o=i.keys.length-1;if(a==o){quat.set(t,i.keys[a].value,n.keys[a].value,r.keys[a].value,s.keys[a].value)}else{const l=i.keys[a].time;const u=i.keys[o].time;const h=(e-l)/(u-l);quat.set(E.Anim.slerpQuaternion.q1,i.keys[a].value,n.keys[a].value,r.keys[a].value,s.keys[a].value);quat.set(E.Anim.slerpQuaternion.q2,i.keys[o].value,n.keys[o].value,r.keys[o].value,s.keys[o].value);quat.slerp(t,E.Anim.slerpQuaternion.q1,E.Anim.slerpQuaternion.q2,h)}return t};class Q{constructor(e,t,i){this.cgl=e;this._options=i;this.fb=null;let n=i.shader;this._useDefaultShader=true;if(i.shader)this._useDefaultShader=false;i.numRenderBuffers=i.numRenderBuffers||1;if(!n){n="".endl()+"IN vec2 texCoord;";for(let e=0;e<i.numRenderBuffers;e++){n=n.endl()+"UNI sampler2D tex"+e+";".endl()}n=n.endl()+"void main()".endl()+"{";if(i.numRenderBuffers==1){n=n.endl()+"    outColor= texture(tex0,texCoord);".endl()}else for(let e=0;e<i.numRenderBuffers;e++){n=n.endl()+"outColor"+e+" = texture(tex"+e+",texCoord);".endl()}n=n.endl()+"}"}const r=i.vertexShader||"".endl()+"IN vec3 vPosition;".endl()+"IN vec2 attrTexCoord;".endl()+"OUT vec2 texCoord;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   gl_Position = vec4(vPosition,  1.0);".endl()+"}";this.bgShader=new L.Shader(e,"corelib copytexture "+t);this.bgShader.setSource(r,n);if(!i.vertexShader)this.bgShader.ignoreMissingUniforms=true;new L.Uniform(this.bgShader,"t","tex",0);new L.Uniform(this.bgShader,"t","tex1",1);new L.Uniform(this.bgShader,"t","tex2",2);new L.Uniform(this.bgShader,"t","tex3",3);this.mesh=L.MESHES.getSimpleRect(this.cgl,"texEffectRect")}setSize(e,t){this._options.width=e;this._options.height=t}copy(e,t,i,n,r){const s=this.cgl;if(!e)e=L.Texture.getEmptyTexture(this.cgl);let a=this._options.width||e.width,o=this._options.height||e.height;if(this.fb){if(a<=0)a=8;if(o<=0)o=8;if(this.fb.getWidth()!=a||this.fb.getHeight()!=o)this.fb.setSize(a,o)}else{let e=L.Texture.FILTER_LINEAR;let t=L.Texture.WRAP_CLAMP_TO_EDGE;if(this._options.isFloatingPointTexture)e=L.Texture.FILTER_NEAREST;if(this._options.hasOwnProperty("filter"))e=this._options.filter;if(this._options.hasOwnProperty("wrap"))t=this._options.wrap;const l={isFloatingPointTexture:this._options.isFloatingPointTexture,pixelFormat:this._options.pixelFormat,numRenderBuffers:this._options.numRenderBuffers||1,filter:e,wrap:t};if(s.glVersion==1)this.fb=new L.Framebuffer(s,a,o,l);else this.fb=new L.Framebuffer2(s,a,o,l)}s.tempData.renderOffscreen=true;this.fb.renderStart(s);s.setTexture(0,e.tex);if(t)s.setTexture(1,t.tex);if(i)s.setTexture(2,i.tex);if(n)s.setTexture(3,n.tex);if(r)s.setTexture(4,r.tex);s.pushShader(this.bgShader);this.mesh.render(this.bgShader);s.popShader();this.fb.renderEnd();s.tempData.renderOffscreen=false;return this.fb.getTextureColor()}dispose(){if(this.fb)this.fb.dispose();if(this.bgShader)this.bgShader.dispose();if(this.mesh)this.mesh.dispose()}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in J)e[t]=J[t];if(J.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var n={};(()=>{n.d=(e,t)=>{for(var i in t){if(n.o(t,i)&&!n.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{n.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";n.r(i);n.d(i,{PixelReader:()=>t});const e=CABLES.SHARED;class t{constructor(){this._log=new e.Logger("LoadingStatus");this.pixelData=null;this._finishedFence=true;this._size=0;this._pbo=null}_fence(s){const a=s.gl;this._finishedFence=false;return new Promise(function(t,i){if(s.aborted)return;let n=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);if(!n)return;a.flush();function r(){if(s.aborted)return;const e=a.clientWaitSync(n,0,0);if(e==a.WAIT_FAILED){console.error("fence wait failed");if(i)i()}else if(e==a.TIMEOUT_EXPIRED){return setTimeout(r,0)}else if(e==a.CONDITION_SATISFIED){t();a.deleteSync(n)}else if(e==a.ALREADY_SIGNALED){t();a.deleteSync(n)}else{this._log.log("unknown fence status",e)}}r()})}read(i,n,e,r,s,a,o,t){if(CABLES.UI)if(!CABLES.UI.loaded||performance.now()-CABLES.UI.loadedTime<1e3)return;if(!this._finishedFence)return;const l=i.gl;let u=1;if(i.aborted)return;if(!n)return;if(e===CGL.Texture.TYPE_FLOAT)e=CGL.Texture.PFORMATSTR_RGBA32F;let h=CGL.Texture.isPixelFormatFloat(e);if(h)u=4;if(CGL.Texture.isPixelFormatHalfFloat(e))u=2;const c=CGL.Texture.setUpGlPixelFormat(i,e);const f=c.numColorChannels*a*o;if(a==0||o==0||f==0)return;if(!this._pixelData||this._size!=f*u){if(u>1)this._pixelData=new Float32Array(f);else this._pixelData=new Uint8Array(f);this._size=f*u}let d=l.UNSIGNED_BYTE;if(u>1)d=l.FLOAT;if(this._size==0||!this._pixelData){this._log.error("readpixel size 0",this._size,a,o);return}if(this._finishedFence){this._pbo=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);l.bufferData(l.PIXEL_PACK_BUFFER,this._pixelData.byteLength,l.DYNAMIC_READ);l.bindFramebuffer(l.FRAMEBUFFER,n);l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);i.profileData.profileFencedPixelRead++;if(this._size!=f*u)this._log.error("buffer size invalid",f,a,o,u);let e=c.glDataType;if(u>1)e=i.gl.FLOAT;let t=c.glDataFormat;l.readPixels(r,s,a,o,t,e,0);l.bindBuffer(l.PIXEL_PACK_BUFFER,null);l.bindFramebuffer(l.FRAMEBUFFER,null)}let g=this._pixelData.byteLength;if(this._finishedFence&&this._pbo)this._fence(i).then(e=>{this._wasTriggered=false;this._finishedFence=true;if(!e&&this._pixelData&&this._pixelData.byteLength==g){l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo);l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._pixelData);l.bindBuffer(l.PIXEL_PACK_BUFFER,null);if(t)t(this._pixelData)}l.deleteBuffer(this._pbo);this._pbo=null});return true}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();